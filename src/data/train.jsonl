{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: When to use []byte or string in Go?\n\nQuestion:\nFrequently in writing Go applications, I find myself with the choice to use []byte or string. Apart from the obvious mutability of []byte, how do I decide which one to use?\nI have several use cases for examples:\n\nA function returns a new []byte. Since the slice capacity is fixed, what reason is there to not return a string?\n[]byte are not printed as nicely as string by default, so I often find myself casting to string for logging purposes. Should it always have been a string?\nWhen prepending []byte, a new underlying array is always created. If the data to prepend is constant, why should this not be a string?", "output": "My advice would be to use string by default when you're working with text. But use []byte instead if one of the following conditions applies:\n\nThe mutability of a []byte will significantly reduce the number of allocations needed.\nYou are dealing with an API that uses []byte, and avoiding a conversion to string will simplify your code."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Want to stop http server remotely\n\nQuestion:\nI want to stop the http server remotely (which I can do), but I also want to receive a message indicating that it has been stopped after it has been stopped. That is causing me some problems. The only solution that I could find is as shown below, which I do not consider ideal.\nCan anyone provide a better solution. The problem is that the final message sent to the client is not getting through unless I use the goroutine as shown at the end \"go func() {\".\nCode is as follows:\n\n//*************\nfunc stopServer(ohtWriter http.ResponseWriter, phtRequest *http.Request) {// Stop The Server\n//*************\n\n    var iBytesSent  int\n    var oOsError    os.Error\n    var sErmes  string\n\n    println(\"Stopping Server\")\n\n    iBytesSent,oOsError = ohtWriter.Write([]byte(\"Message from server - server now stopped.\"))\n\n    if oOsError != nil {\n        sErmes = \". Error = \" +oOsError.String()\n    } else {\n        sErmes = \". No error on write\"\n    }\n\n    println(\"stopServer: Bytes sent = \" +strconv.Itoa(iBytesSent) +sErmes)\n\n    ohtFlusher, tCanFlush := ohtWriter.(http.Flusher)\n    if tCanFlush {\n        ohtFlusher.Flush()\n    }\n\n    go func() {\n        time.Sleep(3e9)\n        os.Exit(0)\n    }()\n}", "output": "Yeah I think without support from the http package, a graceful shutdown is not really possible.  This is maybe a little bit less cringe-worthy, but will still slam closed any other concurrent requests in flight at the time of this request.  Maybe try filing a feature request on the Go issue tracker.  Better yet, open up the http package, and add a graceful shutdown method, and submit it.\nEdit: I guess if you control all of the http.Handlers in your app, you could keep a count of in-flight requests (using appropriate thread synchronization), and modify the code below to a) refuse new connections once \"shutdown\" is called and b) wait for all in-flight requests to complete before shutting down...\npackage main\n\nimport (\n    \"http\"\n    \"os\"\n    \"io\"\n    \"log\"\n    \"strconv\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", ServeHTTP)\n    http.ListenAndServe(\":8081\", nil)\n}\n\nconst responseString = \"Shutting down\\n\"\n\nfunc ServeHTTP(w http.ResponseWriter, req *http.Request) {\n    w.Header().Set(\"Content-Type\", \"text/plain; charset=utf-8\")\n    w.Header().Set(\"Content-Length\", strconv.Itoa(len(responseString)))\n    io.WriteString(w, responseString)\n\n    f, canFlush := w.(http.Flusher)\n    if canFlush {\n        f.Flush()\n    }\n\n    conn, _, err := w.(http.Hijacker).Hijack()\n    if err != nil {\n        log.Fatalf(\"error while shutting down: %v\", err)\n    }\n\n    conn.Close()\n\n    log.Println(\"Shutting down\")\n    os.Exit(0)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How does this Go function type \"HandlerFunc\" work, from the standard library \"net/http\"\n\nQuestion:\nI'm confused about this bit of code from the HTTP package:\ntype HandlerFunc func(ResponseWriter, *Request)\nfunc (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) {\n    f(w, r)\n}\n\nWhy does the ServeHTTP method have the exact same signature as it's type - what's the point?\n \nTesting, I discovered that if I pass a random function (foo) to the HandlerFunc:\nvar bar = HandlerFunc(foo)\n\nbar becomes an instance of HandlerFunc with foo as its ServeHTTP method. Now I'm really confused about how on earth this works.\nIf I have more than one methods on a type, how do I know which one is going to be attached to the new instance and with what name or order?", "output": "This approach allows you to use a function in a context that's expecting a Handler.\nWhat happens is, there's a Handler interface:\n    type Handler interface {\n        ServeHTTP(ResponseWriter, *Request)\n    }\n\nand various functions are declared to accept parameters that are declared to belong to this interface — for example:\n    func TimeoutHandler(h Handler, ns int64, msg string) Handler {\n        f := func() <-chan int64 {\n            return time.After(ns)\n        }\n        return &timeoutHandler{h, f, msg}\n    }\n\nWhat this means is that when you invoke such a function, you have to pass in an object belonging to a type that satisfies this interface, which is to say, a type that has a ServeHTTP method with the appropriate signature. (In Go, unlike some languages, a type doesn't need to explicitly implement an interface, it just needs to have the methods specified by the interface.)\nSo, the code-snippet that you quote:\ntype HandlerFunc func(ResponseWriter, *Request)\nfunc (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) {\n    f(w, r)\n}\n\ncreates a type HandlerFunc that's based on func(ResponseWriter, *Request), but augments the type with a method called ServeHTTP with an appropriate signature, so that it satisfies the Handler interface. This ServeHTTP method just calls the function itself. So, if f is a function with the right signature, you could write something like this:\nvar h HandlerFunc = f    // h == f, but converted to a HandlerFunc\n                         // so it satisfies the Handler interface.\nTimeoutHandler(h, 1000000, \"timed out\")\n\nTo clarify a few things about this:\n\nTesting, I discovered that if I pass a random function (foo) to the HandlerFunc:\nvar bar = HandlerFunc(foo)\nbar becomes an instance of HandlerFunc with foo as its ServeHTTP method. Now I'm really confused about how on earth this works.\n\nFirstly, it's more correct to say that you've converted a random function foo to type HandlerFunc, rather than that you've passed the function to HandlerFunc as though HandlerFunc were a function. (The HandlerFunc(foo) notation is a typecast; you could just as well write var bar HandlerFunc = foo and let the conversion happen implicitly.)\nSecondly, it's more correct to say that bar has a ServeHTTP method that invokes foo, than that foo itself actually is the ServeHTTP method.\nDoes that make sense?"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go webserver how is the performance stability, in terms of long run stability compared to Tomcat, Apache?\n\nQuestion:\nI have been thinking instead of using:\n\nTomcat\nApache \nLightweight webserver\nPHP\nRuby\nJSP\n\nWhy not switch my projects to Go language. Because there i have:\n\nwebserver built in \ni do not even need to depend on PHP, Ruby, JSP \nGo solves cross-platform such as: runs on FreeBSD, Linux, Solaris (Windows, Mac, Android, Tizen)\nnor Apache nor Tomcat nor other webserver maintainence\nspeed of browser would be extreamly faster then other web server scripting languages.\n\nBut one thing i am worried about, which is the stablity of Go webserver compared to other webservers.\nHas anyone done this before or am i alone building such projects for production releases?", "output": "There are no stability problem.\nI have a few webservers 100% in go that run for months, serving about a million queries per month without any problem (mostly json, through GET, POST, and websockets).\nThey're on 64 bits ubuntu servers but I guess you would have difficulties producing the so much gossiped about 32 bits bug, especially with a web server.\nDon't use a front-end if you have no specific reason : It's easy to make a complete web application just using Go. \nYou will be far from alone. In my opinion Go is especially well suited to build long running servers. Goroutines and channels makes it really easy to handle both user requests and long term tasks (or, for example, do the postreatment of user queries after you answered the http query, which isn't so easy in php and is too many LOC in java if you want to do it properly)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does garbage collection work with the Go compiler (gc)?\n\nQuestion:\nI noticed that garbage collection is not yet implemented in gccgo.\nhttp://golang.org/doc/gccgo_install.html#Unimplemented\nDoes the standard Go compiler (gc) support garbage collection yet?", "output": "gccgo has its own runtime, the plan is to switch to use a single runtime shared by both gc and gccgo.\nAlso, the current garbage collector in gc is rather simple, a concurrent and much faster implementation based on research done by IBM is under development, and will probably be the one used by both gccgo and gc."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Adding a new method to an existing (standard) type\n\nQuestion:\nI'm writing some code that needs functionality that is almost satisfied by the ReadBytes method in the bufio package. Specifically, that method reads from a Reader until it encounters a particular byte. I need something that reads till it encounters one out of couple of bytes (space, newline and tab mainly).\nI looked at the source for the library and I know what to do if I have access to the internal buffer used by bufio structs. Is there any way I could \"monkey patch\" the package and add another method or two to it? Or another way to get the functionality I need?", "output": "Something along this approach (caution: untested code):\ntype reader struct{\n        *bufio.Reader // 'reader' inherits all bufio.Reader methods\n}\n\nfunc newReader(rd io.Reader) reader {\n        return reader{bufio.NewReader(rd)}\n}\n\n// Override bufio.Reader.ReadBytes\nfunc (r reader) ReadBytes(delim byte) (line []byte, err error) {\n        // here goes the monkey patch\n}\n\n// Or\n\n// Add a new method to bufio.Reader\nfunc (r reader) ReadBytesEx(delims []byte) (line []byte, err error) {\n        // here goes the new code\n}\n\nEDIT: I should have noted that this doesn't help to access the original package internals (non exported entities). Thanks Abhay for pointing that out in your comment."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does Go language use Copy-on-write for strings\n\nQuestion:\nDoes Go language use Copy-on-write for strings as in Java? I.e. if I pass a string by value to a method and never change it will this allocate memory and copy the string (which will be time inefficient) or it will just reference a single copy.", "output": "It's not Copy-on-Write, as strings are immutable. But sharing a string will not make a copy of the underlying memory region either. In Go, a string is represented as a (length, data) pair. If you pass a string around, Go will copy the length and the pointer but not the data pointed to.\nFor further information, see this recent thread on golang-nuts."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Address of a temporary in Go?\n\nQuestion:\nWhat's the cleanest way to handle a case such as this:\nfunc a() string {\n    /* doesn't matter */\n}\n\nb *string = &a()\n\nThis generates the error:\n\ncannot take the address of a()\n\nMy understanding is that Go automatically promotes a local variable to the heap if its address is taken. Here it's clear that the address of the return value is to be taken. What's an idiomatic way to handle this?", "output": "The address operator returns a pointer to something having a \"home\", e.g. a variable. The value of the expression in your code is \"homeless\". if you really need a *string, you'll have to do it in 2 steps:\ntmp := a(); b := &tmp\n\nNote that while there are completely valid use cases for *string, many times it's a mistake to use them. In Go string is a value type, but a cheap one to pass around (a pointer and an int). String's value is immutable, changing a *string changes where the \"home\" points to, not the string value, so in most cases *string is not needed at all."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Error: Could not determine kind of name for C.stdout when building example from C? Go? Cgo! article\n\nQuestion:\nI'm trying to build the following example from C? Go? Cgo!:\npackage print\n\n/*\n#include <stdio.h>\n#include <stdlib.h>\n*/\nimport \"C\"\nimport \"unsafe\"\n\nfunc Print(s string) {\n    cs := C.CString(s)\n    C.fputs(cs, (*C.FILE)(C.stdout))\n    C.free(unsafe.Pointer(cs))\n}\n\nI'm running Go on Win7 64 and am using the 64 bit version of GCC from http://tdm-gcc.tdragon.net/\nRunning this on Linux isn't an option.\nThe error I get is:\ncould not determine kind of name for C.stdout\n\nI haven't been able to find any documentation on this message, and very few hits show up on Google.\nDoes anyone have ideas on what's causing this? Thanks in advance!", "output": "Here is one way to access C.stdout on windows:\n// Copyright 2009 The Go Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style\n// license that can be found in the LICENSE file.\n\npackage stdio\n\n/*\n#include <stdio.h>\n// on mingw, stderr and stdout are defined as &_iob[FILENO]\n// on netbsd, they are defined as &__sF[FILENO]\n// and cgo doesn't recognize them, so write a function to get them,\n// instead of depending on internals of libc implementation.\nFILE *getStdout(void) { return stdout; }\nFILE *getStderr(void) { return stderr; }\n*/\nimport \"C\"\n\nvar Stdout = (*File)(C.getStdout())\nvar Stderr = (*File)(C.getStderr())\n\nhttps://github.com/golang/go/blob/master/misc/cgo/stdio/stdio.go"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How can I use Go append with two []byte slices or arrays?\n\nQuestion:\nI recently tried appending two byte array slices in Go and came across some odd errors. My code is:\none:=make([]byte, 2)\ntwo:=make([]byte, 2)\none[0]=0x00\none[1]=0x01\ntwo[0]=0x02\ntwo[1]=0x03\n\nlog.Printf(\"%X\", append(one[:], two[:]))\n\nthree:=[]byte{0, 1}\nfour:=[]byte{2, 3}\n\nfive:=append(three, four)\n\nAnd the errors are:\ncannot use four (type []uint8) as type uint8 in append\ncannot use two[:] (type []uint8) as type uint8 in append\n\nWhich taken into consideration the alleged robustness of Go's slices shouldn't be a problem:\nhttp://code.google.com/p/go-wiki/wiki/SliceTricks\nWhat am I doing wrong, and how should I go about appending two byte arrays?", "output": "The Go Programming Language Specification\nAppending to and copying slices\nThe variadic function append appends zero or more values x to s of\n  type S, which must be a slice type, and returns the resulting slice,\n  also of type S. The values x are passed to a parameter of type ...T\n  where T is the element type of S and the respective parameter passing\n  rules apply.\nappend(s S, x ...T) S  // T is the element type of S\nPassing arguments to ... parameters\nIf the final argument is assignable to a slice type []T, it may be\n  passed unchanged as the value for a ...T parameter if the argument is\n  followed by ....\n\n\nYou need to use []T... for the final argument.\nFor your example, with the final argument slice type []byte, the argument is followed by ...,\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    one := make([]byte, 2)\n    two := make([]byte, 2)\n    one[0] = 0x00\n    one[1] = 0x01\n    two[0] = 0x02\n    two[1] = 0x03\n    fmt.Println(append(one[:], two[:]...))\n\n    three := []byte{0, 1}\n    four := []byte{2, 3}\n    five := append(three, four...)\n    fmt.Println(five)\n}\n\nPlayground: https://play.golang.org/p/2jjXDc8_SWT\nOutput:\n[0 1 2 3]\n[0 1 2 3]"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Obtain user's home directory\n\nQuestion:\nIs the following the best way of obtaining the running user's home directory? Or is there a specific function that I've ovelooked?\nos.Getenv(\"HOME\")\n\nIf the above is correct, does anyone happen to know whether this approach is guaranteed to work on non-Linux platforms, e.g. Windows?", "output": "Since go 1.12 the recommended way is:\npackage main\nimport (\n    \"os\"\n    \"fmt\"\n    \"log\"\n)\nfunc main() {\n    dirname, err := os.UserHomeDir()\n    if err != nil {\n        log.Fatal( err )\n    }\n    fmt.Println( dirname )\n}\n\nOld recommendation:\nIn go 1.0.3 ( probably earlier, too ) the following works:\npackage main\nimport (\n    \"os/user\"\n    \"fmt\"\n    \"log\"\n)\nfunc main() {\n    usr, err := user.Current()\n    if err != nil {\n        log.Fatal( err )\n    }\n    fmt.Println( usr.HomeDir )\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go: print variables with gdb\n\nQuestion:\nIn this program, how can break execution with the debugger and print the value of i?\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n        x := \"abc\"\n        i := 3\n        fmt.Println(i)\n        fmt.Println(x)\n}\n\nI can't print i. However I can print x:\ngo build test.go\ngdb test  \n[...]Reading symbols from /home/ned/test...done.\n(gdb) br 9\n(gdb) run\n(gdb) p i\nNo symbol \"i\" in current context.\n(gdb) p x\n$1 = \"abc\"", "output": "It sounds like the variable i probably got optimized out of existence by the compiler. Did you try a debug build?\nYou can use go build -gcflags '-N'."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why does mgo not return the ID of inserted document?\n\nQuestion:\nAccording to the documentation (http://godoc.org/launchpad.net/mgo/v2) you can obtain the ID of your \"Upserted\" document if you use the Upsert method.\nThere is also an Insert method that does not provide this functionality.\nWhy is that?  What if I want to perform an Insert instead of an Upsert?  (or wouldn't ever be any valid reason to want to do that? I'm starting to wonder.)", "output": "You use bson.NewObjectId() to generate an ID to be inserted.\nThis is how you'd insert a new document:\ni := bson.NewObjectId()\nc.Insert(bson.M{\"_id\": i, \"foo\": \"bar\"})\n\nSince you don't know if you're going to insert or update when you issue an Upsert, it would be superfluous to generate an ID just to drop it right after the query (in case an update happens). That's why it's generated db-side and returned to you when applicable."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: getopt-like behavior in Go\n\nQuestion:\nHow do I nicely parse a list of program parameters and automate handling \"--help\" and/or \"--version\" (such as \"program [-d value] [--abc] [FILE1]\") in Go?", "output": "I made it just for you:\npackage main\n\nimport (\n  \"fmt\";\n  \"os\"\n)\n\nfunc main() {\n  for i, arg := range os.Args {\n    if arg == \"-help\" {\n      fmt.Printf (\"I need somebody\\n\")\n    }else if arg == \"-version\" {\n      fmt.Printf (\"Version Zero\\n\")\n    } else {\n      fmt.Printf(\"arg %d: %s\\n\", i, os.Args[i])\n    }\n  }\n}\n\nsee also https://play.golang.org/p/XtNXG-DhLI\nTest:\n\n$ ./8.out -help -version monkey business\nI need somebody\nVersion Zero\narg 3: monkey\narg 4: business"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go - cannot compile hello world (Windows)\n\nQuestion:\nJust trying out Go, but I can't get it to compile my very first program. This caused a bunch of questions on the compiler.\nIt is contained in this single file:\n\"D:\\programming\\Go\\src\\mytest\\mytest.go\"\n\nthe program text is:\n// mytest project mytest.go\npackage mytest\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, Go!\")\n}\n\nIn the package folder I tried the following commands:\n>go build\n\nsays nothing. According to go help build this is the intended result.\n>go build -v\n_/D_/programming/Go/src/mytest\n\nWhat are the _/D_/ things are??? Looks like a new invention!\nAnd the most strange one:\n>go build -v mytest\ncan't load package: package mytest: import \"mytest\": cannot find package\n\nSo what am I doing wrong and how do I get the thing compiled?", "output": "The main function in a program must be in package main. Package main can then import other packages and call them."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: From io.Reader to string in Go\n\nQuestion:\nI have an io.ReadCloser object (from an http.Response object).\nWhat's the most efficient way to convert the entire stream to a string object?", "output": "EDIT:\nSince 1.10, strings.Builder exists. Example:\nbuf := new(strings.Builder)\nn, err := io.Copy(buf, r)\n// check errors\nfmt.Println(buf.String())\n\n\nOUTDATED INFORMATION BELOW\nThe short answer is that it it will not be efficient because converting to a string requires doing a complete copy of the byte array. Here is the proper (non-efficient) way to do what you want:\nbuf := new(bytes.Buffer)\nbuf.ReadFrom(yourReader)\ns := buf.String() // Does a complete copy of the bytes in the buffer.\n\nThis copy is done as a protection mechanism. Strings are immutable. If you could convert a []byte to a string, you could change the contents of the string. However, go allows you to disable the type safety mechanisms using the unsafe package. Use the unsafe package at your own risk. Hopefully the name alone is a good enough warning. Here is how I would do it using unsafe:\nbuf := new(bytes.Buffer)\nbuf.ReadFrom(yourReader)\nb := buf.Bytes()\ns := *(*string)(unsafe.Pointer(&b))\n\nThere we go, you have now efficiently converted your byte array to a string. Really, all this does is trick the type system into calling it a string. There are a couple caveats to this method:\n\nThere are no guarantees this will work in all go compilers. While this works with the plan-9 gc compiler, it relies on \"implementation details\" not mentioned in the official spec. You can not even guarantee that this will work on all architectures or not be changed in gc. In other words, this is a bad idea.\nThat string is mutable! If you make any calls on that buffer it will change the string. Be very careful.\n\nMy advice is to stick to the official method. Doing a copy is not that expensive and it is not worth the evils of unsafe. If the string is too large to do a copy, you should not be making it into a string."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using modified branch of a Go package instead of installed package\n\nQuestion:\nI did a \"go get\" to install github.com/chsc/gogl. Apparently this seems to have put stuff in C:\\Go\\src\\pkg\\github.com\\chsc\\gogl. And when I import \"github.com/chsc/gogl\" I can use the package just fine.\nBut suppose I wanted to make some edits to the package. How do I manage and organize my projects and code? Where do I put my copy of gogl and how do I get all my projects to use my copy of gogl instead of the one installed under C:\\Go\\src\\pkg\\github.com\\chsc\\gogl?", "output": "create your github account\nfork your own version of gogl\ngo get github.com/user782220/gogl  (assume user782220 is your github account)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE Go Json-RPC call example\n\nQuestion:\nI'm trying to understand how to use Json-RPC calls in Google Go that would be used in a Google App Engine app. So far I understand that I somehow should call rpc.Client.Dial, but I don't understand what the \"network\" and \"address\" parameters should be. Can anyone provide a sample, working code that demonstrates how to use Json-RPC in Go?", "output": "I have already written an answer to your question on the go-nuts group, but for completeness, here it is:\n\nGo's jsonrpc package isn't compatible with GAE yet.\n\nReference: https://groups.google.com/d/msg/google-appengine-go/uQ0cv0m9j0E/H3VCrFgEWvcJ\nIt's probably a good idea to read the full thread there, since it describes the limitations on GAE nicely and links to a patched library with lots of workarounds... The issue is already known, but has not been solved yet."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: will go support mips in the future\n\nQuestion:\ngo 1.0 does not support mips.\nWill go support it in the future?", "output": "GCC 4.7 has a Go front-end (with the gccgo command) and can be built, as a cross compiler, for MIPS target."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Casting from one pointer to pointer type to another in Golang error\n\nQuestion:\nCan anyone tell my why this wouldn't compile?\npackage main\n\ntype myint int\nfunc set(a **myint) {\n    i := myint(5)\n    *a = &i \n}\n\nfunc main() {\n    var k *int\n    set( (**myint)(&k) ) // cannot convert &k (type **int) to type **myint\n    print( *k )\n}\n\nMy reasoning so far is this. All types in Golang are different, but it allows to convert from one type to another with C-like cast syntax as long as underlying types are identical. In my example, converting 'int' to 'myint' is not a problem. '*int' to '*myint' isn't either. It's when you have pointer to pointer problems arise. I've been stuck on this for the second day now. Any help is appreciated.", "output": "Here's my analysis.\n(**myint)(&k) -- cannot convert &k (type **int) to type **myint:\ntype **int and type **myint are unnamed pointer types and their pointer base types, type *int and type *myint, don't have identical underlying types.\nIf T (*int or *myint) is a pointer type literal, the corresponding underlying type is T itself.\n(*myint)(k) -- can convert k (type *int) to type *myint:\ntype *int and type *myint are unnamed pointer types and their pointer base types, type int and type myint (type myint int), have identical underlying types.\nIf T (int) is a predeclared type, the corresponding underlying type is T itself. If T (myint) is neither a predeclared type or nor a type literal, T's underlying type is the underlying type of the type to which T refers in its type declaration (type myint int). \n(myint)(*k) -- can convert *k (type int) to type myint:\ntype int and type myint have identical underlying types. \nIf T (int) is a predeclared type, the corresponding underlying type is T itself. If T (myint) is neither a predeclared type or nor a type literal, T's underlying type is the underlying type of the type to which T refers in its type declaration (type myint int). \nHere's the underlying type example from the Types section revised to use integers and int pointers.\ntype T1 int\ntype T2 T1\ntype T3 *T1\ntype T4 T3\n\nThe underlying type of int, T1, and T2 is int. The underlying type of *T1, T3, and T4 is *T1. \nReferences:\nThe Go Programming Language Specification\nConversions\nTypes\nProperties of types and values\nType declarations\nPredeclared identifiers\nPointer Type"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: When is it a good idea to return a pointer to a struct?\n\nQuestion:\nI'm learning Go, and I'm a little confused about when to use pointers. Specifically, when returning a struct from a function, when is it appropriate to return the struct instance itself, and when is it appropriate to return a pointer to the struct?\nExample code:\ntype Car struct {\n  make string\n  model string\n}\n\nfunc Whatever() {\n  var car Car\n\n  car := Car{\"honda\", \"civic\"}\n\n  // ...\n\n  return car\n}\n\nWhat are the situations where I would want to return a pointer, and where I would not want to? Is there a good rule of thumb?", "output": "There are two things you want to keep in mind, performance and API.\nHow is a Car used? Is it an object which has state? Is it a large struct? Unfortunately, it is impossible to answer when I have no idea what a Car is. Truthfully, the best way is to see what others do and copy them. Eventually, you get a feeling for this sort of thing. I will now describe three examples from the standard library and explain why I think they used what they did.\n\nhash/crc32: The crc32.NewIEEE() function returns a pointer type (actually, an interface, but the underlying type is a pointer). An instance of a hash function has state. As you write information to a hash, it sums up the data so when you call the Sum() method, it will give you the state of that one instance.\ntime: The time.Date function returns a Time struct. Why? A time is a time. It has no state. It is like an integer where you can compare them, preform maths on them, etc. The API designer decided that a modification to a time would not change the current one but make a new one. As a user of the library, if I want the time one month from now, I would want a new time object, not to change the current one I have. A time is also only 3 words in length. In other words, it is small and there would be no performance gain in using a pointer.\nmath/big: big.NewInt() is an interesting one. We can pretty much agree that when you modify a big.Int, you will often want a new one. A big.Int has no internal state, so why is it a pointer? The answer is simply performance. The programmers realized that big ints are … big. Constantly allocating each time you do a mathematical operation may not be practical. So, they decided to use pointers and allow the programmer to decide when to allocate new space.\n\nHave I answered your question? Probably not. It is a design decision and you need to figure it out on a case by case basis. I use the standard library as a guide when I am designing my own libraries. It really all comes down to judgement and how you expect client code to use your types."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: syntax error: unexpected semicolon or newline, expecting }\n\nQuestion:\nI have this sample code where I'm defining an array but it doesn't compile: \n$ cat a.go\npackage f\nfunc t() []int  {\n    arr := [] int {\n        1,\n        2\n    }\n    return arr\n}\n\noreyes@OREYES-WIN7 ~/code/go\n$ go build a.go\n# command-line-arguments\n.\\a.go:5: syntax error: unexpected semicolon or newline, expecting }\n.\\a.go:7: non-declaration statement outside function body\n.\\a.go:8: syntax error: unexpected }\n\nHowever if I remove the newline it works: \n$ cat a.go\npackage f\nfunc t() []int  {\n    arr := [] int {\n        1,\n        2 }\n    return arr\n}\n\noreyes@OREYES-WIN7 ~/code/go\n$ go build a.go\n\nHowcome?", "output": "Simply put a comma (,) at the end of all lines containing elements of the array:\narr :=  [] func(int) int {\n    func( x int ) int { return x + 1 },\n    func( y int ) int { return y * 2 }, // A comma (to prevent automatic semicolon insertion)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to parse *.py file with python?\n\nQuestion:\nI'd like to parse Python source in order to try making a basic source code converter from Python to Go.\n\nWhat module should I use?\nShould I proceed or not?\nIf I should proceed, how?", "output": "Have a look at the language services packages, particularly the ast.\nMy guess is that if you don't already have a solid grasp of both parsing as well as code generation techniques, this is going to be a difficult project to undertake.\ngood luck!"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: go: using pointer allows changing the contents of a struct. Why?\n\nQuestion:\nConsider the following example. I don't fully understand what happens \"in the background\" and seek an explanation. This version seems to make a copy of the struct Foo when I call AddToEntry from the main function. Right? How can I \"proof\" this in the code?\nWhen go makes a copy of the struct, I am just manipulating the copy of the struct and when I get back to the main function I see the original as before?\nWhen I expect a pointer (see comment in the code), everything is fine, my struct is not copied. How can avoid this kind of \"error\"? How can I make sure I am not copying the struct? Is there a possible compile time/run time check for that, or do I have be careful?\npackage main\n\nimport (\n    \"fmt\"\n)\n\ntype Foo struct {\n    Entry []string\n}\n\nfunc MakeFoo() Foo {\n    a:=Foo{}\n    a.Entry = append(a.Entry,\"first\")\n    return a\n}\n\n// if I change (f Foo) to (f *Foo), I get \n// the \"desired\" result\nfunc (f Foo) AddToEntry() {\n    f.Entry = append(f.Entry,\"second\")\n}\n\n\nfunc main() {\n    f:=MakeFoo()\n    fmt.Println(f) // {[first]}\n    f.AddToEntry()\n    fmt.Println(f) // {[first]}\n}", "output": "Your method signature is func (f Foo) AddToEntry(). The way methods work, f.AddToEntry() is is the same as:\ng := Foo.AddToEntry\ng(f)\n\nThe receiver is just another parameter. Why is this important? What happens when you pass a struct and modify it in a function? In C, Go, and other pass by value languages, the struct given in the parameter is only a copy. Therefore, you can not modify the original. Only return the new struct.\nWhen you define func (f *Foo) AddToEntry(), you are defining the receiver, the first parameter, as a pointer. Obviously, given a pointer, you can modify the original struct. What is hidden is that you are implicitly referencing when you access a struct in Go. To put it another way, (*ptrFoo).Entry is the same as ptrFoo.Entry in Go.\nSo the issue here is that for those unaccustomed to go, the syntax is hiding some of what is going on. In C, you would never be able to edit a struct unless you passed a pointer to it. The same happens in Go. You need to use a pointer receiver in order to modify what you are receiving."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I create crossplatform file paths in Go?\n\nQuestion:\nI want to open a given file \"directory/subdirectory/file.txt\" in golang. What is the recommended way to express such a path in an OS agnostic way (ie backslashes in Windows, forward slashes in Mac and Linux)? Something like Python's os.path module?", "output": "For creating and manipulating OS-specific paths directly use os.PathSeparator and the path/filepath package.\nAn alternative method is to always use '/' and the path package throughout your program. The path package uses '/' as path separator irrespective of the OS. Before opening or creating a file, convert the /-separated path into an OS-specific path string by calling filepath.FromSlash(path string). Paths returned by the OS can be converted to /-separated paths by calling filepath.ToSlash(path string)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go programing language please help me set up eclipse or vim or text editor\n\nQuestion:\nI am starting to learn go programing language. I have installed zeus, and eclipse/goclipse. (I like text editor, however i did not find any instructions to plug in with go and compile it). \nNow, on eclipse I ran a basic hello world and I am getting this:\n\"Executable source files must be in the 'cmd' folder\" \n\nGOROOT set on c:\\Go\\\nGOOS set on windows, \nGOARCH set on 386 (I forgot my system, I have windows 32bit) \nGo tool path (go) set on auto \"c:\\go\\bin\\go.exe\" \nGo formatter path set on auto \n(gofmt)auto \"c:\\go\\bin\\gofmt.exe\" \nand Go documentor path (godoc) set on auto \"c:\\go\\bin\\godoc.exe\" \nfinally the GOPATH is empty. \n\nI was following instructions on here http://code.google.com/p/goclipse/wiki/InstallationInstructions and here http://code.google.com/p/goclipse/wiki/GettingStarted.\nNow, on the second link says cmd on the explorer window, there is no \"cmd\" there is bin, pkg, and src. If you can see why i have the error code, i appreciated a million and thank you veeery much in advance. If anyone can help me set up either vim, or text editor to use with go i can go that route as well. Also, i forgot one more thing, like Socrates says, i know nothing hehe so if you could tell me step at a time to fix as i am proud to be noob.\nThanks for reading and sorry about the long text because i wanted to give as much detail as possible.\nMar,\nThanks, again.", "output": "I am not sure what the project state of Goclipse really is, since I don't use it, but I would suggest first and foremost trying the basics of compiling from the command prompt. This will ensure you actually have it working. The instructions given for Goclipse seem old as cmd is not required anymore. That may just be something internal for the project structure in Eclipse+Goclipse.\nDisclaimer: I work in OSX/Linux. This advise for windows is off the top of my head\nIf you have already set your system environment variables to the paths you mentioned, then from the command prompt, you should successfully be able to run the go command.\nIf you cd in the location of your hello.go test file, you should then be able to run:\ngo build hello.go, and have a resulting hello executable in the same location. That is the first step to building a single file.\nGOPATH allows you to set a location for which Go should search to find packages. This location should have underneath it a src directory, and a pkg directory. Your project go will live under src, and pkg is where packages get installed. Having a bin is optional since you can direct the executables to whatever location you want with GOBIN or the -o flag of running go build -o /path/to/bin/hello hello.go\nA generic GOPATH structure might look like this:\nprojects/\n  src/\n    hello/\n      hello.go\n  pkg/\n\nYou would then be able to set GOPATH=/path/to/projects and could build from any location via:\ngo build -o /path/to/bin/hello hello\nAnother alternative to Eclipse is using SublimeText2, which I have found to be excellent, and it is cross-platform just like Eclipse. It also has a package manager to install plugins, and there is a great Go plugin called GoSublime"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why are there only two query types in the Go Database library?\n\nQuestion:\nFrom what I can tell, there are only two types of results the Go database/sql interface library expects back - a row or an array of rows. However, there is at least one more type of result - a single column.\nDB.column('SELECT COUNT(*) FROM `user` WHERE `banned` IS NOT NULL')\n\nIs there any way to handle this - or do I just have to fetch a row and then access the COUNT(*) from that?", "output": "Yes you fetch a one column row but is that so hard ?\nvar count int\nrow := db.QueryRow(\"SELECT COUNT(*) FROM `user` WHERE `banned` IS NOT NULL\")\nerr := row.Scan(&count)\n\nNote that this may be compacted if you find it too verbose (you may remove the row variable).\nI think that other similar systems in other languages (for example JDBC) don't offer natively this shortcut either.\nI find easier to handle an API that I can memorize and browse rather than an API which has all the utilities I might be willing to use to remove one line in my code."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: how to import a DLL function written in C using GO?\n\nQuestion:\nI'm looking for an example code how import a function from a dll written in C. equivalent to DllImport of  C#.NET. It's possible? \nI'm using windows.\nany help is appreciated. thanks in advance.", "output": "You want to use cgo. Here's an introduction."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go Test always passses why?\n\nQuestion:\nI installed go and tried the first part on How to write go code\nAnd after a while of not seeing the desired result I notice go test always passes, always!\nWhat am I missing?\n$ go version\ngo version go1\n$ mkdir -p src/example/math \n\n$ cat >src/example/math/sum_test.go <<.\n> package math\n>\n> import \"testing\"\n>\n> func SumTest( t *testing.T ) {\n>    t.Errorf(\"ssss %d\", 1 )\n> }\n> .\n\n$ go test example/math\nok      example/math    0.044s\n\nI'm using windows x64 and I'm using git-bash as shell", "output": "From the go command man page:\nA test function is one named TestXXX (where XXX is any alphanumeric string not starting with a lower case letter) and should have the signature,\nfunc TestXXX(t *testing.T) { ... }\n\nYour SumTest() function doesn't follow that pattern, and is likely to be ignored.\nThis should work better:\nfunc TestSum( t *testing.T )"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How am I meant to use Filepath.Walk in Go?\n\nQuestion:\nThe filepath.Walk function takes a function callback. This is straight function with no context pointer. Surely a major use case for Walk is to walk a directory and take some action based on it, with reference to a wider context (e.g. entering each file into a table).\nIf I were writing this in C# I would use an object (with fields that could point back to the objects in the context) as a callback (with a given callback method) on it so the object can encapsulate the context that Walk is called from.\n(EDIT: user \"usr\" suggests that the closure method occurs in C# too)\nIf I were writing this in C I'd ask for a function and a context pointer as a void * so the function has a context pointer that it can pass into the Walk function and get that passed through to the callback function.\nBut Go only has the function argument and no obvious context pointer argument.\n(If I'd designed this function I would have taken an object as a callback rather than a function, conforming to the interface FileWalkerCallback or whatever, and put a callback(...) method on that interface. The consumer could then attach whatever context to the object before passing it to Walk.)\nThe only way I can think of doing it is by capturing the closure of the outer function in the callback function. Here is how I am using it:\nfunc ScanAllFiles(location string, myStorageThing *StorageThing) (err error) {\n    numScanned = 0\n\n    // Wrap this up in this function's closure to capture the `corpus` binding.\n    var scan = func(path string, fileInfo os.FileInfo, inpErr error) (err error) {\n        numScanned ++\n\n        myStorageThing.DoSomething(path)\n    }\n\n    fmt.Println(\"Scan All\")\n\n    err = filepath.Walk(location, scan)\n\n    fmt.Println(\"Total scanned\", numScanned)\n\n    return\n}\n\nIn this example I create the callback function so its closure contains the variables numScanned and myStorageThing.\nThis feels wrong to me. Am I right to think it feels weird, or am I just getting used to writing Go? How is it intended for the filepath.Walk method to be used in such a way that the callback has a reference to a wider context?", "output": "You're doing it about right.  There are two little variations you might consider.  One is that you can replace the name of an unused parameter with an underbar.  So, in your example where you only used the path, the signature could read\nfunc(path string, _ os.FileInfo, _ error) error\n\nIt saves a little typing, cleans up the code a little, and makes it clear that you are not using the parameter.  Also, for small functions especially, it's common skip assigning the function literal to a variable, and just use it directly as the argument.  Your code ends up reading,\nerr = filepath.Walk(location, func(path string, _ os.FileInfo, _ error) error {\n    numScanned ++\n\n    myStorageThing.DoSomething(path)\n})\n\nThis cleans up scoping a little, making it clear that you are using the closure just once."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Simulate a tcp connection in Go\n\nQuestion:\nIn Go, a TCP connection (net.Conn) is a io.ReadWriteCloser. I'd like to test my network code by simulating a TCP connection. There are two requirements that I have:\n\nthe data to be read is stored in a string\nwhenever data is written, I'd like it to be stored in some kind of buffer which I can access later\n\nIs there a data structure for this, or an easy way to make one?", "output": "Why not using bytes.Buffer? It's an io.ReadWriter and has a String method to get the stored data. If you need to make it an io.ReadWriteCloser, you could define you own type:\ntype CloseableBuffer struct {\n    bytes.Buffer\n}\n\nand define a Close method:\nfunc (b *CloseableBuffer) Close() error {\n    return nil\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What next generation low level language is the best bet when migrating a code base?\n\nQuestion:\nLet's say you have a company running a lot of C/C++, and you want to start planning migration to new technologies so you don't end up like COBOL companies 15 years ago.\nFor now, C/C++ runs more than fine and there is plenty dev on the market for it.\nBut you want to start thinking about it now, because given the huge running code base and the data sensitivity, you feel it can take 5-10 years to move to the next step without overloading the budget and the dev teams. \nYou have heard about D, starting to be quite mature, and Go, promising to be quite popular.\nWhat would be your choice and why?", "output": "D and Go will probably just become as popular as Python and Ruby are today. They each fill a niche, and even though D was supposed to be a full-fledged replacement of C++, it probably will never acquire enough mass to push C++ away. Not to mention that they both aren't stable/mature enough, and it's unknown whether you'll have support for these languages in 10-20 years for the then-current  hardware and operating systems. Considering that C/C++ is pretty much the compiled language and is used in the great majority of operating systems and native-code applications, it's very unlikely that it'll go away in the foreseeable future."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I add the Go to gitg's list of viewable sources?\n\nQuestion:\nI am just beginning to \"git\" for the first time and have git and gitg installed from Ubuntu 10.4 / AMD64 distribution (i.e. maybe not 'latest' version but not ancient).  \nI am trying to look at the go code I've committed via gitg and in the \"tree tab\" it says:\nCannot display file content as text.\n\nHowever, the \"details tab\" shows the diffs of the same file just fine.\nI know gitg's \"tree tab\" is working because I can use the tree view on *.c / *.html / *.txt, etc just fine.\n<question> Is there a way to tweak gitg into understanding that \"*.go\" is just text? </question>\nA little more context:\n\nInstalled gitg version is 0.0.5 - ie a version behind latest - 0.0.6 - source of which I am looking thru now.\n\nI do have a working /usr/share/gtksourceview-2.0/language-specs/go.lang.\nIt works just fine as highlighter in gedit.\nIt appears that gitg may require displayable files to have a mime type of \"text/plain\", so I added that to go.lang \nNo joy. gitg still fails on *.go.\nI'm relatively sure the fix is simple, just don't know where to look.", "output": "When it comes to gitg alt text http://trac.novowork.com/gitg/chrome/site/logo.png (the git repository viewer targeting gtk+/GNOME), it may be interesting to look at its code (also here):\nIn particular,  gitg-commit-view.c displays that message because its function gitg_utils_can_display_content_type() return an unknown type for text display purposes.\ngboolean\ngitg_utils_can_display_content_type(gchar const *content_type)\n{\n        return g_content_type_is_a(content_type, \"text/plain\") || \n                   g_content_type_equals(content_type, \"application/octet-stream\");\n}\n\nSo you do need to declare go file type as text/plain (in gitg, not \"to go.lang\") and it should work.\n\nActually, the declaration is not in gitg: g_content_type_is_a is a function of glib\\gio\\gcontenttype.c (project glib), and it calls get_registry_classes_key(), which read the registry (HKEY_CLASSES_ROOT for Windows, mime type registered for Unix).\nSo if you register the go files, it should work:\nxdg-icon-resource install --context mimetypes --size 48 go-type.png plain/text\n\nThe xml file to register (found by the OP Hotei, great work!)\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<mime-info xmlns=\"http://www.freedesktop.org/standards/shared-mime-info\">\n  <mime-type type=\"application/x-extension-go\">\n    <sub-class-of type=\"text/plain\"/>\n    <comment>go for files</comment>\n    <glob pattern=\"*.go\"/>\n  </mime-type>\n</mime-info>\n\nxdg-mime install go-mime.xml\nupdate-desktop-database"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: exec.Run - What's wrong with this Go program?\n\nQuestion:\nIsn't this Golang program supposed to output a directory listing to stdout?\nIt compiles ok, but does nothing.\npackage main\n\nimport \"exec\"\n\nfunc main() {\n  argv := []string{\"-la\"}\n  envv := []string{}\n  exec.Run(\"ls\", argv, envv, \"\", exec.DevNull, exec.PassThrough, exec.MergeWithStdout)\n}", "output": "this works:\npackage main\nimport \"exec\"\n\nfunc main() {\n  cmd, err := exec.Run(\"/bin/ls\", []string{\"/bin/ls\", \"-la\"}, []string{}, \"\", exec.DevNull, exec.PassThrough, exec.PassThrough)\n  if (err != nil) {\n    return\n  }\n  cmd.Close()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you get the terminal size in Go?\n\nQuestion:\nHow do I get the terminal size in Go. In C it would look like this:\nstruct ttysize ts; \nioctl(0, TIOCGWINSZ, &ts);\n\nBut how to i access TIOCGWINSZ in Go", "output": "The cgo compiler can't handle variable arguments in a c function and macros in c header files at present, so you can't do a simple\n// #include <sys/ioctl.h>\n// typedef struct ttysize ttysize;\nimport \"C\"\n\nfunc GetWinSz() {\n    var ts C.ttysize;\n    C.ioctl(0,C.TIOCGWINSZ,&ts)\n}\n\nTo get around the macros use a constant, so\n// #include <sys/ioctl.h>\n// typedef struct ttysize ttysize;\nimport \"C\"\n\nconst TIOCGWINSZ C.ulong = 0x5413; // Value from Jed Smith's answer\n\nfunc GetWinSz() {\n    var ts C.ttysize;\n    C.ioctl(0,TIOCGWINSZ,&ts)\n}\n\nHowever cgo will still barf on the ... in ioctl's prototype. Your best bet would be to wrap ioctl with a c function taking a specific number of arguments and link that in. As a hack you can do that in the comment above import \"C\"\n// #include <sys/ioctl.h>\n// typedef struct ttysize ttysize;\n// void myioctl(int i, unsigned long l, ttysize * t){ioctl(i,l,t);}\nimport \"C\"\n\nconst TIOCGWINSZ C.ulong = 0x5413; // Value from Jed Smith's answer\n\nfunc GetWinSz() {\n    var ts C.ttysize;\n    C.myioctl(0,TIOCGWINSZ,&ts)\n}\n\nI've not tested this, but something similar should work."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How can a garbage collector find out about object references done from the stack?\n\nQuestion:\nIn languages with automatic garbage collection like Haskell or Go, how can the garbage collector find out which values stored on the stack are pointers to memory and which are just numbers? If the garbage collector just scans the stack and assumes all addresses to be references to objects, a lot of objects might get incorrectly marked as reachable.\nObviously, one could add a value to the top of each stack frame that described how many of the next values are pointers, but wouldn't that cost a lot of performance?\nHow is it done in reality?", "output": "There exist GCs that assume that every bit pattern that is the address of something the GC is managing is in fact a pointer (and so don't release the something). This can actually work pretty well, because calls pointers are usually bigger than small common integers, and usually have to be aligned. But yes, this can cause collection of some objects to be delayed. The Boehm collector for C works this way, because it's library-based and so don't get any specific help from the compiler.\nThere are also GCs that are more tightly coupled to the language they're used in, and actually know the structure of the objects in memory. I've never read up specifically in stack frame handling, but you could record information to help the GC if the compiler and GC are designed to work together. One trick would be putting all the pointer references together and using one word per stack frame to record how many there are, which is not such a huge overhead. If you can work out what function corresponds to each stack frame without adding a word saying so, then you could have a per-function \"stack frame layout map\" compiled in. Another option would be to use tagged words, where you set the low order bit of words that are not pointers to 1, which (due to address alignment) is never needed for pointers, so you can tell them apart. That means you have to shift unboxed values in order to use them though."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to do a call-cc in Go?\n\nQuestion:\nIs it possible to do a Call-with-current-continuation in Google's new Language Go?", "output": "According to one of the go contributors, no it's not possible."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Installing go debuggers on OSX\n\nQuestion:\nAfter installing go, I got the following lines:\n\nOn OS X the debuggers must be installed setgrp procmod.\n  Read and run ./sudo.bash to install the debuggers.\n\nSorry for the beginner question, but what exactly does this mean?  What do I have to do to install the debuggers?\nI ran ./sudo.bash but nothing happened.  Am I reading this too literally?", "output": "In theory, you simply do as you did, and it copies the binaries from the build area to /usr/local/bin and then makes them belong to group procmod and SetGID.\nConsider running:\nsh -x sudo.bash\n\nThat should show you what it is doing as it does it.\nI don't entirely agree with what that script does; I want the Go debuggers not in /usr/local/bin, thank you, but under $GOROOT, so I don't use the official sudo.bash but instead created my own sudo.bash.goroot which contains:\n#!/usr/bin/env bash\n# Copyright 2009 The Go Authors. All rights reserved.\n# Use of this source code is governed by a BSD-style\n# license that can be found in the LICENSE file.\n\nset -e\n. ./env.bash\n\ncase \"`uname`\" in\nDarwin)\n    ;;\n*)\n    exit 0\nesac\n\nfor i in prof cov\ndo\n    sudo cp \"$GOROOT\"/src/cmd/$i/6$i $GOROOT/bin/6$i\n    sudo chgrp procmod $GOROOT/bin/6$i\n    sudo chmod g+s $GOROOT/bin/6$i\ndone\n\nThat works fine for me."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does a channel return two values?\n\nQuestion:\nI saw some code in this link, and got confused:http://www.darkcoding.net/software/go-lang-after-four-months/\nWhat's the meaning of the second value(ok)?\nfor self.isRunning {\n\n    select {\n    case serverData, ok = <-fromServer:   // What's the meaning of the second value(ok)?\n        if ok {\n            self.onServer(serverData)\n        } else {\n            self.isRunning = false\n        }\n\n    case userInput, ok = <-fromUser:\n        if ok {\n            self.onUser(userInput)\n        } else {\n            self.isRunning = false\n        }\n    }\n\n}", "output": "The boolean variable ok returned by a receive operator indicates whether the received value was sent on the channel (true) or is a zero value returned because the channel is closed and empty (false).\nThe for loop terminates when some other part of the Go program closes the fromServer or the fromUser channel. In that case one of the case statements will set ok to true. So if the user closes the connection or the remote server closes the connection, the program will terminate.\nhttp://play.golang.org/p/4fJDkgaa9O:\npackage main\n\nimport \"runtime\"\n\nfunc onServer(i int) { println(\"S:\", i) }\nfunc onUser(i int)   { println(\"U:\", i) }\n\nfunc main() {\n    fromServer, fromUser := make(chan int),make(chan int)\n    var serverData, userInput int\n    var ok bool\n\n    go func() {\n        fromServer <- 1\n        fromUser <- 1\n        close(fromServer)\n        runtime.Gosched()\n        fromUser <- 2\n        close(fromUser)\n    }()\n\n    isRunning := true\n    for isRunning {\n        select {\n            case serverData, ok = <-fromServer:\n                if ok {\n                    onServer(serverData)\n                } else {\n                    isRunning = false\n                }\n\n            case userInput, ok = <-fromUser:\n                if ok {\n                    onUser(userInput)\n                } else {\n                    isRunning = false\n                }\n            }\n        }\n        println(\"end\")\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Build documentation for Go 1 on Windows\n\nQuestion:\nHow to build Go 1 documentations on Windows?\nIt is at D:\\go\\doc on my machine and all links and paths are broken.", "output": "I'm not a master on Windows, but Go's documentation does not work like that. You should use godoc command for accessing Go documentation. Run godoc -http=:6060 and access documentation at http://127.0.0.1:6060 in your browser."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go-Scala-Go! What are the main differences?\n\nQuestion:\nI just found this web page comparing some code written in Scala, C# and Go. I am astonished to see how close Scala and Go code looks like, much more than Scala code compared to C# code. \nSo my question is: What are the most significant differences between Scala and Go?", "output": "I don't think so, at least conceptually they are very different. Go is much more C++ like and \"low level\" oriented than C#, and C# has only a few functional features while Scala allows you to write typical \"functional\" Code (more verbose than OCaml or Haskell, but similar). Scala's type system is quite sophisticated, but is nevertheless based on a Java/C#-like foundation. On the other hand, Go's object-oriented part looks quite different. I didn't try out Go, as I found it too C-like and too low-level. As a Java programmer I know that C# is technically ahead and has a lot of nice features missing in Java. When learning Scala it widened my view, giving me the advantage and power of functional Code without losing the good things from the object oriented world. After the years in Java jail programming in Scala is a really refreshing and mindblowing experience."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to check variable type at runtime in Go language\n\nQuestion:\nI have few C functions declared like this\nCURLcode curl_wrapper_easy_setopt_long(CURL* curl, CURLoption option, long param);\nCURLcode curl_wrapper_easy_setopt_str(CURL* curl, CURLoption option, char* param);\n\nI would like to expose those as one Go function like this\nfunc (e *Easy)SetOption(option Option, param interface{})\n\nso I need to be able to check param type at runtime. How do I do that and is this good idea (if not what is good practice in this case)?", "output": "See type assertions here:\nhttp://golang.org/ref/spec#Type_assertions\nI'd assert a sensible type (string, uint64) etc only and keep it as loose as possible, performing a conversion to the native type last.\nfunc (e *Easy)SetOption(option Option, param interface{}) {\n    if s, ok := param.(string); ok {\n        // s is string here\n    }\n    // else...\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: do actions on end of execution\n\nQuestion:\nI have an http server (launched using http.Handle) and I would like to do some operations.\nHow can I do that (on linux) ? Is it possible to do those operations in case of a ctrl-C ?\nI'm not familiar with unix signals so the answer may be trivial.", "output": "You can subscribe to the TERM and INT signals using the signal package. But note that these signals are only sent when the process is killed explicitly; normal exit (initiated by the process itself) does not involve any sort of signals.  I think for normal exit just do something in the main routine (which supposedly should spawn worker goroutines and then wait on them).\nRead man 7 signal for more general info on POSIX signals."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Are vector assignments copied by value or by reference in Google's Go language?\n\nQuestion:\nIn the following code, I create one peg puzzle then do a move on it which adds a move to its movesAlreadyDone vector. Then I create another peg puzzle then do a move on it which adds a move to its movesAlreadyDone vector. When I print out the values in that vector for the second one, it has the move in it from the first one along with the move from the second one. Can anyone tell me why it seems to be assigning by reference and not value? Are vector assignments copied by value or by reference in Google's Go language?\npackage main\n\nimport \"fmt\"\nimport \"container/vector\"\n\ntype Move struct { x0, y0, x1, y1 int }\n\ntype PegPuzzle struct {\n    movesAlreadyDone * vector.Vector;\n}\n\nfunc (p *PegPuzzle) InitPegPuzzle(){\n    p.movesAlreadyDone = vector.New(0);\n}\n\nfunc NewChildPegPuzzle(parent *PegPuzzle) *PegPuzzle{\n    retVal := new(PegPuzzle);\n    retVal.movesAlreadyDone = parent.movesAlreadyDone;\n    return retVal\n}\n\nfunc (p *PegPuzzle) doMove(move Move){\n    p.movesAlreadyDone.Push(move);\n}\n\nfunc (p *PegPuzzle) printPuzzleInfo(){\n    fmt.Printf(\"-----------START----------------------\\n\");\n    fmt.Printf(\"moves already done: %v\\n\", p.movesAlreadyDone);\n    fmt.Printf(\"------------END-----------------------\\n\");\n}\n\nfunc main() {\n    p := new(PegPuzzle);\n    cp1 := new(PegPuzzle);\n    cp2 := new(PegPuzzle);\n\n    p.InitPegPuzzle();\n\n    cp1 = NewChildPegPuzzle(p);\n    cp1.doMove(Move{1,1,2,3});\n    cp1.printPuzzleInfo();\n\n    cp2 = NewChildPegPuzzle(p);\n    cp2.doMove(Move{3,2,5,1});\n    cp2.printPuzzleInfo();\n}\n\nAny help will be greatly appreciated. Thanks!", "output": "Incidental to the answer, but vector.New has been deleted from recent versions of Go. You need to write\nfunc (p *PegPuzzle) InitPegPuzzle(){\n    p.movesAlreadyDone = new (vector.Vector);\n}\n\nIn your original code, the things you are copying are pointers to vectors. This is just the same as pointers in C. You can call it \"by reference\" if you like, but they're pointers.\nTo copy an entire vector, use InsertVector:\nfunc (p *PegPuzzle) InitPegPuzzle(){\n    p.movesAlreadyDone = new (vector.Vector);\n}\n\nfunc NewChildPegPuzzle(parent *PegPuzzle) *PegPuzzle{\n    retVal := new (PegPuzzle);\n    retVal.InitPegPuzzle ();\n    retVal.movesAlreadyDone.InsertVector (0, parent.movesAlreadyDone);\n    return retVal\n}\n\nThis gives a complete unique copy."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why do I need a semicolon here?\n\nQuestion:\nHere is a test Go program:\npackage main\nimport fmt \"fmt\"\nfunc main () {\n    ex := \"moo cow\\n\";\n    fmt.Print (ex)\n}\n\nWith the semicolon, it compiles. However, if the semicolon is removed, it doesn't:\n\nstring.go:5: syntax error near fmt\n\nAny ideas?\n\nUpdate (March 2012): Newer Go releases are able to compile both forms (with and without the semicolon).", "output": "From The Go Programming Language Specification:\n\nElements of a list of statements are\n  separated by semicolons, which may be\n  omitted only if the previous\n  statement:\n\nends with the closing parenthesis \")\" of a list of declarations; or\nends with a closing brace \"}\" that is not part of an expression."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why is this Go code blocking?\n\nQuestion:\nI wrote the following program:\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc processevents(list chan func()) {\n    for {\n        //a := <-list\n        //a()\n    }\n}\n\nfunc test() {\n    fmt.Println(\"Ho!\")\n}\n\nfunc main() {\n\n    eventlist := make(chan func(), 100)\n\n    go processevents(eventlist)\n\n    for {\n        eventlist <- test\n        fmt.Println(\"Hey!\")\n    }\n}\n\nSince the channel eventlist is a buffered channel, I think I should get at exactly 100 times the output \"Hey!\", but it is displayed only once. Where is my mistake?", "output": "Update (Go version 1.2+)\nAs of Go 1.2, the scheduler works on the principle of pre-emptive multitasking.\nThis means that the problem in the original question (and the solution presented below) are no longer relevant.\nFrom the Go 1.2 release notes\n\nPre-emption in the scheduler\nIn prior releases, a goroutine that was looping forever could starve out other goroutines\n  on the same thread, a serious problem when GOMAXPROCS provided only one user thread.\n  In Go > 1.2, this is partially addressed: The scheduler is invoked occasionally upon\n  entry to a function. This means that any loop that includes a (non-inlined) function\n  call can be pre-empted, allowing other goroutines to run on the same thread.\n\nShort answer\nIt is not blocking on the writes. It is stuck in the infinite loop of processevents.\nThis loop never yields to the scheduler, causing all goroutines to lock indefinitely.\nIf you comment out the call to processevents, you will get results as expected, right until the 100th write. At which point the program panics, because nobody reads from the channel.\nAnother solution is to put a call to runtime.Gosched() in the loop.\nLong answer\nWith Go1.0.2, Go's scheduler works on the principle of Cooperative multitasking.\nThis means that it allocates CPU time to the various goroutines running within a given OS thread by having these routines interact with the scheduler in certain conditions.\nThese 'interactions' occur when certain types of code are executed in a goroutine.\nIn go's case this involves doing some kind of I/O, syscalls or memory allocation (in certain conditions).\nIn the case of an empty loop, no such conditions are ever encountered. The scheduler is therefore never allowed to run its scheduling algorithms for as long as that loop is running. This consequently prevents it from allotting CPU time to other goroutines waiting to be run and the result you observed ensues: You effectively created a deadlock that can not be detected or broken out of by the scheduler.\nThe empty loop is usually never desired in Go and will, in most cases, indicate a bug in the program. If you do need it for whatever reason, you have to manually yield to the scheduler by calling runtime.Gosched() in every iteration.\nfor {\n    runtime.Gosched()\n}\n\nSetting GOMAXPROCS to a value > 1 was mentioned as a solution. While this will get rid of the immediate problem you observed, it will effectively move the problem to a different OS thread, if the scheduler decides to move the looping goroutine to its own OS thread that is. There is no guarantee of this, unless you call runtime.LockOSThread() at the start of the processevents function. Even then, I would still not rely on this approach to be a good solution. Simply calling runtime.Gosched() in the loop itself, will solve all the issues, regardless of which OS thread the goroutine is running in."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Where can I find a Vim syntax file for the go language?\n\nQuestion:\nHas anyone created a vim syntax file for the go language?", "output": "go.vim\nThere is also a syntax file on vim.org."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go string to ascii byte array\n\nQuestion:\nHow can I encode my string as ASCII byte array?", "output": "If you're looking for a conversion, just do byteArray := []byte(myString)\nThe language spec details conversions between strings and certain types of arrays (byte for bytes, int for Unicode points)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Dynamically create variables of certain type based on string in Go\n\nQuestion:\nSimple version\nHow can you create a variable of a certain type based upon the value of a string?\ntype ta struct { a int }\ntype tb struct { b float }\ntype tc struct { c string }\n\nt := \"tb\"\nv := MagicVarFunc(t) // Returns a new allocated var of type interface{}\nv.(tb).b = 8.3\n\nThe true example\nIn my, surprisingly enough, working example below, I am dynamically creating variables based on a string. This is done by registering each struct type in a map with the string being the key and a nil-pointer of the type being the value.\nEach type implements an interface with the method New() which returns a new variable of that specific type.\nThe example below is very close to what I wish to do, where each action has a set of JSON encoded data which will populate the corresponding struct. The way I've structured it is also because I wish to be able to create new stand alone actions that I register to the map.\nI am not sure if am abusing the language now.\nMay anyone give me any pointers if I am completely out of my mind? Is there an obviously easier way?\npackage main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\n// All I require of an action is that it may be executed\ntype ActionHandler interface {\n    Exec()\n    New() ActionHandler\n}\n\n// My list of actions\nvar mActions = make(map[string]ActionHandler)\n\n// Action Exit (leaving the program)\ntype aExit struct {}\nfunc (s *aExit) Exec() { fmt.Println(\"Good bye\") }\nfunc (s *aExit) New() ActionHandler { return new(aExit) }\nfunc init() {\n    var a *aExit\n    mActions[`exit`] = a\n}\n\n// Action Say (say a message to someone)\ntype aSay struct {\n    To  string\n    Msg string\n}\nfunc (s *aSay) Exec() { fmt.Println(`You say, \"` + s.Msg + `\" to ` + s.To) }\nfunc (s *aSay) New() ActionHandler { return new(aSay) }\nfunc init() {\n    var a *aSay\n    mActions[`say`] = a\n}\n\nfunc inHandler(action string, data []byte) {\n    a := mActions[action].New()\n    json.Unmarshal(data, &a)\n    a.Exec()\n}\n\nfunc main(){\n    inHandler(`say`, []byte(`{\"to\":\"Sonia\",\"msg\":\"Please help me!\"}`))\n    inHandler(`exit`, []byte(`{}`))\n}", "output": "You can use reflection to get the zero value of, or to allocate a new value (like new) of a type using reflection, if you can get the Type value at runtime. However, I don't think there is a way to get the Type from a string. You would need to have a value of that type to get the type itself.\nI adopted your idea, of using a map. I map the string to the type itself, which you can get using reflect.TypeOf, which gets the type out of an interface value. Then I used reflect.Zero to get the zero value of that type (a convenient value that exists for every type). Then I got the value out as an interface.\npackage main\nimport \"reflect\"\n\ntype ta struct { a int }\ntype tb struct { b float64 }\ntype tc struct { c string }\n\nvar mActions map[string]reflect.Type = make(map[string]reflect.Type)\nfunc init() {\n  var a ta\n  mActions[`ta`] = reflect.TypeOf(a)\n  var b tb\n  mActions[`tb`] = reflect.TypeOf(b)\n  var c ta\n  mActions[`tc`] = reflect.TypeOf(c)\n}\n\nfunc MagicVarFunc(action string) interface{} {\n  return reflect.Zero(mActions[action]).Interface()\n}\n\nfunc main() {\n  t := \"tb\"\n  v := MagicVarFunc(t) // Returns a new allocated var of type interface{}\n  x := v.(tb)\n  x.b = 8.3\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Programs have to access to global variables in package\n\nQuestion:\nI've a package with global variables related to a file open\n(*os.File), and its logger associated.\nBy another side, I'll build several commands that are going to use\nthat package and I want not open the file to set it as logger every\ntime I run a command.\nSo, the first program to run will set the global variables, and here\nis my question:\n\nDo the next programs to use the package can access to those global\nvariables without problem? It could be created a command with a flag\nto initialize those values before of be used by another programs, and\nanother flag to finish it (unset the global variables in the package). \nIf that is not possible, which is the best option to avoid such IO-bound? To use a server in Unix sockets?", "output": "Assuming by 'program' you actually mean 'process', the answer is no.\nIf you want to share a (customized perhaps) logging functionality between processes then I would consider a daemon-like (Go doesn't yet AFAIK support writing true daemons) process/server and any kind of IPC you see handy."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Managing sessions in Go\n\nQuestion:\nAre there some Go libraries for sessions?\nUsing Python/Django there wasn't any problem.\nI am new to Go and I haven't found anything about it. So, are there general sessions support for Go? Are there some frameworks with sessions support? (It seems web.go has no sessions support, doesn't it?)", "output": "Gorilla's sessions package is the one I use and I guess the best choice for most projects. Gorilla also offers a lower-level package, securecookie.\nOther options include seshcookie and authcookie."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to draw in X11 with Go\n\nQuestion:\nI've been looking into draw and draw.x11 packages that come with Go. I didn't find out a simple way to draw a line on a X11 window.\nWhere I can find some simple 2D drawing examples?", "output": "I found myself the answer, here it goes a simple example:\npackage main\n\nimport (\n    \"os\"\n    \"time\"\n    \"image\"\n    \"exp/draw/x11\"\n)\n\nfunc main() {\n    win, _ := x11.NewWindow()\n    color := image.RGBAColor{255, 255, 255, 255}\n\n    img := win.Screen()\n    for i, j := 0, 0; i < 100 && j < 100; i, j = i + 1, j + 1 {\n        img.Set(i, j, color)\n    }\n\n    win.FlushImage()\n    time.Sleep(10 * 1000 * 1000 * 1000)\n    win.Close()\n    os.Exit(0)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to properly call JSON-RPC in Go?\n\nQuestion:\nI've been trying various configurations in order to call a simple JSON-RPC server for Bitcoin in Go, but didn't manage to get anywhere.\nIn Python, the entire code looks like:\nfrom jsonrpc import ServiceProxy\naccess = ServiceProxy(\"http://user:pass@127.0.0.1:8332\")\nprint access.getinfo()\n\nBut in Go, I seem to be bumping into erros like \"too many colons in address\", or \"no such host\". I've tried using both of the packages rpc and rpc/jsonrpc, using methods Dial and DialHTTP, using various network parameters and still can't get anywhere.\nSo, how do I properly call a JSON-RPC server in Go?", "output": "The jsonrpc package doesn't support json-rpc over HTTP at the moment. So, you can't use that, sorry.\nBut the jsonrpc specification is quite simple and it's probably quite easy to write your own jsonrpchttp (oh, I hope you know a better name) package.\nI was able to call \"getinfo\" succesfully using the following (horrible) code:\npackage main\n\nimport (\n    \"encoding/json\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n)\n\nfunc main() {\n    data, err := json.Marshal(map[string]interface{}{\n        \"method\": \"getinfo\",\n        \"id\":     1,\n        \"params\": []interface{}{},\n    })\n    if err != nil {\n        log.Fatalf(\"Marshal: %v\", err)\n    }\n    resp, err := http.Post(\"http://bob:secret@127.0.0.1:8332\",\n        \"application/json\", strings.NewReader(string(data)))\n    if err != nil {\n        log.Fatalf(\"Post: %v\", err)\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatalf(\"ReadAll: %v\", err)\n    }\n    result := make(map[string]interface{})\n    err = json.Unmarshal(body, &result)\n    if err != nil {\n        log.Fatalf(\"Unmarshal: %v\", err)\n    }\n    log.Println(result)\n}\n\nMaybe you can clean it up a bit by implementing the rpc.ClientCodec interface (see jsonrpc/client.go for an example). Then you can take advantage of Go's rpc package."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to execute command which requires input from user\n\nQuestion:\nI want to execute perforce command line \"p4\" from Go to do the login job. \"p4 login\" require user to input password. \nHow can I run a program that requires user's input in Go?\nThe following code doesn't work. \nerr  = exec.Command(p4cmd, \"login\").Run()\nif err != nil {\n    log.Fatal(err)\n}", "output": "From the os/exec.Command docs:\n// Stdin specifies the process's standard input. If Stdin is\n// nil, the process reads from the null device (os.DevNull).\nStdin io.Reader\n\nSet the command's Stdin field before executing it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Appending maps to a map in Go\n\nQuestion:\nI am trying to build a map[string]map[string]string which will look something like this:\n{ \"notes\": \n    {\n    \"Title\":note.Title,\n    \"Body\":note.Body,\n    },\n    {\n    \"Title\":note.Title,\n    \"Body\":note.Body,\n    },\n    {\n    \"Title\":note.Title,\n    \"Body\":note.Body,\n    },\n}\n\nfrom a struct (notes) of structs (note)\nI have thought of doing it like this:\nfor _, note := range notes {\n        thisNote := map[string]string{\n            \"Title\":note.Title,\n            \"Body\":note.Body,\n        }\n\n        content[\"notes\"] = append(content[\"notes\"], thisNote)\n}\n\nBut obviously that is not going to work because I am trying to append a map to a map rather than a slice.\nIs there a really easy solution to this that I am missing?", "output": "I'm pretty sure you can use a struct like this instead since mustache receives the data as an interface{}\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    var data struct {\n        Notes []*Note\n    }\n\n    notes := ...\n    data.Notes = notes\n    tmpl := ...\n    templ.Render(data, w)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I make go find my package?\n\nQuestion:\nWhere should I put my package so that it can be imported by another package?\n$ tree\n.\n├── main.go\n└── src\n    └── test.go\n\n1 directory, 2 files\n\n$ cat src/test.go \npackage test\n\n$ cat main.go \npackage main\n\nimport \"test\"\n\n$ go build main.go \nmain.go:3:8: import \"test\": cannot find package", "output": "Set your GOPATH. Put your package foo source(s) in GOPATH/src/optional-whatever/foo/*.go and use it in code as\nimport \"optional-whatever/foo\"\n\nYou don't need to explicitly install foo, the go tool is a build tool, it will do that automagically for you whenever necessary."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: snipMate filetype isn't set correctly\n\nQuestion:\nI downloaded vim and used it in a python file and the snippets worked perfectly. But when I tried to use snipMate in a .go file (golang) it didn't work. I read the documentation and couldn't find an answer but when I manually used the command \":set ft=go\"\nthe snippets worked. Why does snipMate automatically work for python and not go. Snippet files for both languages are supplied. How do I get snippets for go to automatically work?", "output": "It sounds like your .go files aren't getting set to the appropriate filetype. You can use\nau BufRead,BufNewFile *.go setl ft=go\n\nin your ~/.vimrc to remedy this.\nThe appropriate place for files like this is in your ~/.vim/ftdetect directory. For instance, you could create a file called ~/.vim/ftdetect/go.vim and put the command in there."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Composition and multiple inheritance\n\nQuestion:\nSince Go uses an composition system instead of (multiple) inheritance, I'm just wondering about these 3 code snippets. Go says they force the programmer to use composition.\nA) should be (almost) correct Go-Code,\nB) pseudo\nC) pseudo\nImho the result will always be the same on all three codes, beside the fact, that B) and C) can be used for even more stuff and A) forces you to stick to composition?\nEven if you assume B) to not have the sort-method inside of the class but - lets say global like A) doesn't make a real difference oO\nA) Go code:\ninterface Sort\n    Len()\n    Less(i, j int) bool\n    Swap(i, j int)\n\nfunc (qs *Sort) sort()\n    doTheSorting\n\ntype MyData struct {\n    var value int\n}\n\nfunc (s *MyData) Len() { ... }\nfunc (s *MyData) Less(i, j int) bool { ... }\nfunc (s *MyData) Swap(i, j int) { ... }\n\nB) Looks like Inheritance but can imho be seen as embedded, according to how the compiler works.\nclass Sort\n\n    public sort() { ... }\n\n    abstract Len()\n    abstract Less(i, j int) bool\n    abstract Swap(i, j int)\n\nC)\ninterface SortInterface\n    void Len()\n    bool Less(i, j int)\n    void Swap(i, j int)\n\nclass Sort implements SortInterface\n    public sort() { ... }\n\nUsage B and C:\nclass MyClass **embed** Sort\n\n    int value\n\n    void Len() { ... }\n    bool Less(i, j int) { ... }\n    void Swap(i, j int) { ... }", "output": "No this is not how go works. Here is an example (pulled from the standard library) of a type that can be sorted.\ntype IntSlice []int\n\nfunc (p IntSlice) Len() int           { return len(p) }\nfunc (p IntSlice) Less(i, j int) bool { return p[i] < p[j] }\nfunc (p IntSlice) Swap(i, j int)      { p[i], p[j] = p[j], p[i] }\n\nThis implements the interface:\n// Name of interface changed for clarity\ntype Sort interface {\n    Len() int\n    Less(i, j int) bool\n    Swap(i, j int)\n}\n\nA type which implement the Sort interface does not get a new method. You can not assign a method to an interface such as in your example func (qs *Sort) sort() {...}.\nHowever, it is allowed to be passed to functions and methods expecting a variable of type Sort. Because of this, I am able to call sort.Sort(myIntSlice) and it will then be sorted.\nHere is an example function which takes any parameter that implements the Sort interface:\nfunc IsSorted(data Sort) bool {\n    n := data.Len()\n    for i := n - 1; i > 0; i-- {\n        if data.Less(i, i-1) {\n            return false\n        }\n    }\n    return true\n}\n\nIn IsSorted, the function has no idea what the true type of data is. It could be IntSlice or anything else. What it does know is that whatever parameter you gave it implements the methods in the Sort interface.\nI do not seem to be able to figure out the question you asked however. Also, psuedo code is very difficult to understand. Using another language such as java would have been better."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a way to get Go to compile and link in one step (6g and 6l at once)?\n\nQuestion:\nI'm trying to search Google but the keyword 'go' makes it difficult to find any useful answers.\nReading the http://golang.org/ page doesn't turn up anything useful either.\nRight now, I have a simple function in my bash.rc:\nfunction gogo() {\n    6g -o gotmp.tmp $@;\n    6l -o go.out gotmp.tmp;\n    rm -f gotmp.tmp;\n}\n\nHowever, this is not perfect. It would be nice for something built in (perhaps something like gogcc but using 6g/6l backend).\nThanks!", "output": "Do you have a reason to not use a build system? \nThere is a ready made Makefile in $GOROOT/doc/. Other build systems: What build systems work with Go?"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Extract links from a web page using Go lang\n\nQuestion:\nI am learning google's Go programming language. Does anyone know the best practice to extract all URLs from a html web page?\nComing from the Java world, there are libraries to do the job, for example jsoup , htmlparser, etc. But for go lang, I guess no available similar library was made yet?", "output": "Go's standard package for HTML parsing is still a work in progress and is not part of the current release.  A third party package you might try though is go-html-transform.  It is being actively maintained."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go Compiler for Windows\n\nQuestion:\nI have found in some web article that go has Windows compiler. Can anybody suggest me the web address where I can download it and some information about how to install it and commands for run a code? Thanks in advance.", "output": "Go Windows downloads"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Synchronized channels?\n\nQuestion:\nSuppose I'm parsing some kind of input with the following three methods:\nfunc parseHeader ([]byte) []byte\nfunc parseBody   ([]byte) []byte\nfunc parseFooter ([]byte) []byte\n\nThey all parse a certain part of the same input and return it as []byte, so they can be used like this:\ni := []byte( /* the input */ )\nb := new(bytes.Buffer)\n\nb.Write(parseHeader(i))\nb.Write(parseBody(i))\nb.Write(parseFooter(i))\n\nNow I'd like to make these 3  processes parallel by using channels. My idea was passing a channel to these functions for them to write to, but how can I make sure they will write in the correct order to the channel? (i.e. that the body is written to the channel after the header and the footer after the body)", "output": "Essentially you can't, at least not without adding an additional layer of messages to do extra hand-shaking. What would be better to do is to use three separate channels and read from them in the order you want to receive them, that way you don't need to worry about the write-order of the sending processes.\nHere's a minimal example:\npackage main\n\nimport \"fmt\"\n\nfunc sendme(num int, ch chan int) {\n        ch <- num // send integer 'num' down chan ch\n}\n\nfunc main() {\n        // Create three new channels\n        one := make(chan int)\n        two := make(chan int)\n        three := make(chan int)\n\n        // Start each parallel invocation of \"sendme\" as a go routine, in any order\n        go sendme(3, three)\n        go sendme(1, one)\n        go sendme(2, two)\n\n        // Read from each channel in the order we wish to process the\n        // data\n        fmt.Println(<- one, <- two, <- three)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: In Go, how do I create a \"constructor\" for a type with a string base type?\n\nQuestion:\ntrying to have a type Char that is a string one character long.  what I'm unable to do is create a \"constructor\".  I know I'm missing something completely obvious.\ndeclare the Char type\n\n  type Char string\n\ncan use that type with a declaration\n\n  var c1 Char(\"abc\")\n  var c2 Char = \"abc\"\n\nthese are wrong:  c1 and c2 need to be \"a\", not \"abc\"\nwhat I really want is a \"constructor\" to limit Char to one character\n\n func Char( s string ) Char {\n   var ch string = s[0]\n   return ch\n }\n\nof course having the type Char and func Char is not the way to do it\n\n type.go:8: Char redeclared in this block\n\nis there any way for to force type initialization through a constructor?  or am I even asking the correct question?\nlet me state differently: if the user says var c Char = \"abc\" they will have an invalid value for type Char - is there any way to force the user into func NewChar(string) Char as Char's only valid constructor?", "output": "This is the char package. Note the unexported Char struct field c.\npackage char\n\ntype Char struct {\n    c rune\n}\n\nfunc New(c rune) *Char {\n    return &Char{c}\n}\n\nfunc (c *Char) Char() rune {\n    return c.c\n}\n\nfunc (c *Char) String() string {\n    return string(c.c)\n}\n\nHere's an example of how to use the char package.\npackage main\n\nimport (\n    \"char\"\n    \"fmt\"\n)\n\nfunc main() {\n    var c = char.New('z')\n    var d = c.Char()\n    hello := \"Hello, world; or สวัสดีชาวโลก\"\n    h := []rune(hello)\n    ก := char.New(h[len(h)-1])\n    fmt.Println(c, \"a-\"+c.String(), '0' <= d && d <= '9', ก)\n}\n\nOutput:\nz a-z false ก"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go template function\n\nQuestion:\nIt noticed a weird thing with Go templates when I try to use Funcs and FuncMap. The following code works as expected:\nbuffer := bytes.NewBufferString(\"\")\n\nfuncMap := template.FuncMap{\n    \"label\": strings.Title,\n}\n\nt, _ := template.New(\"alex\").Funcs(funcMap).Parse(\"{{label \\\"alex\\\"}}\") \n\nt.Execute(buffer, \"\")\n\nreturn string(buffer.Bytes()) //=> \"Alex\"\n\nBut when I try to put the template in a file, it does not work (Execute() says: \"alex\" is an incomplete or empty template):\nt, _ := template.New(\"alex\").Funcs(funcMap).ParseFiles(\"template.html\") \n\nWith template.html:\n{{label \\\"alex\\\"}}\n\nAny idea why ? Is this a bug ? Are there simpler ways to use methods/functions in templates ?", "output": "ParseFiles could probably use better documentation.  A template object can have multiple templates in it and each one has a name.  If you look at the implementation of ParseFiles, you see that it uses the filename as the template name inside of the template object.  So, name your file the same as the template object, (probably not generally practical) or else use ExecuteTemplate instead of just Execute."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Printing Issue with Concurrent Routines in Go\n\nQuestion:\nI have three concurrent routines like this,\nfunc Routine1() {\n\nPrint (value a, value b, value c)\nPrint (value a, value b, value c)\nPrint (value a, value b, value c)\n\n}\n\nfunc Routine2() {\nPrint (value e, value f, value g)\nPrint (value e, value f, value g)\nPrint (value e, value f, value g)\n}\nfunc Routine3() {\nPrint (value x, value y, value z)\nPrint (value x, value y, value z)\nPrint (value x, value y, value z)\n}\n\nfunc main() {\ngo Routine1(command12, response12, command13, response13)\ngo Routine2(command12, response12, command23, response23)\nRoutine3(command13, response13, command23, response23)\n}\n\nNow what problem I am facing is, sometimes it will happen that, as the result of three concurrent routines, sometimes the print statement is not executing properly means not printing whole, there is some thing inserted by another print. For example,  Print (value a, value b, value c) of routine 1 gives output like value a, value b, value g where value g is inserted by routine 2. Can anybody suggest me, how can I stop it ? I have tried sync-mutex procedure. However may be as my code is too long and may be I can not put lock-unlock in a right way, so it is giving a deadlock error. Can anybody suggest me how can I implement those in a simple way or in a less risky sync-mutex procedure.\nMore info about this problem of mine can be found here.", "output": "Printing as you describe it is not an atomic operation. Instead of using mutexes, try the Go way. Pass a channel into each goroutine which accepts a string. Every time you want to print something, just send the string into that channel.\nA separate goroutine does nothing more than read from that channel and prints whatever comes out. This way there is no need for locks.\npackage main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(2) // 2 routines we need to wait for.\n\n    stdout := make(chan string)\n\n    go routine1(&wg, stdout)\n    go routine2(&wg, stdout)\n    go printfunc(stdout)\n\n    wg.Wait()\n\n    close(stdout)\n}\n\nfunc routine1(wg *sync.WaitGroup, stdout chan<- string) {\n    defer wg.Done()\n\n    stdout <- \"first print from 1\"\n    // do stuff\n    stdout <- \"second print from 1\"\n}\n\nfunc routine2(wg *sync.WaitGroup, stdout chan<- string) {\n    defer wg.Done()\n\n    stdout <- \"first print from 2\"\n    // do stuff\n    stdout <- \"second print from 2\"\n}\n\nfunc printfunc(stdout <-chan string) {\n    for {\n        select {\n        case str := <- stdout:\n            fmt.Println(str)\n        }\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to check if a file exists in Go?\n\nQuestion:\nGo's standard library does not have a function solely intended to check if a file exists or not (like Python's os.path.exists). What is the idiomatic way to do it?", "output": "To check if a file doesn't exist, equivalent to Python's if not os.path.exists(filename):\nif _, err := os.Stat(\"/path/to/whatever\"); errors.Is(err, os.ErrNotExist) {\n  // path/to/whatever does not exist\n}\n\nTo check if a file exists, equivalent to Python's if os.path.exists(filename):\nEdited: per recent comments\nif _, err := os.Stat(\"/path/to/whatever\"); err == nil {\n  // path/to/whatever exists\n\n} else if errors.Is(err, os.ErrNotExist) {\n  // path/to/whatever does *not* exist\n\n} else {\n  // Schrodinger: file may or may not exist. See err for details.\n\n  // Therefore, do *NOT* use !os.IsNotExist(err) to test for file existence\n\n\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: In Go, does it make sense to write non-blocking code?\n\nQuestion:\ncoming from node.js point of view, where all code is non-blocking.\nIn Go, non-blocking is easily achieved using channels.\nif one were writing a node.js type server in go, does it make sense to make it non-blocking?  for example, having a database connect() function return a channel, as versus blocking while waiting for the connection to occur.\nto me, this seems the correct approach\nbut ...", "output": "Blocking and non-blocking aren't really about performance, they are about an interface.\nIf you have a single thread of execution then a blocking call prevents your program from doing any useful work while it's waiting.\nBut if you have multiple threads of execution a blocking call doesn't really matter because you can just leave that thread blocked and do useful work in another.\nIn Go, a goroutine is swapped out for another one when it blocks on I/O. The Go runtime uses non-blocking I/O syscalls to avoid the operating system blocking the thread so a different goroutine can be run on it while the first is waiting for it's I/O.\nGoroutines are really cheap so writing non-blocking style code is not needed."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Organizing a multiple-file Go project\n\nQuestion:\nNote: this question is related to this one, but two years is a very long time in Go history.\nWhat is the standard way to organize a Go project during development ?\nMy project is a single package mypack, so I guess I put all the .go files in a mypack directory.\nBut then, I would like to test it during development so I need at least a file declaring the main package, so that I can do go run trypack.go\nHow should I organize this ? Do I need to do go install mypack each time I want to try it ?", "output": "I would recommend reviewing this page on How to Write Go Code\nIt documents both how to structure your project in a go build friendly way, and also how to write tests. Tests do not need to be a cmd using the main package. They can simply be TestX named functions as part of each package, and then go test will discover them.\nThe structure suggested in that link in your question is a bit outdated, now with the release of Go 1. You no longer would need to place a pkg directory under src. The only 3 spec-related directories are the 3 in the root of your GOPATH:  bin, pkg, src . Underneath src, you can simply place your project mypack, and underneath that is all of your .go files including the mypack_test.go\ngo build will then build into the root level pkg and bin.\nSo your GOPATH might look like this:\n~/projects/\n    bin/\n    pkg/\n    src/\n      mypack/\n        foo.go\n        bar.go\n        mypack_test.go\n\nexport GOPATH=$HOME/projects\n$ go build mypack\n$ go test mypack\n\nUpdate: as of >= Go 1.11, the Module system is now a standard part of the tooling and the GOPATH concept is close to becoming obsolete."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to access individual values from a multi-value returning function?\n\nQuestion:\nGo functions can return multiple values:\nfunc f() (int, int) {\n    return 2, 3\n}\n\nIs there any way to access individual values from such a multi-value returning function except assignment, i.e. suppose there is \nfunc g(i int) {...}\n\nis there is simpler way to write the following two lines?\n_, i = f()\ng(i)", "output": "My personal favorite would be g(f()[1]) but that's not possible either.\nThe current solution used by the standard library is to write simple helper functions which are dropping the unwanted return values. For example, take a look at the template package.\nA lot of functions there return a (*Template, os.Error) tuple, but there is a helper called template.Must() which only returns a *Template and panics if the error isn't nil.\nAlternatively, a general helper function like func extract(index int, values ...interface{}) interface{} might do the trick. But since there isn't support for generics yet, I wouldn't write something like that."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go, DER and handling big integers\n\nQuestion:\nI want to create a Google Go application that will be able to DER encode and decode big integers (namely, ECDSA signature r and s). From what I understand I should use the asn1 package, but what functions should I be calling?\nFor example, I want to encode \n316eb3cad8b66fcf1494a6e6f9542c3555addbf337f04b62bf4758483fdc881d\n\nand\nbf46d26cef45d998a2cb5d2d0b8342d70973fa7c3c37ae72234696524b2bc812\n\nto get this:\n30450220316eb3cad8b66fcf1494a6e6f9542c3555addbf337f04b62bf4758483fdc881d022100bf46d26cef45d998a2cb5d2d0b8342d70973fa7c3c37ae72234696524b2bc81201\n\nand vice versa. Which function should I call for encoding, and which for decoding and how?", "output": "You need to encode an ASN.1 sequence containing both r and s integers as follows:\nECDSA-Sig-Value ::= SEQUENCE {\n  r INTEGER,\n  s INTEGER }\n\nPlease note that I am not a Go developer but according to the documentation Marshal and Unmarshal functions seems to accept structs in order to encode/decode ASN.1 sequences.\nThis code sample seems to work for both encoding and decoding:\npackage main\n\nimport (\n    \"fmt\"\n    \"big\"\n    \"asn1\"\n)\n\ntype ecdsa struct {\n    R, S *big.Int\n}\n\nfunc main() {\n    r, _ := new(big.Int).SetString(\"316eb3cad8b66fcf1494a6e6f9542c3555addbf337f04b62bf4758483fdc881d\", 16);\n    s, _ := new(big.Int).SetString(\"bf46d26cef45d998a2cb5d2d0b8342d70973fa7c3c37ae72234696524b2bc812\", 16);\n    sequence := ecdsa{r, s}\n    encoding, _ := asn1.Marshal(sequence)\n    fmt.Println(encoding)\n    dec := new(ecdsa)\n    asn1.Unmarshal(encoding, dec)\n    fmt.Println(dec)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GO-OpenGL LoadMatrixd and GetDoublev issue\n\nQuestion:\ngl.MatrixMode(gl.MODELVIEW)\ngl.PushMatrix()\n\nm := new([16]float64)\nsetIdentity(m)\n\ngl.LoadMatrixd((*gl.GLdouble)(&m[0]))\ngl.Rotated(90, 0, 1, 0)\ngl.GetDoublev(gl.MODELVIEW_MATRIX, (*gl.GLdouble)(&m[0]))\ngl.PopMatrix()\n\nfmt.Printf(\"%f\", m[0])\n// m[0] == forward.x\n\nThe contents of m doesn't not change after the GetDoublev. I am trying to port some C code (which works and it basically this). What am I doing wrong?\nThe C code as requested:\n//m is float[16] set to identity\nglMatrixMode(GL_MODELVIEW);\nglPushMatrix();\n\nglLoadMatrixf(m);\nglRotatef(90, 0,1,0);\nglGetFloatv(GL_MODELVIEW_MATRIX, m);\nglPopMatrix();", "output": "You must call sdl.SetVideoMode() before you can use Matrix functions."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Do const if statements do the same thing as #ifdef macros in Go?\n\nQuestion:\nThere's no text preprocessing in Go. Like Java and others like it, if I want to remove a block of code I can use a const value and surround the code with an if.\nIf I do this, does the compiler optimise the code from the AST and out of the generated code? Or is the condition executed each time?\nEDIT: If I want to replicate #ifdef what's the best way to do it?", "output": "If statements with constant conditions are not the same as #ifdef because the code inside is always compiled no matter what. However, the compilers do optimize it away when possible. Consider this program:\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    if false {\n        fmt.Println(\"Hello, world!\")\n    }\n}\n\nIf we run go tool 6g -S test.go, here's the assembly output for the main function:\n--- prog list \"main\" ---\n0000 (test.go:7) TEXT    main+0(SB),$40-0\n0001 (test.go:11) RET     ,\n\nThe dead code is gone so all it does is return.\nIf you do need to actually conditionally compile parts of your code, it's best to do it through the build system."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: variable declared and not used in a for loop\n\nQuestion:\nThis one has come up a couple times for Go here, but I think my experience is unique.  Here are my codes.\ntype Stack []Weight\n\nfunc newStack( size int, startSpread Spread ) Stack {\n  stack := make(Stack, size)\n\n  for _, curWeight := range stack {\n    curWeight = Weight{ startSpread, rand.Float64( ), rand.Float64( ) }\n  }\n\n  return stack\n}\n\nWhy is gc telling me I'm not using curWeight?", "output": "Please note that the range construct (for _, curWeight := range stack) does copy the elements, one after another. So, you are just copying a value, and then you do not use the copy for any further computations, printing or returning. You just drop the copy again.\nSo I guess your initial idea was to add the weight to the stack and return it. Let`s do that:\nfunc newStack(size int, startSpread Spread) Stack {\n    stack := make(Stack, size)\n\n    for i := 0; i < size; i++ {\n        stack[i] = Weight{startSpread, rand.Float64(), rand.Float64()}\n    }\n\n    return stack\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: The number of bytes read and unsigned numbers\n\nQuestion:\nAs an example to clarify my question, in Google Go 1.0, the following interface is defined in the \"io\" package:\ntype Reader interface {\n    Read(p []byte) (n int, err error)\n}\n\nEspecially the result parameter list (n int, err error) intrigues me. Intrinsically the number of bytes can not be negative, according to the documentation of the interface:\n\nIt returns the number of bytes read (0 <= n <= len(p))[...]\n\nIn C the reason to use int was the in-band value -1 to signal an error condition (see Effective Go: Multiple return values). Because of multiple return values, special in-band values are not necessary.\nThere exists the type uint in Go 1.0.\nWhat is the specific reason for using int versus uint in the case of values that only use the positive range [0,∞) without the need for having special in-band values?", "output": "The de facto numeric type for integers in most cases is int. For example, len(x) and cap(x) return int values even though those too cannot be negative. In most cases returning an int helps avoid type conversions between different numeric types.\nSo yes, Read() could have returned a uint, but this would make it slightly more unwieldy to work with."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go IDE With GUI Design Support\n\nQuestion:\nI was taking a look on Go language, but I want to know if there is any IDE developed only for it, but that have a GUI design feature, as Visual Studio and Netbeans.", "output": "You can also find an Eclipse plugin here: http://code.google.com/p/goclipse/\nHowever, at the moment of writing this is still at an early development stage."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I get CMake to work with the go programming language?\n\nQuestion:\nI have been using CMake with C++ to build libraries and executables and would like to use the same for the go programming language.\nWhat steps do I need to take to configure CMake so it would work with the go programming language?\nEssentially, my compiler is 6g which produces a compiled foo.6 - I send it to a linker via 6l foo.6 and I am done.  I have the compiler and linker already built and installed.\nObviously, I can just write a simple Makefile for this, but it would be nice to use CMake consistently throughout my project.  \nTIA for any advice that would help me get started.", "output": "You might wish to implement CMake' support for Go. Roughly speaking it involves following steps:\n\nCreate CMakeDetermineGoCompiler.cmake module, which would find Go\ncompiler for the current system. \nCreate CMakeGoCompiler.cmake.in - a\ntemplate, which would be configured by CMakeDetermineGoCompiler.\nCreate CMakeTestGoCompiler.cmake, module which would compile a\nsimple go source to check if the compiler works. \nCreate CMakeGoInformation.cmake, which would set some language-related\nvariables (CMAKE_GO_LINK_EXECUTABLE and so on)\n\nThese things should be placed in CMAKE_MODULES_DIR. For reference you can take a look at how Java/CXX support is implemented.\nAlternatively, if don't want to mess with such internal stuff, you can solve your task by creating a macro(), which would create a bunch of custom targets/commands (see add_custom_{target,command}() documentation)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Store map key/values in a persistent file\n\nQuestion:\nI will be creating a structure more or less of the form:\ntype FileState struct {\n    LastModified int64\n    Hash string\n    Path string\n}\n\nI want to write these values to a file and read them in on subsequent calls.  My initial plan is to read them into a map and lookup values (Hash and LastModified) using the key (Path).  Is there a slick way of doing this in Go?\nIf not, what file format can you recommend?  I have read about and experimented with with some key/value file stores in previous projects, but not using Go.  Right now, my requirements are probably fairly simple so a big database server system would be overkill.  I just want something I can write to and read from quickly, easily, and portably (Windows, Mac, Linux).  Because I have to deploy on multiple platforms I am trying to keep my non-go dependencies to a minimum.\nI've considered XML, CSV, JSON.  I've briefly looked at the gob package in Go and noticed a BSON package on the Go package dashboard, but I'm not sure if those apply.\nMy primary goal here is to get up and running quickly, which means the least amount of code I need to write along with ease of deployment.", "output": "As long as your entiere data fits in memory, you should't have a problem. Using an in-memory map and writing snapshots to disk regularly (e.g. by using the gob package) is a good idea. The Practical Go Programming talk by Andrew Gerrand uses this technique.\nIf you need to access those files with different programs, using a popular encoding like json or csv is probably a good idea. If you just have to access those file from within Go, I would use the excellent gob package, which has a lot of nice features.\nAs soon as your data becomes bigger, it's not a good idea to always write the whole database to disk on every change. Also, your data might not fit into the RAM anymore. In that case, you might want to take a look at the leveldb key-value database package by Nigel Tao, another Go developer. It's currently under active development (but not yet usable), but it will also offer some advanced features like transactions and automatic compression. Also, the read/write throughput should be quite good because of the leveldb design."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Putting many PropertyList's into Google App Engine datastore (in Go) and loading them again with Query.GetAll\n\nQuestion:\nI am putting entities (as a datastore.PropertyList) into the datastore like this:\n// save one\nvar plist datastore.PropertyList = make(datastore.PropertyList, 3)\nplist = append(plist, datastore.Property { \"name\", \"Mat\", false, false })\nplist = append(plist, datastore.Property { \"age\", \"29\", false, false })\nplist = append(plist, datastore.Property { \"location\", \"London\", false, false })\nkey := datastore.NewIncompleteKey(context, \"Record\", nil)\ndatastore.Put(context, key, &plist)\n\n// save another one\nvar plist datastore.PropertyList = make(datastore.PropertyList, 3)\nplist = append(plist, datastore.Property { \"name\", \"Laurie\", false, false })\nplist = append(plist, datastore.Property { \"age\", \"27\", false, false })\nplist = append(plist, datastore.Property { \"location\", \"London\", false, false })\nkey := datastore.NewIncompleteKey(context, \"Record\", nil)\ndatastore.Put(context, key, &plist)\n\nThat all works fine (although the code above is more like pseudo code for now).  I am able to load them individually, and the datastore.PropertyList comes out with each field as its own datastore.Property.\nHowever, when I try to retrieve many of them using a Query, it fails:\nquery := datastore.NewQuery(\"Record\")\n\nplists := make(datastore.PropertyList, 0, 10)\nkeys, err := query.GetAll(context, &plists)\n\nI get the following error:\ndatastore: cannot load field \"age\" into a \"datastore.Property\": no such struct field\n\nIt seems that it doesn't complain about Name because that happens to be a valid property of datastore.Property, so how do I get it to load the items as intended, with each item in plists being a datastore.PropertyList instead of datastore.Property?", "output": "I changed the implementation to use the PropertyLoadSaver interface - you can see it working nicely in our new Active Record style wrapper for datastore: http://github.com/matryer/gae-records (see the record.go type's Load and Save methods)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Difficulty with Go Rand package\n\nQuestion:\nIs there any Go function which returns true pseudo random number in every run? What I actually mean is, consider following code,\npackage main\n\nimport (\n    \"fmt\"\n    \"rand\"\n)\n\nfunc main() {\n    fmt.Println(rand.Int31n(100))\n}\n\nEvery time I execute this code, I get the same output. Is there a method that will return different, random results each time that it is called?", "output": "The package rand can be used to generate pseudo random numbers, which are generated based on a specific initial value (called \"seed\").\nA popular choice for this initial seed is for example the current time in nanoseconds - a value which will probably differ when you execute your program multiple times. You can initialize the random generator with the current time with something like this:\nrand.Seed(time.Now().UnixNano())\n\n(don't forget to import the time package for that)\nThere is also another package called crypto/rand which can be used to generate better random values (this generator might also take the user's mouse movements, the current heat of the processor and a lot of other factors into account). However, the functions in this package are several times slower and, unless you don't write a pass-phrase generator (or other security related stuff), the normal rand package is probably fine."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: semicolon insertion ala google go with flex\n\nQuestion:\nI'm interested in adding semi-colon insertion ala Google Go to my flex file.\nFrom the Go documentation:\n\nSemicolons\nLike C, Go's formal grammar uses semicolons to terminate statements;\n  unlike C, those semicolons do not appear in the source. Instead the\n  lexer uses a simple rule to insert semicolons automatically as it\n  scans, so the input text is mostly free of them.\nThe rule is this. If the last token before a newline is an identifier\n  (which includes words like int and float64), a basic literal such as a\n  number or string constant, or one of the tokens\nbreak continue fallthrough return ++ -- ) }\n\nthe lexer always inserts a semicolon after the token. This could be\n  summarized as, “if the newline comes after a token that could end a\n  statement, insert a semicolon”.\nA semicolon can also be omitted immediately before a closing brace, so\n  a statement such as\ngo func() { for { dst <- <-src } }()\n\nneeds no semicolons. Idiomatic Go programs have semicolons only in\n  places such as for loop clauses, to separate the initializer,\n  condition, and continuation elements. They are also necessary to\n  separate multiple statements on a line, should you write code that\n  way.\nOne caveat. You should never put the opening brace of a control\n  structure (if, for, switch, or select) on the next line. If you do, a\n  semicolon will be inserted before the brace, which could cause\n  unwanted effects. Write them like this\nif i < f() {\n    g()\n}\n\nnot like this\nif i < f()  // wrong! \n{           // wrong!\n    g()     // wrong!\n}           // wrong!\n\n\nHow would I go about doing this (how can I insert tokens in the stream, how can I see the last token that was matched to see if it is a good idea, etc etc etc)?\nI am using bison too, but Go seems to just use their lexer for semicolon insertion.", "output": "You could pass lexer result tokens through a function that inserts semicolons where necessary. Upon detection of the need to insert, the next token can be put back to the input stream, basically lexing it again in the next turn.\nBelow is an example that inserts a SEMICOLON before a newline, when it follows a WORD. The bison file \"insert.y\" is this:\n%{\n#include <stdio.h>\n\nvoid yyerror(const char *str) {\n  printf(\"ERROR: %s\\n\", str);\n}\n\nint main() {\n  yyparse();\n  return 0;\n}\n%} \n%union {\n  char *string;\n}\n%token <string> WORD\n%token SEMICOLON NEWLINE\n%%\ninput: \n     | input WORD          {printf(\"WORD: %s\\n\", $2); free($2);}\n     | input SEMICOLON     {printf(\"SEMICOLON\\n\");}\n     ;\n%%\n\nand the lexer is generated by flex from this:\n%{\n#include <string.h>\n#include \"insert.tab.h\"\nint f(int token);\n%}\n%option noyywrap\n%%\n[ \\t]          ;\n[^ \\t\\n;]+     {yylval.string = strdup(yytext); return f(WORD);}\n;              {return f(SEMICOLON);}\n\\n             {int token = f(NEWLINE); if (token != NEWLINE) return token;}\n%%\nint insert = 0;\n\nint f(int token) {\n  if (insert && token == NEWLINE) {\n    unput('\\n');\n    insert = 0;\n    return SEMICOLON;\n  } else {\n    insert = token == WORD;\n    return token;\n  }\n}\n\nFor input \nabc def\nghi\njkl;\n\nit prints\nWORD: abc\nWORD: def\nSEMICOLON\nWORD: ghi\nSEMICOLON\nWORD: jkl\nSEMICOLON\n\nUnputting a non-constant token requires a little extra work - I have tried to keep the example simple, just to give the idea."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reference to string literals in Go\n\nQuestion:\nIn my application I will frequently pass references to a static string. I wish to avoid having Go allocate memory for each call, but I failed to get the address to my string literal.\nWhy is it not possible to take the address of a string literal (see test1() in the example below)? Have I misunderstood the syntax, or is it a limitation due to the internal workings of Go?\nIf not possible, what would be the best solution?\ntest2() works, but will it allocate memory for the var hej each time?\ntest3() will not allocate any new memory, but I wish to avoid clutter outside the function.  \npackage main\n\nimport \"fmt\"\n\nvar konnichiwa = `こんにちは世界`\n\n// Gives the compile error `cannot take the address of \"Hello world\"`\nfunc test1() (*string) { return &`Hello world` }\n\n// Works fine\nfunc test2() (*string) {\n    hej := `Hej världen`\n    return &hej\n}\n\nfunc test3() (*string) { return &konnichiwa }\n\nfunc main(){\n    fmt.Println(*test1())\n    fmt.Println(*test2())\n    fmt.Println(*test3())\n}\n\nThanks for help!", "output": "Taking the address of a literal (string, number, etc) is illegal because it has ambiguous semantics.\nAre you taking the address of the actual constant? Which would allow the value to be modified (and could lead to a runtime error) or do you want to allocate a new object, copy the constant over and get the address to the new version?\nThis ambiguity does not exist in the case of test2 since you are dealing with an existing variable of which the semantics are clearly defined. The same would not work if the string was defined as const.\nThe language spec avoids this ambiguity by explicitly not allowing what you are asking for. The solution is test2. While it is slightly more verbose, it keeps the rules simple and clean.\nOf course, every rule has its exceptions, and in Go this concerns composit literals: The following is legal and defined as such in the spec:\nfunc f() interface{} {\n    return &struct {\n        A int\n        B int\n    }{1, 2} \n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to start a Go program as a daemon in Ubuntu?\n\nQuestion:\nWhat is the proper way to start a Go program as a daemon in Ubuntu ? I will then monitor it with Monit. Should I just do something like:\ngo run myapp.go &\n\nAre there things specific to Go that I should take into account ?", "output": "You should build an executable for your program (go build) and then either write a script for upstart and it will run your program as a daemon for you, or use an external tool like daemonize. I prefer the latter solution, because it does not depend on a system-dependent upstart. With daemonize you can start your application like\ndaemonize -p /var/run/myapp.pid -l /var/lock/subsys/myapp -u nobody /path/to/myapp.exe\n\nThis will give you a well-behaving unix daemon process with all necessary daemon preparations done by daemonize."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How best do I keep a long running Go program, running?\n\nQuestion:\nI've a long running server written in Go.  Main fires off several goroutines where the logic of the program executes.  After that main does nothing useful.  Once main exits, the program will quit.  The method I am using right now to keep the program running is just a simple call to fmt.Scanln().  I'd like to know how others keep main from exiting.  Below is a basic example.  What ideas or best practices could be used here?\nI considered creating a channel and delaying exit of main by receiving on said channel, but I think that could be problematic if all my goroutines become inactive at some point.\nSide note:  In my server (not the example), the program isn't actually running connected to a shell, so it doesn't really make sense to interact with the console anyway.  For now it works, but I'm looking for the \"correct\" way, assuming there is one.\npackage main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    go forever()\n    //Keep this goroutine from exiting\n    //so that the program doesn't end.\n    //This is the focus of my question.\n    fmt.Scanln()\n}\n\nfunc forever() {\n    for ; ; {\n    //An example goroutine that might run\n    //indefinitely. In actual implementation\n    //it might block on a chanel receive instead\n    //of time.Sleep for example.\n        fmt.Printf(\"%v+\\n\", time.Now())\n        time.Sleep(time.Second)\n    }\n}", "output": "The current design of Go's runtime assumes that the programmer is responsible for detecting when to terminate a goroutine and when to terminate the program. The programmer needs to compute the termination condition for goroutines and also for the entire program. A program can be terminated in a normal way by calling os.Exit or by returning from the main() function.\nCreating a channel and delaying exit of main() by immediately receiving on said channel is a valid approach of preventing main from exiting. But it does not solve the problem  of detecting when to terminate the program.\nIf the number of goroutines cannot be computed before the main() function enters the wait-for-all-goroutines-to-terminate loop, you need to be sending deltas so that main function can keep track of how many goroutines are in flight:\n// Receives the change in the number of goroutines\nvar goroutineDelta = make(chan int)\n\nfunc main() {\n    go forever()\n\n    numGoroutines := 0\n    for diff := range goroutineDelta {\n        numGoroutines += diff\n        if numGoroutines == 0 { os.Exit(0) }\n    }\n}\n\n// Conceptual code\nfunc forever() {\n    for {\n        if needToCreateANewGoroutine {\n            // Make sure to do this before \"go f()\", not within f()\n            goroutineDelta <- +1\n\n            go f()\n        }\n    }\n}\n\nfunc f() {\n    // When the termination condition for this goroutine is detected, do:\n    goroutineDelta <- -1\n}\n\nAn alternative approach is to replace the channel with sync.WaitGroup. A drawback of this approach is that wg.Add(int) needs to be called before calling wg.Wait(), so it is necessary to create at least 1 goroutine in main() while subsequent goroutines can be created in any part of the program:\nvar wg sync.WaitGroup\n\nfunc main() {\n    // Create at least 1 goroutine\n    wg.Add(1)\n    go f()\n\n    go forever()\n    wg.Wait()\n}\n\n// Conceptual code\nfunc forever() {\n    for {\n        if needToCreateANewGoroutine {\n            wg.Add(1)\n            go f()\n        }\n    }\n}\n\nfunc f() {\n    // When the termination condition for this goroutine is detected, do:\n    wg.Done()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go's runtime library document out of date?\n\nQuestion:\nSo, I'm working on parsing a  POST using GO.  What I want is the body of the post, so I try the following (r is of type *http.Request in this context):\nvar body io.Reader\nvar d []byte\nbody = r.Body.Reader\nbody.Read( d)\n\nHowever, this results in a compilation error:\nCompile error: <file>:44: \n    r.Body.Reader undefined (type io.ReadCloser has no field or method Reader)\n\nOdd.  I could have sworn that it was defined in the docs... Ah! here it is.\nNow, I'm fairly new to Go, but this smells a little odd -- what have I screwed up?", "output": "From your link, the doc for a ReadCloser is:\ntype ReadCloser interface {\n    Reader\n    Closer\n}\n\nWhat this is telling you, is that a ReadCloser interface is composed of a Reader and a Closer functionality. It IS both. That means the ReadCloser takes on those interface definitions. They are not actually members, the way you are accessing them.\nA Reader is:\ntype Reader interface {\n    Read(p []byte) (n int, err error)\n}\n\nSo that means you should be accessing Read like this:\nbody = r.Body\nbody.Read(d)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Searching for information about the Go language\n\nQuestion:\nI was trying to look for information about generic database drivers for Google's Go language, when I notice I have hard time to get any result.\nGo SQL returns nothing related to the Go language, and golang SQL only returns useful results from the mailing list (and not, say, from github).\nIs there any smarter way I can look for information about the go language?\nOne of the creator said that search engines will recognize the context of the overloaded word \"go\", and it'll eliminate my problem, but I say - why bother? go issue9!", "output": "Take a look at the dashboard: http://godashboard.appspot.com/project. It's the best overview of current Go related projects. Another one is http://go-lang.cat-v.org/.\nmue"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go : concatenate file contents\n\nQuestion:\nI'm currently learning how to develop with Go (or golang) and I have a strange issue:\nI try to create a script looking inside an HTML file in order to get all the sources of each  tags.\nThe goal of the script is to merge all the retrieved files.\nSo, that's for the story: for now, I'm able to get the content of each JavaScript files but... I can't concatenate them...\nYou can see below my script:\n//Open main file\nmainFilePath := \"/path/to/my/file.html\"\nmainFileDir := path.Dir(mainFilePath)+\"/\"\n\nmainFileContent, err := ioutil.ReadFile(mainFilePath)\n\nif err == nil {\n    mainFileContent := string(mainFileContent)\n    var finalFileContent bytes.Buffer\n\n    //Start RegExp searching for JavaScript src\n    scriptReg, _ := regexp.Compile(\"<script src=\\\"(.*)\\\">\")\n    scripts := scriptReg.FindAllStringSubmatch(mainFileContent,-1)\n\n    //For each SRC found...\n    for _, path := range scripts {\n        //We open the corresponding file\n        subFileContent, err := ioutil.ReadFile(mainFileDir+path[1])\n\n        if err == nil {\n            //And we add its content to the \"final\" variable\n            fmt.Println(finalFileContent.Write(subFileContent))\n        } else {\n            fmt.Println(err)\n        }\n    }\n\n    //Try to display the final result\n    // fmt.Println(finalFileContent.String())\n    fmt.Printf(\">>> %#v\", finalFileContent)\n    fmt.Println(\"Y U NO WORKS? :'(\")\n\n} else {\n    fmt.Println(err)\n}\n\nSo, each fmt.Println(finalFileContent.Write(subFileContent)) display something like 6161 , so I assume the Write() method is correctly executed.\nBut fmt.Printf(\">>> %#v\", finalFileContent) displays nothing. Absolutely nothing (even the \">>>\" are not displayed!) And it's the same for the commented line just above.\nThe funny part is that the string \"Y U NO WORK ? :'(\" is correctly displayed...\nDo you know why?\nAnd do you know how to solve this issue?\nThanks in advance!", "output": "You are ignoring some errors. What are your results when you run the following version of your code?\npackage main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"path\"\n    \"regexp\"\n)\n\nfunc main() {\n    //Open main file\n    mainFilePath := \"/path/to/my/file.html\"\n    mainFileDir := path.Dir(mainFilePath) + \"/\"\n\n    mainFileContent, err := ioutil.ReadFile(mainFilePath)\n\n    if err == nil {\n        mainFileContent := string(mainFileContent)\n        var finalFileContent bytes.Buffer\n\n        //Start RegExp searching for JavaScript src\n        scriptReg, _ := regexp.Compile(\"<script src=\\\"(.*)\\\">\")\n        scripts := scriptReg.FindAllStringSubmatch(mainFileContent, -1)\n\n        //For each SRC found...\n        for _, path := range scripts {\n            //We open the corresponding file\n            subFileContent, err := ioutil.ReadFile(mainFileDir + path[1])\n\n            if err == nil {\n                //And we add its content to the \"final\" variable\n\n                // fmt.Println(finalFileContent.Write(subFileContent))\n                n, err := finalFileContent.Write(subFileContent)\n                fmt.Println(\"finalFileContent Write:\", n, err)\n\n            } else {\n                fmt.Println(err)\n            }\n        }\n\n        //Try to display the final result\n        // fmt.Println(finalFileContent.String())\n\n        // fmt.Printf(\">>> %#v\", finalFileContent)\n        n, err := fmt.Printf(\">>> %#v\", finalFileContent)\n        fmt.Println()\n        fmt.Println(\"finalFileContent Printf:\", n, err)\n\n        fmt.Println(\"Y U NO WORKS? :'(\")\n\n    } else {\n        fmt.Println(err)\n    }\n}\n\nUPDATE:\nThe statement:\nfmt.Println(\"finalFileContent Printf:\", n, err)\n\nOutputs:\nfinalFileContent Printf: 0 write /dev/stdout: winapi error #8\n\nor\nfinalFileContent Printf: 0 write /dev/stdout: Not enough storage is available to process this command.\n\nFrom MSDN:\n\nERROR_NOT_ENOUGH_MEMORY\n8 (0x8)\nNot enough storage is available to process this command.\n\nThe formatted output to the Windows console overflows the buffer (circa 64KB).\nThere is a related Go open issue:\n\nIssue 3376: windows: detect + handle console in os.File.Write"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Learning go, trying to figure out the exec package. In what ways can I improve my code?\n\nQuestion:\nWrote a simple program that calls \"ls\", then passes each line through regexp filtering for files that end in an \"s\".  ls is used only for the purposes of learning the exec package.  How can I improve the code below to be more correct/succinct/go-ish?\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os/exec\"\n    \"regexp\"\n)\n\nfunc main() {\n\n    cmd := exec.Command(\"ls\")\n    stdout, _ := cmd.StdoutPipe()\n    s := bufio.NewReader(stdout)\n    cmd.Start()\n\n    go cmd.Wait()\n\n    for {\n        l, _, err := s.ReadLine()\n        if err != nil {\n            break\n        }\n\n        if m, err := regexp.Match(\".*s$\", l); m && err == nil {\n            fmt.Println(string(l))\n        }\n    }\n}", "output": "The Cmd.Output example in the standard documentation is pretty succinct.  It doesn't do any text processing, but it shows how to execute a command and get the output with a single function call.\nHere's a way to combine that example with yours,\npackage main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n    \"regexp\"\n)\n\nfunc main() {\n    out, err := exec.Command(\"ls\").Output()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Print(string(bytes.Join(regexp.MustCompile(\".*s\\n\").FindAll(out, -1), nil)))\n}\n\nIf the goal is to get a broad overview of the package, experiment with a number of the functions and methods to learn their different capabilities.  Experiment with command arguments.  Experiment with the different fields of the Cmd struct.  Try not to get too distracted with other packages like regexp, just look for the simplest examples that exercise a package feature.\nOf course if you see how you might use an exec feature in a real application, try it.  You'll learn that one feature in more depth."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you convert a string of ints to an array in Go?\n\nQuestion:\nI haven't been able to find this anywhere (or I just don't understand it). I'm reading in a list of numbers from a file separated by spaces. I.e. the file looks like \"1 4 0 0 2 5 ...etc\", and I want it in the form of an array (or, preferably, a 2 dimensional array where each new line is separated as well). How might I go about doing this?  \nThis is the code I have so far - a lot of it is taken from tutorials I found, so I don't fully understand all of it.  It reads in a file just fine, and returns a string. \nSide question: when I print the string, I get this at the end  of the output: %!(EXTRA )\nDoes anyone know how to fix that?  I'm assuming it's putting the last nil character in the return string, but I don't know how to fix that.   \npackage main\nimport (\n  \"fmt\"\n  \"os\"\n)\n\nfunc read_file(filename string) (string, os.Error) {\n  f, err := os.Open(filename)\n  if err != nil {\n    return \"\", err\n  }\n  defer f.Close()  // f.Close will run when we're finished.\n\n  var result []byte\n  buf := make([]byte, 100)\n  for {\n    n, err := f.Read(buf[0:])\n    result = append(result, buf[0:n]...) // append is discussed later.\n    if err != nil {\n      if err == os.EOF {\n        break\n      }\n    return \"\", err  // f will be closed if we return here.\n    }\n  }\n  return string(result), nil // f will be closed if we return here.\n}\n\nfunc print_board() {\n\n}\n\nfunc main() {\n fmt.Printf(read_file(\"sudoku1.txt\")) // this outputs the file exactly, \n                                      // but with %!(EXTRA <nil>) at the end. \n                                      // I do not know why exactly\n}\n\nThank you very much for any help you can offer.\n-W", "output": "You can use the strings package to convert the string to a 2 dimensional array of ints. Explaining some of the language constructs used here is a bit outside the scope of this question, but feel free to ask for clarification on anything.\n// read_file also returns an error!\ns, err := read_file(\"sudoku1.txt\")\nif err != nil {\n    panic(err.String())\n}\n\n// split into rows at newlines\nrows := strings.Split(s, \"\\n\")\nboard := make([][]int, len(rows))\nfor i, row := range rows {\n    // extract all whitespace separated fields\n    elems := strings.Fields(row)\n    board[i] = make([]int, len(elems))\n    for j, elem := range elems {\n        var err os.Error\n            // convert each element to an integer\n        board[i][j], err = strconv.Atoi(elem)\n        if err != nil {\n            panic(err.String())\n        }\n    }\n}\nfmt.Println(board)\n\nThe reason for the %(!EXTRA <nil>) is that read_file returns two values, the second being an error (which is nil in this case). Printf tries to match that second value to a slot in the string. Since the string doesn't contain any formatting slots (%v, %d, %s...), Printf determines that it is an extra parameter, and says that in the output.\nNote that the package ioutil already provides a ReadFile function, which will give you a []byte instead of a string, but is otherwise identical in function to your read_file."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Interface Go with C libraries\n\nQuestion:\nHow does one interface a Go program with a C library?\nI've been browsing Go's source code but I still didn't figured it out. If someone has already done so, could you share, please?\nUPDATED: Thanks to @fserb, I am posting some documentation from the Go sources:\n\nCgo enables the creation of Go\n  packages that call C code.\nUsage: cgo [compiler options] file.go\nThe compiler options are passed\n  through uninterpreted when invoking\n  gcc to compile the C parts of the\n  package.\nThe input file.go is a syntactically\n  valid Go source file that imports the\n  pseudo-package \"C\" and then refers to\n  types such as C.size_t, variables such\n  as C.stdout, or functions such as\n  C.putchar.\nIf the import of \"C\" is immediately\n  preceded by a comment, that comment is\n  used as a header when compiling the C\n  parts of the package.  For example:\n// #include <stdio.h>\n// #include <errno.h>\nimport \"C\"\n\nCgo transforms the input file into\n  four output files: two Go source\n  files, a C file for 6c (or 8c or 5c),\n  and a C file for gcc.\nThe standard package makefile rules in\n  Make.pkg automate the process of using\n  cgo.  See $GOROOT/misc/cgo/stdio and\n  $GOROOT/misc/cgo/gmp for examples.\nCgo does not yet work with gccgo.", "output": "Check cgo. Also, take a look at misc/cgo/gmp on the Go source code for an example code on how to wrap a C library in Go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to read at least N bytes in Go\n\nQuestion:\nHow do you ensure you get at least n bytes when reading from a file in Go? The function seems to return the number of bytes you got, but I would rather just wait until more bytes are available. Is this possible without doing a bunch of manual plumbing?", "output": "Use io.ReadAtLeast() function: http://golang.org/pkg/io/#ReadAtLeast"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you iterate over all values produced by a function?\n\nQuestion:\nI am new to go, and I have found myself writing a few for loops which look like this:\nfor element, err := producer.Produce(); err == nil; element, err = producer.Produce() {\n    process(element)\n}\n\nwhere producer.Produce() is a function like reader.ReadString('\\n') or fmt.Fscan(Reader, &token). I would much rather like to write\nfor element := range elements {\n    process(element)\n}\n\nbut for now, I would be satisfied to know if there is a cleaner way to iterate over the output of these kinds of functions in go. In particular, is there a nice way to get rid of this annoying duplication in the init statement and the post statement of the for statement?", "output": "I don't think there's anything quite as clean as what you're looking for. The idiomatic way to write it is:\nfor {\n    element, err := producer.Produce()\n    if err != nil {\n        break\n    }\n    process(element)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Built-in helper for \"Must\" pattern in Go\n\nQuestion:\nIs there a more built-in wrapper to make a function that returns (X, error) successfully execute or abort, like regexp.MustCompile?\nI'm talking about something like this, but more \"built-in\".", "output": "There is not. The best you'll get is something like this:\nfunc Must(fn func() (interface{}, error)) interface{} {\n    v, err := fn()\n    if err != nil {\n        log.Fatalln(err)\n    }\n    return v\n}\n\nThen to use it:\nMust(func() (interface{}, error) {\n    return template.ParseGlob(pattern)\n}).(*template.Template)\n\nAssuming that template.ParseGlob(pattern) is the call you wanted to wrap.\nGo does not have parametric polymorphism, so this kind of code will end up requiring type assertions to restore the original type and so (in my opinion) is more effort than it's worth. The tidiest, idiomatic error handling you'll get for long chains of potential failure is simply to check for an error, and return it. Defer your cleanup handlers:\nfunc MyFunc() (err error) {\n    a, err := blah1()\n    if err != nil {\n        return\n    }\n    defer a.Close()\n    b, err := blah2(a)\n    if err != nil {\n        return\n    }\n    defer b.Close()\n    // ad nauseam\n}\n\nLong and tedious, but at least it's explicit and easy to follow. Here are two modules I wrote that are crying out for parametric polymorphism that might give you some ideas for dealing without it:\n\nbitbucket.org/anacrolix/dms/futures\nbitbucket.org/anacrolix/dms/cache"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go- CPU/Memory/Network\n\nQuestion:\nI'm writing a cross-platform Go application that runs as a daemon. It basically listens for changes on the filesystem and copies/downloads changes to/from a server. The idea is that it should never slow down the machine, queueing tasks until the machine is idle.\nTo do this, I would like to monitor CPU, RAM, and network usage, but network usage (if possible). I am currently targeting Windows 7+, Mac OS 10+, and Linux 3+.\nI'm primarily a Linux programmer, so I'm not familiar with Windows/BSD APIs, but I've already found some good information about BSD, so I think I can figure that out. I'm having trouble tracking down the Windows syscalls (I don't know of a way to get a Windows man page...). I've managed to find these resources (for Windows):\n\nhttp://msdn.microsoft.com/en-us/library/ms724400%28VS.85%29.aspx\nhttp://www.philosophicalgeek.com/2009/01/03/determine-cpu-usage-of-current-process-c-and-c/\nhttp://msdn.microsoft.com/en-us/library/windows/desktop/aa373083%28v=vs.85%29.aspx\nIs it possible to know the cpu utilization from a script\n\nI would prefer to use a syscall instead of shelling out/wrapping a C++ API. Obviously, I would be interested in any other Go libraries that already do this.\nUltimately, I'm looking for something like this: http://nodejs.org/api/os.html\nI'm pretty much looking for syscalls and examples of how to use them.\nIf I'm headed in the wrong direction, please let me know. I'm not married to the idea of polling the kernel for system information, but that seemed to me the most reliable way to get that information. I'd prefer to run the application as an underprivileged user.", "output": "I found https://github.com/AllenDang/w32, a project that provides wrappers for a lot of Windows API calls. I added a call to GetSystemTimes in my fork, and that is what I am currently using. I've opened a pull request, so it should be merged soon.\nThis allowed me to get CPU information (times for idle, kernel and user, similar to /proc/stats), and it seems to be working pretty well. Here's some example code:\npackage main\n\nimport (\n    \"w32\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    var idle, kernel, user w32.FILETIME\n\n    w32.GetSystemTimes(&idle, &kernel, &user)\n    idleFirst   := idle.DwLowDateTime   | (idle.DwHighDateTime << 32)\n    kernelFirst := kernel.DwLowDateTime | (kernel.DwHighDateTime << 32)\n    userFirst   := user.DwLowDateTime   | (user.DwHighDateTime << 32)\n\n    time.Sleep(time.Second)\n\n    w32.GetSystemTimes(&idle, &kernel, &user)\n    idleSecond   := idle.DwLowDateTime   | (idle.DwHighDateTime << 32)\n    kernelSecond := kernel.DwLowDateTime | (kernel.DwHighDateTime << 32)\n    userSecond   := user.DwLowDateTime   | (user.DwHighDateTime << 32)\n\n    totalIdle   := float64(idleSecond - idleFirst)\n    totalKernel := float64(kernelSecond - kernelFirst)\n    totalUser   := float64(userSecond - userFirst)\n    totalSys    := float64(totalKernel + totalUser)\n\n    fmt.Printf(\"Idle: %f%%\\nKernel: %f%%\\nUser: %f%%\\n\", (totalIdle / totalSys) * 100, (totalKernel / totalSys) * 100, (totalUser / totalSys) * 100)\n    fmt.Printf(\"\\nTotal: %f%%\\n\", (totalSys - totalIdle) * 100 / totalSys)\n}\n\nIf I can find RAM/Network stats, I should be set."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Possible to port gui functions with swig\n\nQuestion:\nI was wondering if it would be possible to port the gtk gui framework to Go with the swig wrapper? Or am I just living in a fantasy world?", "output": "Technically, yes. It looks like SWIG support for Go is limited right now.\nThe real problem with simple SWIG wrappers is the ugly details leak through. The produced interface would need a layer on top of it in order to provide \"Goish\" behavior, especially in regards to garbage collection and interfaces."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go: What is the fastest/cleanest way to remove multiple entries from a slice?\n\nQuestion:\nHow would you implement the deleteRecords function in the code below:\nExample:\n\ntype Record struct {\n  id int\n  name string\n}\n\ntype RecordList []*Record\n\nfunc deleteRecords( l *RecordList, ids []int ) {\n   // Assume the RecordList can contain several 100 entries.\n   // and the number of the of the records to be removed is about 10.\n   // What is the fastest and cleanest ways to remove the records that match\n   // the id specified in the records list.\n}", "output": "I did some micro-benchmarking on my machine, trying out most of the approaches given in the replies here, and this code comes out fastest when you've got up to about 40 elements in the ids list:\nfunc deleteRecords(data []*Record, ids []int) []*Record {\n    w := 0 // write index\n\nloop:\n    for _, x := range data {\n        for _, id := range ids {\n            if id == x.id {\n                continue loop\n            }\n        }\n        data[w] = x\n        w++\n    }\n    return data[:w]\n}\n\nYou didn't say whether it's important to preserve the order of records in the list. If you don't then this function is faster than the above and still fairly clean.\nfunc reorder(data []*Record, ids []int) []*Record {\n    n := len(data)\n    i := 0\nloop:\n    for i < n {\n        r := data[i]\n        for _, id := range ids {\n            if id == r.id {\n                data[i] = data[n-1]\n                n--\n                continue loop\n            }\n        }\n        i++\n    }\n    return data[0:n]\n}\n\nAs the number of ids rises, so does the cost of the linear search. At around 50 elements, using a map or doing a binary search to look up the id becomes more efficient, as long as you can avoid rebuilding the map (or resorting the list) every time. At several hundred ids, it becomes more efficient to use a map or a binary search even if you have to rebuild it every time.\nIf you wish to preserve original contents of the slice, something like this is more appropriate:\nfunc deletePreserve(data []*Record, ids []int) []*Record {\n    wdata := make([]*Record, len(data))\n    w := 0\nloop:\n    for _, x := range data {\n        for _, id := range ids {\n            if id == x.id {\n                continue loop\n            }\n        }\n        wdata[w] = x\n        w++\n    }\n    return wdata[0:w]\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you add an external package to a GoClipse project for Google App Engine?\n\nQuestion:\nI've compiled Goauth so that I can use OAuth in my Go Google App Engine project.  Where do I put the goauth.a file so that I can both use it in the project, and have it available when deploying to the GAE servers?  I can get it working locally if I put it in a subfolder of $GOROOT/pkg, but then it can't be found when compiling at deployment time.\nGoClipse sets up a project with lots of folders, I'm not really sure what their purpose is,  where should I put goauth.a and how do I import it?", "output": "To fix this I ended up including the source for the package in the directory tree for my app, as mentioned in this thread on the google-appengine-go group http://groups.google.com/group/google-appengine-go/browse_thread/thread/1fe745debc678afb\nHere is the important part of the thread:\n\nYou may include as many packages as necessary.  Packages are imported\n  by path relative to the base directory (the one that has your app.yaml\n  file), so if you have the following:\nhelloworld/app.yaml\n  helloworld/hello/hello.go // package hello\n  helloworld/world/world.go // package world   \nyou can import \"world\" in hello and import \"hello\" in world.\nIf you are including a third-party library, it might look something like this:  \nhelloworld/app.yaml\n  helloworld/hello/hello.go // package hello\n  helloworld/world/world.go // package world\n  helloworld/goprotobuf.googlecode.com/proto/*.go // package proto\nThen you can, as normal, import \"goprotobuf.googlecode.com/proto\"."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why does Go not seem to recognize size_t in a C header file?\n\nQuestion:\nI am trying to write a go library that will act as a front-end for a C library. If one of my C structures contains a size_t, I get compilation errors. AFAIK size_t is a built-in C type, so why wouldn't go recognize it?\nMy header file looks like:\ntypedef struct mystruct\n{\n    char *      buffer;\n    size_t      buffer_size;\n    size_t *    length;\n} mystruct;\n\nand the errors I'm getting are:\ngcc failed:\nIn file included from <stdin>:5:\nmydll.h:4: error: expected specifier-qualifier-list before 'size_t'\n\non input:\n\ntypedef struct { char *p; int n; } _GoString_;\n_GoString_ GoString(char *p);\nchar *CString(_GoString_);\n#include \"mydll.h\"\n\nI've even tried adding // typedef unsigned long size_t or // #define size_t unsigned long in the .go file before the #include, and then I get \"gcc produced no output\".\nI have seen these questions, and looked over the example with no success.", "output": "The original problem was solved by adding the #include <stddef.h> - thanks Ken and Georg. \nThe second problem was that my Go code was using mydll.mystruct rather than C.mystruct, so the C package was not being used at all. There was a bug in the cgo compiler that displayed this error message when the C package was imported and not used. The cgo bug has been fixed (by someone else) to give a more useful error message.\nDetails are here."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go StartsWith(str string)\n\nQuestion:\nIs there a StartsWith(str1, str2 string) function that can check if str1 is a prefix of str2 in Go language?\nI want a function similar to the Java's startsWith().", "output": "The strings package has what you are looking for. Specifically the HasPrefix function: http://golang.org/pkg/strings/#HasPrefix\nExample:\nfmt.Println(strings.HasPrefix(\"my string\", \"prefix\"))  // false\nfmt.Println(strings.HasPrefix(\"my string\", \"my\"))      // true\n\nThat package is full of a lot of different string helper functions you should check out."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go: what determines the iteration order for map keys?\n\nQuestion:\nThe Go Programming Language Specification says:\n\n3. The iteration order over maps is not specified. [...]\n\nThat's to be expected since a map type can be implemented as a hash table, or as a search tree, or as some other data structure. But how is map actually implemented in Go?\nPut differently, what determines the iteration order of the keys in\nfor k, _ := range m { fmt.Println(k) }\n\nI started wondering about this after I saw that a map with string keys apparently do have a certain iteration order. A program like\npackage main\nimport (\"fmt\"; \"time\"; \"rand\")\n\nfunc main() {\n    rand.Seed(time.Seconds())\n    words := [...]string{\"foo\", \"bar\", \"a\", \"b\", \"c\", \"hello\", \"world\",\n        \"0\", \"1\", \"10\", \"100\", \"123\"}\n    stringMap := make(map[string]byte)\n    for i := range rand.Perm(len(words)) {\n        stringMap[words[i]] = byte(rand.Int())\n    }\n    fmt.Print(\"stringMap keys:\")\n    for k, _ := range stringMap { fmt.Print(\" \", k) }\n    fmt.Println()\n}\n\nprints the following on my machine:\nstringMap keys: a c b 100 hello foo bar 10 world 123 1 0\n\nregardless of the insertion order.\nThe equivalent program with a map[byte]byte map also prints the keys in a shuffled order, but here the key order depends on the insertion order.\nHow is all this implemented? Is the map specialized for integers and for strings?", "output": "Map is implemented in Go as a hashmap.\nThe Go run-time uses a common hashmap implementation which is implemented in C. The only implementation differences between map[string]T and map[byte]T are: hash function, equivalence function and copy function.\nUnlike (some) C++ maps, Go maps aren't fully specialized for integers and for strings.\nIn Go release.r60, the iteration order is independent from insertion order as long as there are no key collisions. If there are collisions, iteration order is affected by insertion order. This holds true regardless of key type. There is no difference between keys of type string and keys of type byte in this respect, so it is only a coincidence that your program always printed the string keys in the same order. The iteration order is always the same unless the map is modified.\nHowever, in the newest Go weekly release (and in Go1 which may be expected to be released this month), the iteration order is randomized (it starts at a pseudo-randomly chosen key, and the hashcode computation is seeded with a pseudo-random number). If you compile your program with the weekly release (and with Go1), the iteration order will be different each time you run your program. That said, running your program an infinite number of times probably wouldn't print all possible permutations of the key set. Example outputs:\nstringMap keys: b 0 hello c world 10 1 123 bar foo 100 a\nstringMap keys: hello world c 1 10 bar foo 123 100 a b 0\nstringMap keys: bar foo 123 100 world c 1 10 b 0 hello a\n..."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can I type assert a slice of interface values?\n\nQuestion:\nI am trying to type assert from a []Node, to []Symbol. In my code, Symbol implements the Node interface.\nHere is some surrounding code:\n 43 func applyLambda(args []Node, env Env) Node {\n 44     if len(args) > 2 {\n 45         panic(\"invalid argument count\")\n 46     }\n 47     fixed, rest := parseFormals(args.([]Symbol))\n 48     return Func{\n 49         Body: args[1],\n 50         FixedVarNames: fixed,\n 51         RestVarName: rest,\n 52     }\n 53 }\n\nHere's the error I get:\n./builtins.go:47: invalid type assertion: args.([]Symbol) (non-interface type []Node on left)\n\nI'm sure there's a good reason for this. What's the best way to proceed?", "output": "In saying x.(T) variable x should be of interface type, because only for variables of type interface dynamic type is not fixed. And while Node is an interface, []Node is not. A slice is a distinct, non-interface type. So it just doesn't make sense to assume a slice of interface values is an interface too.\nType Node has a clear definition in your code and thus is an interface. You have specified the list of methods for it. Type []Node isn't like that. What methods does it define?\nI understand where your are coming from with this. It may be a useful shortcut, but just doesn't make sense. It's kind of like expecting syms.Method() to work when syms's type is []Symbol and Method is for Symbol.\nReplacing line 47 with this code does what you want:\nsymbols := make([]Symbol, len(args))\nfor i, arg := range args { symbols[i] = arg.(Symbol) }\nfixed, rest := parseFormals(symbols)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Trouble responding to multiple requests at the same time\n\nQuestion:\nI am trying to convert my node.js HTTP server to Go.  Here's what I want to happen:\nI have a resource that gets generated intermittently (say every second or so), and I want all requests for this resource to wait until the next time it is generated.  This way clients can poll and be guaranteed to get only the up-to-date resource.  I am using web.go to remove a lot of the complexity of running an HTTP server.\nHere is a brief version of my code:\npackage main\n\nimport (\n    \"time\"\n    \"web\"\n    \"fmt\"\n    vector \"container/vector\"\n)\n\nvar listeners vector.Vector;\n\nfunc resource (ctx *web.Context) {\n    c := make(chan int)\n    listeners.Push(c)\n    go func() {\n        <-c\n        go func() {\n            ctx.WriteString(\"Cool\")\n            fmt.Println(\"Wrote something\")\n        }()\n    }()\n}\n\nfunc resourceLoop() {\n    time.Sleep(5 * 1000 * 1000000) // sleep for 5 seconds\n    for ; listeners.Len() > 0 ; {\n        c := listeners.Pop().(chan int)\n        c <- 1\n    }\n\n    go resourceLoop()\n}\n\nfunc main() {\n    web.Get(\"/resource\", resource)\n\n    go resourceLoop()\n\n    web.Run(\"localhost:4000\")\n}\n\nI would expect there to be a Context.End() or similar function, but it doesn't seem to have one.  I read the source for web.go, but I couldn't figure out where it was ending the response (web.go:268 is where my resource() is called).  In node.js this is trivial, you can call a ServerResponse.end().\nWhen I kill the server while running the script in Chrome, I get this output (seems to be correct, except that the response isn't ending):\n4\nCool\nHTTP/1.1 200 OK\nContent-Type: text/html; charset=utf-8\nDate: Sat, 16 Apr 2011 00:37:58 GMT\nServer: web.go\nTransfer-Encoding: chunked\n\n0\n\nIs this a problem with the web.go framework or am I doing something wrong?  If it's a problem with the framework, I'll file an issue with him.\nI'm pretty new to Go, so I could be going about this completely wrong.", "output": "I've never used web.go, but it seems that your example is entirely too complicated.  Why do you need a goroutine to spawn a goroutine?  I would assume the framework itself would take care of concurrency and just write this:\nfunc resource (ctx *web.Context, val string) string {\n    c := make(chan int)\n    listeners.Push(c)\n    <-c\n    return \"Cool\"\n}\n\nOtherwise, it looks like it is doing exactly what you want and you just need to close the connection if you're truly done with it:\nctx.Close()"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Use Google Go's Goroutines To Create A Bayes Network\n\nQuestion:\nI have a large dataset of philosophic arguments, each of which connect to other arguments as proof or disproof of a given statement. A root statement can have many proofs and disproofs, each of which may also have proofs and disproofs.  Statements can also be used in multiple graphs, and graphs can be analyzed under a \"given context\" or assumption.\nI need to construct a bayesian network of related arguments, so that each node propagates influence fairly and accurately to it's connected arguments; I need to be able to calculate the probability of chains of connected nodes concurrently, with each node requiring datastore lookups that must block to get results; the process is mostly I/O bound, and my datastore connection can run asynchronously in java, go and python {google appengine}.  Once each lookup completes, it propagates the effects to all other connected nodes until the probability delta drops below a threshold of irrelevance {currently 0.1%}.  Each node of the process must calculate chains of connections, then sum up all the results across all queries to adjust validity results, with results chained outward to any connected arguments.\nIn order to avoid recurring infinitely, I was thinking of using an A*-like process in goroutines to propagate updates to the argument maps, with a heuristic based on compounding influence which ignores nodes once probability of influence dips below, say 0.1% .  I'd tried to set up the calculations with SQL triggers, but it got complex and messy way too fast. Then I moved to google appengine to take advantage of asynchronous nosql, and it was better, but still too slow.  I need to be run the updates fast enough to get a snappy UI, so when a user creates or votes for or against a proof or disproof, they can see the results reflected in UI immediately.\nI think Go is the language of choice to support the concurrency I need, but I'm open to suggestions.  The client is a monolithic javascript app that just uses XHR and websockets to push and pull argument maps {and their updates} in real time.  I have a java prototype that can compute large chains in 10~15s, but monitoring of performance shows that most of my runtime is wasted in synchronization and overhead from ConcurrentHashMap.\nIf there are other highly-concurrent languages worth trying out, please let me know. I know java, python, go, ruby and scala, but will learn any language if it suits my needs. \nSimilarly, if there are open source implementations of huge Bayesian networks, please leave a suggestion.", "output": "I think it's a bit difficult to tell what you are asking about. Maybe you can elaborate on your question.\nGoroutines are quite cheap, and are a perfect match for modern web applications which use XHR or Websockets heavily (and other I/O bound applications which have to wait for database responses and stuff like that). Additionally, the go runtime is also able to execute those goroutines in parallel, so that Go is also a good fit for CPU bound tasks, which should take advantage of multiple cores and the speed of a natively compiled language.\nBut you should also keep in mind, that goroutines and channels aren't for free. They still require some amount of memory and each synchronization point (e.g. a channel send or receive) comes with its cost. That's normally not a problem, since the synchronization is, in comparison to a database query for example, extremely cheap, but it might not be suited for building efficient Bayesian networks, especially if the actual work of each goroutine / node is negligible in comparison to the synchronization overhead.\nYour primary goal for every concurrent program should be to avoid shared mutability as far as possible. So a Bayesian network modeled with goroutines and channels might be a good educational example and a great way to measure the performance of Go's channel implementation, but it's probably not the best fit for your problem."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Code Transformation from Java to Go\n\nQuestion:\nI don't know syntax of Go. Can anybody help me to convert following java code in google's go language .\nimport java.io.*;\n\nclass FileWrite \n{\n  public static void main(String args[])\n  {\n    try {\n      // Create file \n      FileWriter fstream = new FileWriter(\"out.txt\");\n      BufferedWriter out = new BufferedWriter(fstream);\n      out.write(\"Hello Java\");\n      // Close the output stream\n      out.close();\n    } catch (Exception e){ //Catch exception if any\n      System.err.println(\"Error: \" + e.getMessage());\n    }\n  }\n}\n\nThis java code creates a file named out.txt and write a string (Hello Java) on the file.", "output": "But, how this problem can solved ? play.golang.org/p/169zmQvK7m –\n  alessandro\n\nFor example,\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc routine(fd *os.File) {\n    abc := 1\n    fd.WriteString(\"Hello Go \" + strconv.Itoa(abc) + \" ok\\n\")\n    fd.WriteString(\"\\nHello Gopher!\\n\")\n}\n\nfunc main() {\n    fd, err := os.Create(\"out.txt\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer fd.Close()\n    abc := 1\n    fd.WriteString(\"Hello Go \" + strconv.Itoa(abc) + \" ok\\n\")\n    fd.WriteString(\"\\nHello Gopher!\\n\")\n    routine(fd)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to implement a queue in Go?\n\nQuestion:\nThe current Go library doesn't provide the queue container.\nTo implement a simple queue, I use circle array as the underlying data structure.\nIt follows algorithms mentioned in TAOCP:\nInsert Y into queue X: X[R]<-Y; R<-(R+1)%M; if R=F then OVERFLOW.\nDelete Y from queue X: if F=R then UNDERFLOW; Y<-X[F]; F<-(F+1) % M.\nF: Front, R: Rear, M: Array length.\n\nFollowing is the code:\npackage main\n\nimport (\n    \"fmt\"\n)\n\ntype Queue struct {\n    len        int \n    head, tail int \n    q          []int\n}\n\nfunc New(n int) *Queue {\n    return &Queue{n, 0, 0, make([]int, n)} \n}\n\nfunc (p *Queue) Enqueue(x int) bool {\n    p.q[p.tail] = x \n    p.tail = (p.tail + 1) % p.len\n    return p.head != p.tail\n}\n\nfunc (p *Queue) Dequeue() (int, bool) {\n    if p.head == p.tail {\n        return 0, false\n    }   \n    x := p.q[p.head]\n    p.head = (p.head + 1) % p.len\n    return x, true\n}\n\nfunc main() {\n    q := New(10)\n    for i := 1; i < 13; i++ {\n        fmt.Println(i, q.Enqueue(i))\n    }   \n    fmt.Println()\n    for i := 1; i < 13; i++ {\n        fmt.Println(q.Dequeue())\n    }   \n}\n\nBut the output is obviously wrong:\n1 true\n2 true\n3 true\n4 true\n5 true\n6 true\n7 true\n8 true\n9 true\n10 false\n11 true\n12 true\n11 true\n12 true\n0 false\n0 false\n0 false\n0 false\n0 false\n0 false\n0 false\n0 false\n0 false\n0 false\nI think I need one more field to make the code work properly.\nWhat do you suggest?\nThe improved code has a small shortcoming: an array of size n can contain only n-1 elements.\npackage main\n\nimport (\n    \"fmt\"\n)\n\ntype Queue struct {\n    len        int \n    head, tail int \n    q          []int\n}\n\nfunc New(n int) *Queue {\n    return &Queue{n, 0, 0, make([]int, n)} \n}\n\nfunc (p *Queue) Enqueue(x int) bool {\n    p.q[p.tail] = x \n    ntail := (p.tail + 1) % p.len\n    ok := false\n    if ntail != p.head {\n        p.tail = ntail\n        ok = true\n    }   \n    return ok\n}\n\nfunc (p *Queue) Dequeue() (int, bool) {\n    if p.head == p.tail {\n        return 0, false\n    }   \n    x := p.q[p.head]\n    p.head = (p.head + 1) % p.len\n    return x, true\n}\n\nfunc main() {\n    q := New(10)\n    for i := 1; i < 13; i++ {\n        fmt.Println(i, q.Enqueue(i))\n    }   \n    fmt.Println()\n    for i := 1; i < 13; i++ {\n        fmt.Println(q.Dequeue())\n    }   \n}", "output": "When Enqueue fails, you're still incrementing p.tail, so next time it will appear not to fail -- that explains the single false in your first loop (and messes everything up for the second one).  The original algorithm says OVERFLOW meaning \"give everything up\", not \"just keep going as if nothing untowards happened\";-).\nAll you need to do is decrement p.tail if you've checked that failure's occurring -- or put the incremented value in a local temporary and move it to p.tail only if failure is not occurring, that may be more elegant.  This way, the failing Enqueue does not enqueue the new value, but the queue itself (without that overflowing value) is still semantically intact and correct for future operations."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Appengine Go development server can't find the template package\n\nQuestion:\nI'm attempting to do the go appengine tutorial found here, but I can't complete the example that imports the template library. This is the example code I am trying:\npackage hello\n\nimport (\n    \"fmt\"\n    \"http\"\n    \"template\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/\", root)\n    http.HandleFunc(\"/sign\", sign)\n}\n\nfunc root(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, guestbookForm)\n}\n\nconst guestbookForm = `\n<html>\n  <body>\n    <form action=\"/sign\" method=\"post\">\n      <div><textarea name=\"content\" rows=\"3\" cols=\"60\"></textarea></div>\n      <div><input type=\"submit\" value=\"Sign Guestbook\"></div>\n    </form>\n  </body>\n</html>\n`\n\nfunc sign(w http.ResponseWriter, r *http.Request) {\n    err := signTemplate.Execute(w, r.FormValue(\"content\"))\n    if err != nil {\n        http.Error(w, err.String(), http.StatusInternalServerError)\n    }\n}\n\nvar signTemplate = template.MustParse(signTemplateHTML, nil)\n\nconst signTemplateHTML = `\n<html>\n  <body>\n    <p>You wrote:</p>\n    <pre>{@|html}</pre>\n  </body>\n</html>\n`\n\nThe error I am receiving is:\nCompile error:\n    /home/habitue/Programming/GoExamples/hello/hello.go:36: undefined: template.MustParse\n\nMy app.yaml is this:\napplication: helloworld\nversion: 1\nruntime: go\napi_version: 3\n\nhandlers:\n- url: /.*\n  script: _go_app\n\nI've tried modifying the dev_appserver.py EXTRA_PATHS list to include the system version of Go's libraries, since I noticed the appengine lib folder did not include a template library, but to no avail. Here is my current EXTRA_PATHSwith my changes being the last two entries:\nEXTRA_PATHS = [\n  DIR_PATH\n  ,os.path.join(DIR_PATH, 'lib', 'antlr3')\n  ,os.path.join(DIR_PATH, 'lib', 'django_0_96')\n  ,os.path.join(DIR_PATH, 'lib', 'fancy_urllib')\n  ,os.path.join(DIR_PATH, 'lib', 'ipaddr')\n  ,os.path.join(DIR_PATH, 'lib', 'protorpc')\n      ,os.path.join(DIR_PATH, 'lib', 'webob')\n  ,os.path.join(DIR_PATH, 'lib', 'yaml', 'lib')\n  ,os.path.join(DIR_PATH, 'lib', 'simplejson')\n  ,os.path.join(DIR_PATH, 'lib', 'google.appengine._internal.graphy')\n  ,os.path.join('usr', 'lib', 'go', 'lib')\n  ,os.path.join('usr', 'lib', 'go', 'pkg', 'linux_amd64')\n]\n\nAt this point, I'm not really sure how to proceed. I can't seem to find anywhere online that mentions a similar problem. I'm using the 64bit linux version of the appengine Go SDK, and my OS is Arch Linux, if that is any help.", "output": "The sample is outdated starting with the SDK 1.5.5 update.\nNow it should look more or less like this:\npackage main\n\nimport (\n    \"fmt\"\n    \"http\"\n    \"template\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/\", root)\n    http.HandleFunc(\"/sign\", sign)\n}\n\nfunc root(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, guestbookForm)\n}\n\nconst guestbookForm = `\n<html>\n <body>\n  <form action=\"/sign\" method=\"post\">\n    <div><textarea name=\"content\" rows=\"3\" cols=\"60\"></textarea></div>\n    <div><input type=\"submit\" value=\"Sign Guestbook\"></div>\n  </form>\n </body>\n</html>\n`\n\nfunc sign(w http.ResponseWriter, r *http.Request) {\n    err := signTemplate.Execute(w, r.FormValue(\"content\"))\n    if err != nil {\n        http.Error(w, err.String(), http.StatusInternalServerError)\n    }\n}\n\nvar signTemplate = template.Must(template.New(\"SignIn\").Parse(signTemplateHTML))\n\nconst signTemplateHTML = `\n<html>\n <body>\n  <p>You wrote:</p>\n  <pre>{{.|html}}</pre>\n </body>\n</html>`\n\nNotice the difference in call initializing var signTemplate and the template parameter in the signTemplateHTML variable, {{.|html}} instead of {@|html}."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can you detect how many threads a given number of goroutines will create?\n\nQuestion:\nI understand that goroutines are multiplexed onto multiple OS threads, so if one should block, such as while waiting for I/O, others continue to run. But is there any way to know ahead of time how many threads I would spawn if I was to create n goroutines?\nFor example, if we call the function below would we know how many (or the maximum number of) system threads would be created for n goroutines:\ntype Vector []float64\n\n// Apply the operation to n elements of v starting at i.\nfunc (v Vector) DoSome(i, n int, u Vector, c chan int) {\n    for ; i < n; i++ {\n        v[i] += u.Op(v[i])\n    }\n    c <- 1;    // signal that this piece is done\n}", "output": "According to Pike's Go Course PDF slides (Day 3):\n\n...if you want user-level parallelism you must set $GOMAXPROCS or call runtime.GOMAXPROCS(n). GOMAXPROCS tells the runtime scheduler how many non-syscall-blocked goroutines to run at once.\n\nBased on this blog post, too, it would seem setting the environment variable GOMAXPROCS lets you fix the number of threads. I'm not sure how to get the default number of threads the runtime will manage if you do not specify this value, however.\nThis blog post seems to imply that if you do not set the environment variable the runtime will only utilize one core (presumably because it is only using one process.)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How come Go doesn't have stackoverflows\n\nQuestion:\nI read in this presentation http://golang.org/doc/ExpressivenessOfGo.pdf  page 42:\n\nSafe\n- no stack overflows\n\nHow is this possible? and/or how does Go works to avoid this?", "output": "It's a feature called \"segmented stacks\": every goroutine has its own stack, allocated on the heap.\nIn the simplest case, programming language implementations use a single stack per process/address space, commonly managed with special processor instructions called push and pop (or something like that) and implemented as a dynamic array of stack frames starting at a fixed address (commonly, the top of virtual memory).\nThat is (or used to be) fast, but is not particularly safe. It causes trouble when lots of code is executing concurrently in the same address space (threads). Now each needs its own stack. But then, all the stacks (except perhaps one) must be fixed-size, lest they overlap with each other or with the heap.\nAny programming language that uses a stack can, however, also be implemented by managing the stack in a different way: by using a list data structure or similar that holds the stack frames, but is actually allocated on the heap. There's no stack overflow until the heap is filled."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How can I compile a Go program?\n\nQuestion:\nI got Go to compile: \n\n0 known bugs; 0 unexpected bugs\n\nand typed in the \"hello world\":\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n  fmt.Printf(\"Hello, 世界\\n\")\n}\n\nThen I tried to compile it, but it wouldn't go:\n\n$ 8c gotest2\ngotest2:1 not a function\ngotest2:1 syntax error, last name: main\n\nThis is going on on Ubuntu Linux on Pentium. Go installed and passed its tests. So where did I go wrong? Can someone tell me where to go from here?\nI also tried this program:\npackage main\n\nimport fmt \"fmt\"  // Package implementing formatted I/O.\n\n\nfunc main() {\n    fmt.Printf(\"Hello, world; or Καλημέρα κόσμε; or こんにちは 世界\\n\");\n}\n\nBut this was also no go (must stop making go puns):\n\n$ 8c gotest3.go\ngotest3.go:1 not a function\ngotest3.go:1 syntax error, last name: main", "output": "You're using 8c, which is the c compiler. 8g will compile go, and 8l will link."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Implementing a basic ORM in Go\n\nQuestion:\nI'm trying to design a basic ORM for a data app that I'm working on.  My question about the model I came up with is 2-fold:\n\nIs this the 'best' most 'efficient' model for database tracking?\nIs this idiomatic Go?\n\nThe idea is to load a complete model of the db into memory at app start.  Use this model to generate a map with a crc32 hash of each object (corresponding to a row in the database).  This is what we use to compare with model to find specifically where changes have been made when .save() is called.\nThe first part of the following generates the crc32 map, the second part introduces a random change, and the last part would be part of .save() to write db changes to disk\nThe code:\nfunc main() {\n    // Read data off of disk into memory\n    memDB := ddb\n\n    // Create hash map of memDB\n    peopleMap := make(map[int]uint32)\n    for _, v := range memDB.people {\n        // make row into byte array, looks kludgy\n        hash := []byte(fmt.Sprintf(\"%#v\", v))\n        peopleMap[v.pID] = crc32.ChecksumIEEE(hash)\n        fmt.Printf(\"%v: %v %v \\t(%v %v) - crc sum: %v\\n\",\n            v.pID, v.fName, v.lName, v.job, v.location,\n            peopleMap[v.pID])\n    }\n    fmt.Println(\"\\n# of people in memory:\", len(memDB.people))\n\n    // Sometime later, we need to delete Danielle, so\n    // Delete in memory:\n    var tmpSlice []ddPerson\n    for _, v := range memDB.people {\n        if v.fName == \"Danielle\" {\n            continue\n        }\n        tmpSlice = append(tmpSlice, v)\n    }\n    memDB.people = tmpSlice\n    fmt.Println(\"# of people in memory:\", len(memDB.people))\n\n    // Okay, we save in-memory representation mem.DB back\n    // to disk with some kind of .save() assertion\n    // a len(peopleMap) comparison to len(memDB.people) will\n    // tell us there has been a change for INSERTS and\n    // DELETES, but it won't tell us about updates or which\n    // record was inserted or deleted\n\n    // First, check for additions\n    if len(peopleMap) < len(memDB.people) {\n        // Code to find and add person to disk db ddb here\n        fmt.Println(\"Adding someone to disk database...\")\n    } else if len(peopleMap) > len(memDB.people) {\n        // Check for deletions\n        fmt.Println(\"Purging someone from disk database...\")\n    }\n\n    // in any case, recheck hashes\n    tMap := make(map[int]uint32)\n    for _, v := range memDB.people {\n        hash := []byte(fmt.Sprintf(\"%#v\", v))\n        t := crc32.ChecksumIEEE(hash)\n        // Add to temporary map\n        tMap[v.pID] = t\n        // And check for changes\n        if t != peopleMap[v.pID] {\n            fmt.Println(\"Change detected in in-memory model...\")\n            fmt.Println(\"Writing changes to disk db now\")\n            // Writing any changes to DB here\n            ddb.people = memDB.people\n        }\n    }\n\n    // 'Fix' our hashmap checker deal\n    peopleMap = tMap\n\n    // Carry on\n}\n\nThere is a working version at: http://play.golang.org/p/XMTmynNy7t", "output": "You've implemented an in memory cache of your db which isn't really the same thing as an ORM.\nThere are several problems with what you have:\n\nIf some other process/application ever modifies the database your in memory model will be out of date. This could cause your writes to clobber writes to the db because you didn't know your cache was stale.\nIf the db gets large you're application will get correspondingly large.\n\nMost ORM's provide a way to map a type (eg. structs) to a db read and write. This allows you to read a single object from the database modify it and then write that object back to the database. That is probably a better approach for this.\nAs for how idiomatic your go is I didn't see obviously non idiomatic go but there also isn't much going on in it. At the top memDb := ddb is a function call but you don't have parens after it. This is a syntax error."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: use of import statement\n\nQuestion:\nI've been toying around Go for a couple of weeks now, so far so good.\nNow I am writing a program splitted across different files like this:\n.\n|-- geometry\n|   |-- cone\n|   `-- cone.go\n|-- main.go\n|-- Makefile\n\nthe problem is i can't import cone.go in the main.go, the compiler doesn't find it.\nAnybody?", "output": "If you don't mind a bit of reading, this link has a lengthy discussion on the problem you're asking about.\nHere's a short answer.\nImport looks for package in $GOROOT/pkg (IIRC), it does not look in local directories. What you can do is make a seperate makefile for \"geometry\" using the go package makefile includes (see here) and then have your main makefile make the package and pass the -I to include the new package in ./geometry"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google App Engine Go SDK update problems with template\n\nQuestion:\nI`ve just updated my GAE Go SDK to the newest release. I ran the gofix\non my code, but there were still some errors. The code used to look:\n   AnkietaTemp = template.New(nil)\n   err := AnkietaTemp.ParseFile(\"ankieta/ankieta.html\")\n\nbut now passing nil doesn't seem to work, so I replaced it into:\n   AnkietaTemp = template.New(\"\")\n   _, err := AnkietaTemp.ParseFile(\"ankieta/ankieta.html\")\n\nTried running my app, but in HTML source I get:\n <td width=\"400\"><img src=\"images/{.section One}{@}{.end}\"\nalt=\"images/{.section One}{@}{.end}\" width=\"100%\"/></td>\n\nInstead of a neat reference to an image file.\nWhat is the proper way to parse the template files now, after the\nupdate?", "output": "In the new template package the template tag syntax changed, as you can see in the documentation. E.g. dot (.) is used instead of @ for referencing the \"current\" item and the template tags are indicated with two curly braces instead of one.\nEdit: Oh, and there's no .section tag any more. You didn't provide the structure you pass to template's Execute() method so I can't provide details on how mitigate that exactly, but I guess you can use {{with}} tag like {{with One}}{.}{{end}} or maybe {{.One}}."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Do Sets exist in Go? (like in Python)\n\nQuestion:\nIs there any Go collection similar to 'Set's in python? \nalternatives: \n\nIs there an easy way of implementing Sets in Go?\nIs there any method to eliminate duplicates in a slice?", "output": "You could just have a map[whatevertype]bool and set the value to true. You could add every element in a slice as a map key, then use a range to get only the unique ones back out.\npackage main\nimport \"fmt\"\nfunc main() {\n    m := make(map[string]bool)\n    s := make([]string, 0)\n    s = append(s, \"foo\")\n    s = append(s, \"foo\")\n    s = append(s, \"foo\")\n    s = append(s, \"bar\")\n    s = append(s, \"bar\")\n    for _, r := range s {\n        m[r] = true\n    }\n    s = make([]string, 0)\n    for k, _ := range m {\n        s = append(s, k)\n    }\n    fmt.Printf(\"%v\\n\", s)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to install golang 3rd-party projects from download sources?\n\nQuestion:\nI'm trying to install mgo which is a mongo-driver written in golang. \nThe standard command: \ngo get launchpad.net/mgo\n\nBut it failed because of some cert issues.\nSo I manually download the sources of mgo to local E:\\mgo, but I don't know to how install it.\nThe file tree:\n├─.bzr\n│  ├─branch\n│  │  └─lock\n│  ├─branch-lock\n│  ├─checkout\n│  │  └─lock\n│  └─repository\n│      ├─indices\n│      ├─lock\n│      ├─obsolete_packs\n│      ├─packs\n│      └─upload\n├─bson\n└─testdb\n\nI tried:\ncd mgo\ngo install\n\nIt reports:\nauth.go:34:2: import \"launchpad.net/mgo/bson\": cannot find package\n\nBut if I try to install bson first:\ncd bson\ngo install\n\nIt reports another error:\ngo install: no install location for _/E_/mgo/bson\n\nSo, what's the correct command to install it?", "output": "Finally I successfully install the mgo project. I think it will be helpful for beginners, so I answer it here.\nFirst, we need GOPATH\nDefine a env variable GOPATH, which is your project root directory, and it should have a sub dir src.\nFor me, I define it to E:\\WORKSPACE_GO\\mgo, then create a sub dir src\nCopy the project to the src\nThen copy the mgo project to %GOPATH%/mgo, but we must be careful about the directory structure. It should be exactly the same as the package defined in sources.\nFor mgo, it's package is launchpad.net/mgo, so the structure should be:\nE:\\WORKSPACE_GO\\mgo\\src\\launchpad.net\\mgo\n\ngo install\nAt last, go install them:\ncd E:\\WORKSPACE_GO\\mgo\\src\\launchpad.net\\mgo\\bson\ngo install\n\ncd ..\ngo install\n\nIf there is no error input, it should be successfully installed."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to convert a slice of 4 bytes to a rune? In Go\n\nQuestion:\nI have the in-memory representation of a rune\nkey := make([]byte, 4)\n\nNow, how to convert it to a rune?", "output": "There is a dedicated DecodeRune function :\n\nfunc DecodeRune(p []byte) (r rune, size int)\nDecodeRune unpacks the\n  first UTF-8 encoding in p and returns the rune and its width in bytes.\n  If the encoding is invalid, it returns (RuneError, 1), an impossible\n  result for correct UTF-8.\n\nSo you just have to import \"unicode/utf8\" and do \nr, _ := utf8.DecodeRune(key)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Porting Java app to Go - any advice?\n\nQuestion:\nWe want to rewrite kodingen.com backend with Go which currently is\nJava, running as daemon using jsvc.\nI have never touched any C in my life, am only experienced in Java so I\ndon't know if this is something that I should even start.\nHowever, task is pretty simple\n\nread shell commands from mysql database\nqueue and execute them in parallel\nsave each shell output to the database\n\nthat's it. So these simple requirements gives me hope that I can start\nusing this wonderful language.\nWhat would you advise? Is C still better ?", "output": "I like Go a lot and have made contributions to the project. However, I think you ought to consider a few things about Go before settling on it for sure.\n\nGo is still an unstable language. Its syntax, features, and packages are all subject to change. Make sure you're ready to keep up with this if you choose to use it.\nGo's garbage collection is still immature. Your memory usage should be better than 1.2 GB, but it probably won't get you near C levels.\nThere's no core support for MySQL (or any other database). There are several unofficial MySQL package projects. The most recently updated ones are \nGoMySQL and Go-MySQL-Client-Library. I don't know anything about how complete or stable they are.\n\nAs for queuing and executing in parallel, I think that's something Go will be able to do pretty well. You'll probably use the exec package to execute and parallelize with goroutines."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: ForkExec and Su problem in Go\n\nQuestion:\nI wrote a program that uses ForkExec in Go.\ncommand := \"/bin/su -c '/bin/ls -lh / >/tmp/sC0X3kASz7' joe\"\n\npid, err := os.ForkExec(command, []string{}, os.Environ(), \"\", []*os.File{nil, cmd.Stdout, cmd.Stderr})\n\nif you execute that command on your shell, and do cat /tmp/sC0X3kASz7 you will see your  files listed.\nhowever, ForkExec above only creates the file and writes nothing in it. Any idea why that'd happen ?\ngo is root.\nedit : command := \"/bin/ls -lh / >/tmp/sC0X3kASz7\" didn't work either, just tried. it doesn't even create the /tmp file.\nedit2 : command := \"/bin/bash /tmp/command.txt\" and i put the above command inside this txt file, again, execute from shell, file is created, from ForkExec - nope :(\nedit3 : solution is here http://code.google.com/p/go/issues/detail?id=428", "output": "Is it possible that user joe can't list / for some reason? stderr appears to be going nowhere."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Develop plugins in Go?\n\nQuestion:\nCan go run dynamically in order to be used for a plugin based application ?\nIn eclipse, we can create some plugins that Eclipse can run dynamically. \nWould the same thing be possible in Go ?", "output": "I'll argue that those are two separate problems :\n\nhaving dynamic load\nhaving plugins\n\nThe first one is simply no : A Go program is statically linked, which means you can't add code to a running program. And which also means you must compile the program to let it integrate plugins.\nFortunately, you can define a program accepting plugins in Go as in most languages, and Go, with interfaces and fast compilation doesn't make that task hard.\nHere are two possible approaches :\nSolution 1 : Plugin integrated in the main program\nSimilarly to Eclipse plugins, we can integrate the \"plugins\" in the main program memory, by simply recompiling the program. In this sense we can for example say that database drivers are plugins.\nThis may not feel as simple as in Java, as you must have a recompilation and you must in some point of your code import the \"plugin\" (see how it's done for database drivers) but, given the standardization of Go regarding directories and imports, it seems easy to handle that with a simple makefile importing the plugin and recompiling the application.\nGiven the ease and speed of compilation in Go, and the standardization of package structure, this seems to me to be a very viable solution.\nSolution 2 : Separate process\nIt's especially easy in Go to communicate and to handle asynchronous calls. Which means you could define a solution based on many process communicating by named pipes (or any networking solution). Note that there is a rpc package in Go. This would probably be efficient enough for most programs and the main program would be able to start and stop the plugin processes. This could very well feel similar to what you have in Eclipse with the added benefits of memory space protection.\nA last note from somebody who wrote several Eclipse plugins : you don't want that mess; keep it simple."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Slice of slices types\n\nQuestion:\nI'm currently working my way through the excellent Tour of Go.\nI finished one of the exercises (#45) with the following solution:\nfunc Pic(dx, dy int) [][]uint8 {\n    pic := make([][]uint8, dy) /* type declaration */\n    for i := range pic {\n        pic[i] = make([]uint8, dx) /* again the type? */\n        for j := range pic[i] {\n            pic[i][j] = uint8((i+j)/2)\n        }\n    }\n    return pic\n}\n\nI don't understand why I have to use a make statement with the uint8 type twice (see comments in snippet). That seems redundant but I can't figure out how to do it in an other way.", "output": "There is no other way to do this in Go.\nYes, I agree it is verbose, but necessary. The second make() statement is entirely independent of the first one. It could be argued that the compiler should be able to infer the type from pic[i], but it doesn't at this point.\nAnother point: how would the make() statement look if you omitted the type in the second case? The make() is still required to do the actual allocation and to be able to specify the required len/capacity. \nAs a side note, you mixed up the slice lengths. The exercise states the top level slice should have length dy, not dx as you put in your code."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Which objects are finalized in Go by default and what are some of the pitfalls of it?\n\nQuestion:\nThe function runtime.SetFinalizer(x, f interface{}) sets the finalizer associated with x to f.\nWhat kind of objects are finalized by default?\nWhat are some of the unintended pitfalls caused by having those objects finalized by default?", "output": "The following objects are finalized by default:\n\nos.File: The file is automatically closed when the object is garbage collected.\n\nos.Process: Finalization will release any resources associated with the process. On Unix, this is a no-operation. On Windows, it closes the handle associated with the process.\n\nOn Windows, it appears that package net can automatically close a network connection.\n\n\nThe Go standard library is not setting a finalizer on object kinds other than the ones mentioned above.\nThere seems to be only one potential issue that may cause problems in actual programs: When an os.File is finalized, it will make a call to the OS to close the file descriptor. In case the os.File has been created by calling function os.NewFile(fd int, name string) *File and the file descriptor is also used by another (different) os.File, then garbage collecting either one of the file objects will render the other file object unusable. For example:\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"runtime\"\n)\n\nfunc open() {\n    os.NewFile(1, \"stdout\")\n}\n\nfunc main() {\n    open()\n\n    // Force finalization of unreachable objects\n    _ = make([]byte, 1e7)\n    runtime.GC()\n\n    _, err := fmt.Println(\"some text\") // Print something via os.Stdout\n    if err != nil {\n        fmt.Fprintln(os.Stderr, \"could not print the text\")\n    }\n}\n\nprints:\ncould not print the text"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Complex datatypes as keys in maps in Go\n\nQuestion:\nI'm trying to create a map in Go that is keyed by big integers. Effective Go explicitly says that:\n\nStructs, arrays and slices cannot be used as map keys, because equality is not defined on those types. \n\nwhich makes sense. I could of course convert the big integers to strings and use the string as a key, but I'm looking for a more general solution here. Can I wrap my structure into something (an interface?) that implements an equality function and use that instead?\nExample code that, of course, doesn't work:\npackage main                                                                                                           \n\nimport (                                                                                                               \n        \"big\"                                                                                                          \n        \"fmt\"                                                                                                          \n)                                                                                                                      \n\nfunc main() {                                                                                                          \n        one1 := big.NewInt(1)                                                                                          \n        one2 := big.NewInt(1)                                                                                          \n\n        hmap := make(map[*big.Int] int)                                                                                \n        hmap[one1] = 2                                                                                                 \n        _, exists := hmap[one2]                                                                                        \n        fmt.Printf(\"Exists=%v\\n\", exists)                                                                              \n}", "output": "The rules about equality are going to change soon. From the Go 1 plan:\n\nGo 1 will define equality on struct and array values composed from\n  fields on which equality is also defined (element-wise comparison). \n  It will remove equality on function and map values except for\n  comparison with nil. Go 1 will continue to exclude equality for\n  slices. (In the general case it is infeasible.)\n\nHowever, even with this rules, you can not use *BigInt as key, since it contains a slice. Also note, that it is not possible in Go to write a custom equality operator (neither it is possible to override any other operator). But that's actually a strength of Go in my opinion - things are just simpler without it.\nSo, you will have to use strings for your keys. The strings however do not need to be formatted in decimal (or any other format) as long as you do not want to print them. So the fastest way is probably to use the Bytes() method (which will also discard the sign, make sure to include that separately in your string)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I compare two functions for pointer equality in the latest Go weekly?\n\nQuestion:\nIn Go, is there any way to compare two non-nil function pointers to test for equality? My standard of equality is pointer equality. If not, is there any particular reason why pointer equality is not allowed?\nAs of now, if I attempt to do this in the straight-forward way:\npackage main\n\nimport \"fmt\"\n\nfunc SomeFun() {\n}\n\nfunc main() {\n    fmt.Println(SomeFun == SomeFun)\n}\n\nI get\n./func-pointers.go:12: invalid operation: SomeFun == SomeFun (func can only be compared to nil)\n\nIt is my understanding that this behavior was introduced recently.\n\nI've found an answer using the reflect package; however Atom suggests below that this actually produces undefined behavior. See Atom's post for more info and a possible alternative solution.\npackage main\n\nimport \"fmt\"\nimport \"reflect\"\n\nfunc SomeFun() { }\n\nfunc AnotherFun() { }\n\nfunc main() {\n    sf1 := reflect.ValueOf(SomeFun)\n    sf2 := reflect.ValueOf(SomeFun)\n    fmt.Println(sf1.Pointer() == sf2.Pointer())\n\n    af1 := reflect.ValueOf(AnotherFun)\n    fmt.Println(sf1.Pointer() == af1.Pointer())\n}\n\nOutputs:\ntrue\nfalse", "output": "Note that there is a difference between equality and identity. The operators == and != in Go1 are comparing the values for equivalence (except when comparing channels), not for identity. Because these operators are trying not to mix equality and identity, Go1 is more consistent than pre-Go1 in this respect.\nFunction equality is different from function identity.\n\nOne reason for not allowing == and != on function types is performance. For example, the following closure is not using any variables from its environment:\nf := func(){fmt.Println(\"foo\")}\n\nDisallowing comparisons of functions enables the compiler to generate a single implementation for the closure, instead of requiring the run-time to create a new closure (at run-time). So, from performance viewpoint the decision to disallow function comparisons was a good decision.\n\nIn relation to using the reflect package to determine function identity, a code like\nfunc SomeFun()    {}\nfunc AnotherFun() {}\n\nfunc main() {\n    sf1 := reflect.ValueOf(SomeFun)\n    sf2 := reflect.ValueOf(SomeFun)\n    fmt.Println(sf1.Pointer() == sf2.Pointer())  // Prints true\n\n    af1 := reflect.ValueOf(AnotherFun)\n    fmt.Println(sf1.Pointer() == af1.Pointer())  // Prints false\n}\n\nrelies on undefined behavior. There are no guarantees as to what the program will print. The compiler may decide that it will merge SomeFun and AnotherFun into a single implementation, in which case the 2nd print statement would print true. In fact, there is absolutely no guarantee that the 1st print statement will print true (it may, under some other Go1 compiler and run-time, print false).\n\nA correct answer to your original question is:\npackage main\n\nimport \"fmt\"\n\nfunc F1() {}\nfunc F2() {}\n\nvar F1_ID = F1  // Create a *unique* variable for F1\nvar F2_ID = F2  // Create a *unique* variable for F2\n\nfunc main() {\n    f1 := &F1_ID  // Take the address of F1_ID\n    f2 := &F2_ID  // Take the address of F2_ID\n\n    // Compare pointers\n    fmt.Println(f1 == f1)  // Prints true\n    fmt.Println(f1 == f2)  // Prints false\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to convert int[] to uint8[]\n\nQuestion:\nSO, I need your help. I couldn’t find anything on that topic. Golang is a freshly baked language so it’s quite hard to find answers quick for a newcomers like me.", "output": "The predeclared Go int type size is implementation-specific, either 32 or 64 bits (Numeric types).\nHere's an example of converting big-endian ints to bytes (uint8s).\npackage main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc IntsToBytesBE(i []int) []byte {\n    intSize := int(reflect.TypeOf(i).Elem().Size())\n    b := make([]byte, intSize*len(i))\n    for n, s := range i {\n        switch intSize {\n        case 64 / 8:\n            binary.BigEndian.PutUint64(b[intSize*n:], uint64(s))\n        case 32 / 8:\n            binary.BigEndian.PutUint32(b[intSize*n:], uint32(s))\n        default:\n            panic(\"unreachable\")\n        }\n    }\n    return b\n}\n\nfunc main() {\n    i := []int{0, 1, 2, 3}\n    fmt.Println(\"int size:\", int(reflect.TypeOf(i[0]).Size()), \"bytes\")\n    fmt.Println(\"ints:\", i)\n    fmt.Println(\"bytes:\", IntsToBytesBE(i))\n}\n\nOutput:\nint size: 4 bytes\nints: [0 1 2 3]\nbytes: [0 0 0 0 0 0 0 1 0 0 0 2 0 0 0 3]\n\nor\nint size: 8 bytes\nints: [0 1 2 3]\nbytes: [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 2 0 0 0 0 0 0 0 3]"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: \"variable declared and not used\" compilation error\n\nQuestion:\nI am learning Google's new language Go. I am just trying stuff out and I noticed\nthat if you declare a variable and do not do anything with it the go compiler (8g in my case) fails to\ncompile with this error: hello.go:9: error declared and not used. I was suprised at this since most language compilers just warn you about unused variables but still compile.\nIs there anyway I can get around this? I checked the documentation for the compiler and I don't see anything that would change this behaviour. Is there a way to just delete error so that this will compile?\npackage main\n\nimport \"fmt\"\nimport \"os\"\n\nfunc main()\n{\n     fmt.Printf(\"Hello World\\n\");\n     cwd, error := os.Getwd();\n     fmt.Printf(cwd);\n}", "output": "You could try this:\ncwd, _ := os.Getwd();\n\nbut it seems like it would be better to keep the error like in Jurily's answer so you know if something went wrong."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: OpenGL render-to-texture-via-FBO -- incorrect display vs. normal Texture\n\nQuestion:\noff-screen rendering to a texture-bound offscreen framebuffer object should be so trivial but I'm having a problem I cannot wrap my head around.\nMy full sample program (2D only for now!) is here:\nhttp://pastebin.com/hSvXzhJT\nSee below for some descriptions.\nI'm creating an rgba texture object 512x512, bind it to an FBO. No depth or other render buffers are needed at this point, strictly 2D.\nThe following extremely simple shaders render to this texture:\nVertex shader:\nvarying vec2 vPos; attribute vec2 aPos;\nvoid main (void) {\n    vPos = (aPos + 1) / 2;\n    gl_Position = vec4(aPos, 0.0, 1.0);\n}\n\nIn aPos this just gets a VBO containing 4 xy coords for a quad (-1, -1 :: 1, -1 :: 1, 1 :: -1, 1)\nSo although the framebuffer resolution should theoretically by 512x512 obviously the shader renders its \"texture\" onto a \"full-(off)screen quad\", following GLs -1..1 coords paradigm.\nFragment shader:\nvarying vec2 vPos;\nvoid main (void) {\n    gl_FragColor = vec4(0.25, vPos, 1);\n}\n\nSo it sets a fully opaque color with red fixed at 0.25 and green/blue depending on x/y anywhere between 0 and 1.\nAt this point my assumption is that a 512x512 texture is rendered showing only the -1..1 full-(off)screen quad, fragment-shaded for green/blue from 0..1.\nSo this is my off-screen setup. On-screen, I have another real visible full-screen quad with 4 xyz coords { -1, -1, 1 ::: 1, -1, 1 ::: 1, 1, 1 ::: -1, 1, 1 }. Again, for now this is 2D so no matrices and so z is always 1.\nThis quad is drawn by a different shader, simply rendering a given texture, text-book GL-101 style. In my sample program linked above I have a simple boolean toggle doRtt, when this is false (the default), render-to-texture is not performed at all and this shader simply shows uses texture.jpg from the current directory.\nThis doRtt=false mode shows that the second on-screen quad-renderer is \"correct\" for my current requirements and performs the texturing as I want it to: repeated twice vertically and twice horizontally (later will be clamped, repeat is just for testing here), otherwise scaling with NO texture filtering or mipmapping.\nSo no matter how the window (and thus view port) is resized, we always see a full-screen quad with a single texture repeated twice horizontally, twice vertically.\nNow, with doRtt=true, the second shader still does its job but the texture is never fully correctly scaled -- or drawn, this I'm not sure since unfortunately we can't just say \"hey gl save this FBO to disk for debugging purposes\".\nThe RTT shader DOES perform some partial rendering (or maybe a full one, again can't be sure what's happening off-screen...) Especially when you resize the viewport a lot smaller than the default size you see the breaks between the texture repeats, and not all colors to be expected from our very simple RTT fragment shader are indeed shown.\n(A) either: the 512x512 texture is created correctly but not mapped correctly by my code (but then why is with doRtt=false any given texture.jpg file using the exact same simple textured-quad-shader showing just fine?)\n(B) or: the 512x512 texture is not rendered correctly and somehow the rtt frag shader changes its output depending on the window resolution -- but why? The off-screen quad is always at -1..1 for x and y, the vertex shader always maps this to fragment coords 0..1, the RTT texture always stays at 512x512 for this simple test!\nNote, BOTH the off-screen quad AND the on-screen quad never change their coords and are always \"full-screen\" (-1..1 in both dimensions).\nAgain, this should be so simple. What on earth am I missing?\nSpecs: OpenGL 4.2 (but the code doesn't need any 4.2 features obviously!), Nvidia Quadro 5010M, openSuse 12.1 64bit, Golang Weekly 22-Feb-2012.", "output": "First of all - try checking OpenGL errors. Call glGetError() after each OpenGL function. Also you must set correct viewport for drawing. Before drawing to FBO call glViewport(0, 0, 512, 512). Before drawing to screen call glViewport(0, 0, display_width, display_height).\nAlso there is no need to bind rttFrameTex when you are rendering to it using FBO. Binding texture is needed only when you are reading texture in shader."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Open a file in the same directory as the .go source file in Go\n\nQuestion:\nWhen in a source file $PWD/dir/src.go I use\nos.Open(\"myfile.txt\")\n\nit looks for myfile.txt in $PWD (which looks normal).\nIs there way to tell Go to look for myfile.txt in the same directory as src.go ? I need something like __FILE__ in Ruby.", "output": "Go is not an interpreted language so looking for a file in the same location as the source file doesn't make any sense. The go binary is compiled and the source file doesn't need to be present for the binary to run. Because of that Go doesn't come with an equivalent to FILE. The runtime.Caller function returns the file name at the time the binary was compiled.\nI think perhaps if we understood why you actually wanted this functionality we could advise you better."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can I make gotest pass compiler flags?\n\nQuestion:\nI have just put together a Go package that is going to be a part in a fairly large system with a lot of shared packages. I was able to get it to compile by writing its Makefile such that the compiler is called with -I flags:\ninclude $(GOROOT)/src/Make.inc\n\nTARG=foobar\nGOFILES=\\\n    foobar.go\\\n\nfoobar:\n    $(GC) -I$(CURDIR)/../intmath -I$(CURDIR)/../randnum foobar.go\n\ninclude $(GOROOT)/src/Make.pkg\n\nIt compiles just fine, and being a good boy, I wrote a comprehensive set of tests. However, when I try to run the tests with gotest, I get a compile error:\n$ gotest\nrm -f _test/foobar.a\n8g  -o _gotest_.8 foobar.go  foobar_test.go\nfoobar.go:4: can't find import: intmath\nmake: *** [_gotest_.8] Error 1\ngotest: \"C:\\\\msys\\\\bin\\\\sh.exe -c \\\"gomake\\\" \\\"testpackage\\\" \\\"GOTESTFILES=foobar_test.go\\\"\" failed: exit status 2\n\nSo, the Go file itself will compile when I use the -I flags to tell it where to find the intmath and randnum packages, but gotest doesn't seem to use the Makefile.\nAnswering peterSO's question:\nfoobar.go's import section looks like this:\nimport (\n    \"intmath\"\n    \"randnum\"\n    \"container/vector\"\n)\n\nAnd the compile works fine as long as I have the -I flags going to the compiler. I have tried to use relative paths, like this:\nimport (\n    \"../intmath\"\n    \"../randnum\"\n    \"container/vector\"\n)\n\nbut that just doesn't seem to work.\nEDIT: answering further peterSO questions:\nGOROOT is set to C:\\Go the directory where I have all of the Go stuff -- aside from my source code -- installed. I was expecting the relative path to be relative to the directory in which the source file lives.\nMy source tree looks like this:\nserver/\n    foobar/\n    randnum/\n    intmath/\n\nSo, while I am open to a different, more Go-idiomatic directory structure, my instinct is to arrange them as peers.\nIs there some way that I can nudge gotest into compiling foobar.go with the needed flags?", "output": "Create the Windows source code directory structure:\nC:\\server\nC:\\server\\foobar\nC:\\server\\intnum\n\nFor intnum.go:\npackage intnum\n\nfunc IntNum() int {\n    return 42\n}\n\nMakefile:\ninclude $(GOROOT)/src/Make.inc\nTARG=server/intnum\nGOFILES=\\\n    intnum.go\\\ninclude $(GOROOT)/src/Make.pkg\n\nRun:\n$ cd c/server/intnum\n$ make install\n\nFor foobar.go:\npackage foobar\n\nimport (\n    \"math\"\n    \"server/intnum\"\n)\n\nfunc FooBar() float64 {\n    return float64(intnum.IntNum()) * math.Pi\n}\n\nMakefile:\ninclude $(GOROOT)/src/Make.inc\nTARG=server/foobar\nGOFILES=\\\n    foobar.go\\\ninclude $(GOROOT)/src/Make.pkg\n\nRun:\n$ cd /c/server/foobar\n$ make install\n\nAfter the install, the intnum.a and foobar.a package files will be in the $GOROOT\\pkg\\windows_386\\server (C:\\Go\\pkg\\windows_386\\server) directory`."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Shorter way of writing singleton-structs\n\nQuestion:\nIf I want to create a \"singleton\" struct, I can do the following:\nfoo := struct{\n    bar  func(string, int, bool) error\n}{  bar: func(a string, b int, c bool) error {\n    // ...\n}}\n\nas you can see I have to write bar's signature twice. Is there a shorter way to write this?", "output": "There isn't a shorter way.\nIf the struct really has only one field, you may want to change foo's type:\nfoo := func(a string, b int, c bool) error {\n    // ...\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you write multiline strings in Go?\n\nQuestion:\nDoes Go have anything similar to Python's multiline strings: \n\"\"\"line 1\nline 2\nline 3\"\"\"\n\nIf not, what is the preferred way of writing strings spanning multiple lines?", "output": "According to the language specification, you can use a raw string literal, where the string is delimited by backticks instead of double quotes.\n`line 1\nline 2\nline 3`"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go Programming Language - System Time\n\nQuestion:\nCan anybody help me by answering how to get system time in GO. For example, in the below code, I want to know when the first print and second print statements are executed and what is the time difference between them.\npackage main\n\nimport \"fmt\"\n\nfunc main() {\nfmt.Println(\"Hello, 世界\")\n    fmt.Println(\"Hello, 世界\")\n}", "output": "See the time package. Documentation can be found at http://golang.org/pkg/time/\nFor getting the nanoseconds-time before, after the first and after the last of your statements, and then printing them out:\npackage main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n  i1 := time.Nanoseconds();\n  fmt.Println(\"Hello, 世界\")\n  i2 := time.Nanoseconds();\n  fmt.Println(\"Hello, 世界\")\n  i3 := time.Nanoseconds();\n  fmt.Println(\"Check this out!\")\n  fmt.Println(i1)\n  fmt.Println(i2)\n  fmt.Println(i3)\n  fmt.Println(time.NanosecondsToLocalTime(i1).Format(time.StampNano))\n  fmt.Println(time.NanosecondsToLocalTime(i2).Format(time.StampNano))\n  fmt.Println(time.NanosecondsToLocalTime(i3).Format(time.StampNano))\n}\n\nIn my VM, I then get the following results:\n~/dev/go/test $ nano test.go\n~/dev/go/test $ 6g test.go; \n~/dev/go/test $ 6l test.6\n~/dev/go/test $ ./6.out\nHello, 世界\nHello, 世界\nCheck this out!\n1322386593830456000\n1322386593830498000\n1322386593830501000\nNov 27 10:36:33.830456000\nNov 27 10:36:33.830498000\nNov 27 10:36:33.830501000"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go Threads - Pause Execution\n\nQuestion:\nI have two threads of execution like,\nRoutine 1 {\n// do something\n}\nRoutine 2 {\n// do something\n}\n\nIs it possible to pause execution of routine 2 from routine 1 for few seconds and how can it possible ?", "output": "From one thread, it is not possible to control another thread implicitly. You can do like this, define a bool and based on that you can pause by time.Sleep(2*1e9)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go xml unmarshalling\n\nQuestion:\nIs there a way to extract the source of an image in an HTML file using only one struct (with encode/xml)? Now I have something like this\ntype XML struct {\n    A Image `xml:\"div>img\"`\n}\n\ntype Image struct {\n    I string `xml:\"src,attr\"`\n}\n\nAnd would be great to only declare something like this :\ntype Image struct {\n    I string `xml:\"div>img,src,attr\"`\n}\n\nThis is the HTML :\n<div><div><img src=\"hello.png\"/></div></div>", "output": "Seems that a good way is to use the exp/html package, like this:\npackage main\n\nimport (\n    \"exp/html\"\n    \"strings\"\n)\n\nfunc main() {\n    a, _ := html.Parse(strings.NewReader(testString))\n    println(a.FirstChild.FirstChild.NextSibling.FirstChild.FirstChild.FirstChild.Attr[0].Val)\n}\n\nvar testString = `<div><div><img src=\"hello.png\"/></div></div>`\n\nAll this FirstChild and NextSibling are needed because exp/html constructs a \"correct\" html5 tree so this code is actually parsing this:\n<html>\n    <head></head>\n    <body>\n        <div>\n            <div>\n                <img src=\"hello.png\"/>\n            </div>\n        </div>\n    </body>\n</html>"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I find out if a goroutine is done, without blocking?\n\nQuestion:\nAll the examples I've seen so far involve blocking to get the result (via the <-chan operator).\nMy current approach involves passing a pointer to a struct:\ntype goresult struct {\n    result resultType;\n    finished bool;\n}\n\nwhich the goroutine writes upon completion. Then it's a simple matter of checking finished whenever convenient. Do you have better alternatives?\nWhat I'm really aiming for is a Qt-style signal-slot system. I have a hunch the solution will look almost trivial (chans have lots of unexplored potential), but I'm not yet familiar enough with the language to figure it out.", "output": "You can use the \"comma, ok\" pattern (see their page on \"effective go\"):\nfoo     := <- ch; // This blocks.\nfoo, ok := <- ch; // This returns immediately."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can I use shared objects with Go?\n\nQuestion:\nCan I use shared objects with Go?", "output": "According to the Go FAQ, you can call into C libraries using a \"foreign function interface\":\n\nDo Go programs link with C/C++ programs?\nThere are two Go compiler implementations, 6g and friends, generically called gc, and gccgo. Gc uses a different calling convention and linker and can therefore only be linked with C programs using the same convention. There is such a C compiler but no C++ compiler. Gccgo is a GCC front-end that can, with care, be linked with GCC-compiled C or C++ programs. However, because Go is garbage-collected it will be unwise to do so, at least naively.\nThere is a “foreign function interface” to allow safe calling of C-written libraries from Go code. We expect to use SWIG to extend this capability to C++ libraries. There is no safe way to call Go code from C or C++ yet.\n\nTo answer your earlier question about Windows DLL's: no, as there is currently not a windows implementation of Go. For more information, read can-go-compiler-be-installed-on-windows"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is \"A Tour of Go\" trying to say?\n\nQuestion:\nThere are a few points in the tutorial that sort of leave you on your own without a clue or link if you're not in the know I guess. So I'm sorry about the length of these:\nhttp://tour.golang.org/#15\nTry printing needInt(Big) too\n\nI'm guessing ints are allowed less bits than constants?\n\nhttp://tour.golang.org/#21\nthe { } are required.\n\n(Sound familiar?)\n\nWhich language is alluded to?\n\nhttp://tour.golang.org/#25\n(And a type declaration does what you'd expect.)\n\nWhy do we need the word type and the word struct? What was I supposed to expect?\n\nhttp://tour.golang.org/#28\nWhy implicit zeroes in the constructor? This sounds like a dangerous design choice by Go. Is there a PEP or anything beyond http://golang.org/doc/go_faq.html on this?\n\nhttp://tour.golang.org/#30\nMake? Are there constructors? What's the difference between new and make?\n\nhttp://tour.golang.org/#33\nWhere did delete come from? I didn't import it.\n\nhttp://tour.golang.org/#36\nWhat's the %v formatter stand for? Value?\n\nhttp://tour.golang.org/#47\npanic: runtime error: index out of range\n\ngoroutine 1 [running]:\ntour/pic.Show(0x400c00, 0x40ca61)\n    go/src/pkg/tour/pic/pic.go:24 +0xd4\nmain.main()\n    /tmpfs/gosandbox-15c0e483_5433f2dc_ff6f028f_248fd0a7_d7c2d35b/prog.go:14 +0x25\n\nI guess I broke go somehow....\npackage main\n\nimport \"tour/pic\"\n\nfunc Pic(dx, dy int) [][]uint8 {\n    image := make([][]uint8, 10)\n    for i := range image {\n        image[i] = make([]uint8, 10)\n    }\n    return image\n}\n\nfunc main() {\n    pic.Show(Pic)\n}\n\n\nhttp://tour.golang.org/#59\nI return error values when a function fails? I have to qualify every single function call with an error check? The flow of the program is uninterrupted when I write crazy code? E.g. Copy(only_backup, elsewhere);Delete(only_backup) and Copy fails....\nWhy would they design it like that?", "output": "#15:\n\nI'm guessing int's are allowed less bits than constants?\n\nYes, exactly. According to the spec, \"numeric constants represent values of arbitrary precision and do not overflow\", whereas type int has either 32 or 64 bits.\n#21:\n\nWhich language is alluded to?\n\nNone; it's alluding to #16, which says the same thing, in the same words, about for-loops.\n#25 :\na type declaration does what you'd expect is a little unfortunate, I agree (as it assumes too much on what a reader could expect...) but it means you're defining a struct (with the struct keyword) and binding the type name \"Vertex\" to it, with the type Vertex part (see http://golang.org/ref/spec#Type_declarations)\n#28:\nthe fact that uninitialized structs are zeroed is really really useful in many cases (many standard structs like buffers use it also)\nIt's not implicit in the contructor only. Look at this\nvar i int; fmt.Println(i)\nThis prints out 0. This is similar to something like java where primitive types have an implicit default value. booleans are false, integers are zero, etc. The spec on zero values.\n#30:\nnew allocates memory and returns a pointer to it, while make is a special function used only for Slices, maps and channels.\nSee http://golang.org/doc/effective_go.html#allocation_new for a more in-depth explanation of make vs new\n#33:\ndelete, like append or copy is one of the basic operators of the language. See the full list of them at: http://golang.org/ref/spec#Predeclared_identifiers\n#36:\nYes, %v stands for \"value\". See http://golang.org/pkg/fmt/\n#47:\n\ntry with this:\nfunc Pic(dx, dy int) [][]uint8 {\n    image := make([][]uint8, dy) // dy, not 10\n    for x := range image {\n        image[x] = make([]uint8, dx) // dx, not 10\n        for y := range image[x] {\n            image[x][y] = uint8(x*y) //let's try one of the mentioned \n                                             // \"interesting functions\"\n         }    \n    }\n    return image\n}\n\n\n#59:\n\nThe language's design and conventions encourage you to explicitly\n  check for errors where they occur (as distinct from the convention in\n  other languages of throwing exceptions and sometimes catching them).\n  In some cases this makes Go code verbose, but fortunately there are\n  some techniques you can use to minimize repetitive error handling.\n\n(quoted from Error handling and Go )"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Bi-directional RPC options for cross-language client/server\n\nQuestion:\nI'm trying to lay out an idea for a project, where a client-side GUI can be developed in python, and the GUI can be driven by a backend in potentially any other language, over RPC.\nMore specifically, right now I am working with PyQt on the client side, and Go as the initial backend. \nHere are my goals: \n\nPyQt client\n\nRoles: View, Controller\nOneway calls (SIGNAL/SLOT), such as: button.clicked -> RPC.handleSignal\nRequest/Reply RPC, such as: rowCount = model.rowCount -> RPC.call.model.rowCount\n\nAgnostic backend (Go in this case)\n\nRoles: Controller, Model\nOneway calls (Emit SIGNAL), such as: model.dataChanged -> RPC.emitSignal\n\n\nI refer to each of these as having controller roles becase a user could define signal/slot connections in the GUI client side, or the backend could define its own signal/slot connections over RPC, assuming knowledge about the view on the client side. It would depend solely on how the user wants to set up the controller.\nI am looking at Thrift right now, vs say a lighter weight basic rpc without an IDL. But mainly my question is whether it would be a messy approach to try and do Thrift as two .thrift files, with  client/server <----> client/server (two connections), in order to get the bi-directional functionality? The benefit I see with Thrift is the IDL, so that I can build my interface specifically, and backend code can just implement the parts they want. \nDoes anyone have a recommendation for a solution to this? Two Thrift interfaces? One Thrift interface, that provides a service to let the client establish a second simple socket to receive oneway calls from the server? Or is Thrift somewhat even overkill here? While the backend -> GUI interface is really only a single service function, the GUI -> backend could expand a bit (modelHandlers, slotHandlers, general server status queries).\n(Edit) More Thoughts\nPart of me is thinking that the pattern could be done with any RPC framework, and it would be like this?\n\nBackend server process starts; listens on port\nClient GUI starts; connects to server RPC; listens on new port; sends port to server via RPC call\nServer receives port from client, and binds to it for a second RPC connection\nClient and Server have 2 connections, for bi-directional RPC", "output": "On the network when you connect to a server via TCP (or any other similar connection based protocol), when connecting your PC already chooses and listens on a (pseudo/relatively) random port in order to receive the servers answers. So for that matter, as long as the server keeps the connection and both sides keep the connection alive you already have a bi-directional connection. So from a technical, low-level point of view you do not need to initiate a second connection.\nDepending on your RPC system it may or may not use TCP and it may or may not feature bi-directional communication (or rather, bi-directional communication initialization).\nNow, for thrift, there does not seem to be much documentation there yet (no API reference). But checking the example code it seems to abstract the connection-handling away and use request/response communication only. So in this case, yes, you would have to listen on a defined port client side and tell the server, so the server can initiate a request/response communication.\nGo itself provides the rpc package, which is exclusive to go data, so will not help you.\nHowever, it also provides the websocket package. Although initially targeted at webserver to webbrowser communications it is a bi-directional protocol (that’s what it’s about after all) and can be used by any application type. It may not be as efficient size-/bandwidth-wise but it does the job.\nI’m not sure about the state of implementation in the go package. The Conn type does have an origin field but the Conn.Dial function example passes http://localhost; I’m not sure whether this is replaced with a remotely-accessible websocket origin. The Handler.ServeHTTP function provides an http.ResponseWriter, which you can probably use to initiate connection as well. At least that’s the first thing I would test.\nAn alternative, if you are comfortable with using a defined dataformat and handle networking yourself, is protobuf. There is a community project for go bindings to protobuf. You could then handle the TCP connection yourself (connecting to it and sending your data, receiving the data, holding the connection info etc).\nAs for other alternatives, you may want to check the community packages page and or the community projects page (especially the Go Ajax and go-xmlrpc – both are very rudimentary at this point though)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using a map for its set properties with user defined types\n\nQuestion:\nI'm trying to use the built-in map type as a set for a type of my own (Point, in this case). The problem is, when I assign a Point to the map, and then later create a new, but equal point and use it as a key, the map behaves as though that key is not in the map. Is this not possible to do?\n// maptest.go\n\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    set := make(map[*Point]bool)\n\n    printSet(set)\n    set[NewPoint(0, 0)] = true\n    printSet(set)\n    set[NewPoint(0, 2)] = true\n    printSet(set)\n\n    _, ok := set[NewPoint(3, 3)] // not in map\n    if !ok {\n        fmt.Print(\"correct error code for non existent element\\n\")\n    } else {\n        fmt.Print(\"incorrect error code for non existent element\\n\")\n    }\n\n    c, ok := set[NewPoint(0, 2)] // another one just like it already in map\n    if ok {\n        fmt.Print(\"correct error code for existent element\\n\") // should get this\n    } else {\n        fmt.Print(\"incorrect error code for existent element\\n\") // get this\n    }\n\n    fmt.Printf(\"c: %t\\n\", c)\n}\n\nfunc printSet(stuff map[*Point]bool) {\n    fmt.Print(\"Set:\\n\")\n    for k, v := range stuff {\n        fmt.Printf(\"%s: %t\\n\", k, v)\n    }\n}\n\ntype Point struct {\n    row int\n    col int\n}\n\nfunc NewPoint(r, c int) *Point {\n    return &Point{r, c}\n}\n\nfunc (p *Point) String() string {\n    return fmt.Sprintf(\"{%d, %d}\", p.row, p.col)\n}\n\nfunc (p *Point) Eq(o *Point) bool {\n    return p.row == o.row && p.col == o.col\n}", "output": "package main\n\nimport \"fmt\"\n\ntype Point struct {\n    row int\n    col int\n}\n\nfunc main() {\n    p1 := &Point{1, 2}\n    p2 := &Point{1, 2}\n    fmt.Printf(\"p1: %p %v p2: %p %v\\n\", p1, *p1, p2, *p2)\n\n    s := make(map[*Point]bool)\n    s[p1] = true\n    s[p2] = true\n    fmt.Println(\"s:\", s)\n\n    t := make(map[int64]*Point)\nt[int64(p1.row)<<32+int64(p1.col)] = p1\nt[int64(p2.row)<<32+int64(p2.col)] = p2\n    fmt.Println(\"t:\", t)\n}\n\nOutput:\np1: 0x7fc1def5e040 {1 2} p2: 0x7fc1def5e0f8 {1 2}\ns: map[0x7fc1def5e0f8:true 0x7fc1def5e040:true]\nt: map[4294967298:0x7fc1def5e0f8]\n\nIf we create pointers to two Points p1 and p2 with the same coordinates they point to different addresses.\ns := make(map[*Point]bool) creates a map where the key is a pointer to the memory allocated to a Point and the value is boolean value. Therefore, if we assign elements p1 and p2 to the map s then we have two distinct map keys and two distinct map elements with the same coordinates.\nt := make(map[int64]*Point) creates a map where the key is a composite of the coordinates of a Point and the value is a pointer to the Point coordinates. Therefore, if we assign elements p1 and p2 to the map t then we have two equal map keys and one map element with the shared coordinates."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Sharing Memcache on Gae with Go and Java\n\nQuestion:\nCan I write to the memcache from Go and read it from Java (on appengine)?\nFrom the memcache viewer it looks like the answer is no, since there are keys of type \"Java string\" and \"Go string\".  What about sharing []byte?\nAre web-hooks and the data store the only ways of communicating between Java and Go on Appengine?\nThanks", "output": "I don't know the answer to your question, but you will find part of it in method makePbKey in MemcacheSerialization.java. That shows how Java takes an Object and makes a key out of it.\nLikewise, in file appengine/memcache/memcache.go, you can see how AppEngine for Go makes a key out of Item.Key (type string). See GetMulti, where each key is converted from a string to a []byte via a simple cast.\nSo, the final answer to your question depends on you finding a path through both mkPbKey and GetMulti that results in the same key. It seems to me like if you give Java a key of type String, and it has length less than 250, and you remember to put \"\" before and after your keys in Go, it might work. (But reading mkPbKey makes me wonder how it reacts to a string which has 200 code points in it, all of which result in multi-byte encodings in UTF-8. Seems like it will produce a bigger key than they are expecting.)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Wait Group Implementation\n\nQuestion:\nCan anybody show me by giving a simple example code how Wait Group works or can be implemented (better if it is given for example like this)? Thanks.", "output": "I found an answer of it i.e. on Mutual Exclusion of Concurrent Go Routine's. And code is on http://play.golang.org/p/bdBRtA6vS7. Thanks."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to properly output a string in a Windows console with go?\n\nQuestion:\nI have a exe in go which prints utf-8 encoded strings, with special characters in it.\nSince that exe is made to be used from a console window, its output is mangled because Windows uses ibm850 encoding (aka code page 850).\nHow would you make sure the go exe print correctly encoded strings for a console windows, ie print for instance:\néèïöîôùòèìë\n\ninstead of (without any translation to the right charset)\n├®├¿├»├Â├«├┤├╣├▓├¿├¼├½", "output": "Since 2016, You can now (2017) consider the golang.org/x/text, which comes with a encoding charmap including the ISO-8859 family as well as the Windows 1252 character set.\nSee \"Go Quickly - Converting Character Encodings In Golang\"\nr := charmap.ISO8859_1.NewDecoder().Reader(f)\nio.Copy(out, r)\n\nThat is an extract of an example opening a ISO-8859-1 source text (my_isotext.txt), creating a destination file (my_utf.txt), and copying the first to the second.\nBut to decode from ISO-8859-1 to UTF-8, we wrap the original file reader (f) with a decoder.\nI just tested (pseudo-code for illustration):\npackage main\n\nimport (\n    \"fmt\"\n\n    \"golang.org/x/text/encoding\"\n    \"golang.org/x/text/encoding/charmap\"\n)\n\nfunc main() {\n    t := \"string composed of character in cp 850\"\n    d := charmap.CodePage850.NewDecoder()\n    st, err := d.String(t)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(st)\n}\n\nThe result is a string readable in a Windows CMD.\nSee more in this Nov. 2018 reddit thread."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Which characters are allowed in a function/struct/interface name?\n\nQuestion:\nI am new to go and have started playing around with A Tour of Go. I noticed one peculiarity namely that I am allowed to name a function _ but that function can not be called: \nimport \"fmt\"\n\ntype sel struct {\n    s string\n}\n\nfunc _(s string) sel {\n    return sel{s}\n}\n\nfunc main() {\n    fmt.Println(\"Hello\")\n    _(\"foo\") // <-- does not compile\n}\n\nIf I comment the entire _(\"foo\") line then the program compiles. \nMy question is what characters are allowed in function names? Is it only alphanumeric characters or can I use $ for instance?\nAre the rules for naming other things e.g. structs, interfaces etc. the same as those for functions?", "output": "The spec says that func, var or const name must begin with (unicode_letter or _), and can end with any (unicode_letter, unicode_digit or _).\nunicode_letter can be a Chinese, or Hebrew letter if you'd like it to."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why doesn't the Go statement execute in parallel?\n\nQuestion:\nI'm testing this Go code on my VirtualBoxed Ubuntu 11.4\npackage main\n\nimport (\"fmt\";\"time\";\"big\")\nvar c chan *big.Int\n\nfunc sum( start,stop,step int64) {\n    bigStop := big.NewInt(stop)\n    bigStep := big.NewInt(step)\n    bigSum  := big.NewInt(0)\n    for i := big.NewInt(start);i.Cmp(bigStop)<0 ;i.Add(i,bigStep){\n        bigSum.Add(bigSum,i)\n    }\n    c<-bigSum           \n}\n\nfunc main() {\n    s := big.NewInt( 0 )\n    n := time.Nanoseconds()\n\n    step := int64(4)\n    c = make( chan *big.Int , int(step))\n    stop := int64(100000000)\n    for j:=int64(0);j<step;j++{\n        go sum(j,stop,step)     \n    }\n    for j:=int64(0);j<step;j++{\n        s.Add(s,<-c)\n    }\n    n = time.Nanoseconds() - n\n    fmt.Println(s,float64(n)/1000000000.)\n}\n\nUbuntu has access to all my 4 cores. I checked this with simultaneous run of several executables and System Monitor.\nBut when I'm trying to run this code, it's using only one core and is not gaining any profit of parallel processing.\nWhat I'm doing wrong?", "output": "You probably need to review the Concurrency section of the Go FAQ, specifically these two questions, and work out which (if not both) apply to your case:\n\nWhy doesn't my multi-goroutine program\n  use multiple CPUs?\nYou must set the GOMAXPROCS shell environment\n  variable or use the similarly-named function\n  of the runtime package to allow the run-time\n  support to utilize more than one OS thread.\nPrograms that perform parallel computation\n  should benefit from an increase in GOMAXPROCS.\n  However, be aware that concurrency is not parallelism.\nWhy does using GOMAXPROCS > 1\n  sometimes make my program slower?\nIt depends on the nature of your\n  program. Programs that contain several\n  goroutines that spend a lot of time\n  communicating on channels will\n  experience performance degradation\n  when using multiple OS threads. This\n  is because of the significant\n  context-switching penalty involved in\n  sending data between threads.\nGo's goroutine scheduler is not as\n  good as it needs to be. In future, it\n  should recognize such cases and\n  optimize its use of OS threads. For\n  now, GOMAXPROCS should be set on a\n  per-application basis.\nFor more detail on this topic see the\n  talk entitled Concurrency is not Parallelism."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to do a SOAP call in Go?\n\nQuestion:\nGiven that Adwords is a Google thing, and Go is a Google thing, how long until there's a version of the Adwords API written in Go? \nAssociated with that question, another: are there any SOAP libraries for Go yet?", "output": "The Google APIs for Go is a work in progress."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang array referencing eg. b[1:4] references elements 1,2,3\n\nQuestion:\nThe golang blog states :\n\"A slice can also be formed by \"slicing\" an existing slice or array. Slicing is done by specifying a half-open range with two indices separated by a colon. For example, the expression b[1:4] creates a slice including elements 1 through 3 of b (the indices of the resulting slice will be 0 through 2).\"\nCan someone please explain to me the logic in the above. IE. Why doesn't b[1:4] reference elements 1 through 4? Is this consistent with other array referencing?", "output": "The reason is given in the Go Language Specification section on Slices.\n\nFor a string, array, or slice a, the\n  primary expression\n    a[low : high]\n\nconstructs a substring or slice. The\n  index expressions low and high select\n  which elements appear in the result.\n  The result has indexes starting at 0\n  and length equal to high - low.\nFor convenience, any of the index\n  expressions may be omitted. A missing\n  low index defaults to zero; a missing\n  high index defaults to the length of\n  the sliced operand.\n\nIt's easy and efficient to calculate the length of the slice as high - low."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How can I setup go-gb to build inside of vim\n\nQuestion:\nHas anyone setup go-gb as your makeprg in vim?  There is all sorts of documentation on configuration makeprg for compiling c code, but now much that I can find on configuring new commands.\nIdeally i'd be able to run the :make command from vim and utilize errorformat on my builds.\nset errorformat=%D(in\\ %.%#)\\ building\\ pkg\\ \\\"%f\\\",%f:%l:\\ %m%.%#,%-G%.%#", "output": "In order to use gb as your makeprg in vim:\n$ cd mygodir\n$ vi main.go\n#inside vi\n# :set errorformat=%D(in\\ %.%#)\\ building\\ pkg\\ \\\"%f\\\",%f:%l:\\ %m%.%#,%-G%.%#\n#and then\n# :set makeprg=gb\n#now\n#:mak\n#will work as usual."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it OK to leave a channel open?\n\nQuestion:\nIs it OK to leave a Go channel open forever (never close the channel) if I never check for its state? Will it lead to memory leaks? Is the following code OK?\nfunc (requestCh chan<- Request) GetResponse(data RequestData) Response {\n    reply := make(chan Response)\n    requestCh <- Request{data: data, replyCh: reply}\n    return <-reply\n}", "output": "It's OK to leave a Go channel open forever and never close it. When the channel is no longer used, it will be garbage collected.\n\nNote that it is only necessary to close a channel if the receiver is\n  looking for a close.  Closing the channel is a control signal on the\n  channel indicating that no more data follows. \nDesign Question: Channel Closing"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GO templates for dynamic html\n\nQuestion:\nCan anyone please tell me how to code up simple page like guestbook.jsp on https://developers.google.com/appengine/docs/java/gettingstarted/usingjsps using GO templates?\nIn my opinion it is easy to write one that works but I would like to know if it can be done as concisely as a JSP page.\nThere are two problems that I don't know how to address\n\nJSP page uses two objects user and request while template creation takes only one.\nIf we use separate templates for generating a sign-out link and a guestbook, then how do we nest them in the main page?", "output": "What I do is create a struct (that I call a \"page\" object), populate it with the entities I need, and then operate on them in the template.\nfunc myPage(w http.ResponseWriter, r *http.Request) {\n    var user *User // fetch from somewhere\n\n    page := struct {        \n        Title     string\n        User      *User\n    }{\"My title\", user}\n\n    return templates.ExecuteTemplate(w, \"myPage\", page)\n}\n\nThe template can look something like this, giving you access to all fields in the struct:\n{{define \"myPage\"}}\n{{template \"head\" .}}\n\nTitle: {{.Title}}<br />\nName: {{.User.Name}}<br />\n\n{{template \"tail\" .}}\n{{end}}\n\n(Note that {{template \"head\" .}} will include another template, here a header and a footer.)\nAnother thing I use a lot are variables in the templates. You can define variables by using the dollar symbol. \nThe following example is not very elegant, but may give you an idea of what is possible. Imagine we have three slices: one with \"User\" objects, one with \"Spot\" objects and one with \"Checkin\" objects. They are all the same length and are related by position (index 0 for each contains the user that was checked in, the spot he/she checked in at, and the checkin object contains the time it happened). \"range\" will give you two variables as it iterates over the slice: index ($i in the example) and the value ($v). Using \"index\" you can ask for an entity in a slice, so {{$user := index $checkinUsers $i}} will give you the object at the position pointed to by $i.\n{{$checkinUsers := .CheckinUsers}}\n{{$checkinSpots := .CheckinSpots}}\n{{range $i, $v := .Checkins}}\n    {{$user := index $checkinUsers $i}}\n    {{$spot := index $checkinSpots $i}}\n    <tr>\n        <td>\n            {{$user.FirstName}} {{$user.LastName}} @ {{$spot.Description}} ({{$v.Time}})<br />\n        </td>\n    </tr>\n    {{end}}\n\nAgain, this example isn't very elegant, but I hope you can see that it is possible to make dynamic HTML in Go just as easily as in JSPs (my experience is that the resulting pages are cleaner than JSPs, and thus more understandable by less experienced web-developers and designers). \nEx animo,\n/Alexander Yngling."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Converting several bytes in an array to another type in Go\n\nQuestion:\nI just started yesterday with Go so I apologise in advance for the silly question. \nImagine that I have a byte array such as:\nfunc main(){\n    arrayOfBytes := [10]byte{1,2,3,4,5,6,7,8,9,10}\n}\n\nNow what if I felt like taking the first four bytes of that array and using it as an integer? Or perhaps I have a struct that looks like this:\ntype eightByteType struct {\n    a uint32\n    b uint32\n}\n\nCan I easily take the first 8 bytes of my array and turn it into an object of type eightByteType? \nI realise these are two different questions but I think they may have similar answers. I've looked through the documentation and haven't seen a good example to achieve this. \nBeing able to cast a block of bytes to anything is one of the things I really like about C. Hopefully I can still do it in Go.", "output": "Look at encoding/binary, as well as bytes.Buffer\nTL;DR version:\nimport (\n    \"encoding/binary\"\n    \"bytes\"\n)\n\nfunc main() {\n    var s eightByteType\n    binary.Read(bytes.NewBuffer(array[:]), binary.LittleEndian, &s)\n}\n\nA few things to note here: we pass array[:], alternatively you could declare your array as a slice instead ([]byte{1, 2, 3, 4, 5}) and let the compiler worry about sizes, etc, and eightByteType won't work as is (IIRC) because binary.Read won't touch private fields. This would work:\ntype eightByteType struct {\n    A, B uint32\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to declare runtime.LockOSThread() and runtime.UnlockOSThread()\n\nQuestion:\nI could not able to find how to declare runtime.LockOSThread() and runtime.UnlockOSThread(). I define it like [runtime.LockOSThread()] some code [runtime.UnlockOSThread()]. But it is giving error,undefined: runtime.LockOSThread and undefined: runtime.UnlockOSThread. Can anybody suggest me how to define it ? For more, I define it like,\nRoutine 1 {\nruntime.LockOSThread()\ndo something\nruntime.UnlockOSThread\n\n}\n\nmain {\nroutine1\n}", "output": "For example,\npackage main\n\nimport \"runtime\"\n\nfunc routine() {\n    runtime.LockOSThread()\n    runtime.UnlockOSThread()\n}\n\nfunc main() {\n    go routine()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Usage of interface in Go\n\nQuestion:\nI would like to understand the interface type with a simple example of it's use in Go (Language).\nI read the web documentation, but I don't get it.", "output": "The idea behind go interfaces is duck typing. Which simply translates into: If you look like a duck and quack like a duck then you are a  duck. Meaning that if your object implements all duck's features then there should be no problem using it as a duck. Here is an example:\npackage main\n\nimport (\n    \"fmt\"\n)\n\ntype Walker interface {\n    Walk() string\n}\n\ntype Human string\ntype Dog string\n\nfunc (human Human) Walk() string { //A human is a walker\n    return \"I'm a man and I walked!\"\n}\n\nfunc (dog Dog) Walk() string { //A dog is a walker\n    return \"I'm a dog and I walked!\"\n}\n\n//Make a walker walk\nfunc MakeWalk(w Walker) {\n    fmt.Println(w.Walk())\n}\n\nfunc main() {\n    var human Human\n    var dog Dog\n    MakeWalk(human)\n    MakeWalk(dog)\n}\n\nHere a Human is a Walker and a Dog is a Walker. Why? Because they both.. well... Walk. They both implement the Walk () string function. So this is why you can execute MakeWalk on them. \nThis is very helpful when you want different types to behave in the same manner. A practical example would be file type objects (sockets, file objects) - you need a Write and a Read function on all of them. Then you can use Write and Read in the same fashion independent of their type - which is cool."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Creating a array of extended types\n\nQuestion:\nI have a struct A, extending (\"subclassing\") it with struct B, like this:\npackage main\n\ntype A struct {\n    x int\n}\n\ntype B struct {\n    A\n    y int\n}\n\nI want to create a array where I can append A or B to it, so that this code works:\nfunc main() {\n    var m [2]B\n\n    m[0] = B { A { 1 }, 2 }\n    m[0].x = 0\n    m[0].y = 0\n\n    m[1] = A { 3 }\n    m[1].x = 0\n}\n\nIt doesn't. If I create the array of the type B, I get \"cannot use struct literal (type A) as type B in assignment\". If I try to create the array of the type A, I get the the same error (just with the types reversed).\nSo my question is: which type should the array be?", "output": "You could use struct values. For example,\npackage main\n\nimport \"fmt\"\n\ntype A struct {\n    x int\n}\n\ntype B struct {\n    A\n    y int\n}\n\nfunc main() {\n    var m []interface{}\n    m = append(m, B{A{1}, 2})\n    m = append(m, A{3})\n    fmt.Println(m[0], m[1])\n    if b, ok := m[0].(B); ok {\n        b.x = 0\n        b.y = 0\n        m[0] = b\n    }\n    if a, ok := m[1].(A); ok {\n        a.x = 0\n        m[1] = a\n    }\n    fmt.Println(m[0], m[1])\n}\n\nOutput:\n{{1} 2} {3}\n{{0} 0} {0}\n\nOr, you could use struct pointers. For example,\npackage main\n\nimport \"fmt\"\n\ntype A struct {\n    x int\n}\n\ntype B struct {\n    A\n    y int\n}\n\nfunc main() {\n    var m []interface{}\n    m = append(m, &B{A{1}, 2})\n    m = append(m, &A{3})\n    fmt.Println(m[0], m[1])\n    if b, ok := m[0].(*B); ok {\n        b.x = 0\n        b.y = 0\n    }\n    if a, ok := m[1].(*A); ok {\n        a.x = 0\n    }\n    fmt.Println(m[0], m[1])\n}\n\nOutput:\n&{{1} 2} &{3}\n&{{0} 0} &{0}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why would I make() or new()?\n\nQuestion:\nThe introduction documents dedicate many paragraphs to explaining the difference between new() and make(), but in practice, you can create objects within local scope and return them.\nWhy would you use the pair of allocators?", "output": "Go has multiple ways of memory allocation and value initialization:\n&T{...}, &someLocalVar, new, make\nAllocation can also happen when creating composite literals.\n\nnew can be used to allocate values such as integers, &int is illegal:\nnew(Point)\n&Point{}      // OK\n&Point{2, 3}  // Combines allocation and initialization\n\nnew(int)\n&int          // Illegal\n\n// Works, but it is less convenient to write than new(int)\nvar i int\n&i\n\nThe difference between new and make can be seen by looking at the following example:\np := new(chan int)   // p has type: *chan int\nc := make(chan int)  // c has type: chan int\n\nSuppose Go does not have new and make, but it has the built-in function NEW. Then the example code would look like this:\np := NEW(*chan int)  // * is mandatory\nc := NEW(chan int)\n\nThe * would be mandatory, so:\nnew(int)        -->  NEW(*int)\nnew(Point)      -->  NEW(*Point)\nnew(chan int)   -->  NEW(*chan int)\nmake([]int, 10) -->  NEW([]int, 10)\n\nmake(Point)  // Illegal\nmake(int)    // Illegal\n\nYes, merging new and make into a single built-in function is possible. However, it is probable that a single built-in function would lead to more confusion among new Go programmers than having two built-in functions.\nConsidering all of the above points, it appears more appropriate for new and make to remain separate."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using big integer values in Go? (ParseInt only converts up to \"2147483647\"?)\n\nQuestion:\nHow do you convert a long string of digits (50 digits) into an integer in Go?\nI am getting the output for the code below: \nnumber = 2147483647\n\n\nerr = strconv.ParseInt: parsing \"37107287533902102798797998220837590246510135740250\n  \": value out of range\n\nIt seems to be able to convert numbers only up to 2147483647.\npackage main\n\nimport \"fmt\"\nimport \"io/ioutil\"\nimport \"strings\"\nimport \"strconv\"\n\nvar (\n        number int64\n)\n\nfunc main() {\n    fData,err := ioutil.ReadFile(\"one-hundred_50.txt\")\n    if err != nil {\n            fmt.Println(\"Err is \",err)\n        }   \n    strbuffer := string(fData)\n    lines := strings.Split(strbuffer, \"\\n\")\n\n    for i, line := range lines {\n        fmt.Printf(\"%d: %s\\n\", i, line)\n        number, err := strconv.Atoi(line)\n        fmt.Println(\"number = \", number)\n        fmt.Println(\"err = \", err)\n    }   \n}", "output": "You want the math/big package, which provides arbitrary-precision integer support.\nimport \"math/big\"\n\nfunc main() {\n    // ...\n    for i, line := range lines {\n        bi := big.NewInt(0)\n        if _, ok := bi.SetString(line, 10); ok {\n            fmt.Printf(\"number = %v\\n\", bi)\n        } else {\n            fmt.Printf(\"couldn't interpret line %#v\\n\", line)\n        }\n    }\n}\n\nHere's a quick example of it working."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to use a Go package built from a different version?\n\nQuestion:\nI'm using Go for Google App Engine, which uses an older version of Go.  I want to use a third party package that requires a newer version of Go (goauth). It is possible to use that package in my Google App Engine program?\nGoauth uses strings.SplitN, which does not seem to be present in the GAE version of Go.", "output": "Not without hacking the source of oauth to make it compatible, I'm afraid.\nEither that, or you can try and contact the author to see if they are willing to publish a version compatible with AppEngine's Go version.\nA third option would be to find an older revision of oauth which is compatible with your Go version and just use that one."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does the Go language have function/method overloading?\n\nQuestion:\nI'm porting a C library to Go. A C function (with varargs) is defined like this:\ncurl_easy_setopt(CURL *curl, CURLoption option, ...); \n\nSo I created wrapper C functions:\ncurl_wrapper_easy_setopt_str(CURL *curl, CURLoption option, char* param);\ncurl_wrapper_easy_setopt_long(CURL *curl, CURLoption option, long param);\n\nIf I define function in Go like this:\nfunc (e *Easy)SetOption(option Option, param string) {\n    e.code = Code(C.curl_wrapper_easy_setopt_str(e.curl, C.CURLoption(option), C.CString(param)))\n}\n\nfunc (e *Easy)SetOption(option Option, param long) {\n    e.code = Code(C.curl_wrapper_easy_setopt_long(e.curl, C.CURLoption(option), C.long(param)))\n}\n\nThe Go compiler complains:\n*Easy·SetOption redeclared in this block\n\nSo does Go support function (method) overloading, or does this error mean something else?", "output": "No it does not.\nSee the Go Language FAQ, and specifically the section on overloading.\n\nMethod dispatch is simplified if it doesn't need to do type matching as well. Experience with other languages told us that having a variety of methods with the same name but different signatures was occasionally useful but that it could also be confusing and fragile in practice. Matching only by name and requiring consistency in the types was a major simplifying decision in Go's type system.\n\nUpdate: 2016-04-07\nWhile Go still does not have overloaded functions (and probably never will), the most useful feature of overloading, that of calling a function with optional arguments and inferring defaults for those omitted can be simulated using a variadic function, which has since been added. But this comes at the loss of type checking.\nFor example: http://changelog.ca/log/2015/01/30/golang"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: I am trying to write a simple script in Go but get bad interpreter: Permission denied error\n\nQuestion:\nI am trying to write a script in Go but I get this error: \n\nbad interpreter: Permission denied\n\nMy super simple script is as follow:\n#!/usr/local/Cellar/go/1.0.2/bin  \nfmt.Println(\"Hello World\")  \n\nI don´t know if this is possible but I would really like to write scripts in Go since I like the language a lot.", "output": "Go isn't a scripting language. Like in C you have to compile your source code to make an executable.\nFrom the \"Getting Started\" :\n\nCreate a file named hello.go and put the following program in it:\n\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Printf(\"hello, world\\n\")\n}\n\n\nThen run it with the go tool:\n\n$ go run hello.go\nhello, world\n\nIn the spirit of Python, there are attempts to make Go scripts kinda possible. Here's for example what you can do with gorun :\n#!/usr/bin/gorun\n\npackage main\n\nfunc main() {\n    println(\"Hello world!\")\n}\n\nBut that's not really the logic of Go and that's not nearly as simple as what you typed in your question."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: \"Unknown escape sequence\" error in Go\n\nQuestion:\nI have the following function written in Go.  The idea is the function has a string passed to it and returns the first IPv4 IP address found.  If no IP address is found, an empty string is returned.\nfunc parseIp(checkIpBody string) string {\n    reg, err := regexp.Compile(\"[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+\")\n    if err == nil {\n        return \"\"\n    }   \n    return reg.FindString(checkIpBody)\n}\n\nThe compile-time error I'm getting is\n\nunknown escape sequence: .\n\nHow can I tell Go that the '.' is the actual character I'm looking for?  I thought escaping it would do the trick, but apparently I'm wrong.", "output": "The \\ backslash  isn't being interpreted by the regex parser, it's being interpreted in the string literal. You should escape the backslash again:\nregexp.Compile(\"[0-9]+\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+\")\n\nA string quoted with \" double-quote characters is known as an \"interpreted string literal\" in Go. Interpreted string literals are like string literals in most languages: \\ backslash  characters aren't included literally, they're used to give special meaning to the next character. The source must include \\\\ two backslashes in a row to obtain an a single backslash character in the parsed value.\nGo has another alternative which can be useful when writing string literals for regular expressions: a \"raw string literal\" is quoted by ` backtick characters. There are no special characters in a raw string literal, so as long as your pattern doesn't include a backtick you can use this syntax without escaping anything:\nregexp.Compile(`[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+`)\n\nThese are described in the \"String literals\" section of the Go spec."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Decrypt using the CTR mode\n\nQuestion:\nI'm trying to understand how encryption using the CTR mode works, so I created these functions to test it:\nimport (\n    \"crypto/cipher\"\n    \"crypto/rand\"\n)\n\n// generateIV generates an initialization vector (IV) suitable for encryption.\n//\n// http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation#Initialization_vector_.28IV.29\nfunc generateIV(bytes int) []byte {\n    b := make([]byte, bytes)\n    rand.Read(b)\n    return b\n}\n\nfunc encrypt(block cipher.Block, value []byte) []byte {\n    iv := generateIV(block.BlockSize())\n    encrypted := make([]byte, len(value) + block.BlockSize())\n    encrypted = append(encrypted, iv...)\n    stream := cipher.NewCTR(block, iv)\n    stream.XORKeyStream(encrypted, value)\n    return encrypted\n}\n\nfunc decrypt(block cipher.Block, encrypted []byte) []byte {\n    iv := encrypted[:block.BlockSize()]\n    ciphertext := encrypted[block.BlockSize():]\n    stream := cipher.NewCTR(block, iv)\n    plain := make([]byte, len(ciphertext))\n    // XORKeyStream is used to decrypt too?\n    stream.XORKeyStream(plain, ciphertext)\n    return plain\n}\n\nEncryption seems to work fine, but well I don't know really because I don't understand the output of decryption. Should I use stream.XORKeyStream to decrypt too? The test looks like this:\nimport (\n    \"crypto/aes\"\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestEncryptCTR(t *testing.T) {\n    block, err := aes.NewCipher([]byte(\"1234567890123456\"))\n    if err != nil {\n        panic(err)\n    }\n\n    value := \"foobarbaz\"\n    encrypted := encrypt(block, []byte(value))\n    decrypted := decrypt(block, encrypted)\n    fmt.Printf(\"--- %s ---\", string(decrypted))\n}\n\nBut I'm definitely not getting \"foobarbaz\" back. Can you spot what I'm doing wrong?", "output": "The problem was me trying to do too much before testing the basics. I wanted to prepend the IV to the generated ciphertext, but somewhat I broke everything when I did that. This simple version, with no prepended IV, works:\nimport (\n    \"crypto/cipher\"\n    \"crypto/rand\"\n)\n\n// generateIV generates an initialization vector (IV) suitable for encryption.\n//\n// http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation#Initialization_vector_.28IV.29\nfunc generateIV(bytes int) []byte {\n    b := make([]byte, bytes)\n    rand.Read(b)\n    return b\n}\n\nfunc encrypt(block cipher.Block, value []byte, iv []byte) []byte {\n    stream := cipher.NewCTR(block, iv)\n    ciphertext := make([]byte, len(value))\n    stream.XORKeyStream(ciphertext, value)\n    return ciphertext\n}\n\nfunc decrypt(block cipher.Block, ciphertext []byte, iv []byte) []byte {\n    stream := cipher.NewCTR(block, iv)\n    plain := make([]byte, len(ciphertext))\n    // XORKeyStream is used to decrypt too!\n    stream.XORKeyStream(plain, ciphertext)\n    return plain\n}\n\nAnd the corresponding test:\nimport (\n    \"crypto/aes\"\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestEncryptCTR(t *testing.T) {\n    block, err := aes.NewCipher([]byte(\"1234567890123456\"))\n    if err != nil {\n        panic(err)\n    }\n\n    iv := generateIV(block.BlockSize())\n    value := \"foobarbaz\"\n    encrypted := encrypt2(block, []byte(value), iv)\n    decrypted := decrypt2(block, encrypted, iv)\n    fmt.Printf(\"--- %s ---\", string(decrypted))\n}\n\nI get \"--- foobarbaz ---\", as expected.\nNow back to make the prepending IV work. :)\nEdit And this is it, with auto-generated and prepended IV:\nfunc encrypt(block cipher.Block, value []byte) []byte {\n    // Generate an initialization vector (IV) suitable for encryption.\n    // http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation#Initialization_vector_.28IV.29\n    iv := make([]byte, block.BlockSize())\n    rand.Read(iv)\n    // Encrypt it.\n    stream := cipher.NewCTR(block, iv)\n    stream.XORKeyStream(value, value)\n    // Return iv + ciphertext.\n    return append(iv, value...)\n}\n\nfunc decrypt(block cipher.Block, value []byte) []byte {\n    if len(value) > block.BlockSize() {\n        // Extract iv.\n        iv := value[:block.BlockSize()]\n        // Extract ciphertext.\n        value = value[block.BlockSize():]\n        // Decrypt it.\n        stream := cipher.NewCTR(block, iv)\n        stream.XORKeyStream(value, value)\n        return value\n    }\n    return nil\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: what's the state of go language IDE support?\n\nQuestion:\nCan anyone share his experience working with go in one of the three java IDE giants -I mean eclipse, netbeans and JIdea\n--\nthere's a similar question here https://stackoverflow.com/questions/1737098/is-there-an-ide-for-go but I think it's a little outdated, almost a year ago...", "output": "There is a page at http://go-lang.cat-v.org/text-editors/ which describes methods for getting various text editors and IDEs, including Eclipse and IntelliJ IDEA, to play nicely with Go. Both GEdit and Vim have decent support, having defined methods for integration with GoCode, a code completion daemon, and syntax highlighting."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reading bytes into structs using reflection\n\nQuestion:\nI'm trying to write functions that will allow me to marshal/unmarshal simple structs into byte arrays. I've succeeded in writing Marshal, with help from the kind folks at #go-nuts, but I'm running into trouble writing Unmarshal.\n// Unmarshal unpacks the binary data and stores it in the packet using\n// reflection.\nfunc Unmarshal(b []byte, t reflect.Type) (pkt interface{}, err error) {\n    buf := bytes.NewBuffer(b)\n    p := reflect.New(t)\n    v := reflect.ValueOf(p)\n    for i := 0; i < t.NumField(); i++ {\n        f := v.Field(i)\n        switch f.Kind() {\n        case reflect.String:\n            // length of string\n            var l int16\n            var e error\n            e = binary.Read(buf, binary.BigEndian, &l)\n            if e != nil {\n                err = e\n                return\n            }\n\n            // read length-of-string bytes from the buffer\n            raw := make([]byte, l)\n            _, e = buf.Read(raw)\n            if e != nil {\n                err = e\n                return\n            }\n\n            // convert the bytes to a string\n            f.SetString(bytes.NewBuffer(raw).String())\n        default:\n            e := binary.Read(buf, binary.BigEndian, f.Addr())\n            if e != nil {\n                err = e\n                return\n            }\n        }\n    }\n\n    pkt = p\n    return\n}\n\nThe problem with the code above is that the call to f.Addr() near the end is apparently trying to get the address of an unaddressable value.\nIf there is an alternative solution, I would appreciate that as well. Either way, any help would be much appreciated.\nThanks!", "output": "I think you should use\nv := p.Elem()   // Get the value that 'p' points to\n\ninstead of\nv := reflect.ValueOf(p)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Implementing ICMP ping in Go\n\nQuestion:\nIs it possible to implement an ICMP ping in Go? The alternative is to fork a 'ping' process, but I'd rather write it in Go.", "output": "Currently, the ICMP Echo (Ping) function isn't supported in the Go net package.\n\nThere's no support for sending ICMP\n  echo requests. You'd have to add\n  support to package net.  ping"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: \"net\" package import error in Go\n\nQuestion:\nI'm trying to run a sample Go program that I found on the net, which is given below:\n/* IP */\n\npackage main\n\nimport (\n    \"net\"\n    \"os\"\n    \"fmt\"\n)\n\nfunc main() {\n    if len(os.Args) != 2 {\n        fmt.Fprintf(os.Stderr, \"Usage: %s ip-addr\\n\", os.Args[0])\n        os.Exit(1)\n    }\n    name := os.Args[1]\n\n    addr := net.ParseIP(name)\n    if addr == nil {\n        fmt.Println(\"Invalid address\")\n    } else {\n        fmt.Println(\"The address is \", addr.String())\n    }\n    os.Exit(0)\n}\n\nThen I try to compile it using:\n6g ip.go\n\nand I get the following error:\nip.go:7: can't find import: net\n\nDoes my go version not have a net package? or am I using a wrong version of compiler? Thanks!", "output": "If you are still using the 6g compiler command then I assume you are not using the recent Go1 stable release? It would depend on the version you are actually running. \"net\" is a valid package: http://golang.org/pkg/net/\nRecommended that you install the latest Go.\n$ go run ip.go 127.0.0.1\nThe address is  127.0.0.1\n\nYou can see that the go playground, using Go 1, works:\nhttp://play.golang.org/p/rXSep9GH-U"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Decoding variable-schema JSON in Go\n\nQuestion:\nI'm asking this about Go's encoding/json, but I guess it also applies to any other JSON libraries that map JSON blobs to objects in whatever language.\nHere's an example. If you want to a shorten a URL using the goo.gl URL shortener API, you get back either a successful response:\n{\n \"kind\": \"urlshortener#url\",\n \"id\": \"http://goo.gl/fbsS\",\n \"longUrl\": \"http://www.google.com/\"\n}\n\nOr an error response:\n{\n \"error\": {\n  \"errors\": [\n   {\n    \"domain\": \"global\",\n    \"reason\": \"required\",\n    \"message\": \"Required\",\n    \"locationType\": \"parameter\",\n    \"location\": \"resource.longUrl\"\n   }\n  ],\n  \"code\": 400,\n  \"message\": \"Required\"\n }\n}\n\nIs there an idiomatic way of dealing with this -- a response that could adhere to two completely different schemas? \nNormally I deal with JSON using maps/lists; I know that's possible in Go. I could unmarshal to a map[string]interface{} and then check if the map has \"error\" as a key. But then I'd have to decode again into a proper struct, I think. (Am I wrong?)\nI'm doing something like this. I have one type for each kind of response:\ntype successResponse struct {\n    Kind string\n    Id string\n    LongUrl string\n}\n\ntype errorResponse struct {\n    Error struct {\n        Errors []struct {\n            Domain string\n            Reason string\n            Message string\n            LocationType string\n            Location string\n        }\n        Code int\n        Message string\n    }\n}\n\nAnd decoding looks like this:\ns := new(successResponse)\nerr := json.Unmarshal(blob, s)\nif err == nil {\n    // handle success\n} else {\n    e := new(errorResponse)\n    err = json.Unmarshal(blob, e)\n    if err == nil {\n        // handle error response\n    } else {\n        // handle actual error\n    }\n}\n\nBut that seems kind of ugly. How should I approach this?", "output": "Since the fields in your json responses are distinct from each other you can just create one struct with the union of all the fields. The json decoder will ignore fields that are not present in the json string and you can test the existence of the fields to know which type of response you are getting back."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Iterating through a golang map\n\nQuestion:\nI have a map of type: map[string]interface{}\nAnd finally, I get to create something like (after deserializing from a yml file using goyaml)\nmymap = map[foo:map[first: 1] boo: map[second: 2]]\n\nHow can I iterate through this map? I tried the following:\nfor k, v := range mymap{\n...\n}\n\nBut I get an error:\ncannot range over mymap\ntypechecking loop involving for loop\n\nPlease help.", "output": "For example,\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    type Map1 map[string]interface{}\n    type Map2 map[string]int\n    m := Map1{\"foo\": Map2{\"first\": 1}, \"boo\": Map2{\"second\": 2}}\n    //m = map[foo:map[first: 1] boo: map[second: 2]]\n    fmt.Println(\"m:\", m)\n    for k, v := range m {\n        fmt.Println(\"k:\", k, \"v:\", v)\n    }\n}\n\nOutput:\nm: map[boo:map[second:2] foo:map[first:1]]\nk: boo v: map[second:2]\nk: foo v: map[first:1]"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Compile Go file in Windows?\n\nQuestion:\nI am trying to learn Go and have installed Go MinGW but I cannot find out how to actually compile a .go file ANYWHERE.  This is the program linked directly from the Go wiki for Windows Support, but all the tutorials talk about using 6g and gccgo etc. to compile and none of those work from my windows machine.", "output": "I'm dumb, the file linked is 32 bit and I was using \"6g\" to compile because my system is 64 bit.  \"8g\" works to compile.\n\"8g myfile.go\"\n\"8l myfile.8\"\n\"myfile.out\"\nWorks to get it running."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to check the uniqueness inside a for-loop?\n\nQuestion:\nIs there a way to check slices/maps for the presence of a value?\nI would like to add a value to a slice only if it does not exist in the slice.\nThis works, but it seems verbose. Is there a better way to do this?\norgSlice := []int{1, 2, 3}\nnewSlice := []int{}\nnewInt := 2\n    \nnewSlice = append(newSlice, newInt)\nfor _, v := range orgSlice {\n    if v != newInt {\n        newSlice = append(newSlice, v)\n    }\n}\n\nnewSlice == [2 1 3]", "output": "Your approach would take linear time for each insertion. A better way would be to use a map[int]struct{}. Alternatively, you could also use a map[int]bool or something similar, but the empty struct{} has the advantage that it doesn't occupy any additional space. Therefore map[int]struct{} is a popular choice for a set of integers.\nExample:\nset := make(map[int]struct{})\nset[1] = struct{}{}\nset[2] = struct{}{}\nset[1] = struct{}{}\n// ...\n\nfor key := range(set) {\n  fmt.Println(key)\n}\n// each value will be printed only once, in no particular order\n\n\n// you can use the ,ok idiom to check for existing keys\nif _, ok := set[1]; ok {\n  fmt.Println(\"element found\")\n} else {\n  fmt.Println(\"element not found\")\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the zero for string?\n\nQuestion:\nfunc NewKey(c appengine.Context, kind, stringID string, intID int64, parent *Key) *Key\n\nThe documentation says :\n\nNewKey creates a new key. kind cannot be empty. Either one or both of\n  stringID and intID must be zero. If both are zero, the key\n  returned is incomplete. parent must either be a complete key or nil.\n\nWhat is the zero for string?\nI tried 0 and nil, and I got errors like:\ncannot use nil as type string in function argument", "output": "That's \"\" :\nvar s string\nfmt.Println(s==\"\") // prints \"true\"\n\nA string cannot be nil (but a *string can). \nYou can simply test\nif stringId==\"\" {\n\nTo pass a zero string in stringID, use\nk := NewKey(c, \"kind\", \"\", 0, p)\n\nFrom the specification :\n\nWhen memory is allocated to store a value, either through a\n  declaration or a call of make or new, and no explicit initialization\n  is provided, the memory is given a default initialization. Each\n  element of such a value is set to the zero value for its type: false\n  for booleans, 0 for integers, 0.0 for floats, \"\" for strings, and nil\n  for pointers, functions, interfaces, slices, channels, and maps."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Good example Go code with standard library usage\n\nQuestion:\nOne of the rather daunting things for me in picking up a new language is the standard library: is it large? What does it have in it? How often is it used? What conventions does it use?\nI've been reading the Go tutorial and Effective Go, but I'd like to look at some idiomatic example code for complete (but not too complex) programs, and see how they make use of Go's standard library.\nIf you have a sample project sitting around you'd be willing to share, or you know of one that would be good to study, I'd appreciate it!", "output": "Feel free to take a look into the - still growing - packages of my Tideland Common Go Library at http://code.google.com/p/tideland-cgl/source/browse/. So if you find something unclear there you can ask me."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Convert between slices of different types\n\nQuestion:\nI get a byte slice ([]byte) from a UDP socket and want to treat it as an integer slice ([]int32) without changing the underlying array, and vice versa. In C(++) I would just cast between pointer types; how would I do this in Go?", "output": "As others have said, casting the pointer is considered bad form in Go. Here are examples of the proper Go way and the equivalent of the C array casting.\nWARNING: all code untested.\nThe Right Way\nIn this example, we are using the encoding/binary package to convert each set of 4 bytes into an int32. This is better because we are specifying the endianness. We are also not using the unsafe package to break the type system.\nimport \"encoding/binary\"\n\nconst SIZEOF_INT32 = 4 // bytes\n\ndata := make([]int32, len(raw)/SIZEOF_INT32)\nfor i := range data {\n    // assuming little endian\n    data[i] = int32(binary.LittleEndian.Uint32(raw[i*SIZEOF_INT32:(i+1)*SIZEOF_INT32]))\n}\n\nThe Wrong Way (C array casting)\nIn this example, we are telling Go to ignore the type system. This is not a good idea because it may fail in another implementation of Go. It is assuming things not in the language specification. However, this one does not do a full copy. This code uses unsafe to access the \"SliceHeader\" which is common in all slices. The header contains a pointer to the data (C array), the length, and the capacity. Instead of just converting the header to the new slice type, we first need to change the length and capacity since there are less elements if we treat the bytes as a new type.\nimport (\n    \"reflect\"\n    \"unsafe\"\n)\n\nconst SIZEOF_INT32 = 4 // bytes\n\n// Get the slice header\nheader := *(*reflect.SliceHeader)(unsafe.Pointer(&raw))\n\n// The length and capacity of the slice are different.\nheader.Len /= SIZEOF_INT32\nheader.Cap /= SIZEOF_INT32\n\n// Convert slice header to an []int32\ndata := *(*[]int32)(unsafe.Pointer(&header))"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Application Domain of Go Language\n\nQuestion:\nCan anybody tell me application domain of \"go\" language ?\nWhich applications were built using \"Go\" language ?\nFor what kind of applications it is best suited for ?", "output": "From the FAQ:\n\nWhat is the purpose of the project?\n[...]\nBy its design, Go proposes an approach for the construction of system software on multicore machines.\nIs Google using Go internally?\nThe Go project was conceived to make it easier to write the kind of servers and other software Google uses internally, but the implementation isn't quite mature enough yet for large-scale production use. While we continue development we are also doing experiments with the language as a candidate server environment. It's getting there. For instance, the server behind http://golang.org is a Go program; in fact it's just the godoc document server running in a production configuration.\n\nSo the intended domain is systems and server development for current multicore machines."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to support Allman Style coding in Go?\n\nQuestion:\nIn all the projects I've worked with in other languages the bracing-style of choice has been the Allman Style(aka ANSI style). The lack of a free-form bracing style(parenthesis too) is something I miss from other C-style syntax family of languages when working in Go.\nCan anyone come up with a way to make the Go compiler accept the following bracing-style?\npackage main\n\nimport \"fmt\"\n\nfunc main() \n{\n    f()\n    fmt.Println(\"Returned normally from f.\")\n}\n\nfunc f() \n{\n    fmt.Println(\"In function f.\")\n}\n\nNote I am aware of the arguments for why Go was designed with such artificial 'limitation', but I'm not really buying into it. I'm a firm believer that the bracing-style used should really be decided by the coding-standard adopted by the people or company working on the code-base rather than being forced upon by the language itself.\nAs such please consider my question within the scope of 'how it can be done' rather than 'why not to do it and just adapt'.\nThanks", "output": "Give a try to https://gofork.org\nforkgo supports allman/horstmann style:\npackage main\nimport\n(   \"fmt\"\n)\n\n\nfunc main()\n{   if false\n    {   fmt.Println(\"jack\")\n        fmt.Println(\"forkgo\")\n    } else\n    {   fmt/\n           .Println(\"hello\")\n        fmt.Println(\"forkgo\")\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is the HTTP package server safe to use in production?\n\nQuestion:\nGo implements FastCGI, as well as a native HTTP server in its standard library.\nIs it safe to use the server from the HTTP package in production (as an application server) or is it recommended to use the FastCGI interface to connect to a more robust solution like Apache in terms of security?", "output": "Go's http package is intended for production use, but it hasn't put in the time to prove itself like Apache or Nginx. There may still be issues lurking. One thing I can think of is the potential DoS attack path available right now: http://code.google.com/p/go/issues/detail?id=2630\nWe use Go's http package directly in production where I work. We haven't had any problems with it so far."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Whats the difference of functions and methods in Go?\n\nQuestion:\nI am trying to get started with Go and the documentation is very good. What I did not find in the documentation is the difference between functions and methods.\nAs far as I understand at the moment: functions are \"global\", which means I do not have to import a package to use functions, they are always there. Methods are bound to packages. Is this correct?", "output": "As far as I understand at the moment: functions are \"global\", which means I do not have to import a package to use functions, they are always there. Methods are bound to packages. Is this correct?\n\nNo, that's not correct. There are just a couple of functions from the builtin package which are always available. Everything else needs to be imported.\nThe term \"method\" came up with object-oriented programming. In an OOP language (like C++ for example) you can define a \"class\" which encapsulates data and functions which belong together. Those functions inside a class are called \"methods\" and you need an instance of that class to call such a method.\nIn Go, the terminology is basically the same, although Go isn't an OOP language in the classical meaning. In Go, a function which takes a receiver is usually called a method (probably just because people are still used to the terminology of OOP).\nSo, for example:\nfunc MyFunction(a, b int) int {\n  return a + b\n}\n// Usage:\n// MyFunction(1, 2)\n\nbut\ntype MyInteger int\nfunc (a MyInteger) MyMethod(b int) int {\n  return a + b\n}\n// Usage:\n// var x MyInteger = 1\n// x.MyMethod(2)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Concurrency and slice iteration\n\nQuestion:\nI have a read-only slice of objects of a certain type.\nA lot of concurrent goroutines will iterate over this slice to find a certain object in it and use it.\nThis slice is strictly read-only, it is written to only once (when the application is launched) and then never again.\nWill concurrent goroutines interfere with each other when iterating over the slice? (Do I need to apply a read-lock?)", "output": "To the best of my knowledge, as long as the slice is read-only, there's no problem. Reading a slice does not mutate it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reading an integer from standard input\n\nQuestion:\nHow do I use the fmt.Scanf function in Go to get an integer input from the standard input?\nIf this can't be done using fmt.Scanf, what's the best way to read a single integer?", "output": "http://golang.org/pkg/fmt/#Scanf\nAll the included libraries in Go are well documented.\nThat being said, I believe\nfunc main() {\n    var i int\n    _, err := fmt.Scanf(\"%d\", &i)\n}\n\ndoes the trick"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: A few questions about the Go Language\n\nQuestion:\nI have a few questions about the Go programming language:\n\nHow is the addition of int and float variables implemented in the language?\nis there a diffrence between the last question and the addition of int and float literals (for instance 3+2.1)?\nWhat are all the sequencers in the Go language?", "output": "There aren't implicit type conversions; you will have to explicitly decide which sort of addition you want and convert one or both operands to the relevant type.\nYou could answer this by simple experimentation.\npackage main\nimport \"fmt\"\nfunc main() {\n    var i int = 3 + 2\n    var f float = 3 + 2.1\n    fmt.Printf(\"%d %f\\n\", i, f)\n}\n\nIf you try replacing the 2 with 2.1, the code does not compile.\nWhat do you mean by 'sequencers'?"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google App Engine Go - using OpenID, should I also use captcha?\n\nQuestion:\nCurrently I'm developing a GAE application in golang that would allow the users to log into the service using OpenID from Google. Each account would be mapped to one Google account obviously. Should I implement captcha for user registration, or does using the OpenID already prevent the service from a bot attack?", "output": "First of all, fear of a bot attack is really a preliminary caution. Parsing CSRF tokens (which you should use anyway) and dealing with cookies would already cause enough pain to an attacker. I doubt anyone would trouble himself into setting up very own OpenID provider which is the only way one can do that.\nSecondly, App Engine's OpenID Federated Login is the User API feature, not Go runtime's one — you can use any OP with it (Facebook, Yahoo!, Steam... Google). User API provides two modes (configurable via Application Settings): OpenID Federated Login and Google Accounts sign in.  Which to pick depends on requirements. If all you need is user's Google account you'd better use the latter, when if it's simple password-less sign in with nearly everything, choose OpenID. From the app's perspective both look identical. Best way to go is OAuth, though.\nGetting back on the question, both Google Accounts API and OAuth would make such attacks almost impossible and with OpenID it is a little simpler.\nhttps://developers.google.com/appengine/docs/go/users/overview"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Customizing an existing handler in Go's http library\n\nQuestion:\nWith the following being defined as is noted in the http library:\nfunc Handle(pattern string, handler Handler)\ntype Handler interface { ServeHTTP(*Conn, *Request) }\n\nHow can I improve upon an existing handler (say, websocket.Draft75Handler for instance) by giving it an additional argument (and tell it what to do with the argument)?\nI'm trying to create a handler that contains within it one end of a channel. It will use that channel to talk to some other part of the program. How can I get that channel into the the handler function?\nApologies if this is a silly question. I'm new at go and decided to learn by reading the tutorial and then jumping right into code. Thanks for any help!", "output": "If the type is a function, like websocket.Draft75Handler, you could wrap it in a closure:\nfunc MyHandler(arg interface{}) websocket.Draft75Handler {\n    return func(c *http.ConnConn) {\n        // handle request\n    }\n}\n\nfunc main() {\n    http.Handle(\"/echo\", MyHandler(\"argument\"))\n    err := http.ListenAndServe(\":12345\", nil)\n    if err != nil {\n        panic(\"ListenAndServe: \" + err.String())\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the equivalent of a Java ArrayList<E> in Golang?\n\nQuestion:\nIn my particular use case, I would like to know how the following Java code would be implemented in Go - \nclass Channel {\n    public String name;\n    public Channel(){}\n}\n\nArrayList<Channel> channels = new ArrayList<Channel>();\n\nI've gotten started, and I think this would be the appropriate struct for Channel  in Go -\nstruct Channel {\n    name string\n}\n\nI just need to know how ArrayList would work in Go", "output": "Use a slice:\nvar channels []Channel  // an empty list\nchannels = append(channels, Channel{name:\"some channel name\"})\n\nAlso, your Channel declaration is slightly off, you need the 'type' keyword:\ntype Channel struct {\n    name string\n}\n\nHere's a complete example: http://play.golang.org/p/HnQ30wOftb\nFor more info, see the slices article.\nThere's also the go tour (tour.golang.org) and the language spec (golang.org/ref/spec, see #Slice_types, #Slices, and #Appending_and_copying_slices)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang: emailing an image stored as a Google Appengine blobstore blob\n\nQuestion:\nI'm trying to read a JPEG file stored in the GAE blobstore back into a byte array using the following code:\ninfo,_  := blobstore.Stat(context,appengine.BlobKey(request.FormValue(\"blobkey\")))\nimage   := make([]byte,info.Size)\nreader  := blobstore.NewReader(context,appengine.BlobKey(request.FormValue(\"blobkey\")))\nn,nerr  := reader.Read(image)\n\nThe image is stored correctly i.e. it can be served using blobstore.Send(...).\nAnd the above code sort of works (in that it does read back the blob data) but it converts any 0x0a byte into a 0x0d 0x0a pair (i.e. LF into CR LF).\nIs there a way in Go to work around this behaviour (without writing a filter to convert 0x0d0a back to 0x0a) ?\nEDIT: \nIt turns out the problem is not with Blobstore.Reader at all, but with the attachment encoding in mail.py on the dev appserver.", "output": "The mail attachment handling on the dev appserver does not correctly encode image data. If the attachment data is known to be binary, a partial workaround is to add the line:\nencoders.encode_base64(mime_attachment)\n\nafter the line \nmime_attachment.set_payload(attachment.data())\n\nin the file \n\ngoogle/appengine/api/mail.py\n\nUsing a MIMEImage attachment for an image content type would be a better solution but causes a 'LazyImporter object is not callable' error."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: simulating packet losses and delays programmatically\n\nQuestion:\nI have a server that exposes its services over rpc and a client that uses these services. To test this setup, I need to introduce packet losses and delays. I found a few techniques on stackoverflow like tc, modifying iptables etc but all of them need root password to simulate the packet loss. Is there a way to simulate these packet losses without needing a root password. \nNote: The code is written in GO programming language", "output": "One way is to isolate your packet handling code, and create mock-version of it (or ifdef'd sections) that, for testing, misbehave in the manner of your choosing.\nThat may be enough for your needs. \nFor industrial-strength testing, for a commercial or critical application, you'll want AT LEAST a box where you have root password. :) And perhaps more exotic test equipment that can misbehave in more exotic ways."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does Go cross-compile on Ubuntu to a Windows executable?\n\nQuestion:\nUsing Ubuntu, what steps should I take to compile Go source code into a Windows executable?", "output": "Building Windows Go programs on Linux"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Shared GAE datastore, Go <-> Java, regexp.FindStringIndex index shifting (byte-index vs utf-8-char-index)\n\nQuestion:\nShort version:\nThis prints 3, which makes sense because in Go strings are basically a slice of bytes, and it takes three bytes to represent this character.  How can I get len, and regexp functions to work in terms of characters, not bytes.\npackage main\nimport \"fmt\"\nfunc main() {\n    fmt.Println(len(\"ウ\"))//returns 3\n    fmt.Println(utf8.RuneCountInString(\"ウ\"))//returns 1\n}\n\nBackground:\nI'm saving text into the GAE datastore using JDO (Java).\nThen I'm processing the text using Go, specifically I'm using regexp.FindStringIndex and saving the index to the datastore.\nThen back in Java land I send the unmodified text, and index to the GWT client via json.\nSomewhere along the way the indexes are 'shifting', so by the time its on the client, they are off.\nIt seems the issue has to do with character encoding, I'm assuming Java/Go are interpreting the text (indexes) differently utf-8 char/byte?.  I see references to Runes in the regexp package.\nI think I can either make regexp.FindStringIndex return byte indexes in go, or make GWT client understand the utf-8 indexes.\nAny suggestions? I should be using UTF-8 incase I need to internationalize the app in the future, right?\nThanks\nEDIT:\nAlso when I was finding the index using Java on the server things just worked.\nOn the client (GWT) I'm using text.substring(start,end)\nTEST:\npackage main\n\nimport \"regexp\"\nimport \"fmt\"\n\nfunc main() {\n    fmt.Print(regexp.MustCompile(`a`).FindStringIndex(\"ウィキa\")[1])\n}\n\nThe code outputs 10, not 4.\nThe plan is to get FindStringIndex to return 4, any ideas?\nUpdate 2: Position Conversion\nfunc main() {\n    s:=\"ab日aba本語ba\";\n    byteIndex:=regexp.MustCompile(`a`).FindAllStringIndex(s,-1)\n    fmt.Println(byteIndex)//[[0 1] [5 6] [7 8] [15 16]]\n\n    offset :=0\n    posMap := make([]int,len(s))//maps byte-positions to char-positions\n    for pos, char := range s {\n        fmt.Printf(\"character %c starts at byte position %d, has an offset of %d, and a char position of %d.\\n\", char, pos,offset,pos-offset)\n        posMap[pos]=offset\n        offset += utf8.RuneLen(char)-1\n    }\n    fmt.Println(\"posMap =\",posMap)\n    for pos ,value:= range byteIndex{\n        fmt.Printf(\"pos:%d value:%d subtract %d\\n\",pos,value,posMap[value[0]])\n        value[1]-=posMap[value[0]]\n        value[0]-=posMap[value[0]]\n    }\n    fmt.Println(byteIndex)//[[0 1] [3 4] [5 6] [9 10]]\n\n}\n\n* Update 2 *\n    lastPos:=-1\n    for pos, char := range s {\n        offset +=pos-lastPos-1\n        fmt.Printf(\"character %c starts at byte position %d, has an offset of %d, and a char position of %d.\\n\", char, pos,offset,pos-offset)\n        posMap[pos]=offset\n        lastPos=pos\n    }", "output": "As you've probably gathered, Go and Java treat strings differently. In Java, a string is a series of codepoints (characters); in Go, a string is a series of bytes. Text manipulation functions in Go understand UTF-8 codepoints when necessary, but since the string is represented as bytes, the indices they return and work with are byte indexes, not character indexes.\nAs you observe in the comments, you can use a RuneReader and FindReaderIndex to get indexes in characters rather than bytes. strings.Reader provides an implementation of RuneReader, so you can use strings.NewReader to wrap a string in a RuneReader.\nAnother option is to take the substring you want the length of in characters and pass it to utf8.RuneLen, which returns the number of characters in the UTF-8 string. Using a RuneReader is probably more efficient, however."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Garbage collection and cgo\n\nQuestion:\nIs it possible to make the garbage collector in Go handle and release memory allocated through C code? I apologize, I haven't used C and cgo before so my examples may need some clarification.\nLets say you've got some C library that you'd like to use and this library allocates some memory that needs to be freed manually. What I'd like to do is something like this:\npackage stuff\n\n/*\n#include <stuff.h>\n*/\nimport \"C\"\n\ntype Stuff C.Stuff\n\nfunc NewStuff() *Stuff {\n    stuff := Stuff(C.NewStuff()) // Allocate memory\n\n    // define the release function for the runtime to call\n    // when this object has no references to it (to release memory)   \n    // In this case it's stuff.Free()     \n\n    return stuff\n\n}\n\nfunc (s Stuff) Free() {\n    C.Free(C.Stuff(s)) // Release memory\n}\n\nIs there any way for the garbage collector to call Stuff.Free() when there are no references to *Stuff in the Go runtime? \nAm I making sense here?\nPerhaps a more direct question is: Is it possible to make the runtime automatically handle the cleanup of C allocated memory by writing a function that the runtime calls when there are zero references to that object?", "output": "There exists the runtime.SetFinalizer function, but it cannot be used on any object allocated by C code.\nHowever, you can create a Go object for each C object that needs to be freed automatically:\ntype Stuff struct {\n    cStuff *C.Stuff\n}\n\nfunc NewStuff() *Stuff {\n    s := &Stuff{C.NewStuff()}\n    runtime.SetFinalizer(s, (*Stuff).Free)\n    return s\n}\n\nfunc (s *Stuff) Free() {\n    C.Free(s.cStuff)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: in go, why []int instead of int[]?\n\nQuestion:\nthis syntax was started quite some time ago, and I do not understand its appeal\nto me, even with initialization,\n\nvar arr int[2]{ 1, 2 }  // wrong!\n\nis more readable than\n\nvar arr [2]int{ 1, 2 }  // to me this seems klutzy\n\n\nbefore more people get on my case, please see notes, and link in answer was exactly the info I was seeking.", "output": "The second way is more readable to me. It's an opinion thing. Since you didn't create the language, your opinion wasn't the one adopted.\nThere may have also been other factors, such as the second way being easier to parse.\nHere's a blog post on the Go syntax choices. It sounds like it was mostly about readability.\nAlso, this difference from C might play a part (found here):\n\nThe size of an array is part of its\n  type. The types [10]int and [20]int\n  are distinct."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to get the reflect.Type of an interface?\n\nQuestion:\nIn order to determine whether a given type implements an interface using the reflect package, you need to pass a reflect.Type to reflect.Type.Implements().  How do you get one of those types?\nAs an example, trying to get the type of an uninitialized error (interface) type does not work (it panics when you to call Kind() on it)\nvar err error\nfmt.Printf(\"%#v\\n\", reflect.TypeOf(err).Kind())", "output": "Do it like this:\nvar err error\nt := reflect.TypeOf(&err).Elem()\n\nOr in one line:\nt := reflect.TypeOf((*error)(nil)).Elem()"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: .go file compilation error for windows 64bit\n\nQuestion:\nMy original question was, this. Which was answered by peterSO correctly. However, when I am trying to execute .go program, I found errors like this  for program 1 and thisfor program 2. Can anybody help me about, how can this be solved ?", "output": "You have been installing multiple versions of Go, including release/release.r60.3 and weekly.2011-09-01 for windows 386. If your PATH environment variable points to 8g for [windows 386 release.r60.3 10076] but your GOROOT environment variable points to packages for [windows 386 weekly.2011-09-01 9631], you will get the following error.\nC:\\Arpssss> 8g hello.go\nhello.go:3: import C:/go/pkg/windows_386/fmt.a: \nobject is [windows 386 weekly.2011-09-01 9631] \nexpected [windows 386 release.r60.3 10076]\n\nClean up the mess you've created! Uninstall Go. Delete all go installation folders. Install gowin386_release.r60.3_installer.exe.\nCheck your GOROOT (for Go packages) and GOBIN (for 8g) environment variables.\nC:\\>set GO\nGOBIN=C:/Go/bin\nGOROOT=C:/Go\n\nCheck that GOBIN is the only go folder in your PATH environment variable. For example,\nC:\\>set PATH\nPATH=...;C:/Go/bin;...;\n\nwhere ... is an ellipsis."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Performance of Google's Go?\n\nQuestion:\nSo has anyone used Google's Go?  I was wondering how the mathematical performance (e.g. flops) is compared to other languages with a garbage collector... like Java or .NET?\nHas anyone investigated this?", "output": "The Go math package is largely written in assembler for performance.\nBenchmarks are often unreliable and are subject to interpretation. For example, Robert Hundt's paper Loop Recognition in C++/Java/Go/Scala looks flawed. The Go blog post on Profiling Go Programs dissects Hundt's claims."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: problems when accessing C union field\n\nQuestion:\nI'd like to access the field of C union in Go. below is my source code, but i got an error when compile it:\npackage main\n\n// #include <stdio.h>\n// #include <stdlib.h>\n// union bar {\n//        char   c;\n//        int    i;\n//        double d;\n// };\nimport \"C\"\n\nimport \"fmt\"\n\nfunc main() {\n    var b *C.union_bar = new(C.union_bar)\n    b.c = 4\n    fmt.Println(b)\n}\n\nwhen i build, i got errors like below:\nb.c undefined (type *[8]byte has no field or method c)\nWho could tell me the correct approach to access a union field?", "output": "Seems like unions are treated, for type safety, as [N]byte, N == size of the biggest union item. Thus it is necessary to handle the \"Go visible\" type as [8]byte in this case. Then it appears to work:\npackage main\n\n/*\n\n#include <stdio.h>\n#include <stdlib.h>\nunion bar {\n       char   c;\n       int    i;\n       double d;\n} bar;\n\nvoid foo(union bar *b) {\n    printf(\"%i\\n\", b->i);\n};\n\n*/\nimport \"C\"\n\nimport \"fmt\"\n\nfunc main() {\n    b := new(C.union_bar)\n    b[0] = 1\n    b[1] = 2\n    C.foo(b)\n    fmt.Println(b)\n}\n\n\n(11:28) jnml@celsius:~/src/tmp/union$ go build && ./union\n513\n&[1 2 0 0 0 0 0 0]\n(11:28) jnml@celsius:~/src/tmp/union$ \n\n\nNote: The same code would print a different number at a machine with other endianness."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google Go error - \"cannot make type\"\n\nQuestion:\nIn my Go code I want to make an array of custom data type. I call\nBlocks=make(*BlockData, len(blocks))\n\nand I get error:\ncannot make type *BlockData\n\nmy class BlockData contains such field types as uint64, int64, float32, string, []byte, []string and []*TransactionData. The last one is an array of pointers to another custom class of mine.\nWhat should I do to fix this error?", "output": "make() is used to create slices, maps and channels. The type name must have [] before it when making a slice.\nUse this to make a slice of pointers to BlockData.\nBlocks = make([]*BlockData, len(blocks))\n\nRead more in the Go language specification."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Multiple input (fmt.Scanln)\n\nQuestion:\nWhy does this doesn't work, or how to get multiple input with fmt.Scanln?\nEDIT: If I insert more then one word then I get the Error \"Scan: expected newline\", anything I can do about this?\n    var username string\n    print(\"Username: \")\n    _, err := fmt.Scanln(&username)\n    if err != nil {\n            fmt.Println(\"Error: \", err)\n    }\n\n    var password string\n    print(\"Password: \")\n    _, err := fmt.Scanln(&password)\n    if err != nil {\n            fmt.Println(\"Error: \", err)\n    }\n\n    var status string\n    print(\"Status: \")\n    _, err := fmt.Scanln(&status)\n    if err != nil {\n            fmt.Println(\"Error: \", err)\n    }\n\n    fmt.Println(username, password, status)", "output": "You are re-declaring the err variable multiple times in the same scope.\nThe compiler error should have made that clear. The following will work:\nvar err error\nvar username string\n\nprint(\"Username: \")\n_, err = fmt.Scanln(&username)\nif err != nil {\n    fmt.Println(\"Error: \", err)\n}\n\nvar password string\nprint(\"Password: \")\n_, err = fmt.Scanln(&password)\nif err != nil {\n    fmt.Println(\"Error: \", err)\n}\n\nvar status string\nprint(\"Status: \")\n_, err = fmt.Scanln(&status)\nif err != nil {\n    fmt.Println(\"Error: \", err)\n}\n\nfmt.Println(username, password, status)\nreturn"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: bufio.NewReader always creates a new line :/\n\nQuestion:\nI use this, to collect a input and display the input then, but when I do it like this the \"something\" text will be displayed in a new line, but I want the text to be displayed in the same line, any ideas?\nfunc main() {\n    fmt.Println(\"Example\")\n    print(\"example: \")\n    in := bufio.NewReader(os.Stdin); \n    input, err := in.ReadString('\\n');\n    if err != nil {\n        fmt.Println(\"Error: \", err)\n    }\n\n    fmt.Println(input, \"something\")\n}", "output": "fmt.Println() automatically appends a newline to the end of it's output.\nYou could try using Printf, which takes a \"format string\" and a list of inputs.\nAn example would be:\nfunc main() {\n  fmt.Println(\"Example\")\n  print(\"example: \")\n  in := bufio.NewReader(os.Stdin); \n  input, err := in.ReadString('\\n');\n  if err != nil {\n      fmt.Println(\"Error: \", err)\n  }\n\n  fmt.Printf(\"something : %s\", input)\n}\n\nIn this case, %s is a placeholder for a string type.\nAll the placeholders can be found in the fmt godoc: http://golang.org/pkg/fmt/\nAlso if the input itself has a newline at the end, you can use Trim from the package strings to pull off the \\n character."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Receiving binary data via HTTP in Go\n\nQuestion:\nWhat's the best way to go about receiving binary data via HTTP in go?  In my case, I'd like to send a zip file to my application's REST API.  Examples specific to goweb would be great, but net/http is fine too.", "output": "Just read it from the request body\nSomething like\npackage main\n\nimport (\"fmt\";\"net/http\";\"io/ioutil\";\"log\")\n\nfunc h(w http.ResponseWriter, req *http.Request) {\n    buf, err := ioutil.ReadAll(req.Body)\n    if err!=nil {log.Fatal(\"request\",err)}\n    fmt.Println(buf) // do whatever you want with the binary file buf\n}\n\nA more reasonable approach is to copy the file into some stream\ndefer req.Body.Close()\nf, err := ioutil.TempFile(\"\", \"my_app_prefix\")\nif err!=nil {log.Fatal(\"cannot open temp file\", err)}\ndefer f.Close()\nio.Copy(f, req.Body)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What does a basic DOM XML parser need?\n\nQuestion:\nI've started programming in Google's Go Language, and the package I'm attempting to write is an API for processing and creating DOCX files (I'm familiar with this topic and thought it would be a good way to learn Go). As DOCX files are primarly a ZIP file with various XML files inside them, I rather need a DOM XML parser. However, I was unable to find any native Go DOM XML Parsers, as the only ones I saw seemed to be very limited, and probably SAX parsers (anyone who uses Go, correct me if I'm wrong).\nSo this past weekend I wrote a very basic DOM XML parser that was able to parse one of the simpler XML files within the DOCX package and output it back intact. At the moment I'm not going to bother with Namespace, XSLT, or schema validation support, as those aren't useful for manipulating DOCX files. My question is, what other XML standards and functionality would be important to incorporate into the parser?\nAt the moment, it only really just creates a tree of elements and attributes, which I can modify and save. I'm not current handling CDATA elements or XML escape characters (though those would be easy to do and I'll get to that this weekend).", "output": "First of all: if you specifically want to do DOM parser, you need to implement DOM API. But I am not sure if you actually mean that; perhaps you just mean an XML parser that produces XML tree model (\"dom\"); or just an XML parser? DOM is hardly the only way.\nAlso note that implementing DOM tree model using SAX parser is the most common way; few if any DOM packages have embedded parsers, commonly parser is exposed separately.\nAs to XML parser features, some of things that are MUSTs in my opinion are:\n\nHandling of character entities (ampersand and number), pre-defined general entities (lt, gt, apos, quot)\nHandling of xml declaration ()\nHandling of various input encodings; declared by xml declaration or externally -- too many parsers skimp on this, but is very imporant since xml documents can reliably detect encoding internally.\nChecking for uniqueness of attribute values\nChecking for proper nesting of elements\nSkipping of comments\nSkippping (if not handling) of processing instructions\nCDATA handling -- it's simple to do\nKeeping track of line numbers for error reporting\n\nOther eventually useful things are:\n\nNamespace handling\nChecking of character validity, both content and names\nNormalization of lineefeds as per xml specification"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What does the '.' (dot or period) in a Go import statement do?\n\nQuestion:\nIn the Go tutorial, and most of the Go code I've looked at, packages are imported like this:\nimport (\n    \"fmt\"\n    \"os\"\n    \"launchpad.net/lpad\"\n    ...\n)\n\nBut in http://bazaar.launchpad.net/~niemeyer/lpad/trunk/view/head:/session_test.go, the gocheck package is imported with a . (period):\nimport (\n    \"http\"\n    . \"launchpad.net/gocheck\"\n    \"launchpad.net/lpad\"\n    \"os\"    \n)\n\nWhat is the significance of the . (period)?", "output": "It allows the identifiers in the imported package to be referred to in the local file block without a qualifier.\n\nIf an explicit period (.) appears instead of a name, all the package's exported identifiers will be declared in the current file's file block and can be accessed without a qualifier.\nAssume we have compiled a package containing the package clause package math, which exports function Sin, and installed the compiled package in the file identified by \"lib/math\". This table illustrates how Sin may be accessed in files that import the package after the various types of import declaration.\n\nImport declaration          Local name of Sin\n\nimport   \"lib/math\"         math.Sin\nimport M \"lib/math\"         M.Sin\nimport . \"lib/math\"         Sin\n\nRef: http://golang.org/doc/go_spec.html#Import_declarations"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Writing a Python extension in Go (Golang)\n\nQuestion:\nI currently use Cython to link C and Python, and get speedup in slow bits of python code. However, I'd like to use goroutines to implement a really slow (and very parallelizable) bit of code, but it must be callable from python. (I've already seen this question)\nI'm (sort of) happy to go via C (or Cython) to set up data structures etc if necessary, but avoiding this extra layer would be good from a bug fix/avoidance point of view.\nWhat is the simplest way to do this without having to reinvent any wheels?", "output": "Update 2015: possible as of Go 1.5 https://blog.filippo.io/building-python-modules-with-go-1-5/\n\nwith Go 1.5 you can build .so objects and import them as Python modules, running Go code (instead of C) directly from Python.\n\nSee also https://github.com/go-python/gopy\n\ngopy generates a CPython extension module from a go package."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to print the results from a concurrent and recursive function?\n\nQuestion:\nI've been going through the go tour, and I've finished the web crawler exercise, but I think that the technique I used to print all the results may be inefficient.\nHere is my code. I only edited the crawl and main functions so I'll just post that. Here is the link to the exercise ( http://tour.golang.org/#70 )\n    var used = make(map[string]bool)\n\n    func Crawl(url string, depth int, fetcher Fetcher, results chan string) {\n        if depth <= 0 {\n            return\n        }\n        body, urls, err := fetcher.Fetch(url)\n        if err != nil {\n            results <- fmt.Sprintf(\"%v\",err)\n            return\n        }\n        results <-fmt.Sprintf(\"\\nfound: %s %q\\n\", url, body)\n        for _,u := range urls {\n            if used[u] == false {\n                used[u] = true\n                go Crawl(u, depth-1, fetcher, results)\n            }\n        }\n        return\n    }\n    //------------------------------------------------------------\n    func main() {\n        used[\"http://golang.org/\"] = true\n        results := make(chan string)\n        go Crawl(\"http://golang.org/\", 4, fetcher, results)\n        for i := 0; i < len(used); i++ {\n            fmt.Println(<-results)\n        }\n    }\n\nI use the \"for i < len(used)\" line in main to ensure that the value from results is printed only if there is a result to print. I can't just use\n    for i := range results\n\nbecause it is hard to use \"close(results)\" in the crawl function since it is recursive, but with the way I do it I have to find the length of the variable used every time.\nIs there a better way to do this?", "output": "To wait for a collection of goroutines to finish, use a sync.WaitGroup.\nI believe you'll find the example in the official documentation very familiar..\nhttp://golang.org/pkg/sync/#example_WaitGroup\nQuoting:\nvar wg sync.WaitGroup\nvar urls = []string{\n    \"http://www.golang.org/\",\n    \"http://www.google.com/\",\n    \"http://www.somestupidname.com/\",\n}\nfor _, url := range urls {\n    // Increment the WaitGroup counter.\n    wg.Add(1)\n    // Launch a goroutine to fetch the URL.\n    go func(url string) {\n        // Fetch the URL.\n        http.Get(url)\n        // Decrement the counter.\n        wg.Done()\n    }(url)\n}\n// Wait for all HTTP fetches to complete.\nwg.Wait()\n\nThis will block until all the work is done.\nIf you really want to print the results progressively as you collect them, the simplest way is to do it in the fetcher itself."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why is Go so slow (compared to Java)?\n\nQuestion:\nAs we could see from The Computer Language Benchmarks Game in 2010:\n\nGo is on average 10x slower than C \nGo is 3x slower than Java !?\n\nHow can this be, bearing in mind that Go compiler produces native code for execution?\nImmature compilers for Go? Or there is some intrinsic problem with the Go language?\nEDIT:\nMost answers deny intrinsic slowness of Go languge, claiming the problem resides in immature compilers.\nTherefore I've made some own tests to calculate Fibonacci numbers: Iterative algorithm runs in Go (freebsd,6g) with the same speed as in C (with O3 option). The dull recursive one runs in Go 2 times slower than in C (with -O3 option; with -O0 - the same). But I haven't seen 10x fall as in the Benchmarks Game.", "output": "The 6g and 8g compilers are not particularly optimising, so the code they produce isn't particularly fast.\nThey're designed to run fast themselves and produce code that's OK (there is a bit of optimisation). gccgo uses GCC's existing optimisation passes, and might provide a more pointful comparison with C, but gccgo isn't feature-complete yet.\nBenchmark figures are almost entirely about quality of implementation. They don't have a huge amount to do with the language as such, except to the extent that the implementation spends runtime supporting language features that the benchmark doesn't really need. In most compiled languages a sufficiently clever compiler could in theory strip out what isn't needed, but there comes a point where you're rigging the demo, since very few real users of the language would write programs that didn't use that feature. Moving things out of the way without removing them entirely (e.g. predicting virtual call destinations in JIT-compiled Java) starts to get tricky.\nFWIW, my own very trivial test with Go when I was taking a look at it (a loop of integer addition, basically), gccgo produced code towards the fast end of the range between gcc -O0 and gcc -O2 for equivalent C. Go isn't inherently slow, but the compilers don't do everything, yet. Hardly surprising for a language that's 10 minutes old."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Type converting slices of interfaces\n\nQuestion:\nI'm curious why Go does't implicitly convert []T to []interface{} when it will implicitly convert T to interface{}.  Is there something non-trivial about this conversion that I'm missing?  \nExample:\nfunc foo([]interface{}) { /* do something */ }\n\nfunc main() {\n    var a []string = []string{\"hello\", \"world\"}\n    foo(a)\n}\n\ngo build complains \n\ncannot use a (type []string) as type []interface {} in function argument\n\nAnd if I try to do it explicitly, same thing: b := []interface{}(a) complains \n\ncannot convert a (type []string) to type []interface {}\n\nSo every time I need to do this conversion (which seems to come up a lot), I've been doing something like this:\nb = make([]interface{}, len(a), len(a))\nfor i := range a {\n    b[i] = a[i]\n}\n\nIs there a better way to do this, or standard library functions to help with these conversions?  It seems kind of silly to write 4 extra lines of code every time I want to call a function that can take a list of e.g. ints or strings.", "output": "In Go, there is a general rule that syntax should not hide complex/costly operations.\nConverting a string to an interface{} is done in O(1) time. Converting a []string to an interface{} is also done in O(1) time since a slice is still one value. However, converting a []string to an []interface{} is O(n) time because each element of the slice must be converted to an interface{}.\nThe one exception to this rule is converting strings. When converting a string to and from a []byte or a []rune, Go does O(n) work even though conversions are \"syntax\".\nThere is no standard library function that will do this conversion for you. Your best option though is just to use the lines of code you gave in your question:\nb := make([]interface{}, len(a))\nfor i := range a {\n    b[i] = a[i]\n}\n\nOtherwise, you could make one with reflect, but it would be slower than the three line option. Example with reflection:\nfunc InterfaceSlice(slice interface{}) []interface{} {\n    s := reflect.ValueOf(slice)\n    if s.Kind() != reflect.Slice {\n        panic(\"InterfaceSlice() given a non-slice type\")\n    }\n\n    // Keep the distinction between nil and empty slice input\n    if s.IsNil() {\n        return nil\n    }\n\n    ret := make([]interface{}, s.Len())\n\n    for i:=0; i<s.Len(); i++ {\n        ret[i] = s.Index(i).Interface()\n    }\n\n    return ret\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: When to flush a file in Go?\n\nQuestion:\nWhen is it necessary to flush a file?\nI never do it because I call File.Close and I think that it is flushed automatically, isn't it?", "output": "You'll notice that an os.File doesn't have a .Flush() because it doesn't need one because it isn't buffered. Writes to it are direct syscalls to write to the file.\nWhen your program exits(even if it crashes) all files it has open will be closed automatically by the operating system and the file system will write your changes to disk when it gets around to it (sometimes up to few minutes after your program exits).\nCalling os.File.Sync() will call the fsync() syscall which will force the file system to flush it's buffers to disk. This will guarantee that your data is on disk and persistent even if the system is powered down or the operating system crashes.\nYou don't need to call .Sync()"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: C++ libraries that implement Go goroutines or Go channels?\n\nQuestion:\nI'm working with a medium-sized C++ code base which is currently entirely single-threaded. The time has come, however, to pursue concurrency and parallelism for performance gains. I'm very interested in the concurrency model of Google's Go programming language, with very lightweight goroutines and a system of communicating channels.\nSadly, for a variety of perfectly valid reasons, the project needs to stay in C++. So my question is: Is there a C++ library that approximates the Go paradigm for parallelism? Specifically, is there an approximation of goroutines or go channels available for C++? My fallback plan is just to use boost::thread.\nThe application in question is a long-running proprietary simulation for the financial forecasting domain. It's usually CPU bound, but also gets blocked on IO when new data become available. Many of the computations involved are not dependent on previous results and could be fairly easily made to run in parallel. Being able to run the application in a distributed context is a long-term goal, but not one that needs to be solved immediately.", "output": "If your aim is primarily speeding up compute things, Intel's TBB (Threading Building Blocks) is (IMHO) a better option than rolling your own inferior version from boost::thread."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: smtp.SendMail fails after 10 minutes with EOF\n\nQuestion:\nI'm trying to send mail via the standard library SMTP package and it does nothing for exactly 10 minutes and then fails with an unhelpful End of File error I can't make sense of.\n// excerpt from the calling function\n// --- snip ---\nif e := mailNotify(board, validPosts, ipMinusPort, delTime); e != nil {\n    errorPage(w, tmpl, \"Contact Administrator\",\n        \"Email notification failed, please contact archive admin.\")\n    log.Println(\"ERROR: Failed to send notification email: \" + e.Error())\n}\n// --- snip ---\n\nfunc mailNotify(board *config.Board, validPosts []int64, \n                        ip string, delTime time.Time) error {\n\n    addresses := strings.Split(board.NotifyAddr, \",\")\n    if len(addresses) < 1 {\n        return nil\n    }\n\n    msg := new(bytes.Buffer)\n    type values struct {\n        IP      string\n        Posts   []int64\n        DelTime time.Time\n    }\n    t.ExecuteTemplate(msg, \"post_reported\", &values{ip, validPosts, delTime})\n    auth:= smtp.PlainAuth(\"\", board.NotifyAddr, board.NotifyPass,\n        strings.Split(board.SMTPServer, \":\")[0])\n    return smtp.SendMail(board.SMTPServer, auth,\n        board.FromEmail, addresses, msg.Bytes())\n}\n\nThe exact message that gets logged is:\n\n2012/07/25 22:57:58 ERROR: Failed to send notification email: EOF\n\nI've log.Printf debugged this function and verified the values being sent at this point are valid. The email address is a real address on gmail.com and the password is correct, and board.SMTPServer is smtp.googlemail.com:465. I've tried storing the result of msg.Bytes() in a separate variable and taking the length to be sure that it was producing an byte array to send, and the length is indeed non-zero. I'm guessing the EOF is bubbling up from somwhere deeper in the standard library than the SendMail function itself, but I have no idea where it's choking and I don't know what I did to upset it.", "output": "Gmail's port 465 is for connecting via TLS, but SendMail expects plain old TCP. Try connecting to port 587 instead. SendMail will upgrade to TLS automatically when it's available (which it is in this case)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go compiler says \"declared and not used\" but they are being used\n\nQuestion:\nI have the following function that is giving me \"variable declared and not used\" errors:\ntype Comparison struct {\n        Left []byte\n        Right []byte\n        Name string\n}\n\nfunc img(w http.ResponseWriter, r *http.Request, c appengine.Context, u *user.User) {\n  key := datastore.NewKey(\"Comparison\", r.FormValue(\"id\"), 0, nil)\n  side := r.FormValue(\"side\")\n  comparison := new(Comparison)\n  err := datastore.Get(c, key, comparison)\n  check(err)\n\n  if( side == \"left\"){\n    m, _, err := image.Decode(bytes.NewBuffer(comparison.Left))\n  } else {\n    m, _, err := image.Decode(bytes.NewBuffer(comparison.Right))\n  }\n  check(err)\n\n  w.Header().Set(\"Content-type\", \"image/jpeg\")\n  jpeg.Encode(w, m, nil)\n}\n\nIt gives me the following errors:\ndpcompare.go:171: m declared and not used\ndpcompare.go:171: err declared and not used\ndpcompare.go:173: m declared and not used\ndpcompare.go:173: err declared and not used\ndpcompare.go:178: undefined: m\ndpcompare.go:185: key declared and not used\n\nThe thing is m, err, and key are all being used. I can't wrap my head around why the compiler thinks thy are not.", "output": "As @kostix said, m is local to the scope of the if. Try this code\ntype Comparison struct {\n        Left []byte\n        Right []byte\n        Name string\n}\n\nfunc img(w http.ResponseWriter, r *http.Request, c appengine.Context, u *user.User) {\n  key := datastore.NewKey(\"Comparison\", r.FormValue(\"id\"), 0, nil)\n  side := r.FormValue(\"side\")\n  comparison := new(Comparison)\n  err := datastore.Get(c, key, comparison)\n  check(err)\n\n  // NOTE! now m is in the function's scope\n  var m Image    \n  if( side == \"left\"){\n    m, _, err = image.Decode(bytes.NewBuffer(comparison.Left))\n  } else {\n    m, _, err = image.Decode(bytes.NewBuffer(comparison.Right))\n  }\n  check(err)\n\n  w.Header().Set(\"Content-type\", \"image/jpeg\")\n  jpeg.Encode(w, m, nil)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to get the name of a function in Go?\n\nQuestion:\nGiven a function, is it possible to get its name? Say:\nfunc foo() {\n}\n\nfunc GetFunctionName(i interface{}) string {\n    // ...\n}\n\nfunc main() {\n    // Will print \"name: foo\"\n    fmt.Println(\"name:\", GetFunctionName(foo))\n}\n\nI was told that runtime.FuncForPC would help, but I failed to understand how to use it.", "output": "I found a solution:\npackage main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"runtime\"\n)\n\nfunc foo() {\n}\n\nfunc GetFunctionName(i interface{}) string {\n    return runtime.FuncForPC(reflect.ValueOf(i).Pointer()).Name()\n}\n\nfunc main() {\n    // This will print \"name: main.foo\"\n    fmt.Println(\"name:\", GetFunctionName(foo))\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How can I convert a null-terminated string in a byte buffer to a string in Go?\n\nQuestion:\nThis:\nlabel := string([]byte{97, 98, 99, 0, 0, 0, 0})\nfmt.Printf(\"%s\\n\", label)\n\ndoes this (^@ is the null-byte):\ngo run test.go \nabc^@^@^@", "output": "There's this function hidden inside Go's syscall package that finds the first null byte ([]byte{0}) and returns the length. I'm assuming it's called clen for C-Length.\nSorry I'm a year late on this answer, but I think it's a lot simpler than the other two (no unnecessary imports, etc.)\nfunc clen(n []byte) int {\n    for i := 0; i < len(n); i++ {\n        if n[i] == 0 {\n            return i\n        }\n    }\n    return len(n)\n}\n\nSo,\nlabel := []byte{97, 98, 99, 0, 0, 0, 0}\ns := label[:clen(label)]\nfmt.Println(string(s))\n\nWhat that ^ says is to set s to the slice of bytes in label from the beginning to the index of clen(label).\nThe result would be abc with a length of 3."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to import package by path from string in Go?\n\nQuestion:\nI have a string with name of package (like \"my/package/test\") and I wanna import that and call some function from package.\nSomething like this:\nfunc init() {\n  var pkg string = \"test/my/pkg\"\n  import pkg\n  pkg.Test()\n}\n\nPS. Thanks for help", "output": "The Go language does not allow what you mentioned in your example. This is a conscious choice. In my opinion, the reason behind this choice has to do with compiler performance and ease of code understanding by the machine. This for example enables tools such as gofix that can partially fix Go code without need for user intervention.\nIt also enables a programmer to clearly see all of the statically imported packages used by the program.\nSee also the grammar rules for source file organization in the Go language specification.\n\nIn relation to dynamically loading packages at run-time: Go has no support for loading packages at run-time. A future Go run-time might implement this feature (for example, it is occasionally being requested in messages in the golang-nuts mailing list), but the current state is that there is no support for this feature."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Do I have to lock when several go routines write in channel\n\nQuestion:\nDo I have to lock if two go routines write into the same channel or is this automatically handled by go?", "output": "Channels are safe, it's built in."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google App Engine Go HTTP Post []byte\n\nQuestion:\nI want to send []byte data over http via post on Google App Engine in Go. How do I construct bodyType and, body for the request?", "output": "package app\n\nimport (\n    \"http\"\n    \"appengine\"\n    \"appengine/urlfetch\"\n    \"bytes\"\n    \"fmt\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/post\", post)\n}\n\nfunc post(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    bs := []byte{1,2,3}\n    buf := bytes.NewBuffer(bs)\n    client := http.Client{Transport: &urlfetch.Transport{Context:c}}\n    if _, err := client.Post(\"http://localhost:8080/\", \"application/octet-stream\", buf); err != nil {\n        fmt.Println(err)\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go error: \"fmt.Println not used\". What?\n\nQuestion:\nWhat the title said. I'm getting an error:\nfmt.Println not used\n\nThe line mentioned is the last line of my source file. I'm not using the fmt package in that file, but I did recently.\nThis happens when I try to build the package or run tests. \nEDIT: \nIf I go clean myproject the project I still get the same response.\nI ran just go clean and now have:\n# myproject\n<epoch>: fmt.Println not used\n\nEDIT for the benefit of Cat Plus Plus, here's a source file triggering the error:\ntypes2.go\npackage mypackage\n\nimport (\n)\n\nto run:\ngo build mypackage\n# mypackage\n./types2.go:4: fmt.Println not used\n\nYes you read that right.", "output": "The answer was that I had the expression fmt.Println in a file somewhere. The compiler told me that the error was occurring in incorrect file(s). More info in this blog post. \nhttp://blog.afandian.com/2012/07/strange-error-in-go-fmt-println-not-used/"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Are there any SMTP servers written in PHP or Go?\n\nQuestion:\nI don't mean SMTP/IMAP clients, I mean a working SMTP server that can both receive and send email.\nThere are lots of examples of partial PHP and Go SMTP servers that only listen for SMTP connections - aren't there any which show how to send mail?\nI'm really interested in learning this second half of the Simple Mail Transfer Protocol. I understand that there are a lot of bad servers which vary from the standard - but I want to learn how the whole protocol from start to finish is implemented.", "output": "I think you misunderstand how SMTP is supposed to work. Here is a simplified version:\n\nThe Mail User Agent (MUA) queues a message for delivery by sending it to the Mail Submission Agent (MSA).\n\nMSA connects to the Mail Transfer Agent (the \"smtp server\") over SMTP.\n\nThe MTA then uses DNS to lookup the MX record for the recipient's domain. It then contacts the recipient's MX server as a SMTP client.\n\nThe MX server accepts the envelope; it then forwards it to a Mail Delivery Agent (MDA).\n\nMDA then puts the envelope in some message store where some IMAP or POP3 server reads messages. The MUA then connects to these servers to retrieve the message.\n\n\nThe entire process uses three main commands. MAIL, RCPT and DATA.\n\nMAIL = Envelope information, bounce addresses, etc.\nRCTP = The recipient.\nDATA = The payload.\n\nThe SMTP server responds - much like HTTP actually, with error codes and based on that, the MTA knows what to do with the envelope (its a bounce back, so send appropriate reply, etc.)\nIn this process there is no such thing as \"retrieve email\" (ignoring ETRN for a bit); as SMTP is purely for email transmission and not retrieval."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: redigo, SMEMBERS, how to get strings\n\nQuestion:\nI am redigo to connect from Go to a redis database. How can I convert a type of []interface {}{[]byte{} []byte{}} to a set of strings? In this case I'd like to get the two strings Hello and World.\npackage main\n\nimport (\n    \"fmt\"\n    \"github.com/garyburd/redigo/redis\"\n)\n\nfunc main() {\n    c, err := redis.Dial(\"tcp\", \":6379\")\n    defer c.Close()\n    if err != nil {\n        fmt.Println(err)\n    }\n    c.Send(\"SADD\", \"myset\", \"Hello\")\n    c.Send(\"SADD\", \"myset\", \"World\")\n    c.Flush()\n    c.Receive()\n    c.Receive()\n\n    err = c.Send(\"SMEMBERS\", \"myset\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    c.Flush()\n    // both give the same return value!?!?\n    // reply, err := c.Receive()\n    reply, err := redis.MultiBulk(c.Receive())\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Printf(\"%#v\\n\", reply)\n    // $ go run main.go\n    // []interface {}{[]byte{0x57, 0x6f, 0x72, 0x6c, 0x64}, []byte{0x48, 0x65, 0x6c, 0x6c, 0x6f}}\n    // How do I get 'Hello' and 'World' from this data?\n}", "output": "Looking at the source code for the module, you can see the type signature returned from Receive will be:\n\nfunc (c *conn) Receive() (reply interface{}, err error)\n\nand in your case, you're using MultiBulk:\n\nfunc MultiBulk(v interface{}, err error) ([]interface{}, error)\n\nThis gives a reply of multiple interface{} 's in a slice: []interface{}\nBefore an untyped interface{} you have to assert its type like so:\nx.(T)\nWhere T is a type (eg, int, string etc.)\nIn your case, you have a slice of interfaces (type: []interface{}) so, if you want a string, you need to first assert that each one has type []bytes, and then cast them to a string eg:\nfor _, x := range reply {\n    var v, ok = x.([]byte)\n    if ok {\n        fmt.Println(string(v))\n    }\n}\n\nHere's an example: http://play.golang.org/p/ZifbbZxEeJ\nYou can also use a type switch to check what kind of data you got back:\nhttp://golang.org/ref/spec#Type_switches\nfor _, y := range reply {\n    switch i := y.(type) {\n    case nil:\n        printString(\"x is nil\")\n    case int:\n        printInt(i)  // i is an int\n    etc...\n    }\n}\n\nOr, as someone mentioned, use the built in redis.String etc. methods which will check and convert them for you.\nI think the key is, each one needs to be converted, you can't just do them as a chunk (unless you write a method to do so!)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Windows DLL-linking with cgo\n\nQuestion:\nMy ultimate goal is to successfully link to a number of DLLs (opengl32.dll glfw.dll and glu32.dll) from a Go package -- but trying to link to the go-glfw package gave me \"not defined\" errors.\nSo I decided to get a very simple cgo dynamic/shared library linking to work, from the simple unmodified example in %GOROOT%\\misc\\cgo\\life. But just invoking the command go build -o life main.go fails with essentially the same linker error, namely:\ngo-build374967034/_/C_/Go/misc/cgo/life.a(c-life.o)(.text): _assert: not defined\n\n\"not defined\"... just exactly the same error I had when trying to link glfw as per above.\nThis is a fresh untampered-with install of Go 1.0.1 freshly downloaded this morning, on a vanilla, fairly recent Win7 64-bit installation. What could possibly go wrong? I know... Windows. Would love to hear any ideas... seems like DLL linking with CGO is a no-brainer and  simple to do from what I read around the net. Yet even the simplest of examples fails for me.", "output": "I've think this particular bug has been discussed here: http://code.google.com/p/go/issues/detail?id=3261\n but I'm not sure if it can be applied to your case. In the end from what I've read they proposed a patching but not really tried 'cause I'm waiting 1.1 release (hoping they'll fix the runtime infamous memory leak ;) )"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: invalid recursive type in a struct in go\n\nQuestion:\nI am new to the Go programming language and I have an assignment to create and interpreter but I am running into the following problem:\nI want to define an Environment as:\ntype Environment struct{\n    parent Environment\n    symbol string\n    value RCFAEValue\n}\n\nfunc (env Environment) lookup(lookupSymbol string) RCFAEValue{\n    if lookupSymbol == env.symbol{\n        return env.value\n    } //if parent != nill {\n        return env.parent.lookup(lookupSymbol)\n}\n\nBut I get the error \"invalid recursive type Environment\".  Based on my research I changed the parent to type *Environment. But now when I need to create a new Environment with a var of type Environment it get the error \"cannot use fun_Val.ds (type Environment) as type *Environment in field value\".  I am creating the Environment as follows:\nEnvironment{fun_Val.ds,fun_Val.param,exp.arg_exp.interp(env)}\n\nI am trying to keep the amount of code in this post to a limit but if you need more, or have other questions please let me know.", "output": "You need to define Environment as:\ntype Environment struct {\n    parent *Environment // note that this is now a pointer\n    symbol string\n    value  RCFAEValue\n}\n\nOtherwise the compiler has no way to figure out what the size of the Environment structure is. A pointer's size is known, but how big is something that contains itself? (And the inner struct contains itself as well, as does the inner inner struct, and so on.)\nCreating the Environment will then look like:\nEnvironment{&fun_Val.ds, fun_Val.param, exp.arg_exp.interp(env)}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Get a list of all installed packages in Go\n\nQuestion:\nHow can I list all installed packages via goinstall? I need this to reinstall all packages installed on one computer to a different computer.", "output": "There is a list under $GOROOT/goinstall.log\nIf you want to install all the packages on an different computer just copy the file across and\nrun, \ngoinstall -a \nand goinstall will read this file and install all packages listed in it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you get the output of a system command in Go?\n\nQuestion:\nLet's say I want to run 'ls' in a go program, and store the results in a string. There seems to be a few commands to fork processes in the exec and os packages, but they require file arguments for stdout, etc. Is there a way to get the output as a string?", "output": "Edit: This answer is obsolete. Please see Fatih Arslan's answer below.\n\nUse exec.Run by specifying Pipe as the stdout (and stderr if you want). It will return cmd, which contains an os.File in the Stdout (and Stderr) fields. Then you can read it using for example ioutil.ReadAll.\nExample:\npackage main\n\nimport (\n    \"exec\";\n    \"io/ioutil\";\n)\n\nfunc main() {\n    if cmd, e := exec.Run(\"/bin/ls\", nil, nil, exec.DevNull, exec.Pipe, exec.MergeWithStdout); e == nil {\n        b, _ := ioutil.ReadAll(cmd.Stdout)\n        println(\"output: \" + string(b))\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to find out element position in slice?\n\nQuestion:\nHow does one determine the position of an element present in slice?\nI need something like the following:\ntype intSlice []int\n\nfunc (slice intSlice) pos(value int) int {\n    for p, v := range slice {\n        if (v == value) {\n            return p\n        }\n    }\n    return -1\n}", "output": "Sorry, there's no generic library function to do this. Go doesn't have a straight forward way of writing a function that can operate on any slice.\nYour function works, although it would be a little better if you wrote it using range.\nIf you happen to have a byte slice, there is bytes.IndexByte."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to import and use different packages of the same name\n\nQuestion:\nFor example, I want to use both  text/template and html/template in one source file.\nBut the code below throw errors.\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"text/template\" // template redeclared as imported package name\n    \"html/template\" // template redeclared as imported package name\n)\n\nfunc handler_html(w http.ResponseWriter, r *http.Request) {\n    t_html, err := html.template.New(\"foo\").Parse(`{{define \"T\"}}Hello, {{.}}!{{end}}`)\n    t_text, err := text.template.New(\"foo\").Parse(`{{define \"T\"}}Hello, {{.}}!{{end}}`)\n\n}", "output": "import (\n    \"text/template\"\n    htemplate \"html/template\" // this is now imported as htemplate\n)\n\nRead more about it in the spec."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: getpasswd functionality in Go?\n\nQuestion:\nSituation:\nI want to get a password entry from the stdin console - without echoing what the user types. Is there something comparable to getpasswd functionality in Go?\nWhat I tried:\nI tried using syscall.Read, but it echoes what is typed.", "output": "you can do this by execing stty -echo to turn off echo and then stty echo after reading in the password to turn it back on"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google Go and SQLite: What library to use and how?\n\nQuestion:\nI'm fairly new to Google's Go, but I'm trying to learn more by writing a simple application to talk to an SQLite 3 database. So far I've come across a few different sqlite libraries, but they all seem to be sparsely maintained or have little or no documentation.\nI was hoping someone here would be able to point me in the right direction by suggesting a library to use for SQLite 3, and giving me some demo code for simple INSERTs and SELECTs.\nThank you for your time.", "output": "Edit: relevant also for Go 1.\nWith a recent go weekly, and an installed Sqlite3 library on a Linux system, you should:\n$ go get github.com/mattn/go-sqlite3\nsqlite3.go: In function ‘_cgo_7e09c699097a_Cfunc_sqlite3_prepare_v2’:\nsqlite3.go:198:2: warning: passing argument 5 of ‘sqlite3_prepare_v2’ from incompatible pointer type [enabled by default]\n/usr/local/include/sqlite3.h:2924:16: note: expected ‘const char **’ but argument is of type ‘char **’\n$ # those warnings are OK, don't worry\n$ mkdir $GOPATH/src/myproject && cd $GOPATH/src/myproject\n$ wget https://raw.github.com/mattn/go-sqlite3/master/example/main.go\n$ vi main.go # this is an example how to use go-sqlite3\n\nThis should get you started."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How can I make net.Read wait for input in golang?\n\nQuestion:\nSo I'm making a server for my elevator in Go, and I'm running the function \"handler\" as a goroutine with a TCP-connection.\nI want it to read from a connection, and if no signal is detected within a certain timespan I want it to return an error. \nfunc handler(conn net.Conn){\n    conn.SetReadTimeout(5e9)\n    for{\n        data := make([]byte, 512)\n        _,err := conn.Read(data)\n    }\n}\n\nAs long as I have a client sending stuff over the connection it seems to be working fine, but as soon as the client stops sending the net.Read function returns the error EOF and starts looping with no delay whatsoever.\nThis might be how Read is supposed to work, but could someone suggest another way to handle the problem without having to close and open the connection every time I want to read something?", "output": "Read is working as expected I think. It sounds like you want the net.Read to work like a channel in Go. This is pretty easy in go just wrap the net.Read in a running goroutine and use select to read from channels a goroutine is really cheap and so is a channel\nExample:\nch := make(chan []byte)\neCh := make(chan error)\n\n// Start a goroutine to read from our net connection\ngo func(ch chan []byte, eCh chan error) {\n  for {\n    // try to read the data\n    data := make([]byte, 512)\n    _,err := conn.Read(data)\n    if err != nil {\n      // send an error if it's encountered\n      eCh<- err\n      return\n    }\n    // send data if we read some.\n    ch<- data\n  }\n}(ch, eCh)\n\nticker := time.Tick(time.Second)\n// continuously read from the connection\nfor {\n  select {\n     // This case means we recieved data on the connection\n     case data := <-ch:\n       // Do something with the data\n     // This case means we got an error and the goroutine has finished\n     case err := <-eCh:\n       // handle our error then exit for loop\n       break;\n     // This will timeout on the read.\n     case <-ticker:\n       // do nothing? this is just so we can time out if we need to.\n       // you probably don't even need to have this here unless you want\n       // do something specifically on the timeout.\n  }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to receive a result from one of a number of goroutines in Go?\n\nQuestion:\nI've only just recently learned about Google's programming language, Go.  I've been intrigued by its offered support for concurrency, and set out to learn more about it.  However, I went looking to see how Go implemented a particular feature of concurrency, and so far I haven't seen any evidence at all that this feature is there at all.\nHere's a hypothetical situation:  suppose we are programming a function to determine the Foo value of a particular input.  For any given input, the Foo value is found either in domain A, or domain B (not in both).  The techniques of searching in these domains are quite different, but they share the property that successful searches tend to return quickly, while unsuccessful searches must go through the entire dataset to be exhaustive and therefore take a long time.\nNow, in other languages that employ concurrency (such as Cilk) one could program the function Foosearch so that it spawned an Asearch function and a Bsearch function.  These functions would run concurrently, and whenever either of them came up with an answer, that answer would be reported to the calling function Foosearch, which would terminate any functions it had spawned that had not returned.\nWith Go's goroutines, however, it looks like you can only connect two routines with a channel - so you couldn't set up a channel to which either Asearch or Bsearch could send, depending on which found an answer first, and have Foosearch read from it.  It also looks like you can't read from a channel without blocking on it - so you couldn't have Foosearch start Asearch and Bsearch and set up channels from both, then run in a loop checking to see if one or the other has produced an answer.\nIs my understanding of the limits of Go's concurrency correct?  Is there another way to achieve the given result?", "output": "No, I don't believe your understanding of the limits of Go is correct.\nFor one thing, there's nothing I've seen in Go that limits channels to communicating between two routines. You can pass the same channel to both Asearch and Bsearch, and then whichever one finishes can send the result on that channel.\nIf instead you wanted to use two channels, and wait for one of them to get the result, you could just use the select statement. From the Go tutorial, an example selecting on a channel used to send requests, and one used to signal the server to quit:\n21    func server(op binOp, service chan *request, quit chan bool) {\n22        for {\n23            select {\n24            case req := <-service:\n25                go run(op, req);  // don't wait for it\n26            case <-quit:\n27                return;\n28            }\n29        }\n30    }\n\nFurthermore, while receives from a channel normally block, you can also do a non-blocking receive from a channel.\n\nIf a receive expression is used in an\n  assignment or initialization of the\n  form\nx, ok = <-ch\nx, ok := <-ch\nvar x, ok = <-ch\n\nthe receive operation becomes\n  non-blocking. If the operation can\n  proceed, the boolean variable ok will\n  be set to true and the value stored in\n  x; otherwise ok is set to false and x\n  is set to the zero value for its type\n  (§The zero value).\n\nSo, there are several ways to wait for the result from multiple goroutines without blocking. I think I'd go with multiple channels multiplexed using select, as that way you can easily tell which routine returned the result without having to package that information into the value you're sending or doing some other form of out-of-band communication."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Two forms of struct declaration in Go\n\nQuestion:\nI've got two forms of struct declaration in the function scope. As far as I could see the bellow-listed snippet woks just fine. The question is what's the difference between the two declaration ways? Is that only a semantic question or there is something tricky under the covers? \npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    type Person1 struct {\n        Name string\n        Id int\n    }\n    person1 := &Person1{Name : \"John Smith\", Id : 10}\n    fmt.Printf(\"(%s, %d)\\n\", person1.Name, person1.Id)\n    var person2 struct {\n        name string\n        id int\n    }\n    person2.name = \"Kenneth Box\"\n    person2.id = 20\n    fmt.Printf(\"(%s, %d)\\n\", person2.name, person2.id)\n}", "output": "One is a named type - you can create multiple variables of that type, if you need to, using the type name.\nThe other type has no name.  You cannot create more variables of the type other than by using the := operator."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Any smart method to get exp/html back after Go1?\n\nQuestion:\nI've installed the Go release version as root.\nGo1 removed all exp/ code.\nIs there smart method to get exp/* back after Go1?\n(I mean how to install in my local GOPATH?)\n[My Solution]\n# pull from go repository to $HOME/repo/go\ncd $HOME/repo\nhg clone https://go.googlecode.com/hg/go\n# make symbolic link to your GOPATH(eg. $HOME/go)\ncd $HOME/go/src\nln -s $HOME/repo/go/src/pkg/exp .", "output": "Note: with go 1.4 (Q4, 2014), the url for that exp package will change (again):\ncode.google.com/p/go.exp => golang.org/x/exp\n\nThat means now:\ngo get golang.org/x/exp\n\nSee \"Go 1.4 subrepo renaming\".\nRegarding the html package, it is in net/html, so this will become (as commented by andybalholm):\ngo get golang.org/x/net/html"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to multiplex several channels into one?\n\nQuestion:\nThe idea is to have a variable number of channels in a slice, push each value received through them into a single channel, and close this output channel once the last one of the input channels is closed. Something like this, but for a number of channels more than two:\nfunc multiplex(cin1, cin2, cout chan int) {\n    n := 2\n    for {\n        select {\n        case v, ok := <-cin1:\n            if ok {\n                cout <- v\n            } else {\n                n -= 1\n            }\n\n        case v, ok := <-cin2:\n            if ok {\n                cout <- v\n            } else {\n                n -= 1\n            }\n        }\n\n        if n == 0 {\n            close(cout)\n            break\n        }\n    }\n}\n\nThe above code avoids busy looping since there is no default case, which is good (EDIT: it looks like the presence of \", ok\" makes the select statement non-blocking and the loop is busy after all. But for the sake of the example, think of the code as if it would block). Could the same kind of functionality also be achieved with an arbitrary number of input channels? Obviously, this could be done by reducing the slice pairwise to a single channel, but I would be more interested in a simpler solution, if possible.", "output": "I believe this snippet does what you're looking for.  I've changed the signature so that it's clear that the inputs and output should only be used for communication in one direction.  Note the addition of a sync.WaitGroup, you need some way for all of the inputs to signal that they have completed, and this is pretty easy.\nfunc combine(inputs []<-chan int, output chan<- int) {\n  var group sync.WaitGroup\n  for i := range inputs {\n    group.Add(1)\n    go func(input <-chan int) {\n      for val := range input {\n        output <- val\n      }\n      group.Done()\n    } (inputs[i])\n  }\n  go func() {\n    group.Wait()\n    close(output)\n  } ()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to implement resizable arrays in Go\n\nQuestion:\nI come from a C++ background and I'm used to using the std::vector class for things like this.\nLets assume I want a dynamic array of these:\ntype a struct {\n    b int\n    c string\n}\n\nWhat is the standard way of doing this?\nA snippet would be very useful", "output": "Use the append() builtin\nExample:\ntype mytype struct {\n  a, b int\n}\n\nfunc main() {\n  a := []mytype{mytype{1, 2}, mytype{3, 4}}\n  a = append(a, mytype{5, 6})\n}\n\nRefer to the spec for more info on append."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a version of the removeElement function in Go for the vector package like Java has in its Vector class?\n\nQuestion:\nI am porting over some Java code into Google's Go language and I converting all code except I am stuck on just one part after an amazingly smooth port. My Go code looks like this and the section I am talking about is commented out:\nfunc main() {\n    var puzzleHistory * vector.Vector;\n    puzzleHistory = vector.New(0);\n    var puzzle PegPuzzle;\n    puzzle.InitPegPuzzle(3,2);\n    puzzleHistory.Push(puzzle);\n\n    var copyPuzzle PegPuzzle;\n    var currentPuzzle PegPuzzle;\n\n    currentPuzzle = puzzleHistory.At(0).(PegPuzzle);\n    isDone := false;\n    for !isDone {\n        currentPuzzle = puzzleHistory.At(0).(PegPuzzle);\n        currentPuzzle.findAllValidMoves();\n\n        for i := 0; i < currentPuzzle.validMoves.Len(); i++ {\n            copyPuzzle.NewPegPuzzle(currentPuzzle.holes, currentPuzzle.movesAlreadyDone);\n            copyPuzzle.doMove(currentPuzzle.validMoves.At(i).(Move));\n            // There is no function in Go's Vector that will remove an element like Java's Vector\n            //puzzleHistory.removeElement(currentPuzzle);\n            copyPuzzle.findAllValidMoves();\n            if copyPuzzle.validMoves.Len() != 0 {\n                puzzleHistory.Push(copyPuzzle);\n            }\n            if copyPuzzle.isSolutionPuzzle() {\n                fmt.Printf(\"Puzzle Solved\");\n                copyPuzzle.show();\n                isDone = true;\n            }\n        }\n    }\n}\n\nIf there is no version available, which I believe there isn't ... does anyone know how I would go about implementing such a thing on my own?", "output": "How about Vector.Delete( i ) ?"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to mimic Go interface in C/C++?\n\nQuestion:\nIn Go, if the type has all the methods that the interface defined then it can be assigned to that interface variable without explicitly inheriting from it.\nIs it possible to mimic this feature in C/C++?", "output": "Yes. You can use a pure abstract class, and use a template class to wrap types \"implementing\" the abstract class so that they extend the abstract class. Here's a barebones example:\n#include <iostream>\n\n// Interface type used in function signatures.\nclass Iface {\npublic:\n        virtual int method() const = 0;\n};\n\n// Template wrapper for types implementing Iface\ntemplate <typename T>\nclass IfaceT: public Iface {\npublic:\n        explicit IfaceT(T const t):_t(t) {}\n        virtual int method() const { return _t.method(); }\n\nprivate:\n        T const _t;\n};\n\n// Type implementing Iface\nclass Impl {\npublic:\n        Impl(int x): _x(x) {}\n        int method() const { return _x; }\n\nprivate:\n        int _x;\n};\n\n\n// Method accepting Iface parameter\nvoid printIface(Iface const &i) {\n        std::cout << i.method() << std::endl;\n}\n\nint main() {\n        printIface(IfaceT<Impl>(5));\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Application auto build versioning\n\nQuestion:\nIs it possible to increment a minor version number automatically each time a Go app is compiled?\nI would like to set a version number inside my program, with an autoincrementing section:\n$ myapp -version\nMyApp version 0.5.132\n\nBeing 0.5 the version number I set, and 132 a value that increments automatically each time the binary is compiled.\nIs this possible in Go?", "output": "The Go linker (go tool link) has an option to set the value of an uninitialised string variable:\n\n-X importpath.name=value\n  Set the value of the string variable in importpath named name to\n\n\nvalue.\n        Note that before Go 1.5 this option took two separate arguments.\n        Now it takes one argument split on the first = sign.\nAs part of your build process, you could set a version string variable using this. You can pass this through the go tool using -ldflags. For example, given the following source file:\npackage main\n\nimport \"fmt\"\n\nvar xyz string\n\nfunc main() {\n    fmt.Println(xyz)\n}\n\nThen:\n$ go run -ldflags \"-X main.xyz=abc\" main.go\nabc\n\nIn order to set main.minversion to the build date and time when building:\ngo build -ldflags \"-X main.minversion=`date -u +.%Y%m%d.%H%M%S`\" service.go\n\nIf you compile without initializing main.minversion in this way, it will contain the empty string."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using a setter for a struct type does not work as anticipated\n\nQuestion:\nUsing a setter function for a struct, but not working as anticipated:\npackage main\n\nimport \"fmt\"\n\ntype T struct { Val string }\n\n// this setter seems not to work\nfunc (t T) SetVal( s string ) {\n        t.Val = s\n}\n\n// this setter, using ptr to T, seems to work ok\nfunc (t *T) SetVal2( s string ) {\n        (*t).Val = s\n}\n\nfunc main() {\n        v := T{\"abc\"}\n        fmt.Println( v )        // prints {abc}\n        v.SetVal(\"pdq\")\n        fmt.Println( v )        // prints {abc}, was expecting {pdq}!\n        v.SetVal2(\"xyz\")\n        fmt.Println( v )        // prints {xyz}!\n}\n\nI am missing some fundamental understanding - why doesn't SetVal work?\nthe behavior is similar to setting values in reflect which only works if provided a pointer to the object as versus the object itself", "output": "Here is the fundamental understanding you are missing: when a struct is passed in to a function as a pointer, the function can modify the original struct because it has a pointer to it.  However, when a struct is passed in to a function via its value, then a NEW copy of the struct is actually created just for that function call, and any modifications to this new copy of the struct will not affect the original struct.\nYou can prove that this is the way it works by printing out the actual addresses of the structs in question:\npackage main\n\nimport \"fmt\"\n\ntype T struct { Val string }\n\nfunc (t T) SetVal( s string ) {\n        fmt.Printf(\"Address of copy is %p\\n\", &t);\n}\n\nfunc (t *T) SetVal2( s string ) {\n        fmt.Printf(\"Pointer argument is %p\\n\", t);\n}\n\nfunc main() {\n        v := T{\"abc\"}\n        fmt.Printf(\"Address of v is %p\\n\", &v);\n        v.SetVal(\"pdq\")\n        v.SetVal2(\"xyz\")\n}\n\nThe code above results in this output when I run it in the Go playground:\nAddress of v is 0xf840001290\nAddress of copy is 0xf8400013e0\nPointer argument is 0xf840001290\n\nNotice how the first and third pointer printed out are equal, which means they are the same struct.  But the second pointer is different because it is a copy.\nThis seems to be exactly the same way that C structs / function parameters work, by the way."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to get access to the Internet from a Go program running on Android?\n\nQuestion:\nMy program can't access to internet when put in android terminal, but in linux works fine.\n(wget (busybox) works fine with internet in android terminal)\npackage main\n\nimport (\n    \"io\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc Url(url string)(string, io.ReadCloser, http.Header, error){\n    var c = http.Client{}\n    inf, err := c.Get(url)\n    if err == nil {\n        data,_ := ioutil.ReadAll(inf.Body)\n        return string(data), inf.Body, inf.Header, err\n    }\n    return \"\", nil, nil, err\n}\n\nfunc main() {\n    print(\"test internet... \")\n    c,_,_,err := Url(\"http://ifconfig.me/ip\")\n    if err == nil {\n        println(\"\\n ip:\", c)\n    }else{\n        println(\"error\")\n    }\n}\n\ncompiling with:\ngo build main.go    # linux\nCGO_ENABLED=0 GOOS=linux GOARCH=arm go build $(bin).go    # android", "output": "Android does not have full support for Go yet. If at some point in the future they add a Go sdk this will be easier. But for right now unless you feel like modifying Go's source yourself or writing your own set of libraries to handle Androids different environment this is going to be difficult to impossible."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google App Engine Go-Python/Java hybrid application\n\nQuestion:\nCan one write a hybrid Go-Python/Java application and run it on Google App Engine as one application, or do they need to be split into two apps and communicate with each other through HTTP calls? Is there any tutorial or example on something like this being done?", "output": "You can deploy several \"versions\" of the same application at once. Each version will be accessible using a fully qualified URL, and they can all be in different languages."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Starting a process on Windows from Go\n\nQuestion:\nIs it possible to start a windows process from Google Go? I´m looking for a Go package that contains something similar to C# System.Process type, or some alternative method of achieving the same result.", "output": "Go has also a Process type. You can use the StartProcess function of the os package to create a new one. Alternatively, you can also use the Cmd struct of the os/exec package which is a bit easier to use."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Ensure a type implements an interface at compile time in Go\n\nQuestion:\nHow can I ensure that a type implements an interface at compile time? The typical way to do this is by failure to assign to support interfaces from that type, however I have several types that are only converted dynamically. At runtime this generates very gruff error messages, without the better diagnostics given for compile time errors. It's also very inconvenient to find at run time that types I expected to support interfaces, do in fact not.", "output": "Assuming the question is about Go, e.g.\nvar _ foo.RequiredInterface = myType{} // or &myType{} or [&]myType if scalar\n\nas a TLD will check that for you at compile time."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to write node.js addons in go?\n\nQuestion:\nI guess it's all about whether libuv and the other c/cpp glue can be somehow imitated from within a go executable. Is it possible? If yes, could you provide some guidance on where to start?\nThanks!", "output": "At the moment it is not possible (read very complicated) to build shared objects with Go, as to dynamically link them into a system. It's for this same reason that Go can only interface with other web servers through CGI or Fast-CGI.\nSo my answer would be not directly. maybe you could achieve something through IPC and a small C-\"proxy\" that's linked into node."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Cocoa bindings for the Go language\n\nQuestion:\nIs it possible to write macOS/Cocoa applications in Google Go?\nIs there a Go-Obj-C bridge? (it seems to me that Obj-C dynamism would be a great fit for Golang's interfaces)\nCan I at least link the two together and make them talk to each other via plain-old C functions?", "output": "You can have a look at my blog post as an example. I'm afraid I didn't keep working on it, but here's the source code that can help you setting up a bare Cocoa/ObjC/Go project.\nYou're gonna be able to do something like this, as mentioned in the README.\npackage main\n\nimport (\n  \"github.com/alediaferia/gogoa\"\n)\n\nfunc main() {\n    app := gogoa.SharedApplication()\n    window := gogoa.NewWindow(0, 0, 200, 200)\n    window.SetTitle(\"Gogoga!\")\n    window.MakeKeyAndOrderFront()\n\n    app.Run()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Signal Processing in Go\n\nQuestion:\nI have come up with an idea for an audio project and it looks like Go is a useful language for implementing it. However, it requires the ability to apply filters to incoming audio, and Go doesn't appear to have any sort of audio processing package. I can use cgo to call C code, but every signal processing library I find uses C++ classes which cgo cannot handle. It looks like libsox may work. Are there any others?\nWhat libsox can provide and what I need is to take an incoming audio stream and divide it into frequency bands. If I can do this while only reading the file once, then bonus! I am not sure if libsox can do this.", "output": "If you want to use a C++ library you could try SWIG, but you'll have to get it out of Subversion. The next release (2.0.1) will be the first released version to support Go. In my experience the Go support is still a little rough, but then again the library I tried to wrap is a monster.\nAlternatively, you could still create your own bindings through cgo using the same method SWIG does, but it will be painful and tedious. The basic idea is that you first create a C wrapper, then let cgo create a Go wrapper around your C wrapper.\nI don't know anything about signal processing or libsox, though. Sorry."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Shared library in Go?\n\nQuestion:\nIs it possible to create a Shared Library (.so) using Go?\nUPDATED: created an \"issue\" for it.", "output": "This is possible now using -linkshared flag\nWhat you need to do is to first run this command:\ngo install -buildmode=shared -linkshared  std\n\n(Above code makes all common packages shareable!)\nthen \ngo install  -buildmode=shared -linkshared userownpackage\n\nfinally when compiling your code you need to run:\ngo build -linkshared yourprogram\n\nWhat the above those is now it rather than statically linking everything only dynamically links them and you will end up with much smaller compiled files. Just to give you an idea my \"hello.go\" file with static linking is 2.3MB while the same code using dynamic linking is just 12KB!"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to modify printer.Fprint in old version to can run on latest version of Go\n\nQuestion:\nstr := new(bytes.Buffer) //old code\nprinter.Fprint(str, c)   //old code \nstr := new(token.FileSet) //new code\nprinter.Fprint(os.Stdout, str, c) //new code    \n\nsource += \"\\t\" + str.String() + \";\\n\"   \n\nIn this code i try to change str's value from new(bytes.Buffer) to new(token.FileSet) because Fprint's argument requier; \nfunc Fprint(output io.Writer, fset *token.FileSet, node interface{}) os.Error //latest ver.\nnow, i'm stucking in error str.String() because str don't have method String().\nI cann't update my code for run in latest version of Go because a changed of printer.Fprint()\nHow to volve this?", "output": "Here's a sample program.\npackage main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"go/parser\"\n    \"go/printer\"\n    \"go/token\"\n)\n\nfunc main() {\n    const src = `package main\n    func main() {}\n    `\n\n    fset := token.NewFileSet()\n    ast, err := parser.ParseFile(fset, \"\", src, parser.ParseComments)\n    if err != nil {\n        panic(err)\n    }\n\n    var buf bytes.Buffer\n    printer.Fprint(&buf, fset, ast)\n\n    fmt.Print(buf.String())\n}\n\nOutput:\npackage main\n\nfunc main() {}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Converting int and long into string in Go\n\nQuestion:\nI have concurrent routine like this,\nRoutine 1()\n{\nfor 30 times\nSend string\n}\n\nRoutine 2 (out <-chan string)\n{\nfor\ncase str := <- out:\n        fmt.Println(str)\n}\n\nNow, I want to send from routine 1 string like, string + int + string + system time in nanosecond. Can anybody help me how can I achieve this.", "output": "Sorry, I asked it too early. It is possible like this:\nout <- string + strconv.Itoa(int) + string + strconv.Itoa64(time.Nanoseconds())\n\nThanks.\n\nUpdate (Go1): strconv.Itoa64 has been replaced by strconv.FormatInt."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to remove the last character of a string in Golang?\n\nQuestion:\nI want to remove the very last character of a string, but before I do so I want to check if the last character is a \"+\". How can this be done?", "output": "Here are several ways to remove trailing plus sign(s).\npackage main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc TrimSuffix(s, suffix string) string {\n    if strings.HasSuffix(s, suffix) {\n        s = s[:len(s)-len(suffix)]\n    }\n    return s\n}\n\nfunc main() {\n    s := \"a string ++\"\n    fmt.Println(\"s: \", s)\n\n    // Trim one trailing '+'.\n    s1 := s\n    if last := len(s1) - 1; last >= 0 && s1[last] == '+' {\n        s1 = s1[:last]\n    }\n    fmt.Println(\"s1:\", s1)\n\n    // Trim all trailing '+'.\n    s2 := s\n    s2 = strings.TrimRight(s2, \"+\")\n    fmt.Println(\"s2:\", s2)\n\n    // Trim suffix \"+\".\n    s3 := s\n    s3 = TrimSuffix(s3, \"+\")\n    fmt.Println(\"s3:\", s3)\n}\n\nOutput:\ns:  a string ++\ns1: a string +\ns2: a string \ns3: a string +"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Convert a bigint to a string in Go\n\nQuestion:\nHow do one convert a big int to a string (or integer) in Golang?\nbigint := big.NewInt(123) //This is what I have\nbigstr = \"123\" //This is what I want", "output": "Just use the String method : http://golang.org/pkg/math/big/#Int.String\nbigint := big.NewInt(123)\nbigstr := bigint.String()"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Create an enum from a group of related constants in Go\n\nQuestion:\nWhat is preferred (or right) way to group large number of related constants in the Go language? For example C# and C++ both have enum for this.", "output": "const?\nconst (\n    pi = 3.14\n    foo = 42\n    bar = \"hello\"\n)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to get from cgo to exe\n\nQuestion:\nFrom a basic test program. . .\npackage main\n\n/*\n#include <stdio.h>\nstatic void test() {\n        printf(\"hello world\");\n}\n*/\nimport \"C\"\n\nfunc main() {\n        C.test();\n}\n\nI do \"cgo hello_cgo.go\" and get:\n_cgo_.o\n_cgo_defun.c\n_cgo_gotypes.go \nhello_cgo.cgo1.go \nhello_cgo.cgo2.c\n\nHow do I go about compiling from here to an exe?", "output": "Try using the go makefiles. Create a makefile like\n# Makefile\nCGOFILES=test.go\nTARG=test\n\ninclude $(GOROOT)/src/Make.$(GOARCH)\ninclude $(GOROOT)/src/Make.pkg\n\nRunning make will then produce the file _obj/test.a, which you'll have to link with 6l or similar."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: When should `new` be used in Go?\n\nQuestion:\nIt seems pointless to be used in primitive language constructs, as you can't specify any sort of values\nfunc main() {\n    y := new([]float)\n    fmt.Printf(\"Len = %d\", len(*y) ) // => Len = 0\n}\n\nFor stucts it makes a bit more sense, but what's the difference between saying y := new(my_stuct) and the seemingly more concise y := &my_struct? \nAnd since anything you create is based on those primitives, they will be initialized to the said zero values. So what's the point? When would you ever want to use new()?\nSorry for the very-beginner question, but the documentation isn't always that clear.", "output": "You can't use new for slices and maps, as in your code example, but instead you must use the make command: make([]float, 100)\nBoth new(MyStruct) and &MyStruct{} do to the same thing, because Go will allocate values on the heap if you get their address with &. Sometimes the code just expresses it intent better in one style or the other.\nGo does not have built-in support for constructors, so usually you would wrap the call to new into a function, for example NewMyStruct() which does all the necessary initialization. It also makes it possible to initialize private fields or hide the struct behind an interface, to prevent users of the object from directly messing with its internals. Also evolving the structure of the struct is easier that way, when you don't need to change all of its users when adding/removing/renaming/reordering fields."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: math.Mod in Go returns integer part instead of floating-point remainder\n\nQuestion:\nGolang's math.Mod(10, 4) returns 2 -- ie. the integer part of division result 2.5 -- but shouldn't it be \"the floating point remainder\", that is, 0.5?", "output": "The result is correct. math.Mod returns the remainder, which really is 2 in this case. It's equivalent to the % operator, but for floating point numbers."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: gccgo linking Error in Ubuntu 9.10 karmic?\n\nQuestion:\nI am trying to compile go file using gccgo , i installed on my ubuntu 9.10 machine . when i compiled\n $gccgo -c hello.go\n\nhello.o file is generated , while trying to link and to form an executable \n$gccgo -o hello hello.o\ni get the following error \n /usr/local/lib/gcc/i686-pc-linux-gnu/4.5.0/../../../libgo.so: undefined reference to `__sync_fetch_and_add_4'\n/usr/local/lib/gcc/i686-pc-linux-gnu/4.5.0/../../../libgo.so: undefined reference to `__sync_bool_compare_and_swap_4'\ncollect2: ld returned 1 exit status\n\nAm i missing something ? , i have also set my LD_LIBRARY_PATH   in my environment . Thanks", "output": "Maybe try following the advice in  this post  and pass -march=i486 to the compiler? (or -march=i686)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: convert string to fixed size byte array in Go\n\nQuestion:\nIs there convenient way for initial a byte array?\npackage main\nimport \"fmt\"\ntype T1 struct {\n  f1 [5]byte  // I use fixed size here for file format or network packet format.\n  f2 int32\n}\nfunc main() {\n  t := T1{\"abcde\", 3}\n  // t:= T1{[5]byte{'a','b','c','d','e'}, 3} // work, but ugly\n  fmt.Println(t)\n}\n\nprog.go:8: cannot use \"abcde\" (type string) as type [5]uint8 in field value\nif I change the line to t := T1{[5]byte(\"abcde\"), 3}\nprog.go:8: cannot convert \"abcde\" (type string) to type [5]uint8", "output": "You could copy the string into a slice of the byte array:\npackage main\nimport \"fmt\"\ntype T1 struct {\n  f1 [5]byte\n  f2 int\n}\nfunc main() {\n  t := T1{f2: 3}\n  copy(t.f1[:], \"abcde\")\n  fmt.Println(t)\n}\n\nEdit: using named form of T1 literal, by jimt's suggestion."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go equivalent of a void pointer in C\n\nQuestion:\nI've been playing around with Go a little bit making some data structure libraries and I have one big problem. I want the data structure to be able to contain any type, but I don't see any way to do this in Go because you can't declare void pointers and they don't have a class like NSObject that everything inherits from. How would I achieve this same functionality in Go?", "output": "According to the Go Programming Language Specification:\n\nA type implements any interface comprising any subset of its methods and may therefore implement several distinct interfaces. For instance, all types implement the empty interface: interface{}\n\nIf you search within that document for interface{}, you'll see quite a few examples of how you can use it to do what you want."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there any way to get around including an unreachable return statement in go?\n\nQuestion:\nI have the following function:\nfunc fitrange(a, x, b int) int {\n    if a > b {\n        a, b = b, a\n    }\n    switch true {\n    case x < a:\n        return a\n    case x > b:\n        return b\n    default:\n        return x\n    }\n}\n\nThe go compiler complains that the \"function ends without a return statement\" even though every possible path through the switch statement returns a value. Is there any way to get around this other than adding a dummy return statement at the end of the function?", "output": "Instead of adding a return at the end, you can also pacify the compiler by adding a panic.  It's not a bad idea because if your code contains a bug and that \"unreachable\" line is ever reached, your program will halt promptly rather than plow ahead with a potentially wrong answer."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go - What is the equivalent of Python's \"pass\"?\n\nQuestion:\nI have a default cause in a select statement that I want to do nothing, just continue, but leaving the line blank stops anything in the statement from happening\n        select {\n        case quit_status := <-quit:\n            if quit_status == true {\n                fmt.Printf(\"********************* GOROUTINE [%d] Received QUIT MSG\\n\", id)\n                return\n            }\n        default:\n            fmt.Printf(\"GOROUTINE [%d] step: %d, NO QUIT MSG\\n\", id, i)\n        }", "output": "The default case in a select statement is intended to provide non-blocking I/O for channel reads and writes. The code in the default case is executed whenever none of the channels in any of the cases are ready to be read/written to.\nSo in your case, the default block is executed if the quit channel has nothing to say.\nYou can simply remove the default case and it will block on the quit_status := <-quit case until a value is available in quit.. which is probably what you are after in this instance.\nIf you want to immediately continue executing code after the select statement, you should run this select statement in a separate goroutine:\ngo func() {\n    select {\n    case quit_status := <-quit:\n        ...\n\n    }\n}()\n\n// Execution continues here immediately."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Installing packages in a local directory\n\nQuestion:\nWhat is the best practice to install packages (those with go get...) in a local directory?\nExample: I'd like to try out the Revel web framework, but I don't want to clutter my go installation at /usr/local/go.\nNormally I'd say sudo go get github.com/robfig/revel as written on the home page, but that would install it beneath /usr/local/go/src/pkg/....\nIs there an easy way to say (for example) go get --local ... and have the package in the current (sub) directory?", "output": "You can export the env variable GOPATH. For me it is ~/local/lib/go. This folder has the subfolders bin, pkg and src, so it's just like /usr/local/go. The go-tool will then automatically download , build and install packages into this directory."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Atomic Compare And Swap with struct in Go\n\nQuestion:\nI am trying to create a non-blocking queue package for concurrent application using the algorithm by Maged M. Michael and Michael L. Scott as described here.\nThis requires the use of atomic CompareAndSwap which is offered by the \"sync/atomic\" package.\nI am however not sure what the Go-equivalent to the following pseudocode would be:\nE9:   if CAS(&tail.ptr->next, next, <node, next.count+1>)\n\nwhere tail and next is of type:\ntype pointer_t struct {\n    ptr   *node_t\n    count uint\n}\n\nand node is of type:\ntype node_t struct {\n    value interface{}\n    next  pointer_t\n}\n\nIf I understood it correctly, it seems that I need to do a CAS with a struct (both a pointer and a uint). Is this even possible with the atomic-package?\nThanks for help!", "output": "If I understood it correctly, it seems that I need to do a CAS with a struct (both a > pointer and a uint). Is this even possible with the atomic-package?\n\nNo, that is not possible. Most architectures only support atomic operations on a single word. A lot of academic papers however use more powerful CAS statements (e.g. compare and swap double) that are not available today. Luckily there are a few tricks that are commonly used in such situations:\n\nYou could for example steal a couple of bits from the pointer (especially on 64bit systems) and use them, to encode your counter. Then you could simply use Go's CompareAndSwapPointer, but you need to mask the relevant bits of the pointer before you try to dereference it.\nThe other possibility is to work with pointers to your (immutable!) pointer_t struct. Whenever you want to modify an element from your pointer_t struct, you would have to create a copy, modify the copy and atomically replace the pointer to your struct. This idiom is called COW (copy on write) and works with arbitrary large structures. If you want to use this technique, you would have to change the next attribute to next  *pointer_t.\n\nI have recently written a lock-free list in Go for educational reasons. You can find the (imho well documented) source here: https://github.com/tux21b/goco/blob/master/list.go\nThis rather short example uses atomic.CompareAndSwapPointer excessively and also introduces an atomic type for marked pointers (the MarkAndRef struct). This type is very similar to your pointer_t struct (except that it stores a bool+pointer instead of an int+pointer). It's used to ensure that a node has not been marked as deleted while you are trying to insert an element directly afterwards. Feel free to use this source as starting point for your own projects."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: A prototyping language with the ability to be fast\n\nQuestion:\nas an engineering student with a strong mathemathical background, i dealing some problems like this at university:\n\n(numerical) Simulations\nAI Problems\nRobotics\nControl Systems\nand some more\n\nas you can see some are just numerical ones, others have to process some kinds of symbols.\ncurrently i'm working with java, but i'm not very pleased with it (can't say exactly why, probably a personal taste) and now i'm searching for a programming language, in which i can easily prototype new algorithms, like for example in python, and don't care about low level stuff, but has the ability to speed things up if neccessary, e.g. with concurrent/parallel programming, etc. (writing it in python and rewrite it in C/C++ isn't really a option i prefer...)\nto sum it up:\n\neasy to prototype, but\nthe ability to speed algorithms up\nsyntax without boilerplate stuff like in java\nsyntax which is easy to read (i know this could be achived with the most, but some language encourage you more...)\n\ni've looked around at sites, like http://rosettacode.org/ and picked 2 or 3 favorites: Go, Lisp (and maybe Haskell) but other recommandations are welcome", "output": "Common Lisp using SBCL is pretty fast if you take the time to make it fast.\nWhy does this fit what you want?\n\nsymbolic computations\ngood number handling\ncompiles to native on demand by default."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why can't I use the blank identifier in the following Go code?\n\nQuestion:\nfor _, arg := range flag.Args() {\n    go func() {\n        path.Walk(arg, dupes, walkerrs)\n        walkend <- true\n    }()\n}\nfor _ := range flag.Args() {\n    if !<-walkend {\n        os.Exit(1)\n    }\n}\n\nThe second use of _ gives this error: no new variables on left side of :=. What have I done wrong?", "output": "Use this line:\nfor _ = range flag.Args() {\nThe error should disappear if you omit initialization for the blank identifier."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Map with concurrent access\n\nQuestion:\nWhen you use a map in a program with concurrent access, is there any need to use a mutex in functions to read values?", "output": "Multiple readers, no writers is okay:\nhttps://groups.google.com/d/msg/golang-nuts/HpLWnGTp-n8/hyUYmnWJqiQJ\nOne writer, no readers is okay.  (Maps wouldn't be much good otherwise.)\nOtherwise, if there is at least one writer and at least one more either writer or reader, then all readers and writers must use synchronization to access the map.  A mutex works fine for this."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Learn Go Or Improve My Python/Ruby Knowledge\n\nQuestion:\nI was reading about Go, and I can see that it's very good and can be a language used by many developers in some months, but I want to decide a simple thing: Learn Go or improve my Python or Ruby knowledge?\nYears developing with Python: 1\nYears developing with Ruby: 0.3", "output": "If you're just looking to have fun and expand your horizons, then I'd learn Go, since you already know some Python.\nIf you're looking to improve as a developer, I'd personally recommend working on an actual project (using Python, as it's the language you have the most experience with):\n\nThis will take your (Python and general) programming skills to a whole new level\nIf you choose an interesting project, for example a semi-popular open source project, you'll even have some concrete result to show for your extra work. This will help your resume, help you meet other people interested in programming, etc.\n\nI personally believe that spending the time you would have spent learning a new language by coding actual things you can use, is usually a net win (unless of course, like I said, you're just doing it for some fun recreation or relaxation)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Mapping an array to a file via Mmap in Go\n\nQuestion:\nI'm trying to map an array to a file via Mmap, the array could be any type, like float64. In C, I find this one. After  reading some texts, I wrote this sample. I don't know if it is correct, and it is not writing the values to the file. If I increase the size of array a lot, e.g from 1000 to 10000, it crashes. If someone know how to do that in the correctly way, please, tell me.\nThanks!", "output": "For example, revising your sample program,\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    const n = 1e3\n    t := int(unsafe.Sizeof(0)) * n\n\n    map_file, err := os.Create(\"/tmp/test.dat\")\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    _, err = map_file.Seek(int64(t-1), 0)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    _, err = map_file.Write([]byte(\" \"))\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    mmap, err := syscall.Mmap(int(map_file.Fd()), 0, int(t), syscall.PROT_READ|syscall.PROT_WRITE, syscall.MAP_SHARED)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    map_array := (*[n]int)(unsafe.Pointer(&mmap[0]))\n\n    for i := 0; i < n; i++ {\n        map_array[i] = i * i\n    }\n\n    fmt.Println(*map_array)\n\n    err = syscall.Munmap(mmap)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    err = map_file.Close()\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to check if a map contains a key in Go?\n\nQuestion:\nI know I can iterate over a map m with\nfor k, v := range m { ... }\n\nand look for a key, but is there a more efficient way of testing for a key's existence in a map?", "output": "One line answer:\nif val, ok := dict[\"foo\"]; ok {\n    //do something here\n}\n\nExplanation:\nif statements in Go can include both a condition and an initialization statement. The example above uses both:\n\ninitializes two variables - val will receive either the value of \"foo\" from the map or a \"zero value\" (in this case the empty string) and ok will receive a bool that will be set to true if \"foo\" was actually present in the map\nevaluates ok, which will be true if \"foo\" was in the map\n\nIf \"foo\" is indeed present in the map, the body of the if statement will be executed and val will be local to that scope."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I use a (generic) vector in go?\n\nQuestion:\nI am using a Vector type to store arrays of bytes (variable sizes)\nstore := vector.New(200);\n...\nrbuf := make([]byte, size);\n...\nstore.Push(rbuf);\n\nThat all works well, but when I try to retrieve the values, the compiler tells me I need to use type assertions.  So I add those in, and try\nfor i := 0; i < store.Len(); i++ {\n   el := store.At(i).([]byte); \n...\n\nBut when I run this it bails out with:\ninterface is nil, not []uint8\nthrow: interface conversion\n\nAny idea how I can 'cast'/convert from the empty Element interface that Vector uses to store its data to the actual []byte array that I then want to use subsequently?\n\nUpdate (Go1): The vector package has been removed on 2011-10-18.", "output": "This works fine for me. Have you initialised the first 200 elements of your vector? If you didn't they will probably be nil, which would be the source of your error.\npackage main\n\nimport vector \"container/vector\"\nimport \"fmt\"\n\nfunc main() {\n     vec := vector.New(0);\n     buf := make([]byte,10);\n     vec.Push(buf);\n\n     for i := 0; i < vec.Len(); i++ {\n     el := vec.At(i).([]byte);\n     fmt.Print(el,\"\\n\");\n     }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: os.Error - string value (Golang)\n\nQuestion:\nHow do I get the string value of os.Error? ie. assign to a variable.", "output": "For example,\npackage main\n\nimport (\n    \"errors\"\n    \"fmt\"\n)\n\nfunc main() {\n    err := errors.New(\"an error message\")\n    s := err.Error()\n    fmt.Printf(\"type: %T; value: %q\\n\", s, s)\n}\n\nOutput:\ntype: string; value: \"an error message\""}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go: unexpected EOF while reading from a socket\n\nQuestion:\nI have the following simple golang program to download Google's privacy policy. Unfortunately it always crashes with the error unexpected EOF after reading 6861 bytes, even though the document is much longer. Why?\npackage main\n\nimport \"net\"\nimport \"fmt\"\nimport \"io\"\nimport \"os\"\n\nfunc die(msg string, s os.Error) {\n    fmt.Printf(\"%s crashed: %v\\n\", msg, s)\n    os.Exit(1)\n}\n\nfunc main() {\n    fd, err := net.Dial(\"tcp\", \"google.com:80\")\n    if err != nil { die(\"dial\", err) }\n\n    req := []byte(\"GET /intl/en/privacy/ HTTP/1.0\\r\\nHost: www.google.com\\r\\n\\r\\n\")\n    _, err = fd.Write(req)\n    if err != nil { die(\"dial write\", err) }\n\n    buf := make([]byte, 1024)\n    nr := 1\n\n    for nr > 0 {\n        nr, err = io.ReadFull(fd, buf)\n        if err != nil { die(\"dial read\", err) }\n        fmt.Printf(\"read %d\\n\", nr)\n    }\n}\n\noutputs:\nread 1024\nread 1024\nread 1024\nread 1024\nread 1024\nread 1024\ndial read crashed: unexpected EOF", "output": "Function io.ReadFull(fd, buf) should be used only when you know that fd can feed at least len(buf) bytes.\nInstead, try the following:\nvar buf bytes.Buffer\n\nnr, err := io.Copy(&buf, fd)\nif err != nil {\n    die(\"dial read\", err)\n}\n\nIf copying to a file, use an os.File instead of bytes.Buffer."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is a variadic function an appropriate solution for optional argument?\n\nQuestion:\nIf I have a function where the last argument is optional, is it an appropriate practice to use ... to allow the argument to be optional, or is it considered bad form?\nExample:\nfunc Foo(s ...string) {\n    switch len(s) {\n        case 0:\n            fmt.Println(\"You didn't pass an argument\")\n        case 1:\n            fallthrough\n        default:\n            fmt.Printf(\"You passed %s\\n\", s[0])\n    }\n}\n\nFoo(\"bar\")        // \"You passed bar\"\nFoo()             // \"You didn't pass an argument\"\nFoo(\"bar\", \"baz\") // \"You passed bar\"\n\nIn this example, I don't care if too many arguments were passed, but I could handle that in the default: case when needed.", "output": "I would not recommend this. There are different problems with (ab)using variadic parameters for passing optional arguments. Most important of them is probably that the form of the last arg ...T) allows for only one type. For more than one optional parameter with more than one type one can use ...interface{} but that incurs unnecessary run time (un)boxing costs and lacks any (usefull) compile time type checking.\nAnother possible argument against is that I don't think you'll find an example/precedent for this anywhere in the standard library, which is considered an informal Go coding style guide by some."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google's 'go' and scope/functions\n\nQuestion:\nIn one of the example servers given at golang.org:  \npackage main\n\nimport (\n    \"flag\"\n    \"http\"\n    \"io\"\n    \"log\"\n    \"template\"\n)\n\nvar addr = flag.String(\"addr\", \":1718\", \"http service address\") // Q=17, R=18\nvar fmap = template.FormatterMap{\n    \"html\": template.HTMLFormatter,\n    \"url+html\": UrlHtmlFormatter,\n}\nvar templ = template.MustParse(templateStr, fmap)\n\nfunc main() {\n    flag.Parse()\n    http.Handle(\"/\", http.HandlerFunc(QR))\n    err := http.ListenAndServe(*addr, nil)\n    if err != nil {\n        log.Exit(\"ListenAndServe:\", err)\n    }\n}\n\nfunc QR(c *http.Conn, req *http.Request) {\n    templ.Execute(req.FormValue(\"s\"), c)\n}\n\nfunc UrlHtmlFormatter(w io.Writer, v interface{}, fmt string) {\n    template.HTMLEscape(w, []byte(http.URLEscape(v.(string))))\n}\n\n\nconst templateStr = `\n<html>\n<head>\n<title>QR Link Generator</title>\n</head>\n<body>\n{.section @}\n<img src=\"http://chart.apis.google.com/chart?chs=300x300&cht=qr&choe=UTF- 8&chl={@|url+html}\"\n/>\n<br>\n{@|html}\n<br>\n<br>\n{.end}\n<form action=\"/\" name=f method=\"GET\"><input maxLength=1024 size=70\nname=s value=\"\" title=\"Text to QR Encode\"><input type=submit\nvalue=\"Show QR\" name=qr>\n</form>\n</body>\n</html>\n`  \n\nWhy is template.HTMLEscape(w, []byte(http.URLEscape(v.(string)))) contained within UrlHtmlFormatter? Why can't it be directly linked to \"url+html\"?  \nAlso, how could I change func QR to accept parameter values? What I'd like for it to do is accept a command-line flag in place of req *http.Request ... Thanks in advance...", "output": "The signature for function template.HTMLEscape is:\nfunc(w io.Writer, s []byte)\n\nThe type declaration for template.FormatterMap is:\ntype FormatterMap map[string]func(io.Writer, interface{}, string)\n\nTherefore, the signature for a FormatterMap map element value function is:\nfunc(io.Writer, interface{}, string)\n\nThe UrlHtmlFormatter function is a wrapper to give the HTMLEscape function the FormatterMap map element value function signature.\nfunc UrlHtmlFormatter(w io.Writer, v interface{}, fmt string) {\n    template.HTMLEscape(w, []byte(http.URLEscape(v.(string))))\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Are my Go tools built for the wrong architecture?\n\nQuestion:\nI'm a big fan of Go language, and now I am trying to explore other architectures than x86/amd64. I build Go for ARM, and it seems to have good support for that target. All libraries build successfully, and tests fail (because it's trying to run ARM test binaries on my amd64 system).\nAfter all, I have 5g/5l in my $GOBIN folder and they produce valid and working ARM binaries.\nBut what's happening to other Go tools:\n5a:        ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped\n5c:        ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped\n5g:        ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped\n5l:        ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped\n6cov:      ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped\n6nm:       ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped\n6prof:     ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped\ncgo:       ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\nebnflint:  ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\ngodefs:    ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped\ngodoc:     ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\ngofix:     ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\ngofmt:     ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\ngoinstall: ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\ngomake:    POSIX shell script, ASCII text executable\ngopack:    ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.9, not stripped\ngopprof:   a perl script, ASCII text executable\ngotest:    ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\ngotry:     a bash script, ASCII text executable\ngotype:    ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\ngovet:     ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\ngoyacc:    ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\nhgpatch:   ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\n\nSee? cgo is an ARM binary, gofix and gofmt are ARM binaries as well. I thought it's expected that if I provide $GOHOSTOS/$GOHOSTARCH variables I will cross-compile my apps? How to get cgo work for ARM target?", "output": "The Go linux/arm port is incomplete. For example, the cgo runtime for linux/arm is unimplemented. See $GOROOT/src/pkg/runtime/cgo/gcc_arm.S and $GOROOT/src/pkg/runtime/cgo/gcc_linux_arm.c.\n\n[cgo on arm.] It is not planned for Go 1."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Application development in Go\n\nQuestion:\nI'm writing a web application in Go. So far I've written all base libraries I'm going to need for now and that worked out just perfect. The package structure is really handy in that aspect.\nNow I'm at the point where I need to start writing the application itself, the business logic.  I'm a little lost of how or where this code should go.\nI've watched and read pretty much every application development tutorial/walkthrough on the official documentation page and they always write the entire domain logic in the main package/namespace.\nIs this the way to Go (sorry, had to) or was it just for the sake of simplicity?\nPutting the business layer into packages feels uncomfortably wrong in my opinion.", "output": "No, it does not have to be all in the same package. You can easily make a new directory, put your code for that package there, and import it from your main package. It's simple as that.\nYou may want to look at go-tour as a simple web app that consists of a few small packages (pic, wc, ...). If you want to see organization of a big Go app see Camlistore. Both of these are written by Go Authors, so they can be considered nice examples.\nI just have to say that writing small, reusable, and separate packages is very common in Go, and that reduces the size of the main codebase of apps."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to use Go on PowerPC\n\nQuestion:\nIs there a way to get Google Go to generate Linux/PowerPC executables?\nUpdate: I guess this announcement helps a bit.", "output": "The Go compilers provided do not target Linux/ppc, but the GCC frontend, gccgo, may be able to."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: go programming POST FormValue can't be printed\n\nQuestion:\nBefore I being a bit of background, I am very new to go programming language. I am running go on Win 7, latest go package installer for windows. I'm not good at coding but I do like some challenge of learning a new language. I wanted to start learn Erlang but found go very interesting based on the GO I/O videos in youtube.\nI'm having problem with capturing POST form values in GO. I spend three hours yesterday to get go to print a POST form value in the browser and failed miserably. I don't know what I'm doing wrong, can anyone point me to the right direction? I can easily do this in another language like C#, PHP, VB, ASP, Rails etc. I have search the entire interweb and haven't found a working sample. Below is my sample code.\nHere is Index.html page\n{{ define \"title\" }}Homepage{{ end }}\n\n{{ define \"content\" }}\n    <h1>My Homepage</h1>\n\n    <p>Hello, and welcome to my homepage!</p>\n    <form method=\"POST\" action=\"/\">\n    <p> Enter your name : <input type=\"text\" name=\"username\"> </P>\n    <p> <button>Go</button>\n    </form>\n    <br /><br />\n\n{{ end }}\n\nHere is the base page\n<!DOCTYPE html>\n<html lang=\"en\">\n    <head>\n        <title>{{ template \"title\" . }}</title>\n    </head>\n    <body>\n        <section id=\"contents\">\n            {{ template \"content\" . }}\n        </section>\n        <footer id=\"footer\">\n            My homepage 2012 copy\n        </footer>\n    </body>\n</html>\n\nnow some go code\n    package main\n\nimport (\n    \"fmt\"\n    \"http\"\n    \"strings\"\n    \"html/template\"\n\n)\n\nvar index = template.Must(template.ParseFiles(\n  \"templates/_base.html\",\n  \"templates/index.html\",\n))\n\n\nfunc GeneralHandler(w http.ResponseWriter, r *http.Request) {\n    index.Execute(w, nil)\n     if r.Method == \"POST\" {\n        a := r.FormValue(\"username\")\n        fmt.Fprintf(w, \"hi %s!\",a); //<-- this variable does not rendered in the browser!!!\n\n    }\n}\n\nfunc helloHandler(w http.ResponseWriter, r *http.Request) {\n    remPartOfURL := r.URL.Path[len(\"/hello/\"):] \n    fmt.Fprintf(w, \"Hello %s!\", remPartOfURL)\n}\n\n\nfunc main() {\n    http.HandleFunc(\"/\", GeneralHandler)\n    http.HandleFunc(\"/hello/\", helloHandler)\n    http.ListenAndServe(\"localhost:81\", nil)\n}\n\nThanks!\nPS: Very tedious to add four space before every line of code in stackoverflow especially when you are copy pasting. Didn't find it very user friendly or is there an easier way?", "output": "Writing to the ResponseWriter (by calling Execute) before reading the value from the request is clearing it out.\nYou can see this in action if you use this request handler:\nfunc GeneralHandler(w http.ResponseWriter, r *http.Request) {\n   fmt.Println(r.Method)\n   fmt.Println(r.URL)\n   fmt.Println(\"before\",r.FormValue(\"username\"))\n   index.Execute(w, nil)\n   if r.Method == \"POST\" {\n     fmt.Println(\"after\",r.FormValue(\"username\"))\n   } \n }\n\nThis will print out before and after. However, in this case:\nfunc GeneralHandler(w http.ResponseWriter, r *http.Request) {\n  fmt.Println(r.Method)\n  fmt.Println(r.URL)\n  index.Execute(w, nil)\n  if r.Method == \"POST\" {\n    fmt.Println(\"after\",r.FormValue(\"username\"))\n  }\n}\n\nThe after value will be blank."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Python-style generators in Go\n\nQuestion:\nI'm currently working through the Tour of Go, and I thought that goroutines have been used similarly to Python generators, particularly with Question 66. I thought 66 looked complex, so I rewrote it to this:\npackage main\n\nimport \"fmt\"\n\nfunc fibonacci(c chan int) {\n    x, y := 1, 1\n\n    for {\n        c <- x\n        x, y = y, x + y\n    }\n}\n\nfunc main() {\n    c := make(chan int)\n    go fibonacci(c)\n\n    for i := 0; i < 10; i++ {\n        fmt.Println(<-c)\n    }\n}\n\nThis seems to work. A couple of questions:\n\nIf I turn up the buffer size on the channel to say, 10, fibonacci would fill up 10 further spots, as quickly as possible, and main would eat up the spots as quickly as it could go. Is this right? This would be more performant than a buffer size of 1 at the expense of memory, correct?\nAs the channel doesn't get closed by the fibonacci sender, what happens memory-wise when we go out of scope here? My expectation is that once c and go fibonacci is out of scope, the channel and everything on it gets garbage-collected. My gut tells me this is probably not what happens.", "output": "I like @tux21b's answer; having the channel created in the fib() function makes the calling code nice and clean.  To elaborate a bit, you only need a separate 'quit' channel if there's no way to tell the function when to stop when you call it.  If you only ever care about \"numbers up to X\", you can do this:\npackage main\n\nimport \"fmt\"\n\nfunc fib(n int) chan int {\n    c := make(chan int)\n\n    go func() {\n        x, y := 0, 1\n\n        for x < n {\n            c <- x\n            x, y = y, x+y\n        }\n\n        close(c)\n    }()\n\n    return c\n}\n\nfunc main() {\n    // Print the Fibonacci numbers less than 500\n    for i := range fib(500) {\n        fmt.Println(i)\n    }\n}\n\nIf you want the ability to do either, this is a little sloppy, but I personally like it better than testing the condition in the caller and then signalling a quit through a separate channel:\nfunc fib(wanted func (int, int) bool) chan int {\n    c := make(chan int)\n\n    go func() {\n        x, y := 0, 1\n\n        for i := 0; wanted(i, x); i++{\n            c <- x\n            x, y = y, x+y\n        }\n\n        close(c)\n    }()\n\n    return c\n}\n\nfunc main() {\n    // Print the first 10 Fibonacci numbers\n    for n := range fib(func(i, x int) bool { return i < 10 }) {\n        fmt.Println(n)\n    }\n\n    // Print the Fibonacci numbers less than 500\n    for n := range fib(func(i, x int) bool { return x < 500 }) {\n        fmt.Println(n)\n    }\n}\n\nI think it just depends on the particulars of a given situation whether you:\n\nTell the generator when to stop when you create it by\n\nPassing an explicit number of values to generate\nPassing a goal value\nPassing a function that determines whether to keep going\n\nGive the generator a 'quit' channel, test the values yourself, and tell it to quit when appropriate.\n\nTo wrap up and actually answer your questions:\n\nIncreasing the channel size would help performance due to fewer context switches. In this trivial example, neither performance nor memory consumption are going to be an issue, but in other situations, buffering the channel is often a very good idea.  The memory used by make (chan int, 100) hardly seems significant in most cases, but it could easily make a big performance difference.\nYou have an infinite loop in your fibonacci function, so the goroutine running it will run (block on c <- x, in this case) forever.  The fact that (once c goes out of scope in the caller) you won't ever again read from the channel you share with it doesn't change that.  And as @tux21b pointed out, the channel will never be garbage collected since it's still in use. This has nothing to do with closing the channel (the purpose of which is to let the receiving end of the channel know that no more values will be coming) and everything to do with not returning from your function."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: throw: all goroutines are asleep - deadlock\n\nQuestion:\nGiven the following simple Go program\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc total(ch chan int) {\n    res := 0\n    for iter := range ch {\n        res += iter\n    }\n    ch <- res\n}\n\nfunc main() {\n    ch := make(chan int)\n    go total(ch)\n    ch <- 1\n    ch <- 2\n    ch <- 3\n    fmt.Println(\"Total is \", <-ch)\n}\n\nI am wondering if someone can enlighten me as to why I get\nthrow: all goroutines are asleep - deadlock!\n\nthank you", "output": "As you never close the ch channel, the range loop will never finish.\nYou can't send back the result on the same channel. A solution is to use a different one.\nYour program could be adapted like this :\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc total(in chan int, out chan int) {\n    res := 0\n    for iter := range in {\n        res += iter\n    }\n    out <- res // sends back the result\n}\n\nfunc main() {\n    ch := make(chan int)\n    rch  := make(chan int)\n    go total(ch, rch)\n    ch <- 1\n    ch <- 2\n    ch <- 3\n    close (ch) // this will end the loop in the total function\n    result := <- rch // waits for total to give the result\n    fmt.Println(\"Total is \", result)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Unmarshal an ISO-8859-1 XML input in Go\n\nQuestion:\nWhen your XML input isn't encoded in UTF-8, the Unmarshal function of the xml package seems to require a CharsetReader.\nWhere do you find such a thing ?", "output": "Updated answer for 2015 & beyond:\nimport (\n    \"encoding/xml\"\n    \"golang.org/x/net/html/charset\"\n)\nreader := bytes.NewReader(theXml)\ndecoder := xml.NewDecoder(reader)\ndecoder.CharsetReader = charset.NewReaderLabel\nerr = decoder.Decode(&parsed)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How can I convert a ECDSA curve specification from the SEC2 form into the form needed by Go?\n\nQuestion:\nI`m trying to implement ECDSA in the curve secp256k1 in Google Go.\nSecp256k1 is defined by the SECG standard (SEC 2, part 2, Recommended Elliptic Curve Domain Parameters over p, page 15) in terms of parameters p, a, b, G compressed, G uncompressed, n and h.\nIn Go's crypto library, the curves are defined by parameters P, N, B, Gx, Gy and BitSize. How do I convert parameters given by SECG into the ones needed by Go?", "output": "In the elliptic package of Go,\n\nA Curve represents a short-form Weierstrass curve with a=-3.\n\nSo, we have curves of the form y² = x³ - 3·x + B (where both x and y take values in P). P and B thus are the parameters to identify a curve, the others are only necessary for the operations on the curve elements which will be used for cryptography.\nThe SECG standard SEC 2 defines the secp256k1 curve as y² = x³ + a·x + b with a = 0, i.e. effectively y² = x³ + b.\nThese curves are not the same, independent of which b and B are selected here.\nYour conversion is not possible with the elliptic package's Curve class, as it only supports some special class of curves (these with a = -3), while SEC 2 recommends curves from other classes (a = 0 for the ...k1 curves).\n\nOn the other hand, the curves with ...r1 in the name seem to have a = -3. And actually, secp256r1 seems to be the same curve which is available in elliptic as p256(). (I didn't prove this, but at least some the hex digits of the uncompressed form of the base point in SEC 2 are the coordinates of the base point in elliptic.)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to use Go's buffered channel as a thread-safe queue?\n\nQuestion:\nI want to find a queue structure (a data container) whose elements must be first-in-first-out. It is important for me that the structure must be thread-safe. I'm going to use this data container as something like a task or connection pool.\nI know a buffered channel is thread-safe, but I wonder if it works as FIFO, especially in a concurrent situation.\nAnd if it is possible to use buffered channel as a thread-safe  queue, do I need to worry about its efficiency?", "output": "I'm pretty sure that Channels are FIFO. They are also cheap so they would be memory efficient. Beyond that without knowing the details of how you are going to use them We can't really give much more advice."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Golang help reflection to get values\n\nQuestion:\nI'm very new in Go. I was wondering how do I get value of mappings out of this using Reflection in Go. \n\n\ntype url_mappings struct{\n    mappings map[string]string\n}\n\nfunc init() {\n    var url url_mappings\n    url.mappings = map[string]string{\n        \"url\": \"/\",\n        \"controller\": \"hello\"}\n\n\nThanks", "output": "import \"reflect\"\nv := reflect.ValueOf(url)\nf0 := v.Field(0) // Can be replaced with v.FieldByName(\"mappings\")\nmappings := f0.Interface()\n\nmappings's type is interface{}, so you can't use it as a map.\nTo have the real mappings that it's type is map[string]string, you'll need to use some type assertion:\nrealMappings := mappings.(map[string]string)\nprintln(realMappings[\"url\"])\n\n\nBecause of the repeating map[string]string, I would:\ntype mappings map[string]string\n\nAnd then you can:\ntype url_mappings struct{\n    mappings // Same as: mappings mappings\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I unregister a Handler in net/http?\n\nQuestion:\nI am writing a web server wherein I need to register handlers at runtime. E.g. \"/create\" would create a new handler for all URLs like \"/123/*\" and so on. I need a corresponding \"/destroy/123\" which would unregister the handler for \"/123/*\".\nHere's the code for handling \"/create\"\npackage main\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\ntype MyHandler struct {\n    id int\n}\nfunc (hf *MyHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintln(w, r.URL.Path)\n}\n\n// Creates MyHandler instances and registers them as handlers at runtime\ntype HandlerFactory struct {\n    handler_id int\n}\nfunc (hf *HandlerFactory) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    hf.handler_id++\n    handler := MyHandler{hf.handler_id}\n    handle := fmt.Sprintf(\"/%d/\", hf.handler_id)\n    http.Handle(handle, &handler)\n}\n\nfunc main() {\n    factory := HandlerFactory{0}\n    http.Handle(\"/create\", &factory)\n    http.ListenAndServe(\"localhost:8080\", nil)\n}\n\nI tried implementing my own multiplexer by embedding http.ServeMux but it holds its pattern-to-Handler mapping in a private variable (ServeMux.m)", "output": "What I would do is create a custom ServerMux. Copy the code from GOROOT/src/pkg/net/http/server.go. It starts on line 837 and ends at 939.\nThe custom ServerMux would need a method for deregistration. This should be easy to implement. Just grab the lock and del() the map entry. For example (all code untested):\n// TODO: check if registered and return error if not.\n// TODO: possibly remove the automatic permanent link between /dir and /dir/.\nfunc (mux *MyMux) Deregister(pattern string) error {\n    mux.mu.Lock()\n    defer mux.mu.Unlock()\n    del(mux.m, pattern)\n    return nil\n}\n\nIn order to use this new mux, you would do something like this:\nmux := newMux()\nmux.Handle(\"/create\", &factory)\n\nsrv := &http.Server {\n    Addr: localhost:8080\n    Handler: mux,\n}\nsrv.ListenAndServe()\n\nModifying mux by calling deregister() from another goroutine is completely safe and will modify the way ListenAndServe() routes messages."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to ignore errors in datastore.Query.GetAll()?\n\nQuestion:\nI just started developing a GAE app with the Go runtime, so far it's been a pleasure. However, I have encountered the following setback:\nI am taking advantage of the flexibility that the datastore provides by having several different structs with different properties being saved with the same entity name (\"Item\"). The Go language datastore reference states that \"the actual types passed do not have to match between Get and Put calls or even across different App Engine requests\", since entities are actually just a series of properties, and can therefore be stored in an appropriate container type that can support them.\nI need to query all of the entities stored under the entity name \"Item\" and encode them as JSON all at once. Using that entity property flexibility to my advantage, it is possible to store queried entities into an arbitrary datastore.PropertyList, however, the Get and GetAll functions return ErrFieldMismatch as an error when a property of the queried entities cannot be properly represented (that is to say, incompatible types, or simply a missing value). All of these structs I'm saving are user generated and most values are optional, therefore saving empty values into the datastore. There are no problems while saving these structs with empty values (datastore flexibility again), but there are when retrieving them.\nIt is also stated in the datastore Go documentation, that it is up to the caller of the Get methods to decide if the errors returned due to empty values are ignorable, recoverable, or fatal. I would like to know how to properly do this, since just ignoring the errors won't suffice, as the destination structs (datastore.PropertyList) of my queries are not filled at all when a query results in this error.\nThank you in advance, and sorry for the lengthy question.\nUpdate: Here is some code\nquery := datastore.NewQuery(\"Item\") // here I use some Filter calls, as well as a Limit call and an Order call\nitems := make([]datastore.PropertyList, 0)\n_, err := query.GetAll(context, &items) // context has been obviously defined before\nif err != nil {\n    // something to handle the error, which in my case, it's printing it and setting the server status as 500\n}\n\nUpdate 2: Here is some output\nIf I use make([]datastore.PropertyList, 0), I get this:\ndatastore: invalid entity type\n\nAnd if I use make(datastore.PropertyList, 0), I get this:\ndatastore: cannot load field \"Foo\" into a \"datastore.Property\": no such struct field\n\nAnd in both cases (the first one I assume can be discarded) in items I get this:\n[]", "output": "According to the following post the go datastore module doesn't support PropertyList yet.\nUse a pointer to a slice of datastore.Map instead."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go - Data types for validation\n\nQuestion:\nHow to create a new data type for Go which to can check/validate its schema when is created a new variable (of that type)?\nBy example, to validate if a string has 20 characters, I tried:\n// Format: 2006-01-12T06:06:06Z\nfunc date(str string) {\n  if len(str) != 20 {\n    fmt.Println(\"error\")\n  }\n}\nvar Date = date()\n\ntype Account struct {\n  domain  string\n  username string\n  created  Date\n}\n\nbut it fails because Date is not a type.", "output": "In your example, you defined Date as a variable and then tried to use it as a type.\nMy guess is that you want to do something like this.\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\ntype Date int64\n\ntype Account struct {\n    domain   string\n    username string\n    created  Date\n}\n\nfunc NewDate(date string) (Date, os.Error) {\n    // date format: 2006-01-12T06:06:06Z\n    if len(date) == 0 {\n        // default to today\n        today := time.UTC()\n        date = today.Format(time.ISO8601)\n    }\n    t, err := time.Parse(time.ISO8601, date)\n    if err != nil {\n        return 0, err\n    }\n    return Date(t.Seconds()), err\n}\n\nfunc (date Date) String() string {\n    t := time.SecondsToUTC(int64(date))\n    return t.Format(time.ISO8601)\n}\n\nfunc main() {\n    var account Account\n    date := \"2006-01-12T06:06:06Z\"\n    created, err := NewDate(date)\n    if err == nil {\n        account.created = created\n    } else {\n        fmt.Println(err.String())\n    }\n    fmt.Println(account.created)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I hold onto a factory function in Go?\n\nQuestion:\nI'm trying to hold a function that will return new instances of a type implementing a particular interface in a struct. Here's a stripped down example:\npackage main\n\ntype Adder interface {\n    Add(Adder)\n    Val() int\n}\n\ntype NewAdder func() Adder\n\ntype number int\n\ntype NewHolder struct {\n    newFunc NewAdder\n}\n\nfunc (me *number)Add(it Adder) {\n    *me += number(it.Val())\n}\n\nfunc (me *number)Val() int {\n    return int(*me)\n}\n\nfunc newAdder() *number {\n    return (*number)(new(int))\n}\n\nfunc main() {\n    var holder NewHolder\n    holder.newFunc = NewAdder(newAdder)\n}\n\nWhen I try to compile it, it says cannot convert newAdder (type func() *number) to type NewAdder. So what's the go-like way to accomplish my goal?\nHere's a Python example of what I'm trying to do, just for reference:\nclass NewStuffMaker(object):\n    def __init__(self, new):\n        self.new = new\n\ndef make_new():\n    return []\nobj = NewStuffMaker(make_new)\nnew_lst = obj.new()\n\nIdeally, I'd like to be able to hold a bunch of these functions (or structs containing the functions and some other data) in a slice. Is that an unreasonable thing to do?", "output": "package main\n\ntype Adder interface {\n    Add(Adder)\n    Val() int\n}\n\ntype FuncAdder func() Adder\n\ntype Holder struct {\n    FuncAdder\n    SomeOtherData string\n}\n\ntype number int\n\nfunc (n *number) Add(a Adder) {\n    *n += number(a.Val())\n}\n\nfunc (n *number) Val() int {\n    return int(*n)\n}\n\nfunc NumberAdder() Adder {\n    return Adder(new(number))\n}\n\nfunc main() {\n    var holders []Holder\n    var holder Holder\n    holder.FuncAdder = NumberAdder\n    holder.SomeOtherData = \"SomeOtherData\"\n    holders = append(holders, holder)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Initialize custom int type in Go\n\nQuestion:\nIn Go it is valid to create a type:\ntype Num int\n\nbut how can one then initialize that type? make(Num, 2) does not seem to work.", "output": "Initialize the type as you would initialize the underlying type. In your example, the underlying type is an int. For example,\npackage main\n\nimport (\n    \"fmt\"\n)\n\ntype Num int\n\nfunc main() {\n    var m Num = 7\n    n := Num(42)\n    fmt.Println(m, n)\n}\n\nOutput: 7 42\n\nThe built-in function make takes a type T, which must be a slice, map or channel type."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go - recursive struct with array and losing values\n\nQuestion:\nI created an Element struct that has a parent and children, created a helper func called SubElement, and a String method that iterates through all children for print:\npackage main\n\nimport \"fmt\"\n\ntype Element struct {\n  parent *Element\n  children []Element\n  tag string\n}\n\nfunc SubElement(parent *Element, tag string) Element {\n  el := Element{}\n  el.parent = parent\n  el.tag = tag\n  parent.children = append(parent.children, el)\n  return el\n}\n\nfunc (el Element) String() string {\n  s := \"<\" + el.tag + \">\"\n  for _, child := range el.children {\n    s += child.String()\n  }\n  s += \"</\" + el.tag + \">\"\n  return s\n}\n\nfunc main() {\n  root := Element{}\n  root.tag = \"root\"\n\n  a := SubElement(&root, \"a\")\n  b := SubElement(&a, \"b\")\n  SubElement(&b, \"c\")\n\n  fmt.Println(root) // prints: <root><a></a></root>\n  fmt.Println(a) // prints: <a><b></b></a>\n  // and so on\n}\n\nThe problem I'm experiencing is, only the first tier of children are available from the root node I choose to print. I'm sure it's related to the use of append on parent.children, but lack the understanding of how to resolve this correctly.\nTo work around the issue, I changed children to map[int]Element. Then in my SubElement func, I \"append\" with parent.children[len(parent.children)] = el. Then to iterate in the correct order, the String method for-loop is for i:= 0; i < len(el.children); i++, accessing el.children[i].\nStill, I'd like to know how to do this correctly with an array. Thanks", "output": "The first clue is that SubElement doesn't compile as you have it (edit: had it) there (originally.)  You could experiment with making it work, but I recommend you change the Element.children to be []*Element rather than []Element.  Here's a working example:\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    tree := &Element{tag: \"head\"}\n    t1 := SubElement(tree, \"tier-1\")\n    SubElement(t1, \"tier-2\")\n    SubElement(t1, \"tier-2\")\n    t1 = SubElement(tree, \"tier-1\")\n    SubElement(t1, \"tier-2\")\n    fmt.Println(tree)\n}\n\ntype Element struct {\n    parent   *Element\n    children []*Element\n    tag      string\n}\n\nfunc SubElement(parent *Element, tag string) *Element {\n    el := &Element{parent: parent, tag: tag}\n    parent.children = append(parent.children, el)\n    return el\n}\n\nfunc (el *Element) String() string {\n    s := \"<\" + el.tag + \">\"\n    for _, child := range el.children {\n        s += child.String()\n    }\n    s += \"</\" + el.tag + \">\"\n    return s\n}\n\nOutput:\n<head><tier-1><tier-2></tier-2><tier-2></tier-2></tier-1><tier-1><tier-2></tier-2></tier-1></head>"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Thread-safe (Goroutine-safe) cache in Go\n\nQuestion:\nQuestion 1\nI am building/searching for a RAM memory cache layer for my server. It is a simple LRU cache that needs to handle concurrent requests (both Gets an Sets).\nI have found https://github.com/pmylund/go-cache claiming to be thread safe.\nThis is true as far as getting the stored interface. But if multiple goroutines requests the same data, they are all retrieving a pointer (stored in the interface) to the same block of memory. If any goroutine changes the data, this is no longer very safe.\nAre there any cache-packages out there that tackles this problem?\n\nQuestion 1.1\nIf the answer to Question 1 is No, then what would be the suggested solution?\nI see two options:\nAlternative 1\nSolution: Storing the values in a wrapping struct with a sync.Mutex so that each goroutine needs to lock the data before reading/writing to it.\ntype cacheElement struct { value interface{}, lock sync.Mutex }\nDrawbacks: The cache becomes unaware of changes made to data or might even have dropped it out of the cache. One goroutine might also lock others.\nAlternative 2\nSolution: Make a copy of the data (assuming the data in itself doesn't contain pointers)\nDrawbacks: Memory allocation every time a cache Get is performed, more garbage collection.\n\nSorry for the multipart question. But you don't have to answer all of them. If you have a good answer to Question 1, that would be sufficient for me!", "output": "Alternative 2 sounds good to me, but please note that you do not have to copy the data for each cache.Get(). As long as your data can be considered immutable, you can access it with many multiple readers at once.\nYou only have to create a copy if you intend to modify it. This idiom is called COW (copy on write) and is quite common in concurrent software design. It's especially well suited for scenarios with a high read/write ratio (just like a cache).\nSo, whenever you want to modify a cached entry, you basically have to:\n\ncreate a copy of the old cached data, if any.\nmodify the data (after this step, the data should be considered immutable and must not be changed anymore)\nadd / replace the existing element in the cache. You could either use the go-cache library you have pointed out earlier (which is based on locks) for that, or write your own lock-free library that simply swaps the pointers to the data element atomically.\n\nAt this point any goroutine that performs a cache.Get operation will get the new data. Existing goroutines however, might still be reading the old data. So, your program might operate on many different versions of the same data at once. But don't worry, as soon as all goroutines have finished accessing the old data, the GC will collect it automatically."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go equivalent to std::set?\n\nQuestion:\nWhat would be the equivalent in Go to a std::set? Note that only uniqueness is important, I don't care about ordering.\nI've considered using dummy type, such as map[string]bool (where bool is the dummy), however often I find in Go I need to provide a type where one is not required, such as a channel used as a semaphore, and this case. Am I missing something idiomatic to Go?", "output": "Using a map with dummy values as a set is common practice in languages like Perl, which do not have sets. I think it is an acceptable way to get sets in Go, unless you want to implement it yourself or use some third-party implementation. Of course, your datatype has to be one that is allowed as the key in a map, i.e. not struct, array, or slice."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is message passing via channels in go guaranteed to be non-blocking?\n\nQuestion:\nIn order to assess whether go is a possible option for an audio/video application, I would like to know whether message passing in go satisfies any non-blocking progress guarantees (being obstruction-free, lock-free or wait-free). In particular, the following scenarios are relevant:\nSingle producer single consumer:\nTwo threads communicate using a shared channel. Thread A only does asynchronous sends, thread B only does asynchronous receives. Suppose the OS scheduler decides to interrupt thread A at the \"worst possible moment\" for an indefinite amount of time. Is thread B guaranteed to finish a receive operation in a bounded number of cpu cycles or is there a (theoretical) possibility that thread A can put the channel into a state where thread B needs to wait for the OS to resume thread A?\nMultiple producers:\nSeveral threads A1, A2, A3, ... communicate with one or more others threads using a shared channel. The threads Ai only do asynchronous sends. Suppose A2, A3, ... are suspended by the OS scheduler at the \"worst possible moment\" for an indefinite amount of time. Is thread A1 still guaranteed to finish a send operation in a bounded number of cpu cycles? Suppose further that each thread only wants to do one send. If the program is run sufficiently long (with a \"malicious\" scheduler which potentially starves some threads or interrupts and resumes threads at the \"worst possible moment\"), is at least one send guaranteed to succeed?\nI am not so much interested in typical scenarios here, but rather worst-case guarantees.\nSee Non-blocking algorithm (Wikipedia) for more details on obstruction-, lock- and wait-free algorithms.", "output": "The Go Memory Model doesn't require sends and receives to be non-blocking, and the current runtime implementation locks the channel for send and recv. This means, for instance,  that it is possible to starve a sending or receiving go-routine if the OS-scheduler interrupts another thread running another go-routine which tries to send or receive on the same channel while it has already acquired the channel's lock.\nSo the answer is unfortunately no :(\n(unless someone reimplement parts of the runtime using non-blocking algorithms)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Instance new Type (Golang)\n\nQuestion:\nCan anyone tell me how to create a new instance of Type from a string? Reflect?\nThere are examples but they are for the older (pre Go 1 versions) of the language [:(]", "output": "So, if I understand your question correctly, you are asking about how you can create an object when you just have the name of the type as string. So, for example, you might have a string \"MyStruct\" and you want to create an object of this type.\nUnfortunately, that's not easily possible because Go is a statically typed language and the linker will eliminate dead code (or inline parts of it). So, there is no guarantee, that your final executable will even contain the code of \"MyStruct\".\nYou can however, maintain a global map[string]reflect.Type manually. For example by initializing this map in the init() function of your packages which defines such discover-able types. This will also tell the compiler that you are using the types. Afterwards, you can use this map to look up the reflect.Type of the type you want to create and use reflect.New to get a pointer to a new object of that type (stored as a reflect.Value). You can extract the object into an interface with something like this:\nreflect.New(yourtype).Elem().Interface()\n\nElem() will de-reference the pointer and Interface() will return the reflected value as an interface{}. See The Laws of Reflection for further details.\nPS: There might be a better way to structure your program which doesn't even require reflection and which let the compiler catch more errors. Have you considered using a factory method for example? An other easy solution might be to maintain a map[string]func() interface{} of functions which can be invoked to create a new object with that name."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Returning the lenght of a vector idiomatically\n\nQuestion:\nI'm writing a function that returns a sequence of numbers of variable length:\nfunc fib(n int) ??? {\n    retval := ???\n    a, b := 0, 1\n    for ; n > 0; n-- {\n        ??? // append a onto retval here\n        c := a + b\n        a = b\n        b = c\n    }\n}\n\nIt can be observed that the final length of the returned sequence will be n. How and what should fib return to achieve idiomatic Go? If the length was not known in advance, how would the return value, and usage differ? How do I insert values into retval?", "output": "Here, we know how many numbers; we want n Fibonacci numbers.\npackage main\n\nimport \"fmt\"\n\nfunc fib(n int) (f []int) {\n    if n < 0 {\n        n = 0\n    }\n    f = make([]int, n)\n    a, b := 0, 1\n    for i := 0; i < len(f); i++ {\n        f[i] = a\n        a, b = b, a+b\n    }\n    return\n}\n\nfunc main() {\n    f := fib(7)\n    fmt.Println(len(f), f)\n}\n\nOutput: 7 [0 1 1 2 3 5 8]\n\nHere, we don't know how many numbers; we want all the Fibonacci numbers less than or equal to n.\npackage main\n\nimport \"fmt\"\n\nfunc fibMax(n int) (f []int) {\n    a, b := 0, 1\n    for a <= n {\n        f = append(f, a)\n        a, b = b, a+b\n    }\n    return\n}\n\nfunc main() {\n    f := fibMax(42)\n    fmt.Println(len(f), f)\n}\n\nOutput: 10 [0 1 1 2 3 5 8 13 21 34]\n\nYou could also use IntVector from the Go vector package. Note that type IntVector []int."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to install go and goisntall on ubuntu for doozer install\n\nQuestion:\nI am using ubuntu 10.04 and 12.04.\nI am tryig to install doozer and doozed and I am having a hard time dealing with go isntall.  I will need to make a chef recipe for the install.  \nThe directions for installing doozer as follows:\ngoinstall github.com/ha/doozer\n\nHow to I get goinstall?\nEDIT: Using Go 1.0.2 and go install, I get the following output:\ngithub.com/ha/doozer\n# github.com/ha/doozer\n/usr/local/go/src/pkg/github.com/ha/doozer/conn.go:184: cannot use &t.req (type *request) as type proto.Message in function argument:\n    *request does not implement proto.Message (missing ProtoMessage method)\n/usr/local/go/src/pkg/github.com/ha/doozer/conn.go:198: cannot use &r (type *response) as type proto.Message in function argument:\n    *response does not implement proto.Message (missing ProtoMessage method)\n/usr/local/go/src/pkg/github.com/ha/doozer/conn.go:294: undefined: proto.GetInt64\n/usr/local/go/src/pkg/github.com/ha/doozer/conn.go:326: undefined: proto.GetInt64\n/usr/local/go/src/pkg/github.com/ha/doozer/conn.go:412: undefined: proto.GetInt32\n/usr/local/go/src/pkg/github.com/ha/doozer/conn.go:412: undefined: proto.GetInt64\n/usr/local/go/src/pkg/github.com/ha/doozer/err.go:33: cannot call non-function proto.GetString (type struct {})\n/usr/local/go/src/pkg/github.com/ha/doozer/msg.pb.go:127: cannot use this (type *request) as type proto.Message in function argument:\n    *request does not implement proto.Message (missing ProtoMessage method)\n/usr/local/go/src/pkg/github.com/ha/doozer/msg.pb.go:142: cannot use this (type *response) as type proto.Message in function argument:\n    *response does not implement proto.Message (missing ProtoMessage method)", "output": "The doozer and doozerd packages use an old, obsolete version of Go. For the current version, Go 1, get the source code:\ngo get -v github.com/ha/doozer\n\ngo get -v github.com/ha/doozerd\n\nUpgrade the source code to Go 1 and then use go install:\ngo install -v github.com/ha/doozer\n\ngo install -v github.com/ha/doozerd\n\nAlso, pretty.go has been renamed to pretty: \nSee Command go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to include a library in the path while compiling?\n\nQuestion:\nI'm reading this post about go and  was trying to compile the source code found here\nI downloaded the source code, compiled the first file with make and I can see the object is generated:\n$pwd\n/Users/oscarryz/code/go/rsc/rosetta/graph\n\n$ls -ltR\ntotal 136\n-rw-r--r--  1 oscarryz  staff  61295 Sep 17 16:20 _go_.6\ndrwxr-xr-x  3 oscarryz  staff    102 Sep 17 16:20 _obj\n-rw-r--r--  1 oscarryz  staff    126 Sep 17 16:17 Makefile\n-rw-r--r--  1 oscarryz  staff   2791 Sep 17 16:17 graph.go\n\n./_obj:\ntotal 0\ndrwxr-xr-x  3 oscarryz  staff  102 Sep 17 16:20 rsc.googlecode.com\n\n./_obj/rsc.googlecode.com:\ntotal 0\ndrwxr-xr-x  3 oscarryz  staff  102 Sep 17 16:20 hg\n\n./_obj/rsc.googlecode.com/hg:\ntotal 0\ndrwxr-xr-x  3 oscarryz  staff  102 Sep 17 16:20 rosetta\n\n./_obj/rsc.googlecode.com/hg/rosetta:\ntotal 136\n-rw-r--r--  1 oscarryz  staff  68486 Sep 17 16:20 graph.a\n\nNo my question is, how do I refer to that compiled code from the maze directory: \n/Users/oscarryz/code/go/rsc/rosetta/maze/maze.go\n\nWhose import declarations are:\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"rand\"\n    \"time\"\n\n    \"rsc.googlecode.com/hg/rosetta/graph\"\n)\n\nAnd right now is failing to compile with the error message:\n6g  -o _go_.6 maze.go \nmaze.go:20: can't find import: rsc.googlecode.com/hg/rosetta/graph\nmake: *** [_go_.6] Error 1", "output": "Ok, I found it, wasn't that hard. \n\n6g flags: -I DIR search for packages in DIR\n\nI have to specify the -I option like this:\n6g -I ../graph/_obj/ -o _go_.6 maze.go"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go Reflection with Embedding\n\nQuestion:\nIs there a way to access the name of a \"Child\" struct from methods on the \"Parent\" struct when using anonymous method embedding.\nFor Example:\ntype Animal struct{}\n\nfunc (a Animal) SayName() string {\n    v := reflect.TypeOf(a)\n    return v.Name()\n}\n\ntype Zebra struct {\n    Animal\n}\n\nvar zebra Zebra\nzebraName := zebra.SayName() // \"Animal\" want \"Zebra\"\n\nThe SayName() method returns the type.Name() of the \"Parent\".\nI realize I could do something like this, but since this for an API and will be reused often. I would prefer to have a solution that is less repetitive.\ntype Animal struct{\n  Name string\n}\n\nfunc (a Animal) SayName() string {\n    return a.Name\n}\n\ntype Zebra struct {\n    Animal\n}\n\nzebra := &Zebra{Name:\"Zebra\"}\nzebraName := zebra.SayName() // \"Zebra\"\n\nAny ideas on how this could be accomplished? Is this possible in Go?\nThank you.", "output": "An Animal type doesn't know anything about types which may include them as members, so an Animal method can't give you this answer based on the receiver alone.  But must this information come from a Zebra method?\nfunc SayName(a interface{}) string {\n    return reflect.TypeOf(a).Name()\n}\n\nworks for any type, Zebras included."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Partly JSON unmarshal into a map in Go\n\nQuestion:\nMy websocket server will receive and unmarshal JSON data. This data will always be wrapped in an object with key/value pairs. The key-string will act as value identifier, telling the Go server what kind of value it is. By knowing what type of value, I can then proceed to JSON unmarshal the value into the correct type of struct.\nEach json-object might contain multiple key/value pairs.\nExample JSON:\n{\n    \"sendMsg\":{\"user\":\"ANisus\",\"msg\":\"Trying to send a message\"},\n    \"say\":\"Hello\"\n}\n\nIs there any easy way using the \"encoding/json\" package to do this?\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\n// the struct for the value of a \"sendMsg\"-command\ntype sendMsg struct {\n    user string\n    msg  string\n}\n// The type for the value of a \"say\"-command\ntype say string\n\nfunc main(){\n    data := []byte(`{\"sendMsg\":{\"user\":\"ANisus\",\"msg\":\"Trying to send a message\"},\"say\":\"Hello\"}`)\n\n    // This won't work because json.MapObject([]byte) doesn't exist\n    objmap, err := json.MapObject(data)\n\n    // This is what I wish the objmap to contain\n    //var objmap = map[string][]byte {\n    //  \"sendMsg\": []byte(`{\"user\":\"ANisus\",\"msg\":\"Trying to send a message\"}`),\n    //  \"say\": []byte(`\"hello\"`),\n    //}\n    fmt.Printf(\"%v\", objmap)\n}\n\nThanks for any kind of suggestion/help!", "output": "This can be accomplished by Unmarshaling into a map[string]json.RawMessage.\nvar objmap map[string]json.RawMessage\nerr := json.Unmarshal(data, &objmap)\n\nTo further parse sendMsg, you could then do something like:\nvar s sendMsg\nerr = json.Unmarshal(objmap[\"sendMsg\"], &s)\n\nFor say, you can do the same thing and unmarshal into a string:\nvar str string\nerr = json.Unmarshal(objmap[\"say\"], &str)\n\n\nEDIT: Keep in mind you will also need to export the variables in your sendMsg struct to unmarshal correctly. So your struct definition would be:\ntype sendMsg struct {\n    User string\n    Msg  string\n}\n\nExample: https://play.golang.org/p/OrIjvqIsi4-"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Convert from string to int (and throw error if unsuccessful)\n\nQuestion:\nMy apologies if this is a beginner question, but I simply can't seem to find any solution for this. I'm trying to take an argument that can be either a string or an int, depending on the context, and I need to determine which type, (then convert it to int if it is indeed that type.)\nThank you :)", "output": "http://golang.org/pkg/strconv/#Atoi\nfunc Atoi\n\nfunc Atoi(s string) (i int, err error)\nAtoi is shorthand for ParseInt(s, 10, 0).\n\nThis is an update. To clarify, since Atoi accepts string, then trying to pass an int will cause a compile time error. If you need a check during runtime, then you can do something like this.\npackage main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"errors\"\n)\n\nfunc toInt(data interface{}) (n int, err error) {\n    switch t := data.(type) {\n    case int:\n        return t, nil\n    case string:\n        return strconv.Atoi(t)\n    default:\n        return 0, errors.New(fmt.Sprintf(\"Invalid type received: %T\", t))\n    }\n\n    panic(\"unreachable!\")\n}\n\nfunc main() {\n    var (\n        n int\n        err error\n    )\n\n    n, _ = toInt(\"1\")\n    fmt.Println(n)\n\n    n, _ = toInt(2)\n    fmt.Println(n)\n\n    n, err = toInt(32.3)\n    fmt.Println(err)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can I create my own root certificate to use for an SSL connection with Go? Is this safe?\n\nQuestion:\nI'm writing a simple client and server using Go. I don't want to pay for an SSL certificate, and I've read that self-signed certificates are useless for proving identity since an attacker could just MITM and provide his own self-signed certificate.\nHowever, I've learned that I can have my client use whatever root certificates I want. Can I just create my own, have the client trust that, sign a certificate for my server, and connect securely while being protected from MITM attacks? If so, how do I create my own root certificate?", "output": "A self-signed certificate is a special case of deploying your own PKI (pushed to the extreme where you only have one certificate in that PKI).\nBoth can be used to prevent MITM attacks, provided that the client can verify the server certificate using trust anchors (certificates) it knows in advance (and has been configured with them in a trusted manner).\nYou can create your own CA and configure your client to use its root CA certificate or, if you only have a very limited set of servers, you can usually configure clients to trust a specific certificate directly (self-signed or not).\nYou may be interested in these questions for links to tools:\n\nSolutions to sign certificates\nRecommendations for a Certificate Management tool for Linux\nOpenSSL's CA.pl (useful, but may lack general management interfaces)\n\nOnce you've understood the basic principles, the technical aspects are not necessarily difficult, but part of the real difficulty is in the administration of your CA."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: goroutine channels - the value of send statement\n\nQuestion:\nWhen I tried to print out: fmt.Println(c <- x) right before the for loop in the code block below to see what \"c <- x\" would evaluate to, it got the error message:\n\n./select.go:7: send statement c <- x used as value; use select for non-blocking send\nIs \"c <- x\" evaluated to true if the sending operation was successful? And why does Go only let you use the value of the send statement (aka value of \"c <- x\") inside case statements inside a select statement?\n    func fibonacci(c, quit chan int) {\n        x, y := 1, 1\n\n        for {\n            select {\n            case c <- x:\n                x, y = y, x + y\n            case <-quit:\n                fmt.Println(\"quit\")\n                return\n            }\n        }\n    }\n\nThank you", "output": "It's true, c <- x is a statement and has no value.\nYou may be confusing select with switch.  Switch works by seeing which case expression matches or evaluates to true.  Select, on the other hand, looks for cases which are not blocking, picks one of them to allow to proceed, and then runs the statements in the case block.\nSo no, c <- x is not evaluated to true wen the sending operation is successful.  Instead, the statement of the case block, x, y = y, x + y\nis simply executed.  There is no result of a send, no true value, stored anywhere.\nYou may have read that for a receive operation, a variable assigned with a short declarion is only in the scope of the case block.  This is true (although there are no short declarations in the cases of the select statement above.)  If you had a case where you wanted a received value after the case block ends, you would use a simple assignment and not a short declaration.\nOblig: the language spec on the select statement.  It's really very readable."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to add Go support to Geany\n\nQuestion:\nI am trying to make syntax hightlighting and building options work for Geany, any advice?", "output": "Look in $GOROOT/misc and http://go-lang.cat-v.org/text-editors/ for syntax files from other editors to get an idea.\nBarring that, start with C or C++ and add/substract things like go, <-, func, etc."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I allocate memory for an array in the go programming language?\n\nQuestion:\nI want to make an array of size N in go, but I don't know what N will be at compile time, how would I allocate memory for it?\ne.g. \nfunc MakeArray(size int) {\n  return new ([size]int)\n}\n\nwhich doesn't work since size is not a constant. \nThis seems like a simple question, but I just started using go and it's not obvious to me how to do this from reading the tutorial (or searching the documentation for that matter).", "output": "The function make creates slices, maps, and channels, and it returns an initialized value of type T. The make() call allocates a new, hidden array to which the returned slice value refers.\npackage main\n\nimport \"fmt\"\n\nfunc main(){\n\n   ptr := new(int)\n   *ptr = 100\n\n   fmt.Println(\"*ptr = \", *ptr)\n\n   slice := make([]int, 10)    // slice with len(slice) == cap(slice) == 10\n\n   for i:=0; i<len(slice); i++{\n      fmt.Println(slice[i])\n   }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to do a https request with bad certificate?\n\nQuestion:\nSay I want to get https://golang.org programatically. Currently golang.org (ssl) has a bad certificate which is issued to *.appspot.com So when I run this:\npackage main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    _, err := http.Get(\"https://golang.org/\")\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nI get (as I expected)\nGet https://golang.org/: certificate is valid for *.appspot.com, *.*.appspot.com, appspot.com, not golang.org\n\nNow, I want to trust this certificate myself (imagine a self-issued certificate where I can validate fingerprint etc.): how can I make a request and validate/trust the certificate?\nI probably need to use openssl to download the certificate, load it into my file and fill tls.Config struct !?", "output": "Security note: Disabling security checks is dangerous and should be avoided\nYou can disable security checks globally for all requests of the default client:\npackage main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"crypto/tls\"\n)\n\nfunc main() {\n    http.DefaultTransport.(*http.Transport).TLSClientConfig = &tls.Config{InsecureSkipVerify: true}\n    _, err := http.Get(\"https://golang.org/\")\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n\nYou can disable security check for a client:\npackage main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"crypto/tls\"\n)\n\nfunc main() {\n    tr := &http.Transport{\n        TLSClientConfig: &tls.Config{InsecureSkipVerify: true},\n    }\n    client := &http.Client{Transport: tr}\n    _, err := client.Get(\"https://golang.org/\")\n    if err != nil {\n        fmt.Println(err)\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a way to wait after sending a signal to a process?\n\nQuestion:\nWhen a signal (like os.Interrupt) is sent to a process, does the process waits until finish the process? Or, do we have to wait some time after?", "output": "I think you are asking if sending a signal will wait till the process is finished?\nThe answer is that it depends on the platform and the type of signal you send and what the process does with the signal. Some signals such as Kill can't be caught and will cause the process to terminate. Others don't do anything unless the process handles them. Still others will do something if the process doesn't handle them but the process can handle it if it want's to do something different. Until I know more about what you are asking this is the best answer I can give."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Passing an array to an external js through go\n\nQuestion:\nI have a .txt file which contains 3d points of the form (x,y,z). \nUsing go I extract the point co-ordinates into arrays X[], Y[], Z[]. \nNow I need to pass these arrays to an external javascript (ie  a \nfunction in js). \nHow do I do this? \nIn general, how do I pass some arguments to any js function in a .html \nfile.", "output": "Assuming that the server you are running is a Go program, you should go the other way around.\nThe javascript function performs an XHR request to the server, asking for the vector data. The server then optionally reads them from the text file (or already has them in-memory) and sends the data encoded as json back to the client.\nindex.html:\nThe 'doXHR' method should do the actual get request to the server. Whatever the implementation of that is, is up to you to figure out. The jquery framework has a $.ajax() method for this very purpose.\n function getData() {\n      doXHR({\n           uri: \"/getvectors\", \n           success: function(data) {\n                // data now holds the json encoded vector list.\n                // Do whatever you want with it here. \n           }\n      });\n }\n\nOn the Go side:\n func myVectorHandler(w http.ResponseWriter, r *http.Request) {\n      var vectors struct {\n           X []float32\n           Y []float32\n           Z []float32\n      }\n\n      // Fill the X/Y/Z slices here.\n\n      // Encode it as json\n      var data []byte\n      var err os.Error\n      if data, err = json.Marshal(vectors); err != nil {\n           http.Error(w, err.String(), http.StatusInternalServerError)\n           return\n      }\n\n      // Set the correct content type and send data.\n      w.Headers().Set(\"Content-Type\", \"application/x-json\");\n      w.Write(data);\n }\n\nA much simpler solution is to store the vector data in json format in the textfile and serve it to the client as-is. That way your Go server does not have to perform the conversion at runtime."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Implement range in Go\n\nQuestion:\nI have a type List []string and I am implementing some standard functions like Insert, DeleteAt etc. I would like to implement range so I can iterate the list easily.\nI cannot seem to find the way to do that.", "output": "There is no reason to re-implement range since the range keyword will work on type List.\nvar l List\nfor i, v := range l {\n    /* whatever */\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How can I ask MongoDB to evaluate some JavaScript in order to obtain value for a field?\n\nQuestion:\nI want to let MongoDB dynamically assign a value to one of the fields of the document I'm inserting.  For example: the current time from MongoDB server just like NOW() would do in MySQL.\nI tried this:\nc := mongoSession.DB(\"myapp\").C(\"instances\")\nrand.Seed(time.Now().UnixNano())\nerr := c.Insert(\n   struct{Serial, Priority, Url, LastSeen interface{}}{ \n      Url: getInformedHost() + \":\" + getRunningPortString(), \n      Priority: rand.Int(), \n      LastSeen: mongoNow() }\n)\ncheckError(err, \"Could not register on MongoDB server.\", 3)\n\nI have this helper function: \nfunc mongoNow() bson.JavaScript {\n    return bson.JavaScript{Code: \n         \"(new Date()).ISODate('YYYY-MM-DD hh:mm:ss')\"}\n}\n\nthe LastSeen field gets stored as a script instead of evaluated:\n[_id] => MongoId Object (\n    [$id] => 502d6f984eaead30a134fa10\n)\n[priority] => 1694546828\n[url] => 127.0.0.1:8080\n[lastseen] => MongoCode Object (\n    [code] => (new Date()).ISODate('YYYY-MM-DD hh:mm:ss')\n    [scope] => Array (\n    )\n)\n\nHow can I get some javascript evaluated instead of inserted?", "output": "See the following URL on the MongoDB documentation:\nhttp://www.mongodb.org/display/DOCS/Server-side+Code+Execution#Server-sideCodeExecution-Storingfunctionsserverside\n\nThere is a special system collection called system.js that can store JavaScript functions to be reused.\n\nNote though, that the support and performance of server-sided code (equivalent to stored procedures) is still a little poor (details in link).\nEdit: \nTo call a stored procedure from Go using the mgo driver use the mgo.Database type's Run() method (direct link) and issue an eval command with the Javascript code to be executed server-side as argument. Something like:\ndb.Run(bson.M{\"eval\": \"myStoredFunction();\"})\n\ncode untested\nIt is not possible to have code evaluated in a MongoDB insert statement."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What do the operators '<<' and '>>' do?\n\nQuestion:\nI was following 'A tour of GO` on http://tour.golang.org.\nThe table 15 has some code that I cannot understand. It defines two constants with the following syntax:\nconst (\n    Big = 1<<100\n    Small = Big>>99\n)\n\nAnd it's not clear at all to me what it means. I tried to modify the code and run it with different values, to record the change, but I was not able to understand what is going on there.\nThen, it uses that operator again on table 24. It defines a variable with the following syntax:\nMaxInt uint64 = 1<<64 - 1\nAnd when it prints the variable, it prints:\nuint64(18446744073709551615)\nWhere uint64 is the type. But I can't understand where 18446744073709551615 comes from.", "output": "They are Go's bitwise shift operators.\nHere's a good explanation of how they work for C (they work in the same way in several languages).\nBasically 1<<64 - 1 corresponds to 2^64 -1, = 18446744073709551615.\nThink of it this way. In decimal if you start from 001 (which is 10^0) and then shift the 1 to the left, you end up with 010, which is 10^1. If you shift it again you end with 100, which is 10^2. So shifting to the left is equivalent to multiplying by 10 as many times as the times you shift.\nIn binary it's the same thing, but in base 2, so 1<<64 means multiplying by 2 64 times (i.e. 2 ^ 64)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reading a file line by line in Go\n\nQuestion:\nI'm unable to find file.ReadLine function in Go.\nHow does one read a file line by line?", "output": "NOTE: The accepted answer was correct in early versions of Go.  See the highest voted answer contains the more recent idiomatic way to achieve this.\nThere is function ReadLine in package bufio.\nPlease note that if the line does not fit into the read buffer, the function will return an incomplete line. If you want to always read a whole line in your program by a single call to a function, you will need to encapsulate the ReadLine function into your own function which calls ReadLine in a for-loop.\nbufio.ReadString('\\n') isn't fully equivalent to ReadLine because ReadString is unable to handle the case when the last line of a file does not end with the newline character."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does Go have the standard functional primitives?\n\nQuestion:\nDoes the standard library (or a popular agreed-upon library) let me map, filter, fold etc. over slices/maps?", "output": "No. Go's type system doesn't cater for the usual form of these primitives because it lacks generics.\nSee also this thread on golang-nuts."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Issue with runtime.LockOSThread() and runtime.UnlockOSThread\n\nQuestion:\nI have a code like,\nRoutine 1 {\nruntime.LockOSThread()\nprint something\nsend int to routine 2\nruntime.UnlockOSThread\n\n}\n\nRoutine 2 {\nruntime.LockOSThread()\nprint something\nsend int to routine 1\nruntime.UnlockOSThread\n\n}\n\n\nmain {\ngo Routine1\ngo Routine2\n}\n\nI use run time lock-unlock because, I don't want that printing of\nRoutine 1 will mix with Routine 2. However, after execution of above\ncode, it outputs same as without lock-unlock (means printing outputs\nmixed). Can anybody help me why this thing happening and how to force\nthis for happening.\nNB: I give an example of print something, however there are lots of\nprinting and sending events.", "output": "If you want to serialize \"print something\", e.g. each \"print something\" should perform atomically, then just serialize it.\nYou can surround \"print something\" by a mutex. That'll work unless the code deadlock because of that - and surely it easily can in a non trivial program.\nThe easy way in Go to serialize something is to do it with a channel. Collect in a (go)routine everything which should be printed together. When collection of the print unit is done, send it through a channel to some printing \"agent\" as a \"print job\" unit. That agent will simply receive its \"tasks\" and atomically print each one. One gets that atomicity for free and as an important bonus the code can not deadlock easily no more in the simple case, where there are only non interdependent \"print unit\" generating goroutines.\nI mean something like:\nfunc printer(tasks chan string) {\n        for s := range tasks {\n                fmt.Printf(s)\n        }\n}\n\nfunc someAgentX(tasks chan string) {\n        var printUnit string\n        //...\n        tasks <- printUnit\n        //...\n}\n\nfunc main() {\n        //...\n        tasks := make(chan string, size)\n        go printer(tasks)\n        go someAgent1(tasks)\n        //...\n        go someAgentN(tasks)\n        //...\n        <- allDone\n        close(tasks)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Handling panic and deferred func\n\nQuestion:\nFirst of all I love GO :D I have some questions about panic/recover. Panic can be recovered only in deferred funcs? Is deferred func called when deadlock happens? I have tested it and no... Can you please explain why not?", "output": "Panic can be recovered only in deferred funcs?\n\nYes, only in deferred funcs.\n\nIs deferred func called when deadlock happens? I have tested it and no... Can you please explain why not?\n\nIt is an implementation choice made by the authors of the Go run-time. The assumption is that recovering from a deadlock is practically impossible."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: \"cannot reserve arena virtual address space\" while compiling Golang on OpenBSD\n\nQuestion:\nI'm getting the error \"cannot reserve arena virtual address space\" while compiling golang on OpenBSD with command \"ksh all.bash\" (also tried make.bash but didn't work). This is the output:\n$ ksh all.bash\n# Building C bootstrap tool.\ncmd/dist\n\n# Building compilers and Go bootstrap tool for host, openbsd/386.\nlib9\nlibbio\n... (truncated)\npkg/go/doc\npkg/go/build\ncmd/go\nthrow: runtime: cannot reserve arena virtual address space\n\nI tried following the directions on http://code.google.com/p/go-wiki/wiki/OpenBSD, but it is also possible I didn't do it correctly. Any tips would be greatly appreciated.", "output": "Seems like rather than screwing with the \"staff\" group, changing the defaults for the \"default\" section solved the issue.\ndefault:\\\n    :path=/usr/bin /bin /usr/sbin /sbin /usr/X11R6/bin /usr/local/bin /usr/local/sbin:\\\n    :umask=022:\\\n    :datasize-max=infinity:\\\n    :datasize-cur=infinity:\\\n    :maxproc-max=256:\\\n    :maxproc-cur=128:\\\n    :openfiles-cur=128:\\\n    :stacksize-cur=4M:\\\n    :localcipher=blowfish,6:\\\n    :ypcipher=old:\\\n    :tc=auth-defaults:\\\n    :tc=auth-ftp-defaults:"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Parenthesis around type names\n\nQuestion:\nI like having a little visual separation of the type names from the variables in Go.\nI've been playing with the following:\nvar target (int64) = 600851475143\nvar largest (int64) = 0\nvar i (int64)\n\nSo far it compiles correctly and I don't see any difference in the result of my program run.\nIs this dangerous? Is there any semantic difference between the above and the below? \nvar target int64 = 600851475143\nvar largest int64 = 0\nvar i int64\n\nThanks", "output": "There is no semantic difference but you may find yourself fighting against go fmt so I'm thinking it's not worth it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to pass value from MySQL to go template\n\nQuestion:\nThis struct to pass value to template\ntype Entry struct {\n    Name, Mes string\n}\n\nThis function to handle with HandleFunc(\"/\", mysqlWithTempl)\nfunc mysqlWithTempl(w http.ResponseWriter, r *http.Request) {\n\n    // Open database\n    con, err := sql.Open(\"mymysql\", dbName+\"/\"+dbUserName+\"/\"+dbPassword)\n    if err != nil {\n        panic(err)\n    }\n\n    // Close database \n    defer con.Close()\n\n    //query\n    rows, err := con.Query(\"select name, message from entry\")\n\n    tRes := Entry{}\n\n    //fetch result\n    for rows.Next() {\n        var name, message string\n        rows.Scan(&name, &message)\n        tRes.Name = name\n        tRes.Mes = message\n    }\n    index.Execute(w, tRes)\n}\n\nand this template \n<!DOCTYPE html>\n<html>\n    <head>\n        <title> Test </title>\n    </head>\n    <body>\n        <section id=\"contents\">\n        <p> {{.Mes}} {{.Name}} </p>\n       </section>\n    </body>\n</html>\n\nmy ask how can fetch more value from mysql and pass it to template\nWhen try \n for rows.Next() {\n            var name, message string\n            rows.Scan(&name, &message)\n            tRes.Name = name\n            tRes.Mes = message\nindex.Execute(w, tRes)\n        }\n\nall result fetched but every thing repeated", "output": "I think you might be asking how to show multiple results?\nIf so then you want to accumulate all your rows into a slice like so:\nresults := []Entry\nfor rows.Next() {\n    var name, message string\n    rows.Scan(&name, &message)\n    tRes.Name = name\n    tRes.Mes = message\n    results = append(results, tRes)\n}\nindex.Execute(w, results)\n\nThen your template will change to look like this:\n<!DOCTYPE html>\n<html>\n    <head>\n        <title> Test </title>\n    </head>\n    <body>\n        <section id=\"contents\">\n        {{range .}}\n        <p> {{.Mes}} {{.Name}} </p>\n        {{end}}\n       </section>\n    </body>\n</html>\n\nI believe this will cause one <p> {{.Mess}} {{.Name}} </p> to be run per row that your mysql query returns.\nI haven't actually tested this code though so it might have errors."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Convert a float64 to an int in Go\n\nQuestion:\nHow does one convert a float64 to an int in Go? I know the strconv package can be used to convert anything to or from a string, but not between data types where one isn't a string. I know I can use fmt.Sprintf to convert anything to a string, and then strconv it to the data type I need, but this extra conversion seems a bit clumsy - is there a better way to do this?", "output": "package main\nimport \"fmt\"\nfunc main() {\n  var x float64 = 5.7\n  var y int = int(x)\n  fmt.Println(y)  // outputs \"5\"\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to enable go.vim by default (automatically)?\n\nQuestion:\nThe instructions on the Vim site says to just put the file in the /syntax folder. This works all right and well. But, for me to use the syntax I must set the following\n:set syntax=go\n\nEvery single time. So, I know I am doing something wrong. I just don't know what.\nHere are some things from looking around,\nMy HTML5 syntax set is from Rodrigo's HTML5 omnicomplete function and syntax vimball file. Though this uses some installation script to get it going.\nAs far as I can tell this would be my first manual adding of syntax file.\nAlso, my VIMRUNTIME is not set, well because there is no syntax.vim file, so from reading the documentation I see it checks for files via synload.vim\nI even read the \"Making Your Own Syntax Files\" section, which says that same as above with the syntax=go option. Am I supposed to be detecting the .go filetype as described in new filetype section?\nHow can I enable syntax highlighting for GO by default?\nThis is for Mac Snow Leopard.\nI don't think it is this complicated but I decided to leave all the different documentation I skimmed. GO and Vim say to just add the file. But it is definitely not detecting it automatically", "output": "If you are using filetype detection in your ~/.vimrc file with the following line:\nfiletype plugin indent on\n\nthen you can place the file in the following folder:\n~/.vim/after/ftplugin/go.vim\n\nor for windows\n~/vimfiles/...\n\nFor the filetype detection to work, would would want the autocmd in a file in the ftdetect folder:\n~/.vim/ftdetect/go.vim\n\nand the contents would be:\nautocmd BufNewFile,BufReadPost *.go set filetype=go"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go language how detect file changing?\n\nQuestion:\nI need to know how to detect when a file changes using Go. I know that Unix provides a function named fcntl() which notifies when a specific file is changed but I have not found this one in Go.\nPlease help me.", "output": "There is currently an experimental package here. It should be merged into core as os/fsnotify in go1.3"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: how to modify GOPATH in powershell\n\nQuestion:\nI am trying to add my project directory to GOPATH, in linux I can do  \nexport GOPATH=$HOME/mygo   in ~/.bashrc\nwhat is the equivalence in powershell", "output": "This should follow the way you set any Environment variable with Powershell (as described in this article):\nIf you want it permanent (ie will apply for any future shell):\n[Environment]::SetEnvironmentVariable(\"GOPATH\", \"C:\\Your\\Path\", \"User\")\n\n\nOne thing to watch out for: when we used SetEnvironmentVariable to create a new user- or machine-level environment variable that variable didn’t always show up when we ran this command in Windows PowerShell:\n\nGet-ChildItem Env:\n\n\nOr at least it didn’t show up until we restarted PowerShell. (Or started up a new instance of PowerShell.)\n  However, we could retrieve the value of the new variable at any time by using this command:\n\n[Environment]::GetEnvironmentVariable(\"GOPATH\",\"User\")\n\n\nIf you want it for just the current shell, as mentioned in cmotley's answer and detailed in the same article:\n$env:GOPATH = \"C:\\Your\\Path\"\n\nAs Jaykul comments, setting that line in your %UserProfile%\\My Documents\\WindowsPowerShell\\profile.ps1 is the equivalent of an export in ~\\.bashrc:\nSee \"Windows PowerShell Profiles\".\n(There are actually 4 profiles, the one profile mentioned applies only to the current user, but affects all shells)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go undefined imported function\n\nQuestion:\nI have a problem using a function when there should not be any problem.\nIn Go, a Function that starts with a capital letter has a visibility outside the package.\n\nnode.go\npackage grid  \n\ntype Node struct {  \n    id uint  \n    name string  \n    pos_i uint  \n    pos_j uint  \n    node_type string  \n}\n\ngrid.go\npackage grid\n\n/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    the Grid Structure\n____________________________________________________________________________\n*/\ntype Grid struct {\n    // The numbers of divisions in the Grid\n    number_lines uint\n    number_columns uint \n\n    // The Sizes of the Grid\n    width uint\n    height uint\n\n    // An Array of the Nodes\n    nodes []Node\n}\n\n/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    Initialize the Grid\n____________________________________________________________________________\n*/\nfunc InitGrid() *Grid {\n    g := new(Grid)\n\n    g.number_lines = 4\n    g.number_columns = 4\n\n    g.width = 400\n    g.height = 400\n\n    return g\n}\n\nmain.go\npackage main\n\nimport (\n    \"fmt\"\n    \"grid\"\n)\n\n/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    Entry Point of the Application\n____________________________________________________________________________\n*/\nfunc main() {\n    grid_ := grid.InitGrid()\n    fmt.Println(grid_)    \n}\n\n\nsrc/grid/Makefile\ninclude $(GOROOT)/src/Make.inc\n\nTARG=grid\n\nGOFILES=\\\n    node.go\\\n    grid.go\\\n\ninclude $(GOROOT)/src/Make.pkg\n\nsrc/main/Makefile\ninclude $(GOROOT)/src/Make.inc\n\nTARG=main\n\nGOFILES=\\\n    main.go\\\n\ninclude $(GOROOT)/src/Make.cmd\n\n\nWhen I compile the grid package, everything goes well, but when I try to compile le main package, it gives me that error message:\nmanbear@manbearpig:~/Bureau/go_code/main$ gomake  \n6g  -o _go_.6 main.go  \nmain.go:15: undefined: grid.InitGrid  \nmake: *** [_go_.6] Erreur 1  \n\nI don't understand why it gives me that error, I've passed some time reading the Go documentation, but I don't find the reason why it doesn't work.\nThank you for your help.", "output": "You compiled and installed the grid package with just the node.go source file. Compile and install the grid package with the node.go and grid.go source files. For example,\ninclude $(GOROOT)/src/Make.inc\n\nTARG=grid\nGOFILES=\\\n    grid.go\\\n    node.go\\\n\ninclude $(GOROOT)/src/Make.pkg"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google Go Lang Assignment Order\n\nQuestion:\nLet's look at the following Go code:\npackage main\n\nimport \"fmt\"\n\ntype Vertex struct {\n    Lat, Long float64\n}\n\nvar m map[string]Vertex\n\nfunc main() {\n    m = make(map[string]Vertex)\n    m[\"Bell Labs\"] = Vertex{\n        40.68433, 74.39967,\n    }\n    m[\"test\"] = Vertex{\n        12.0, 100,\n    }\n    fmt.Println(m[\"Bell Labs\"])\n    fmt.Println(m)\n}\n\nIt outputs this:  \n{40.68433 74.39967}\n\nmap[Bell Labs:{40.68433 74.39967} test:{12 100}]\n\nHowever, if I Change one minor part of the test vertex declaration, by moving the right \"}\" 4 spaces, like so:\nm[\"test\"] = Vertex{\n    12.0, 100,\n}\n\n.. then the output changes to this:\n{40.68433 74.39967}\n\nmap[test:{12 100} Bell Labs:{40.68433 74.39967}]\n\nWhy the heck does that little modification affect the order of my map?", "output": "Map \"order\" depends on the hash function used. The hash function is randomized to prevent denial of service attacks that use hash collisions. See the issue tracker for details:\nhttp://code.google.com/p/go/issues/detail?id=2630\nMap order is not guaranteed according to the specification. Although not done in current go implementations, a future implementation could do some compacting during GC or other operation that changes the order of a map without the map being modified by your code. It is unwise to assume a property not defined in the specification.\n\nA map is an unordered group of elements of one type, called the element type, indexed by a set of unique keys of another type, called the key type."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to store the address pointed to by a pointer?\n\nQuestion:\nI am trying to create a map of addresses of objects that I create with the time at which it is allocated. The key is the address returned by the call to new(). How do I get the address returned by new()?\ntype T struct{a, b int }\n\nfunc main(){\n\n        var t int64 = time.Nanoseconds()\n        memmap := make(map[uint8]int64)\n        fmt.Printf(\"%d\\n\", t)\n        var ptr *T = new(T)\n        ptr.a = 1\n        ptr.b = 2\n        fmt.Printf(\"%d %d %p %T\\n\", ptr.a, ptr.b, ptr, ptr)\n        //memmap[ptr] = t //gives error\n        //var temp uint8 = ptr//gives error\n}\n\nPlease tell me what should be the type of the key field in the map so that I can store the address returned by new()? I plan to use new() with different types, get the allocated address and map it with the creation time.", "output": "You can use the type Pointer from the unsafe package, but that is, the package name implies it, unsafe. The address itself is a opaque thing and there's only little use in actually using a address value alone for a map, better use a tuple of type and address. That's what unsafe.Reflect does provide you. The package reflect offers you the function UnsafeAddr and a lot more.\nI suggest you read the package documentation for reflect and unsafe packages."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go urlfetch.Transport.RoundTrip, can call in GET, but not POST?\n\nQuestion:\nI'm having a problem getting any response from urlfetch.Transport.RoundTrip in GAE Go. When I browse a page that makes the call in a browser, the call is executed as intended. When the same function is called from a POST request made by poclbm Bitcoin miner, I can't get a response.\nThe call is made by this package I made at line 77.\nIs it possible, that in Google App Engine one can request data from other web pages under a HTTP GET, but not POST, or is there something else that can be causing this problem?", "output": "You can do POST request from App Engine using http.Client.Post, just make sure you create  the http client with urlfetch.Client function."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Typed constant declaration list\n\nQuestion:\nI wish to create an \"enum-like\" list of constants with the following properties:\n\nThe values of each identifier are sequential, with a few gaps. (I believe iota and the blank identifier help in this regard).\nThe identifiers are private to the module.\nThe constants can only be compared with other constants of the same type.\n\nThe enumeration is based on the enum fuse_opcode from FUSE. Here's some code for what I'm trying to accomplish (and also very wrong):\nconst Opcode (\n    _ = iota // skip 0\n    lookupOp\n    forgetOp\n    getattrOp\n    setattrOp\n    readlinkOp\n    symlinkOp // 6\n    _ // skip 7\n    mknodOp // 8\n    // et cetera ad nauseam\n)", "output": "Here's the Go code for the FUSE opcodes. It was created from enum fuse_opcode. Typically you would write a script to do that; I used a text editor. Since the constant values match the C enum values, explicit values are used.\npackage fuse\n\ntype opCode int32\n\nconst (\n    opLookup      = 1\n    opForget      = 2\n    opGetattr     = 3\n    opSetattr     = 4\n    opReadlink    = 5\n    opSymlink     = 6\n    opMknod       = 8\n    opMkdir       = 9\n    opUnlink      = 10\n    opRmdir       = 11\n    opRename      = 12\n    opLink        = 13\n    opOpen        = 14\n    opRead        = 15\n    opWrite       = 16\n    opStatfs      = 17\n    opRelease     = 18\n    opFsync       = 20\n    opSetxattr    = 21\n    opGetxattr    = 22\n    opListxattr   = 23\n    opRemovexattr = 24\n    opFlush       = 25\n    opInit        = 26\n    opOpendir     = 27\n    opReaddir     = 28\n    opReleasedir  = 29\n    opFsyncdir    = 30\n    opGetlk       = 31\n    opSetlk       = 32\n    opSetlkw      = 33\n    opAccess      = 34\n    opCreate      = 35\n    opInterrupt   = 36\n    opBmap        = 37\n    opDestroy     = 38\n    opIoctl       = 39\n    opPoll        = 40\n    opNotifyReply = 41\n)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What should be the values of GOPATH and GOROOT?\n\nQuestion:\nI'm trying to install doozer like this:\n$ goinstall github.com/ha/doozer\n\nI get these errors. \n\ngoinstall: os: go/build: package could not be found locally\ngoinstall: fmt: go/build: package could not be found locally\ngoinstall: io: go/build: package could not be found locally\ngoinstall: reflect: go/build: package could not be found locally\ngoinstall: math: go/build: package could not be found locally\ngoinstall: rand: go/build: package could not be found locally\ngoinstall: url: go/build: package could not be found locally\ngoinstall: net: go/build: package could not be found locally\ngoinstall: sync: go/build: package could not be found locally\ngoinstall: runtime: go/build: package could not be found locally\ngoinstall: strings: go/build: package could not be found locally\ngoinstall: sort: go/build: package could not be found locally\ngoinstall: strconv: go/build: package could not be found locally\ngoinstall: bytes: go/build: package could not be found locally\ngoinstall: log: go/build: package could not be found locally\ngoinstall: encoding/binary: go/build: package could not be found locally", "output": "GOPATH is discussed in the cmd/go documentation: \n\nThe GOPATH environment variable lists places to look for Go code. On\n  Unix, the value is a colon-separated string. On Windows, the value is\n  a semicolon-separated string. On Plan 9, the value is a list.\nGOPATH must be set to get, build and install packages outside the\n  standard Go tree.\n\nGOROOT is discussed in the installation instructions:\n\nThe Go binary distributions assume they will be installed in\n  /usr/local/go (or c:\\Go under Windows), but it is possible to install\n  the Go tools to a different location. In this case you must set the\n  GOROOT environment variable to point to the directory in which it was\n  installed.\nFor example, if you installed Go to your home directory you should add\n  the following commands to $HOME/.profile:\nexport GOROOT=$HOME/go\nexport PATH=$PATH:$GOROOT/bin\n\nNote: GOROOT must be set only when installing to a custom location.\n\n(updated version of Chris Bunch's answer.)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang: run default application for a pdf file on windows\n\nQuestion:\nI'd like to open a PDF file in the filesystem from go with the default application. How can I do that? From the command line I just write the filename of the pdf file and the application opens (with the requested file). When I try to use exec.Command() I get an error (not surprisingly) exec: \"foo.pdf\": executable file not found in %PATH%.\npackage main\n\nimport (\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"foo.pdf\")\n    err := cmd.Start()\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = cmd.Wait()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n}", "output": "You must launch cmd /C start foo.pdf. This will let the start command find the correct executable for you.\ncmd := exec.Command(\"cmd\", \"/C start path_to_foo.pdf\")"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: JSON and dealing with unexported fields\n\nQuestion:\nIs there a technical reason why unexported fields are not included by encoding/json? If not and it is an arbitrary decision could there be an additional back door option (say '+') to include even though unexported?\nRequiring client code to export to get this functionality feels unfortunate, especially if lower case is providing encapsulation or the decision to marshal structures comes much later than design of them.\nHow are people dealing with this? Just export everything?\nAlso, doesn't exporting field names make it difficult to follow suggested idioms. I think if a struct X has field Y, you can not have an accessor method Y(). If you want to provide interface access to Y you have to come up with a new name for the getter and no matter what you'll get something un-idiomatic according to http://golang.org/doc/effective_go.html#Getters", "output": "There is a technical reason. The json library does not have the power to view fields using reflect unless they are exported. A package can only view the unexported fields of types within its own package\nIn order to deal with your problem, what you can do is make an unexported type with exported fields. Json will unmarshal into an unexported type if passed to it without a problem but it would not show up in the API docs. You can then make an exported type that embeds the unexported type. This exported type would then need methods to implement the json.Marshaler and json.Unmarshaler interfaces.\nNote: all code is untested and may not even compile.\ntype jsonData struct {\n    Field1 string\n    Field2 string\n}\n\ntype JsonData struct {\n    jsonData\n}\n\n// Implement json.Unmarshaller\nfunc (d *JsonData) UnmarshalJSON(b []byte) error {\n    return json.Unmarshal(b, &d.jsonData)\n}\n\n// Getter\nfunc (d *JsonData) Field1() string {\n    return d.jsonData.Field1\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What are my options to deploy Go applications alongside PHP applications?\n\nQuestion:\nWhat I'm basically trying to accomplish is having my main website running a CMS written in Go. This will be located at www.example.com.\nI also have applications written in PHP located in directories, such as www.example.com/clients/\nHow can I serve example.com/clients using Apache/PHP while serving example.com using Go built-in web server?", "output": "Via mod_proxy in Apache2, you can proxy different paths into different destinations at localhost or anywhere else accessible by your server, including within your local network (if your server can access it).\nFor this you would use ProxyPass (Apache2 Docs for ProxyPass, which is very useful reading) like the example below:\n<VirtualHost *:80>\n  ServerName some.example.host.xyz\n\n  DocumentRoot /var/www/your-document-root\n\n  Alias /clients/ /var/www/clients/\n  ProxyPass /clients/ !\n  ScriptAlias /something-using-cgi/ /var/www/cgi-stuff/\n  ProxyPass /something-using-cgi/ !\n\n  ProxyPreserveHost On\n  ProxyPass / http://localhost:9876/\n  ProxyPassReverse / http://localhost:9876/\n  ProxyPass /elsewhere/ http://elsewhere.example.host.xyz:1234/\n  ProxyPassReverse /elsewhere/ http://elsewhere.example.host.xyz:1234/\n</VirtualHost>\n\nYou'll want to be sure that you set your proxy security such that external users can't use your reverse proxy as a forward proxy, too.  You can do that via ProxyRequests as described in the official Apache2 docs.  The way I did this on a server is to put this in your server-wide config (you should verify on your own that this is secure enough):\n# disables forward proxy\nProxyRequests Off"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Put the last 8 bits of a big.Int into a uint8\n\nQuestion:\nI'm trying to write a password generator. It requires that characters be in ASCII representation, but I'm trying to use crypto/rand. This provides numbers in big.Int format, though, and I need to convert the relevant lower 8 bits to a form usable in a string. I've tried converting from big.Int to uint8 with no luck so far.\nIs there a good and easy method to do this? I have seen answers involving using encoding/binary to convert from int64 to [8]uint8, but those seem needlessly complex for my purpose. Any guidance at all would be appreciated :).", "output": "If you want to get bytes out of crypto/rand, I'd skip the use of big.Int and rand.Int() entirely and use either rand.Read() or rand.Reader:\npackage main\n\nimport (\n    \"crypto/rand\"\n    \"fmt\"\n    \"io\"\n)\n\n// If you want just a byte at a time ...\n// (you could change 'byte' to int8 if you prefer)    \nfunc secureRandomByte() byte {\n    data := make([]byte, 1)\n    if _, err := rand.Read(data); err != nil {\n        // handle error\n        panic(err)\n    }\n    return data[0]\n}\n\n// If you want to read multiple bytes at a time ...\nfunc genPassword(len int) (string, error) {\n    data := make([]byte, len)\n    if _, err := io.ReadFull(rand.Reader, data); err != nil {\n        // handle error\n        return \"\", err\n    }\n    for i := range data {\n        // XXX quick munge into something printable\n        data[i] &= 0x3F\n        data[i] += 0x20\n    }\n    return string(data), nil\n}\n\nfunc main() {\n    b := secureRandomByte()\n    fmt.Printf(\"%T = %v\\n\", b, b)\n    fmt.Println(genPassword(16))\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Are GAE instances limited to 10 concurrent request?\n\nQuestion:\nI've heard from several sources that Google App Engine Instances have a hard limit of 10 concurrent request. I was wondering if someone could clarify what exactly this means. \nDoes the scheduler block any requests over the 10, or is this enforced through a limit on concurrent threads?\nSpecifically, does this limit affect Go instances the same way that it does Python and Java?\n\nEDIT: here's the feature request which will allow App Engine Instance to\n  handle more then 10 concurrent request / threads. Allow configurable limit of\n  concurrent requests per\n  instance.\n  Please star it.", "output": "This has been fixed as of Nov 18th 2013.\nThe maximum number of requests any GAE instance can process is now configured via the max_concurrent_requests setting eg:\nruntime: go\napi_version: go1\nautomatic_scaling:\n  max_concurrent_requests: 80\n\nhandlers:\n  - url: /.*\n    script: _go_app\n\nThe default is 8 and the maximum is 80.\nSee https://cloud.google.com/appengine/docs/python/config/appref#automatic_scaling for more info."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go: naming convention for slice variables/params?\n\nQuestion:\nIs the convention for naming slices in Go? Specifically, do you use plurals?\nI've noticed that Go App Engine doesn't (eg. it uses key not keys):\nfunc GetMulti(c appengine.Context, key []*Key, dst interface{}) error\n\nI haven't seen anything equivalent in the standard packages or docs I've read. Is singular or plural normal?", "output": "That should be a typo, I guess.\nNames of slices and arrays are plural. It's not hard to find some samples in the standard library: function SetCookies in CookieJar, Readdirnames, or Args variable in the variables of os package.\nBut for any variable use a name that better explains its purpose.\nA clear exception to this all-plural approach is argv which had its name for decades."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Erratic behavior in Windows?\n\nQuestion:\nUpdate:  The question title can be misleading.  This was not Go's fault at all.\n           See the first comment or the accepted answer.\n\nThis following code (well, almost the same) counts page views under Linux allright, but counts them double under Windows.\nCan someone figure out why?\npackage main\n\nimport (\n \"fmt\"\n    \"http\"\n)\n\nfunc main() {\n    println(\"Running\")\n    http.HandleFunc(\"/\", makeHomeHandler())\n http.ListenAndServe(\":8080\", nil)\n}\n\n// this version compiles and run OK under the Linux version of Golang\nfunc makeHomeHandler() func(c *http.Conn, r *http.Request) {\n    views := 1\n    return func(c *http.Conn, r *http.Request) {\n     fmt.Fprintf(c, \"Counting %s, %d so far.\", r.URL.Path[1:], views)\n        views++\n    }\n}\n\n/*\n// this version compiles and run OK under the mingw version of Golang\n// it uses a different argument type for the handler function,\n// but the counter says \"1 so far\", then \"3 so far\", \"5 so far\", and so on.\nfunc makeHomeHandler() func(c http.ResponseWriter, r *http.Request) {\n    views := 1\n    return func(c http.ResponseWriter, r *http.Request) {\n     fmt.Fprintf(c, \"Counting %s, %d so far.\", r.URL.Path[1:], views)\n        views++\n    }\n}\n*/\n\nUnder Mingw:\nhttp://localhost:8080/monkeys => Counting monkeys, 1 so far.\nhttp://localhost:8080/monkeys => Counting monkeys, 3 so far.\nhttp://localhost:8080/donkeys => Counting donkeys, 5 so far.\n\nCould this be a bug?\nFollowup:\nIn fact, if I define an additional handler for another page, like:\n   http.HandleFunc(\"/test\", testPageHandler)\n\nWich does not have a closure, nor increments anything, the counter gets incremented anyway, but only +1:\nSo, still under Mingw:\nhttp://localhost:8080/monkeys => Counting monkeys, 1 so far.\nhttp://localhost:8080/monkeys => Counting monkeys, 3 so far.\nhttp://localhost:8080/test   => Another handler function that does not increment \"views\"\nhttp://localhost:8080/donkeys => Counting donkeys, 6 so far.\n\nUnder Linux output is as spected:\nhttp://localhost:8080/monkeys => Counting monkeys, 1 so far.\nhttp://localhost:8080/monkeys => Counting monkeys, 2 so far.\nhttp://localhost:8080/test   => Another handler function that does not increment \"views\"\nhttp://localhost:8080/donkeys => Counting donkeys, 3 so far.", "output": "I suspect that the behaviour you're seeing is due to the browser requesting a favicon for your page and not due to Windows/mingw. In case you wonder, I'm using 6g ond Darwin, my Firefox 3.6 is also running on Mac OS X.\nTo underline my suspicion, try adding the following to the handler function:\nfmt.Printf(\"Counting %s, %d so far.\\n\", r.URL.Path[1:], views)\n\nThen you can see all the requests reaching your application. One request from a freshly started Firefox to the URL http://localhost:8080/chuchichaestli yields this output:\nCounting chuchichaestli, 1 so far.\nCounting favicon.ico, 2 so far.\n\nbecause Firefox also requests the favicon for your go page.\nFurthermore you're not locking/synchronising access to views even though there could be multiple concurrent requests."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Working with function types in Go\n\nQuestion:\nI wanted to create a function of a certain type. I've found one way to do it, but there must be other, cleaner and nicer ways that do not include using var. What are the alternative ways to declare the function english of type Greeting?\npackage main\n\nimport \"fmt\"\n\ntype Greeting func(name string) string\n\nfunc (g Greeting) exclamation(name string) string {\n    return g(name) + \"!\"\n}\n\nvar english = Greeting(func(name string) string {\n    return \"Hello, \" + name\n})\n\nfunc main() {\n    fmt.Println(english(\"ANisus\"))\n    fmt.Println(english.exclamation(\"ANisus\"))  \n}\n\nIn the example above, I can't exchange var english = Greeting... with english := Greeting..., nor can I remove the Greeting(func ...) and just have the func stand alone since then I won't be able to access the exclamation method.", "output": "If mentioning var is your main problem, you can drop it easily, by changing = into :=, like this:\nenglish := Greeting(func(name string) string {\n    return (\"Hello, \" + name);\n})\n\nBut you don't even have to cast your function into Greeting. The spec says this about function types:\n\nA function type denotes the set of all functions with the same parameter and result types.\n\nAnd this about type identity:\n\nTwo function types are identical if they have the same number of parameters and result values, corresponding parameter and result types are identical, and either both functions are variadic or neither is. Parameter and result names are not required to match.\n\nThis means that each function has its own function type. If two functions have the same signature (parameter and result types), they share one function type. By writing type Greeting func... you're just giving a name to a particular function type, not defining a new one.\nSo the following code works, and I hope shows the right way to work with function types in Go:\npackage main\n\nimport \"fmt\"\n\ntype Greeting func(name string) string\n\nfunc say(g Greeting, n string) { fmt.Println(g(n)) }\n\nfunc french(name string) string { return \"Bonjour, \" + name }\n\nfunc main() {\n        english := func(name string) string { return \"Hello, \" + name }\n\n        say(english, \"ANisus\")\n        say(french, \"ANisus\")\n}\n\nNotice that I also dropped semicolon and parenthesis from your english function. Go developers don't use these punctuations if they don't have to.\nUPDATE: Now that you've provided a sample code I can clearly understand the problem.\nFor this purpose your code is good enough and there are not much other ways of doing it. If you like you can cast just before calling the method:\nenglish := func(name string) string { return \"Hello, \" + name }\nGreeting(english).exclamation(\"ANisus\")\n\nBut I'm not sure this is an improvement. I'm just saying that for what you want to do there does not seem to be other ways to write the code.\nThat is, if we don't want to change your types. I mean, the whole idea of calling a method on a function type seems a little weird. Not that it's wrong, but a little rare. Another way of achieving the same effect in a more usual way is through a struct type and having a field for the function. Something like this:\npackage main\n\nimport \"fmt\"\n\ntype Greeting struct {\n    say func(name string) string\n}\n\nfunc newGreeting(f func(string) string) *Greeting {\n    return &Greeting{say: f}\n}\n\nfunc (g *Greeting) exclamation(name string) string { return g.say(name) + \"!\" }\n\nfunc main() {\n    english := &Greeting{say: func(name string) string {\n        return \"Hello, \" + name\n    }}\n\n    french := newGreeting(func(name string) string {\n        return \"Bonjour, \" + name\n    })\n\n    fmt.Println(english.exclamation(\"ANisus\"))\n    fmt.Println(french.exclamation(\"ANisus\"))\n}\n\nHere english and french show two different ways of coding the same thing. Again, I'm not saying that this is the better solution, but a more usual and more flexible way of achieving the same effect."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using AppEngine/Go Users API with OAuth: code sample, workflow, any help?\n\nQuestion:\nWhile I am very experienced with the AppEngine/Python runtime, I am a newbie to the Go runtime. My first application is close to being ready to roll out, but I still need to provide a capability for the user to log in. I am hoping to use OpenID, as I would rather not require that the user have a Google Id.\nHowever, it seems that there are no or almost no working examples out there, and the AppEngine documentation explicity omits the contents of the function that I need to implement:\nfunc init() {\n    http.HandleFunc(\"/_ah/login_required\", openIdHandler)\n}\n\nfunc openIdHandler(w http.ResponseWriter, r *http.Request) {\n    // ...\n}\n\nWhat goes inside the openIdHandler func?\nI understand that I need to provide a page that will allow the user to select one of the many OpenId providers and enter their Id for that system. I just don't know what to do after that. What is the workflow? Does anyone know of any sample code that I can look at to get a general idea of what I must do and what data I must handle? All of my well-honed google-fu has lead me nowhere.\nTo be clear, I am not looking to interact with any of the services provided by these OpenId providers; I do not wish to create Tweets or Buzz. I do not want access to contacts, docs, Wall postings or anything else. I just wanted an authenticated credenital that I can use inside my application to limit a users access to only his or her own data.", "output": "If I well understood you — you need openid, not oath.\nI rewrote python example (Federated login and logout) for go-lang. Hope this help.\npackage gae_go_openid_demo\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"http\"\n\n    \"appengine\"\n    \"appengine/user\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/\", hello)\n    http.HandleFunc(\"/_ah/login_required\", openIdHandler)\n}\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    u := user.Current(c)\n    if u != nil {\n        url, err := user.LogoutURL(c, \"/\")\n        check(err);\n        fmt.Fprintf(w, \"Hello, %s! (<a href='%s'>Sign out</a>)\", u, url)\n    } else {\n        fmt.Fprintf(w, \"Please, <a href='/_ah/login_required'>login</a>.\")\n    }\n\n}\n\nfunc openIdHandler(w http.ResponseWriter, r *http.Request) {\n    providers := map[string]string {\n        \"Google\"   : \"www.google.com/accounts/o8/id\", // shorter alternative: \"Gmail.com\"\n        \"Yahoo\"    : \"yahoo.com\",\n        \"MySpace\"  : \"myspace.com\",\n        \"AOL\"      : \"aol.com\",\n        \"MyOpenID\" : \"myopenid.com\",\n        // add more here\n    }\n\n    c := appengine.NewContext(r)\n    fmt.Fprintf(w, \"Sign in at: \")\n    for name, url := range providers {\n        login_url, err := user.LoginURLFederated(c, \"/\", url)\n        check(err);\n        fmt.Fprintf(w, \"[<a href='%s'>%s</a>]\", login_url, name)\n    }\n}\n\n// check aborts the current execution if err is non-nil.\nfunc check(err os.Error) {\n    if err != nil {\n        panic(err)\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to get hex-encoded md5 hash in Go\n\nQuestion:\nI'm trying to get the md5 hash of a file in Go, like thus:\nrunning_hash := md5.New(); // type hash.Hash\nrunning_hash.Write(data);  // data is []byte\nsum := running_hash.Sum(); // []uint8 according to the compiler\n\nBut when I try to get the string of the hash's 'sum' (http://golang.org/pkg/hash/), via\nsumstring := string(sum);  // returns 'Ӿ��]앿��N��' or similar\n\nwhen the hash is supposed to be d3be9e835dec95bfbef34ebe1fbf03da. I get the same sort of nonsense, only with different characters, when I try to convert on a byte-by-byte basis.\nHow am I meant to get the hash's string?", "output": "Basically, you've got the binary data but it looks like you're expecting hex. Have a look at the hex package for conversion routines, especially EncodeToString. I'm not a Go programmer, but I think if you just pass sum into hex.EncodeToString, you'll get the answer you expected."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Setting cookies with net/http\n\nQuestion:\nI'm trying to set cookies with Go's net/http package. I have:\npackage main\n\nimport \"io\"\nimport \"net/http\"\nimport \"time\"\n\nfunc indexHandler(w http.ResponseWriter, req *http.Request) {\n    expire := time.Now().AddDate(0, 0, 1)\n    cookie := http.Cookie{\"test\", \"tcookie\", \"/\", \"www.domain.com\", expire, expire.Format(time.UnixDate), 86400, true, true, \"test=tcookie\", []string{\"test=tcookie\"}}\n    req.AddCookie(&cookie)\n    io.WriteString(w, \"Hello world!\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", indexHandler)\n    http.ListenAndServe(\":80\", nil)\n}\n\nI tried googling 'Golang' with 'cookies', but didn't get any good results. If anyone can point me in the right direction it would be greatly appreciated.", "output": "I am not a Go expert, but I think you are setting the cookie on the request, aren't you? You might want to set it on the response. There is a setCookie function in net/http. This might help:\nhttp://golang.org/pkg/net/http/#SetCookie\nfunc SetCookie(w ResponseWriter, cookie *Cookie)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE Golang - OAuth and OAuth2?\n\nQuestion:\nI'm trying to implement a Google App Engine Go application that will be using OAuth and OAuth2 for users logging in. I'm wondering if it is possible, and if so, how to do it? Can someone provide an example of this?", "output": "You can use goauth2 to implement an OAuth2 client on App Engine\nYou can then log your users with their Google Account by requesting https://www.googleapis.com/auth/userinfo.profile scopes as shown on Using OAuth 2.0 for Login"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Pass string slice to variadic empty interface parameter\n\nQuestion:\nA package I am using, gosqlite, has a method with a variadic parameter where its type is the empty interface.\nfunc (s *Stmt) Exec(args ...interface{}) os.Error\n\nI can call this fine if explicitly pass individual parameters:\nstatement := blah()\nerror := statement.Exec(\"hello\", 3.0, true) // works fine\n\nHowever, as the variadic parameter corresponds to placeholders within the in operator of my SQL statement's select, the number of these placeholders is not known at compile time but dynamically changes at run time depending upon what the user is doing. E.g. I end up with SQL akin to the following if the user enters four values:\nSELECT * FROM sky WHERE name IN (?,?,?,?)\n\nSo naturally I would like to call the Exec method with a slice of strings:\nvar values []string = getValuesFromUser()\nstatement := createStatementWithSufficientNumberOfPlaceholders(len(values))\n_ := statement.Exec(values...) // compiler doesn't like this\n\nThis does not compile. I can get around this problem by creating an empty interface slice and copying the references over:\nvalues2 := make([]interface{}, len(values))\nfor index, value := range values { values2[index] = value }\n_ := statement.Exec(values2...) // compiler happy but I'm not\n\nAnd this works fine but it feels a bit clunky. I was wondering if there was some trick to be able to pass values directly to this function or, failing that, a neater way of converting the string slice to an empty interface one?\nMany thanks.", "output": "There is no way to pass a []string directly to a ...interface{} parameter. Doing this requires a linear time copy (with n + 1 allocations!). If the language hid this from you, it would be a significant hidden cost. Normally, passing a slice to a variadic argument just passes the slice into the function.\nAs for other ways of doing this, you could make it cleaner by writing a function that takes a []string and returns the corresponding []interface{}. Of course, you'll have to write it again for each []T -> []interface{} conversion you want to do, but its a rather short function, and all that changes is the signature. You could use reflection, which comes with an inherent runtime cost, to make the function \"generic\", such as in:\nvaluesVal := reflect.ValueOf(values)\n...\nfor i := range values2 { values2[i] = valuesVal.Index(i).Interface() }"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why can't Go method Receiving Types be interfaces?\n\nQuestion:\nFrom the Go documentation on method declarations:\n\nThe receiver type must be of the form T or *T where T is a type name. T is called the receiver base type or just base type. The base type must not be a pointer or interface type and must be declared in the same package as the method.\n\nCan anyone give me some insight on why this might be? Are there any other (statically typed) languages that would allow this? I really want to define methods on an interface so I can treat any instance of a given interface type as another. For example (stealing the example from the Wikipedia article on the Template Method Pattern) if the following was valid:\ntype Game interface {\n    PlayOneGame(playersCount int)\n}\n\ntype GameImplementation interface {\n    InitializeGame()\n    MakePlay(player int)\n    EndOfGame() bool\n    PrintWinner()\n}\n\nfunc (game *GameImplementation) PlayOneGame(playersCount int) {\n    game.InitializeGame()\n    for j := 0; !game.EndOfGame(); j = (j + 1) % playersCount {\n        game.MakePlay(j)\n    }\n    game.PrintWinner()\n}\n\nI could use any instance implementing \"GameImplementation\" as a \"Game\" without any conversion:\nvar newGame Game\nnewGame = NewMonopolyGame() // implements GameImplementation\nnewGame.PlayOneGame(2)\n\nUPDATE: the purpose of this was to try and achieve all the benefits of abstract base classes without all the coupling that goes with an explicit hierarchy. If I wanted to define a new behaviour PlayBestOfThreeGames, abstract base classes would require me to change the base class itself - whereas here I just define one more method on top of the GameImplementation interface", "output": "It's probably for the same reason you can't define methods on interfaces in Java.\nAn interface is meant to be a description of a part of, or the whole of, the external interface for a set of objects and not how they implement the underlying behavior. In Java you would probably use an abstract class if you need parts of the behavior to be pre-defined but I think the only way to do that in Go is to use functions rather than methods.\nI believe that for your example the more Go idiomatic code would be something like this:\ntype GameImplementation interface {\n    InitializeGame()\n    MakePlay(player int)\n    EndOfGame() bool\n    PrintWinner()\n}\n\nfunc PlayOneGame(game GameImplementation, playersCount int) {\n    game.InitializeGame()\n    for j := 0; !game.EndOfGame(); j = (j + 1) % playersCount {\n        game.MakePlay(j)\n    }\n    game.PrintWinner()\n}\n\nWhere PlayOneGame and any specific game implementation are probably living in different packages.\nHere is some discussion on golang-nuts"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Looping over an array of objects in a template (Go)\n\nQuestion:\nI'm passing a struct (one element is an array of Category objects) to the template for rendering. In the template, I have code that looks something like this:\n{.repeated section Categories}\n    <p>{@}</p>\n{.end}\n\nHowever, each Category has a few of its own elements that I need to be able to access (Title for instance). I have tried things like {@.Title} but I can't seem to find the proper syntax for accomplishing this. How do I access members of data in an array during a loop in a template?", "output": "You can just write {Title}.\nWhenever the template package encounters an identifier, it tries to look it up in the current object and if it doesn't find anything it tries the parent (up to the root). The @ is just there if you wan't to access the current object as a whole and not one of its attributes.\nSince I'm not used to the template package either, I've created a small example:\ntype Category struct {\n    Title string\n    Count int\n}\n\nfunc main() {\n    tmpl, _ := template.Parse(`\n        {.repeated section Categories}\n            <p>{Title} ({Count})</p>\n        {.end}\n    `, nil)\n    categories := []Category{\n        Category{\"Foo\", 3},\n        Category{\"Bar\", 5},\n    }\n    tmpl.Execute(os.Stdout, map[string]interface{} {\n        \"Categories\": categories,\n    })\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to access command-line arguments passed to a Go program?\n\nQuestion:\nHow do I access command-line arguments in Go? They're not passed as arguments to main.\n\nA complete program, possibly created by linking multiple packages, must have one package called main, with a function\nfunc main() { ... }\n\ndefined. The function main.main() takes no arguments and returns no value.", "output": "You can access the command-line arguments using the os.Args variable. For example,\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    fmt.Println(len(os.Args), os.Args)\n}\n\nYou can also use the flag package, which implements command-line flag parsing."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a nice way to simulate a \"Maybe\" or \"option\" type in Go?\n\nQuestion:\nI'm sending a reply to a request over a chan X, where X is a struct. The request is a search operation, so ideally I'd like to be able to return either an X, or report it wasn't found.\nThis would be a task for a Maybe X in Haskell or an x option in OCaml. Is there any decent way to do this in Go? I'm not returning a pointer (as the original object I'm returning might be modified later), so I can't just return nil.\nEdit: right now I'm making it a chan interface{} and either sending an X or nil, but this is ugly and defeats type-safety.", "output": "If you're using interface {} you're effectively returning a pointer now. Why not change interface {} to *X and make sure to return a copy of the object? If I understand your reasoning behind not using a chan *X, that is."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Hello World syntax error\n\nQuestion:\nWhen I try to compile the example from the front page of the go language website with the 6g compiler, I get this error:\nhello.go:5: syntax error near \"<string>\"\nI search on Google reveals that a few people have experienced this, but I have found no solution. The answer always seems to be: \"It's works for me, you must do something wrong\". \nI've found a description of the problem that dates back 5 months, so I suspect it's not a problem with the particular build of go that I'm using. Besides, I've tried pulling a newer version, and the problem persists.\nThe source code in question:\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, 世界\")\n }\n\nBtw, I'm saving the source code as UTF-8 with LFs for newlines. It shouldn't be a text encoding issue. I've also tried with different strings not containing \"exotic\" characters", "output": "Try \"which 6g\".\nYou might be picking up an old build.\nAt least that was my case. I had an old 2009 build in my path.\nAfter fixing the environment it worked."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang: goroute with select doesn't stop unless I added a fmt.Print()\n\nQuestion:\nI tried the Go Tour exercise #71\nIf it is run like go run 71_hang.go ok, it works fine.\nHowever, if you use go run 71_hang.go nogood, it will run forever.\nThe only difference is the extra fmt.Print(\"\") in the default in the select statement.\nI'm not sure, but I suspect some sort of infinite loop and race-condition? And here is my solution.\nNote: It's not deadlock as Go didn't throw: all goroutines are asleep - deadlock!\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\ntype Fetcher interface {\n    // Fetch returns the body of URL and\n    // a slice of URLs found on that page.\n    Fetch(url string) (body string, urls []string, err error)\n}\n\nfunc crawl(todo Todo, fetcher Fetcher,\n    todoList chan Todo, done chan bool) {\n    body, urls, err := fetcher.Fetch(todo.url)\n    if err != nil {\n        fmt.Println(err)\n    } else {\n        fmt.Printf(\"found: %s %q\\n\", todo.url, body)\n        for _, u := range urls {\n            todoList <- Todo{u, todo.depth - 1}\n        }\n    }\n    done <- true\n    return\n}\n\ntype Todo struct {\n    url   string\n    depth int\n}\n\n// Crawl uses fetcher to recursively crawl\n// pages starting with url, to a maximum of depth.\nfunc Crawl(url string, depth int, fetcher Fetcher) {\n    visited := make(map[string]bool)\n    doneCrawling := make(chan bool, 100)\n    toDoList := make(chan Todo, 100)\n    toDoList <- Todo{url, depth}\n\n    crawling := 0\n    for {\n        select {\n        case todo := <-toDoList:\n            if todo.depth > 0 && !visited[todo.url] {\n                crawling++\n                visited[todo.url] = true\n                go crawl(todo, fetcher, toDoList, doneCrawling)\n            }\n        case <-doneCrawling:\n            crawling--\n        default:\n            if os.Args[1]==\"ok\" {   // *\n                fmt.Print(\"\")\n            }\n            if crawling == 0 {\n                goto END\n            }\n        }\n    }\nEND:\n    return\n}\n\nfunc main() {\n    Crawl(\"http://golang.org/\", 4, fetcher)\n}\n\n// fakeFetcher is Fetcher that returns canned results.\ntype fakeFetcher map[string]*fakeResult\n\ntype fakeResult struct {\n    body string\n    urls []string\n}\n\nfunc (f *fakeFetcher) Fetch(url string) (string, []string, error) {\n    if res, ok := (*f)[url]; ok {\n        return res.body, res.urls, nil\n    }\n    return \"\", nil, fmt.Errorf(\"not found: %s\", url)\n}\n\n// fetcher is a populated fakeFetcher.\nvar fetcher = &fakeFetcher{\n    \"http://golang.org/\": &fakeResult{\n        \"The Go Programming Language\",\n        []string{\n            \"http://golang.org/pkg/\",\n            \"http://golang.org/cmd/\",\n        },\n    },\n    \"http://golang.org/pkg/\": &fakeResult{\n        \"Packages\",\n        []string{\n            \"http://golang.org/\",\n            \"http://golang.org/cmd/\",\n            \"http://golang.org/pkg/fmt/\",\n            \"http://golang.org/pkg/os/\",\n        },\n    },\n    \"http://golang.org/pkg/fmt/\": &fakeResult{\n        \"Package fmt\",\n        []string{\n            \"http://golang.org/\",\n            \"http://golang.org/pkg/\",\n        },\n    },\n    \"http://golang.org/pkg/os/\": &fakeResult{\n        \"Package os\",\n        []string{\n            \"http://golang.org/\",\n            \"http://golang.org/pkg/\",\n        },\n    },\n}", "output": "Putting a default statement in your select changes the way select works.  Without a default statement select will block waiting for any messages on the channels.  With a default statement select will run the default statement every time there is nothing to read from the channels.  In your code I think this makes an infinite loop.  Putting the fmt.Print statement in is allowing the scheduler to schedule other goroutines.\nIf you change your code like this then it works properly, using select in a non blocking way which allows the other goroutines to run properly.\n    for {\n        select {\n        case todo := <-toDoList:\n            if todo.depth > 0 && !visited[todo.url] {\n                crawling++\n                visited[todo.url] = true\n                go crawl(todo, fetcher, toDoList, doneCrawling)\n            }\n        case <-doneCrawling:\n            crawling--\n        }\n        if crawling == 0 {\n            break\n        }\n    }\n\nYou can make your original code work if you use GOMAXPROCS=2 which is another hint that the scheduler is busy in an infinite loop.\nNote that goroutines are co-operatively scheduled.  What I don't fully understand about your problem is that select is a point where the goroutine should yield - I hope someone else can explain why it isn't in your example."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Nested properties for structs with unknown property names?\n\nQuestion:\nI'm using JSON to get some values into a variable from an external source.\nI have a type like this that json.Unmarshal puts values into:\n    type Frame struct {\n        Type  string\n        Value map[string]interface{}\n    }\n\n    var data Frame\n\nAfter unmarshal, I can access a the type by: data.Type\nbut if I try doing something like:\n    if data.Type == \"image\" {\n        fmt.Printf(\"%s\\n\", data.Value.Imagedata)\n    }\n\nThe compiler complains about no such value data.Value.Imagedata.\nSo my question is, how do I reference properties in Go that I know will be there depending on some condition?\nDoing this works:\n    type Image struct {\n        Filename string\n    }\n\n    type Frame struct {\n        Type  string\n        Value map[string]interface{}\n    }\n\nBut that isn't very flexible as I will be receiving different Values.", "output": "json.Unmarshal will do its best to place the data where it best aligns with your type. Technically your first example will work, but you are trying to access the Value field with dot notation, even though you declared it to be a map:\nThis should give you some form of output:\nif data.Type == 'image'{\n    fmt.Printf(\"%v\\n\", data.Value[\"Imagedata\"])\n}\n\n… considering that \"Imagedata\" was a key in the JSON.\nYou have the option of defining the type as deeply as you want or expect the structure to be, or using an interface{} and then doing type assertions on the values. With the Value field being a map, you would always access the keys like Value[key], and the value of that map entry is an interface{} which you could type assert like Value[key].(float64).\nAs for doing more explicit structures, I have found that you could either break up the objects into their own types, or define it nested in one place:\nNested (with anonymous struct)\ntype Frame struct {\n    Type  string\n    Value struct {\n        Imagedata string `json:\"image_data\"`\n    }\n}\n\nSeperate structs\ntype Frame struct {\n    Type    string\n    Value   value \n}\n\ntype value struct {\n    Imagedata string `json:\"image_data\"`\n}\n\nI'm still learning Go myself, so this the extent of my current understanding :-)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can you \"pin\" an object in memory with Go?\n\nQuestion:\nI have a Go object whose address in memory I would like to keep constant. in C# one can pin an object's location in memory. Is there a way to do this in Go?", "output": "An object on which you keep a reference won't move. There is no handle or indirection, and the address you get is permanent. \nFrom the documentation :\n\nNote that, unlike in C, it's perfectly OK to return the address of a\n  local variable; the storage associated with the variable survives\n  after the function returns\n\nWhen you set a variable, you can read this address using the & operator, and you can pass it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: QR Code library for Go\n\nQuestion:\nIs there a library to generate QR Codes with the Go programming language? I'm looking for something in pure Go that generates image files.", "output": "Russ has done some funny things with QR codes and his tool\nis available here:\nhttp://code.google.com/p/rsc/source/browse/qr"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: 'Go' windows port build problems: 8l linker crashes\n\nQuestion:\nI'm looking to give the 'Go' programming language a try but I'm having trouble getting even a simple test example to work. I think it's probably an issue with the port so I've submitted a ticket under issues in gomingw project page.\n\nWhat steps will reproduce the problem?\n\nCreate any simple go test program\ncompile it with 8g. ie. 8g hello.go\nlink it with 8l. ie. 8l hello.8\n\nWhat is the expected output? What do you see instead?\nI expect 8l to link successfully with no errors. Instead I see the follow errors output followed with a crash.\n>        goos is not known: mingw\n>        warning: uanble to find runtime.a\n>        runtime.morestack not defined\n\nWhat version of the product are you using? On what operating system?\nThis is on windows 7 with gowin32_2010-12-02.zip\nPlease provide any additional information below.\nI have set the 4 standard go variables on my environment as follows:\n       goos = mingw, gobin = G:\\oss\\go\\bin, goarch = 386, goroot = G:\\oss\\go\nFrom looking at the error, I'm going to say it looks like it needs something from mingw gcc toolset? Though I see no mention of this requirement anywhere, neither in the readme or install. What is the runtime.a that is missing? Is it part of mingw? I've also tried one version before this latest one and the problem is present on that version as well.\n\nHas anyone else that's tried Go's port of windows encountered an issue like this? What could be causing this?\nThanks", "output": "The reason for the failure is stated in the error message: goos is not known: mingw. Read the instructions for setting the GOOS environment variable. Set GOOS=windows.\nYou should also be using the latest release of the Go Windows port binary."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reading a local file in Google App Engine with Go\n\nQuestion:\nI'm trying to use go instead of python for my website on google app engine. But I keep getting this error with my script when I test locally.\npanic: runtime error: invalid memory address or nil pointer dereference\n\nI'm pretty confused, however it will run without error if I comment out\nchannel <- buffer[0:dat]\n\nSo I must be using channels incorrectly, Any help?\nEdit:\nThis is the working code, many thanks to Kevin Ballard for helping me get this one.\npackage defp\n\nimport (\n    \"fmt\"\n    \"http\"\n    \"os\"\n)\n\nfunc getContent(filename string, channel chan []byte) {\n    file, err := os.OpenFile(filename, os.O_RDONLY, 0666)\n    defer file.Close()\n    if err == nil {\n        fmt.Printf(\"FILE FOUND : \" + filename + \" \\n\")\n        buffer := make([]byte, 16)\n        dat, err := file.Read(buffer)\n        for err == nil {\n            fmt.Printf(\"herp\")\n            channel <- buffer[0:dat]\n            buffer = make([]byte, 16)\n            dat, err = file.Read(buffer)\n        }\n        close(channel)\n        fmt.Printf(\"DONE READING\\n\")\n    } else {\n        fmt.Printf(\"FILE NOT FOUND : \" + filename + \" \\n\")\n    }\n}\nfunc writeContent(w http.ResponseWriter, channel chan []byte) {\n    fmt.Printf(\"ATTEMPTING TO WRITE CONTENT\\n\")\n    go func() {\n        for bytes := range channel {\n            w.Write(bytes)\n            fmt.Printf(\"BYTES RECEIVED\\n\")\n        }\n    }()\n    fmt.Printf(\"FINISHED WRITING\\n\")\n}\nfunc load(w http.ResponseWriter, path string) {\n    fmt.Printf(\"ATTEMPTING LOAD \" + path + \"\\n\")\n    channel := make(chan []byte, 50)\n    writeContent(w, channel)\n    getContent(path, channel)\n}\nfunc handle(w http.ResponseWriter, r *http.Request) {\n    fmt.Printf(\"HANDLING REQUEST FOR \" + r.URL.Path[1:] + \"\\n\")\n    load(w, r.URL.Path[1:])\n}\nfunc init() {\n    http.HandleFunc(\"/\", handle)\n}", "output": "The reason why your program sometimes panics is that it is sometimes writing to w http.ResponseWriter after the program exits the load function. The http package automatically closes the http.ResponseWriter when the program exits the handler function. In function writeContent, the program will sometimes attempt to write to a closed http.ResponseWriter.\nBTW: You can make the program source code much smaller if you use the io.Copy function.\nTo always get predictable behavior, make sure that all work that you want the program to perform in response to a HTTP request is done before you exit the handler function. For example:\nfunc writeContent(w http.ResponseWriter, channel chan []byte) {\n    fmt.Printf(\"ATTEMPTING TO WRITE CONTENT\\n\")\n    for bytes := range channel {\n            w.Write(bytes)\n            fmt.Printf(\"BYTES RECEIVED\\n\")\n    }\n    fmt.Printf(\"FINISHED WRITING\\n\")\n}\n\nfunc load(w http.ResponseWriter, path string) {\n    fmt.Printf(\"ATTEMPTING LOAD \" + path + \"\\n\")\n    channel := make(chan []byte)\n    workDone := make(chan byte)\n    go func() {\n            writeContent(w, channel)\n            workDone <- 1 //Send an arbitrary value\n    }()\n    go func() {\n            getContent(path, channel)\n            workDone <- 2 //Send an arbitrary value\n    }()\n    <-workDone\n    <-workDone\n}\n\nfunc handle(w http.ResponseWriter, r *http.Request) {\n    fmt.Printf(\"HANDLING REQUEST FOR \" + r.URL.Path[1:] + \"\\n\")\n    load(w, r.URL.Path[1:])\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to implement the algorithm for HashCash in Go (type conversion issues)?\n\nQuestion:\nI've been trying to implement the HashCash algorithm in Go! For those of you who don't know -\n\nHashCash is a method to stop spam. Basically, a header is constructed of some environment variables known both to the client and server (email, timestamp etc.). A random nonce is appended to the end of the header. The client tries to bruteforce a partial hash collision (e.g. where the first x bits are 0) by changing the nonce.\nHashCash works because it's not as expensive to find partial hash collisions. When the server receives this header, they verify the information in it (so it can be used only for one session) and compute the resulting hash. If the first x bits are 0, then a good amount of time has been expended on the client's machine, computing the collision (which wouldn't happen on a spambot)\n\nFor me, I'm just wanting to write a program which finds the time it takes for a client to find a partial hash collision of x bits.\nI wrote this code which will return true/false if the int64 has a hash collision of x bits.\nfunc partialAllZeroes (zeroCount uint8, val int64) (bool, os.Error) {\n    setBitString := \"1111111111111111111111111111111111111111111111111111111111111111\"\n    unsetBitString := \"0000000000000000000000000000000000000000000000000000000000000000\"\n    setBitString = setBitString[0:zeroCount-1]\n    unsetBitString = unsetBitString[0:zeroCount-1]\n    \n    zeroTest, e := strconv.Btoi64(setBitString, 2) // 64 0bits\n    zeroes, e   := strconv.Btoi64(unsetBitString, 2) // 64 1bits\n    \n    if e != nil {\n        return false, e\n    }\n    result := val & zeroTest\n    switch {\n        case result == zeroes:\n            return true, nil\n        case result != zeroes:\n            return false, nil\n    }\n    \n    return false, os.NewError(\"\")\n}\n\nMy current problem is I'm having alot of type conversion issues. For example, I am only able to operate on the int64 type, because that's what strconv.Btoi64 returns. Another issue that I'm also looking at is that the hash function returns as a byte array, and I have no idea how to convert that into an int64.\nBelow is my current hash code -\nhasher := sha1.New()\nbaseCollisionString := \"BASE COLLISION STRING\"\nnonce := \"12345\"\nhasher.Write([]byte(strings.Join(baseCollisionString, nonce)))\ntestCollision := hasher.Sum()\n// Somehow I must convert the first x bits of testCollision into an int64 type, so I can use partialAllZeroes with it", "output": "I would suggest the following code (the function partialAllZeroes should run much faster):\npackage main\n\nimport \"crypto/sha1\"\n\nfunc partialAllZeroes(zeroCount uint8, b []byte) bool {\n    i := 0\n    for zeroCount >= 8 {\n        if b[i] != 0 {\n            return false\n        }\n        i++\n        zeroCount -= 8\n    }\n\n    var mask byte\n    switch zeroCount {\n    case 0: mask = 0x00\n    case 1: mask = 0x01\n    case 2: mask = 0x03\n    case 3: mask = 0x07\n    case 4: mask = 0x0f\n    case 5: mask = 0x1f\n    case 6: mask = 0x3f\n    case 7: mask = 0x7f\n    }\n\n    return (b[i] & mask) == 0\n}\n\nfunc main() {\n    hasher := sha1.New()\n    baseCollisionString := \"BASE COLLISION STRING\"\n    nonce := \"12345\"\n    hasher.Write([]byte(baseCollisionString + nonce))\n    testCollision := hasher.Sum()\n    partialAllZeroes(100, testCollision)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go programming linux amd64 wrong release object\n\nQuestion:\nI wanted to try-out go language from Google.\nI've installed everything correctly like the doc said.\nBut when I try to compile I always have an output similar to this:\n\n$ 6g main.go\nmain.go:3: import /home/manbear/gosource/pkg/linux_amd64/fmt.a: object is [linux amd64 weekly.2011-08-17 9569] expected [linux amd64 release.r59 9199+]\n\nBefore I had something like [linux amd64 release.r56 89** ], I tried to get the good release, but I don't seem to succeed in this quest.\nSome advices would be appreciated :)\nThanks", "output": "I have found the problem.\nI did try the \"hg update release\" but the problem why it did not fix the problem is because when I tried to fixed the release version previously; I had downloaded and installed on my Natty Ubuntu this:\"golang_59-0~9199~oneiric1_amd64.deb\". \nI did not notice that it was for the next version of ubuntu (oneiric) [but it did install flawlessly though].\nWhen I've noticed it in synaptic and delete it completly, recompile golang itself and everything is working now :)\nAn interesting fact, there is a package of \"golang 59-0~9199-natty1\" for Natty in the synaptic repository. I did not installed it since I've followed the general instruction for linux distributions. But I guess that it's possible to skip the compilation of the language itself and just install the package with apt-get install."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Obtaining a Unix Timestamp in Go Language (current time in seconds since epoch)\n\nQuestion:\nI have some code written in Go which I am trying to update to work with the latest weekly builds. (It was last built under r60). Everything is now working except for the following bit:\n if t, _, err := os.Time(); err == nil {\n   port[5] = int32(t)\n }\n\nAny advice on how to update this to work with the current Go implementation?", "output": "import \"time\"\n...\nport[5] = time.Now().Unix()"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to make extensions to python/php/perl with Go?\n\nQuestion:\nI've heard Go is like C with channels and a lot of conveniences. I do very little C, but when I do it's to make small extensions to other languages. Can Go be a safe way to create extensions in other languages? Are people doing this?", "output": "For Python there is goPy: https://github.com/qur/gopy\nFor Perl there is Campher: https://github.com/bradfitz/campher\nFor Lua there is golua: https://github.com/afitz/golua"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to have nested templates in Go using the standard library?\n\nQuestion:\nHow do I get nested templates like Jinja has in the python runtime. TBC what I mean is how do I have a bunch of templates inherit from a base templates, just filing in blocks of the base templates, like Jinja/django-templates does. Is it possible using just html/template in the standard library.\nIf that is not a possibility, what are my alternatives. Mustache seems to be an option but would I then be missing out on those nice subtle features of html/template like the context sensitive escaping etc.? What other alternatives are ther?\n(Environment: Google App Engin, Go runtime v1, Dev - Mac OSx lion)\nThanks for reading.", "output": "Yes it is possible. A html.Template is actually a set of template files. If you execute a defined block in this set, it has access to all the other blocks defined in this set.\nIf you create a map of such template sets on your own, you have basically the same flexibility that Jinja / Django offers. The only difference is that the html/template package has no direct access to the file system, so you have to parse and compose the templates on your own.\nConsider the following example with two different pages (\"index.html\" and \"other.html\") that both inherit from \"base.html\":\n// Content of base.html:\n{{define \"base\"}}<html>\n  <head>{{template \"head\" .}}</head>\n  <body>{{template \"body\" .}}</body>\n</html>{{end}}\n\n// Content of index.html:\n{{define \"head\"}}<title>index</title>{{end}}\n{{define \"body\"}}index{{end}}\n\n// Content of other.html:\n{{define \"head\"}}<title>other</title>{{end}}\n{{define \"body\"}}other{{end}}\n\nAnd the following map of template sets:\ntmpl := make(map[string]*template.Template)\ntmpl[\"index.html\"] = template.Must(template.ParseFiles(\"index.html\", \"base.html\"))\ntmpl[\"other.html\"] = template.Must(template.ParseFiles(\"other.html\", \"base.html\"))\n\nYou can now render your \"index.html\" page by calling \ntmpl[\"index.html\"].Execute(\"base\", data)\n\nand you can render your \"other.html\" page by calling\ntmpl[\"other.html\"].Execute(\"base\", data)\n\nWith some tricks (e.g. a consistent naming convention of your template files), it's even possible to generate the tmpl map automatically."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What does \"...\" mean when next to a parameter in a go function declaration?\n\nQuestion:\nI was going through some code written in Google's Go language, and I came across this:\nfunc Statusln(a ...interface{})\nfunc Statusf(format string, a ...interface{})\n\nI don't understand what the ... means. Does anybody know?", "output": "It means that you can call Statusln with a variable number of arguments. For example, calling this function with:\nStatusln(\"hello\", \"world\", 42)\n\nWill assign the parameter a the following value:\na := []interface{}{\"hello\", \"world\", 42}\n\nSo, you can iterate over this slice a and process all parameters, no matter how many there are. A good and popular use-case for variadic arguments is for example fmt.Printf() which takes a format string and a variable number of arguments which will be formatted according to the format string."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Write MS Excel Sheet\n\nQuestion:\nCan I create an MS Excel sheet using Go? Where can I find a library? Am running Go on a Mac machine for development and on a Linux machine for deployment.", "output": "Create a Microsoft Excel binary file. These are the Microsoft Office Binary (doc, xls, ppt) File Formats.\nMore recently (September 2014):\nOffice Archive\nExcel 97-2007 (XLS)\nSpecifies the Excel Binary File Format (.xls) Structure, which is the binary file format used by Microsoft Excel 97, Microsoft Excel 2000, Microsoft Excel 2002, and Microsoft Office Excel 2003. This format is also supported by Microsoft Office Excel 2007.\nOffice File Formats\nOffice File Formats PDF .zip file"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to use Coffeescript on Google App Engine\n\nQuestion:\nDoes anyone know if it is possible to use Coffeescript on Google App Engine?  If so how can this be done with the app engine Python or Go platforms?", "output": "Coffeescript compiles to Javascript, which can be run in a web browser.  In that case, App Engine can serve up the resulting javascript.\nI don't know of any way to compile coffeescript to python, java or go though, so you can't use it as a server side language."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Including template files in Go executable\n\nQuestion:\nI want to parse a folder of template HTML files and cache (or buffer) them on build for later use in a web project. Basically I am trying to make it so when I build my project I dont need to take the HTML files with me when I upload the executable file.", "output": "I think maybe you are talking about embedding the html files in your binary?\nIf so the best way to do this that I've seen so far has been camlistores fileembed: https://code.google.com/p/camlistore/source/browse/pkg/fileembed/fileembed.go\nSee here for directions on use: https://groups.google.com/d/msg/golang-nuts/LQMv7Zsmsi0/8Aax1XSekjAJ\nThat thread has addtional info on other packages for this as well."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to capture a Ctrl+C signal (SIGINT) and run a cleanup function, in a \"defer\" fashion?\n\nQuestion:\nI want to capture the Ctrl+C (SIGINT) signal sent from the console and print out some partial run totals.", "output": "You can use the os/signal package to handle incoming signals. Ctrl+C is SIGINT, so you can use this to trap os.Interrupt.\nc := make(chan os.Signal, 1)\nsignal.Notify(c, os.Interrupt)\ngo func(){\n    for sig := range c {\n        // sig is a ^C, handle it\n    }\n}()\n\nThe manner in which you cause your program to terminate and print information is entirely up to you."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is this \"err.(*exec.ExitError)\" thing in Go code?\n\nQuestion:\nFor instance, in this answer: \nhttps://stackoverflow.com/a/10385867/20654\n...\nif exiterr, ok := err.(*exec.ExitError); ok {\n...\n\nWhat is that err.(*exec.ExitError)  called? How does it work?", "output": "It's type assertion. I can't explain it better than the spec."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: go compile errors: undefined variables\n\nQuestion:\nnew to programming / even newer to go. having trouble with a small go program - will not compile with undefined variable errors. the code:\npackage main\n\nimport (\n  \"fmt\"\n  \"io\"\n  \"os\"\n)\n\nconst file = \"readfile.txt\" \nvar s string\n\nfunc lookup(string) (string, string, string) {\n    artist := s\n    album := s\n    year := s\n\n    return artist, album, year\n}\n\nfunc enterdisk() (string, string, string) {\n  var artist string\n    var album string\n    var year string\n\n    println(\"enter artist:\")\n  fmt.Scanf(\"%s\", &artist)\n\n    println(\"enter album:\")\n  fmt.Scanf(\"%s\", &album)\n\n    println(\"enter year:\")\n  fmt.Scanf(\"%s\", &year)\n\n    return artist, album, year\n}\n\nfunc main() {\n\n  println(\"enter UPC or [manual] to enter information manually:\")\n  fmt.Scanf(\"%s\", &s)\n\n    s := s\n  switch s { \n        case \"manual\\n\": artist, album, year := enterdisk()\n        default: artist, album, year := lookup(s)\n  }\n\n    f,_ := os.OpenFile(file, os.O_APPEND|os.O_RDWR, 0666) \n  io.WriteString(f, (artist + \", \\\"\" + album + \"\\\" - \" + year + \"\\n\")) \n\n    f.Close()\n    println(\"wrote data to file\")\n}\n\nand the errors:\ncatalog.go:49: undefined: artist\ncatalog.go:49: undefined: album\ncatalog.go:49: undefined: year\n\nhowever, those variables will not be defined until the code runs. additionally, the \"lookup\" function is not yet written, which it just returns what it is passed. i know the lookup and enterdisk functions work on their own, but i am trying to test the switch statement. \ni have tried declaring the variables in main, however i get this error:\ncatalog.go:49: artist declared and not used\ncatalog.go:49: album declared and not used\ncatalog.go:49: year declared and not used\n\np.s. i have read http://tip.goneat.org/doc/go_faq.html#unused_variables_and_imports , and i agree that if this is only semantics, i still want to fix it. i just don't know how!", "output": "Read about blocks and declarations and scope in Go.\n\nEach clause in a switch or select statement acts as an implicit block.\nBlocks nest and influence scoping.\nThe scope of a declared identifier is the extent of source text in\n  which the identifier denotes the specified constant, type, variable,\n  function, or package. \nThe scope of a constant or variable identifier declared inside a\n  function begins at the end of the ConstSpec or VarSpec (ShortVarDecl\n  for short variable declarations) and ends at the end of the innermost\n  containing block.\n\nswitch s { \n    case \"manual\\n\": artist, album, year := enterdisk()\n    default: artist, album, year := lookup(s)\n}\n. . .\nio.WriteString(f, (artist + \", \\\"\" + album + \"\\\" - \" + year + \"\\n\")) \n\nThe scope of the short variable declarations of the artist, album, and year variables in the switch case and default case clauses begins and ends within each clause (the innermost containing block). The artist, album, and year variables no longer exist and are not visible to the WriteString() statement.\nInstead, write:\nvar artist, album, year string\nswitch s {\ncase \"manual\\n\":\n    artist, album, year = enterdisk()\ndefault:\n    artist, album, year = lookup(s)\n}\n. . .\nio.WriteString(f, (artist + \", \\\"\" + album + \"\\\" - \" + year + \"\\n\"))\n\n\nUnlike regular variable declarations, a short variable declaration may\n  redeclare variables provided they were originally declared in the same\n  block with the same type, and at least one of the non-blank variables\n  is new. As a consequence, redeclaration can only appear in a\n  multi-variable short declaration.\n\nTherefore, the artist, album, and year variables are no longer declared (and assigned) using short variable declarations inside the switch case clauses because that would hide the variable declarations in the outer block, they are merely assigned."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: utf8 error in GAE Datastore Viewer (Go runtime)\n\nQuestion:\nI am writing a webapp with the Go runtime in GAE.\nI am saving a struct which contains a string, which is the result of hashing the bytes of another string with MD5, and then encoding the hash sum bytes into a string with hex.\nHere is some code:\nfoo := \"some string\"\nhashedFoo := md5.New()\nhashedFoo.Write([]byte(foo))\nencodedFoo := hex.EncodeToString(hashedFoo.Sum()) // this is what I'm assigning to my struct, and then saving into the Datastore\n\nThis works fine, no complaints when saving or retrieving the stored entities (through code), however, when loading the Datastore Viewer, I get an error that says something like \"Error fetching entities: Property Foo is corrupt in the datastore\", and then there is a traceback with a bunch of references to internal GAE files and then this: \"UnicodeDecodeError: 'utf8' codec can't decode byte 0x85 in position 1: unexpected code byte\". This does not happen in the local development Datastore Viewer, only in the live production one.\nSo my questions are: what encoding does hex.EncodeToString() use? Is there a way to specify utf-8 output? Is this a GAE bug, or is it indeed a bad encoding error?\nThank you in advance.", "output": "The problem was a rogue line that was casting hashedFoo.Sum() directly into a string and assigning that to encodedFoo. This produced some strings with characters not recognizable by utf-8.\nhex.EncodeToString() works fine.\nI guess this is a lesson for myself to keep my code clean and tidy :)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Auto-complete with go-mode\n\nQuestion:\nI'm trying to enable auto-complete-mode whenever a .go file is loaded through go-mode. It works if I invoke auto-complete-mode manually for Go source files, but when I tried adding it to .emacs as below, it doesn't work:\n(add-hook 'go-mode-hook auto-complete-mode)\n\nI've tried a few variations around it but none seem to work. Following is what the Go-Mode snippet currently looks like in my .emacs:\n;; Load Go Mode\n(require 'go-mode-load)\n(add-hook 'go-mode-hook 'auto-complete-mode)\n\nI tried creating my own hook function like this:\n;; Load Go Mode\n(require 'go-mode-load)\n(defun auto-complete-for-go ()\n  (auto-complete-mode 1))\n(add-hook 'go-mode-hook 'auto-complete-for-go)\n\nI also tried including the hook in go-mode-load.el and go-mode.el, as well as calling auto-complete-mode like this:\n(auto-complete-mode t)\n(provide 'go-mode)\n\nDoesn't work either way. I also added the go-mode-hook to auto-complete-default function like so:\n(defun ac-config-default ()\n  (setq-default ac-sources '(ac-source-abbrev ac-source-dictionary ac-source-words-in-same-mode-buffers))\n  (add-hook 'go-mode-hook 'ac-common-setup)\n  ;; Other hooks\n  (global-auto-complete-mode t))\n\nThat doesn't work either. What's the best way to trigger a command just after a major mode is enabled for a buffer?", "output": "Here is workaround for now:\n(add-to-list 'ac-modes 'go-mode)\n\nI fixed the problem in v1.4 branch with the following commits.\n\nAdd go-mode to ac-modes\nAdd go-mode dictionary"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: TCP connection management\n\nQuestion:\nI have this question asked in the Go mailing list, but I think it is more general to get better response from SO.\nWhen work with Java/.Net platform, I never had to manage database connection manually as the drivers handle it. Now, when try to connect to a no sql db with very basic driver support, it is my responsibility to manage the connection. The driver let connect, close, reconnect to a tcp port, but not sure how should i manage it (see the link). Do i have to create a new connection for each db request? can I use other 3rd party connection pooling libraries? \nthanks.", "output": "I don't know enough about MongoDB to answer this question directly, but do you know how MongoDB handles requests over TCP? For example, one problem with a single TCP connection can be that the db will handle each request serially, potentially causing high latency even though it may be bottlenecking on a single machine and could handle a higher capacity. \nAre the machines all running on a local network? If so, the cost of opening a new connection won't be too high, and might even be insignificant from a performance perspective regardless.\nMy two cents: Do one TCP connection per request and just profile it and see what happens. It is very easy to add pooling later if you're DoSing yourself, but it may never be a problem. That'll work right now, and you won't have to mess around with a third party library that may cause more problems than it solves.\nAlso, TCP programming is really easy. Don't be intimidated by it, detecting a closed socket, and reconnecting synchronously or asynchronously is simple."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Multiple initializers in a Go if statement\n\nQuestion:\nJust discovered Go, and am very curious so far.\nI know I'm just being lazy, but I want to know if it is possible to initialize multiple variables in an if statement. I know that the following is possible:\nif x := 5; x == 5 {\n    fmt.Printf(\"Whee!\\n\")\n}\n\nI've tried the following:\nif x := 5, y := 38; x == 5 {\n    fmt.Printf(\"Whee! %d\\n\", y)\n}\n\nif x := 5 && y := 38; x == 5 {\n    fmt.Printf(\"Whee! %d\\n\", y)\n}\n\nBut neither worked. I looked over the documentation on the Go website, so is there anything I am missing or is this simply not possible?", "output": "Here's how to do it:\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    if x, y := 5, 38; x == 5 {\n        fmt.Printf(\"Whee! %d\\n\", y)\n    }\n}\n\n\nTested with this revision:\n\nchangeset:   3975:b51fd2d6c160\ntag:         tip\nuser:        Kevin Ballard <xxxxxxxxxxxxxxxxxxxxx>\ndate:        Tue Nov 10 20:05:24 2009 -0800\nsummary:     Implement new emacs command M-x gofmt"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go channel vs Java BlockingQueue\n\nQuestion:\nAre there any differences between a Go channel and a Java BlockingQueue? Both are queues with similar blocking and memory model semantics. Optionally both can have a capacity set.", "output": "I would say the biggest difference is that Go channels have support for the select statement, which allow you to perform exactly one channel operation.  An example (altered from the Go language specification):\nselect {\ncase i1 = <-c1:\n    print(\"received \", i1, \" from c1\\n\")\ncase c2 <- i2:\n    print(\"sent \", i2, \" to c2\\n\")\ncase i3, ok := (<-c3):  // same as: i3, ok := <-c3\n    if ok {\n        print(\"received \", i3, \" from c3\\n\")\n    } else {\n        print(\"c3 is closed\\n\")\n    }\n}\n\nIn this example, exactly one of the receive-from-c1, send-to-c2, or receive-from-c3 operations will be performed.  When entering the select, a ready channel (if any) is selected randomly.  Otherwise, the operation blocks until one of the channels is ready.\nI'm not aware of any trivial way to model this channel selection using the Java utilities.  One could argue that this is a property of the select statement rather than the design of channels, but I would argue that it's fundamental to the design of channels."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I convert a string to a lower case representation?\n\nQuestion:\nHow do I convert a string to a lower case representation?\nI feel that there must be built-in function for it, but I just can't find it.\nI did find a ToLower in \"unicode/letter\", but it only works for one rune at a time.", "output": "Yes there is, check the strings package.\npackage main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    fmt.Println(strings.ToLower(\"Gopher\"))\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using reflect, how do you set the value of a struct field?\n\nQuestion:\nhaving a rough time working with struct fields using reflect package.  in particular, have not figured out how to set the field value.\n\ntype t struct { fi int; fs string }\nvar r t = t{ 123, \"jblow\" }\nvar i64 int64 = 456\n\n\ngetting Name of field i - this seems to work\nvar field = reflect.TypeOf(r).Field(i).Name\ngetting value of field i as a) interface{}, b) int - this seems to work\nvar iface interface{} = reflect.ValueOf(r).Field(i).Interface()\nvar i int = int(reflect.ValueOf(r).Field(i).Int())\nsetting value of field i - try one - panic\nreflect.ValueOf(r).Field(i).SetInt( i64 )\npanic: reflect.Value·SetInt using value obtained using unexported field\nassuming it did not like field names \"id\" and \"name\", so renamed to \"Id\" and \"Name\"\na) is this assumption correct?\nb) if correct, thought not necessary since in same file / package\nsetting value of field i - try two (with field names capitalized ) - panic\nreflect.ValueOf(r).Field(i).SetInt( 465 )\nreflect.ValueOf(r).Field(i).SetInt( i64 )\npanic: reflect.Value·SetInt using unaddressable value\n\n\nInstructions below by @peterSO are thorough and high quality\nFour. this works:\nreflect.ValueOf(&r).Elem().Field(i).SetInt( i64 )\nhe documents as well that the field names must be exportable (begin with capital letter)", "output": "The Go json package marshals and unmarshals JSON from and to Go structures.\nHere's a step-by-step example which sets the value of a struct field while carefully avoiding errors.\nThe Go reflect package has a CanAddr function.\nfunc (v Value) CanAddr() bool\n\n\nCanAddr returns true if the value's\naddress can be obtained with Addr.\nSuch values are called addressable. A\nvalue is addressable if it is an\nelement of a slice, an element of an\naddressable array, a field of an\naddressable struct, or the result of\ndereferencing a pointer. If CanAddr\nreturns false, calling Addr will\npanic.\n\nThe Go reflect package has a CanSet function, which, if true, implies that CanAddr is also true.\nfunc (v Value) CanSet() bool\n\n\nCanSet returns true if the value of v\ncan be changed. A Value can be changed\nonly if it is addressable and was not\nobtained by the use of unexported\nstruct fields. If CanSet returns\nfalse, calling Set or any\ntype-specific setter (e.g., SetBool,\nSetInt64) will panic.\n\nWe need to make sure we can Set the struct field. For example,\npackage main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    type t struct {\n        N int\n    }\n    var n = t{42}\n    // N at start\n    fmt.Println(n.N)\n    // pointer to struct - addressable\n    ps := reflect.ValueOf(&n)\n    // struct\n    s := ps.Elem()\n    if s.Kind() == reflect.Struct {\n        // exported field\n        f := s.FieldByName(\"N\")\n        if f.IsValid() {\n            // A Value can be changed only if it is \n            // addressable and was not obtained by \n            // the use of unexported struct fields.\n            if f.CanSet() {\n                // change value of N\n                if f.Kind() == reflect.Int {\n                    x := int64(7)\n                    if !f.OverflowInt(x) {\n                        f.SetInt(x)\n                    }\n                }\n            }\n        }\n    }\n    // N at end\n    fmt.Println(n.N)\n}\n\nOutput:\n42\n7\n\nIf we can be certain that all the error checks are unnecessary, the example simplifies to,\npackage main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    type t struct {\n        N int\n    }\n    var n = t{42}\n    fmt.Println(n.N)\n    reflect.ValueOf(&n).Elem().FieldByName(\"N\").SetInt(7)\n    fmt.Println(n.N)\n}\n\nBTW, Go is available as open source code. A good way to learn about reflection is to see how the core Go developers use it. For example, the Go fmt and json packages. The package documentation has links to the source code files under the heading Package files."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does a break statement break from a switch/select?\n\nQuestion:\nI know that switch/select statements break automatically after every case. I am wondering, in the following code:\nfor {\n    switch sometest() {\n    case 0:\n        dosomething()\n    case 1:\n        break\n    default:\n        dosomethingelse()\n    }\n}\n\nDoes the break statement exit the for loop or just the switch block?", "output": "Break statements, The Go Programming Language Specification.\nA \"break\" statement terminates execution of the innermost \"for\",\n  \"switch\" or \"select\" statement.\nBreakStmt = \"break\" [ Label ] .\n\nIf there is a label, it must be that of an enclosing \"for\", \"switch\"\n  or \"select\" statement, and that is the one whose execution terminates\n  (§For statements, §Switch statements, §Select statements).\nL:\n  for i < n {\n      switch i {\n      case 5:\n          break L\n      }\n  }\n\n\nTherefore, the break statement in your example terminates the switch statement, the \"innermost\" statement."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: If type T2 is based on type T1, is there any sort of \"inheritance\" from T1 to T2?\n\nQuestion:\nIf type T2 is based on type T1, other than sharing the same data fields, is there any relationship between T1 and T2?\n\npackage main\nimport \"fmt\"\n\ntype T1 struct { s string }\nfunc (v *T1) F1() string { return v.s }\n\ntype T2 T1\nfunc (v *T2) F2() string { return v.s }\n\nfunc main() {\n        var t1 = T1{ \"xyz\" }\n        var t2 = T2{ \"pdq\" }\n        s0 := t2.F1()                   // error - expected ok\n        s1 := ((*T1)(&t2)).F1()         // ok - expected\n        s2 := ((*T2)(&t1)).F2()         // ok - not expected\n        fmt.Println( s0, s1, s2 )\n}\n\nMy understanding here is lacking\n\nwas hoping that T2 would inherit T1's methods, but such is not the case.\n\nwas expecting T2 could be coerced into T1, since it was derived from T1\n\nwas surprised that T1 could be coerced into T2, but so it is.\n\nit seems that the relationship between T1 and T2 is completely symmetrical - I cannot find anything that breaks the symmetry despite the fact one is actually derived from the other - or is this an illusion?", "output": "Go does not support object-oriented type inheritance.\nIs Go an object-oriented language?\nWhy is there no type inheritance?\nA method is bound to a single specific type.\n\nA method declaration binds an\n  identifier to a method. The method is\n  said to be bound to the base type and\n  is visible only within selectors for\n  that type.\n\nYou can convert between types T1 and T2.\n\nA value x can be converted to type\n  T [when] x's type and T have\n  identical underlying types.\n\nFor example,\npackage main\n\nimport (\n    \"fmt\"\n)\n\ntype T1 struct{ i int }\n\nfunc (t T1) String() string { return \"T1\" }\n\ntype T2 T1\n\nfunc (t T2) String() string { return \"T2\" }\n\nfunc main() {\n    t1 := T1{1}\n    t2 := T2{2}\n    fmt.Println(t1, t2)\n    c1 := T1(t2)\n    c2 := T2(t1)\n    fmt.Println(c1, c2)\n    t1 = T1(c2)\n    t2 = T2(c1)\n    fmt.Println(t1, t2)\n}\n\nOutput:\nT1 T2\nT1 T2\nT1 T2"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Differences between Go and Cython\n\nQuestion:\nToday a great friend of mine asked me what are the main differences between the newest Go language and Cython, which is a set of C-extensions for Python. I don't have much knowledge on Python, can anyone tell me why Go is better/worse than Cython?", "output": "Cython isn't really a language in the conventional sense. It is a preprocessor for building Python extensions that takes Python-like syntax (actually they strive for full Python compatibility) and produces C code (using the Python C API). Doing this they are able to include some special case optimisations, but the real benefits come when you add Cython specific static type information which is incorporated into the C code, bypassing the Python runtime for those operations and resulting in a high speed up. \nGo is a compiled programming language. The first thing that can be done in Go is producing an executable that doesn't include the Python runtime/start a Python interpreter - this is impossible in Cython. (May not be technically impossible - but there is really no point to use Cython if you are not working with Python). Since Cython just produces C most of your questions in the comment don't really apply - you can use any C debugger (although the fact that's a Python extension makes things a bit more complicated)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to implement inter-process communication in Go?\n\nQuestion:\nI’m writing a load balanced server system in Go.\nThe load balancing server will communicate with several application servers and process requests. These servers can both, be running on the same machine or on the network.\nI already figured the networking out but now I need to find an optimal way for the load-balancer to communicate with a local application server. Using localhost-networking seems far from optimal.\nI’m trying to share memory via the shmget and shmat system-calls but haven’t found any working examples and the syscall package is also completely undocumented.\nCan someone provide me with an example of how to use these calls or a realistic alternative that works on Go for doing IPC?", "output": "Go has a built-in RPC system (http://golang.org/pkg/rpc/) for easy communication between Go processes.\nAnother option is to send gob-encoded data (http://blog.golang.org/2011/03/gobs-of-data.html) via network connection.\nYou shouldn't dismiss local networking without benchmarking. For example Chrome uses named pipes for IPC and they transfer a lot of data (e.g. rendered bitmaps) between processes:\n\nOur main inter-process communication primitive is the named pipe. On\n  Linux & OS X, we use a socketpair()\n\n-- http://www.chromium.org/developers/design-documents/inter-process-communication \nIf named pipes are good enough for that, they are probably good enough for your use case. Plus, if you write things well, you could start using named pipes (because it's easy) and then switch to shared memory if you find performance of named pipes not good enough (shared memory is not easy regardless of the language)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: reading json data from a file\n\nQuestion:\nI am running a server with Go programming language, and when I load the server in the browser, the temp handler function is called and the getjson.html file is served by this temp Handler function. Now the screen shows a \"Get Json Data\" button. On clicking this button, I am not getting any results (as something should be displayed on the screen).\nI checked the javascript console and there are no errors as such. \nI am not able to figure out what the problem is, why isn't there any output on the screen.\nContents of servejson.go : \npackage main\n\nimport (\n    \"http\"\n    \"flag\"\n)\n\nvar path = flag.String(\"root\", \"/home/chinmay/work/json/getjson.html\", \"Set root directory, use absolute path\")\n\nfunc temp(w http.ResponseWriter, r *http.Request){\n    w.Header().Set(\"Content-Type\", \"text/html\")\n    http.ServeFile(w,r,*path)\n}\n\nfunc main(){\n    http.HandleFunc(\"/\",temp)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nContents of getjson.html : \npackage main\n\nimport (\n    \"http\"\n    \"flag\"\n)\n\nvar path = flag.String(\"root\", \"/home/chinmay/work/json/getjson.html\", \"Set root directory, use absolute path\")\n\nfunc temp(w http.ResponseWriter, r *http.Request){\n    w.Header().Set(\"Content-Type\", \"text/html\")\n    http.ServeFile(w,r,*path)\n}\n\nfunc main(){\n    http.HandleFunc(\"/\",temp)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nContents of json_data.js:\n{ \n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\",\n  \"age\": 25\n}", "output": "Yes, you can. Live example. Provided that json.txt is a resource next to the document in which this code is running, and (on some browsers) provided this is not running from a local file (e.g., a file:// URL rather than an http:// one; some browsers are okay with local files accessing other local files via ajax, others are not).\nA couple of notes:\n\nIn the\n$(\"div\").append(field + \" \");\n\nline, field will be the value of each property (e.g., \"John\").\nThe order in which the properties are listed is completely undefined.\n\nSo for this specific example, you'd probably be better off with\n<script type=\"text/javascript\">\n$(document).ready(function(){\n  $(\"button\").click(function(){\n    $.getJSON(\"json.txt\",function(result){\n      $(\"div\").append(result.firstName + \" \" + result.lastName + \" \" + result.age);\n    });\n  });\n});\n</script>\n\nLive example\n\nUpdate: From your comments on another answer, it seems like you might be unclear on where and how the script code is running. The JavaScript script runs on the client's browser. The path to use to reference json.txt is exactly like (say) the path to an image you want to show on a page. json.txt must be accessible via the web server, just like an image would need to be accessible via the web server. Think of json.txt as just another resource used by your web page, like any other. In terms of the path, and how you have to make json.txt available, the same rules apply. To be clear: Script running client-side in a web page cannot access a server-side file that can't be retrieved by the browser.\n\nUpdate 2: You've posted more code, and it looks like you've made your server only serve the getjson.html file. Your server also has to serve the json.txt file, or the browser can't access it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go web server : cannot find anything on http://localhost:8080/handler\n\nQuestion:\nI am trying to learn web programming with Go.\nI stared out with a simple \"hello world\" web server:\npackage main\n\nimport \"fmt\"\nimport \"net/http\"\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hello, world\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nAnd when I go to\nhttp://localhost:8080/handler    \n\nin the browser, the browser can´t seem to find anything and nothing happens. What could be the reason for this?", "output": "You mapped your handler to the root (\"/\") of your server.\nCall it like this in your browser \nhttp://localhost:8080/\n\nIf you want to map a service to a specific name you can do this :\nhttp.HandleFunc(\"/something\", handler)\n\nThen you would type this in your browser :\nhttp://localhost:8080/something"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Poor regular expressions in Go\n\nQuestion:\nWhy does the regexp package in Go no support decent regexp? For example the character classes \\w and \\s are not implemented as of Go r60.3. Also (?:non) capturing groups are not recognized.", "output": "Use the \"current state of art\" regexp package.\nIt has support for \\w and \\s and also handles non capturing groups (?:re)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Merge standalone webapp and GAE in Go\n\nQuestion:\nI'm working on a very simple web app, written in Go language.\nI have a standalone version and now port it to GAE. It seems like there is very small changes, mainly concerning datastore API (in the standalone version I need just files).\nI also need to include appengine packages and use init() instead of main().\nIs there any simple way to merge both versions? As there is no preprocessor in Go, it seems like I must write a GAE-compatible API for the standalone version and use this mock module for standalone build and use real API for GAE version. But it sounds like an overkill to me.\nAnother problem is that GAE might be using older Go version (e.g. now recent Go release uses new template package, but GAE uses older one, and they are incompatible). So, is there any change to handle such differences at build time or on runtime?\nThanks,\nSerge\nUPD: Now GAE uses the same Go version (r60), as the stable standalone compiler, so the abstraction level is really simple now.", "output": "In broad terms, use abstraction. Provide interfaces for persistence, and write two implementations for that, one based on the datastore, and one based on local files. Then, write a separate main/init module for each platform, which instantiates the appropriate persistence interface, and passes it to your main application to use."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE GO - html templates and data safety\n\nQuestion:\nWhen displaying a webpage through the use of html templates in Google App Engine Go application, does the passed data and/or raw template ever leave the App Engine, or just the final html output? For example, if I have a class\ntype Foo struct{\n    Public string\n    Secret string\n}\n\nand a template that only uses {{.Public}} argument, does the {{.Secret}} argument ever leave the App? Similarly, if there is a template that displays some special data if the {{.Secret}} argument is present through the use of {{if .Secret}}...{{end}}, is there any way to access that part of the html in any way when the {{.Secret}} argument is not present?", "output": "It's your Go program that parses the template. This can take place on several GAE server instances. Assuming that leaving GAE means being sent over an HTTP/S connection over the public internet, then no - the output you send is the parsed HTML template.\nIt's not possible to access the part after {{if .Secret}} if it's not included in the final HTML that the client receives.\nWhat you could do, however, would be to send the template and it's associated dataset encoded as gob or JSON over to your client, and let your client parse the template."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I define which library to use on Mac OS X?\n\nQuestion:\nI'm having trouble getting a program to work, and I have a feeling it is because Mac OS X has decided to use the wrong library. I want it to use SDL_image, but I think its choosing to use SDL-1.2 instead. Is there a way to force it to use SDL_image? If it helps at all, I'm trying to run a program written in the Go program language.\nI've tried modifying the DYLD_LIBRARY_PATH variable because I suspect dyld might have something to do with it, but it didn't work. Everything else I've found relating to the problem is just error logs that say nothing about how to fix it.\nobjc[96907]: Class SDLTranslatorResponder is implemented in both /opt/local/lib/libSDL-1.2.0.dylib and /usr/local/lib/libSDL-1.3.0.dylib. One of the two will be used. Which one is undefined.\nobjc[96907]: Class SDLTranslatorResponder is implemented in both /opt/local/lib/libSDL-1.2.0.dylib and /usr/local/lib/libSDL_ttf-2.0.0.dylib. One of the two will be used. Which one is undefined.\nobjc[96907]: Class SDL_QuartzView is implemented in both /opt/local/lib/libSDL-1.2.0.dylib and /usr/local/lib/libSDL_ttf-2.0.0.dylib. One of the two will be used. Which one is undefined.\nobjc[96907]: Class SDL_QuartzWindowDelegate is implemented in both /opt/local/lib/libSDL-1.2.0.dylib and /usr/local/lib/libSDL_ttf-2.0.0.dylib. One of the two will be used. Which one is undefined.\nobjc[96907]: Class SDL_QuartzWindow is implemented in both /opt/local/lib/libSDL-1.2.0.dylib and /usr/local/lib/libSDL_ttf-2.0.0.dylib. One of the two will be used. Which one is undefined.\nobjc[96907]: Class SDLTranslatorResponder is implemented in both /opt/local/lib/libSDL-1.2.0.dylib and /usr/local/lib/libSDL_image-1.2.0.dylib. One of the two will be used. Which one is undefined.\nobjc[96907]: Class SDL_QuartzView is implemented in both /opt/local/lib/libSDL-1.2.0.dylib and /usr/local/lib/libSDL_image-1.2.0.dylib. One of the two will be used. Which one is undefined.\nobjc[96907]: Class SDL_QuartzWindowDelegate is implemented in both /opt/local/lib/libSDL-1.2.0.dylib and /usr/local/lib/libSDL_image-1.2.0.dylib. One of the two will be used. Which one is undefined.\nobjc[96907]: Class SDL_QuartzWindow is implemented in both /opt/local/lib/libSDL-1.2.0.dylib and /usr/local/lib/libSDL_image-1.2.0.dylib. One of the two will be used. Which one is undefined.", "output": "Have you tried using install_name_tool -change on your executable to make the library references have absolute path?\nYou could also try using install_name_tool to change the rpath for the executable and remove /opt/local if it is there. Or if there is no rpath you could try adding /usr/local/lib and -change the library references to use @rpath/ (see \"man dyld\" and \"man install_name_tool\")\nYou could also switch from MacPorts to Homebrew then all your open-source software lives under /usr/local and you don't get into this sort of problem."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What are pointers to pointers good for?\n\nQuestion:\nIn the Go programming language; how can pointers to pointers become useful?\n(Why are they not illegal if they are not really useful?)", "output": "The usefulness of any data type depends on the problem being solved and on the method used to solve the problem. If a data type does not fit the problem, it simply does not fit the problem - and there is nothing more to it.\nThe Go programming language (as well as most other programming languages) is based on simple rules that the programmer can use to build new data types. Some of these rules are:\n\n*T: create a new data type that is a pointer to T\n[10]T: an array of Ts\nstruct { t T; u U ... }: a structure which contains a T as a component\n...\n\nThe programmer can create complex data types by composing these simple rules. The total number of possible data types exceeds the number of useful data types. Clearly, there exist (and have to exist) data types which aren't useful at all. This is just a natural consequence of the fact that the rules for building new data types are simple.\nThe type **T falls into the category of types which are less probable to appear in a program. The fact that it is possible to write *****T doesn't imply that such a type has to be immensely useful.\n\nAnd finally, the answer to your question:\nThe type **T usually appears in contexts where we want to redirect users of a value of type T to another value of type T, but for some reason we do not have access to all users of the value or finding the users would cost too much time:\n\nWe do not want to copy values of type T (for some reason)\nWe want all users of a value of type T to access the value via a pointer\nWe want to quickly redirect all users of a particular value of type T to another value\n\nIn such a situation, using **T is natural because it allows us to implement the 3rd step in O(1):\ntype User_of_T struct {\n  Value **T\n}\n\n// Redirect all users of a particular value of type T\n// to another value of type T.\nfunc (u *User_of_T) Redirect(t *T) {\n  *(u.Value) = t\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Pass arguments into HandlerFunc\n\nQuestion:\nI am trying to use the svgo package to plot points on an svg file and display that using the web browser. From looking at the net/http documetation, I don't know how I could pass arguments into my svgWeb function.\nThe example below compiles and displays a triangle and a line in my web-browser, but what I would really like to do is plot xpts and ypts using the Polyline method. How can I pass the appropriate arguments or restructure this example to accomplish that task?\npackage main\n\nimport (\n    \"github.com/ajstarks/svgo\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc svgWeb(w http.ResponseWriter, req *http.Request) {\n    w.Header().Set(\"Content-Type\", \"image/svg+xml\")\n\n    xpts := []int{1, 200, 5}\n    ypts := []int{200, 400, 300}\n    s := svg.New(w)\n    s.Start(500, 500)\n    s.Line(5, 10, 400, 400, \"stroke:black\")\n    s.Polyline(xpts, ypts, \"stroke:black\")\n    s.End()\n}\n\n//// Main Program function\n//////////////////////////////\n\nfunc main() {\n\n    xpts := []int{}\n    ypts := []int{}\n\n    for i := 0; i < 100; i++ {\n        xpts = append(xpts, i)\n        xpts = append(ypts, i+5)\n    }\n\n    http.Handle(\"/economy\", http.HandlerFunc(svgWeb))\n    err := http.ListenAndServe(\":2003\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe:\", err)\n    }\n}", "output": "If your arguments are meant to be supplied by the client, then they should be passed to your handler via the http.Request.\nBut if what you are trying to do is to drive your svgWeb handler by points that are not supplied by the client request, but rather by some other functions in your application generating these values internally, then one way would be to structure your handler into a struct and use member attributes.\nThe struct may look like this:\ntype SvgManager struct {\n    Xpts, Ypts []int\n}\n\nfunc (m *SvgManager) SvgWeb(w http.ResponseWriter, req *http.Request) {\n    w.Header().Set(\"Content-Type\", \"image/svg+xml\")\n\n    s := svg.New(w)\n    s.Start(500, 500)\n    s.Line(5, 10, 400, 400, \"stroke:black\")\n    s.Polyline(m.Xpts, m.Ypts, \"stroke:black\")\n    s.End()\n}\n\nThen in your main:\nmanager := new(SvgManager)\n\nfor i := 0; i < 100; i++ {\n    manager.Xpts = append(manager.Xpts, i)\n    manager.Ypts = append(manager.Ypts, i+5)\n}\n\n// I only did this assignment to make the SO display shorter in width.\n// Could have put it directly in the http.Handle()\nhandler := http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) { \n    manager.SvgWeb(w, req) \n})\nhttp.Handle(\"/economy\", handler)\n\nNow you have an SvgManager instance that could contain other handlers as well, and can be updated to affect the output of their handlers.\nSatisfying the Handler interface\nAs mentioned by @Atom in the comments, you could completely avoid the closure and the wrapper by simply renaming your method to ServeHTTP. This would satisfy the Handler interface\nfunc (m *SvgManager) ServeHTTP(w http.ResponseWriter, req *http.Request) {\n    ...\n\nmanager := new(SvgManager)\nhttp.Handle(\"/economy\", manager)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Simultaneous assignment in Go\n\nQuestion:\nI'm learning Go and can't understand one thing, why creators of this language do support simultaneous assignment? It is very easy to make mistakes like a, b = a, b and not a, b = b, a, as I would want, thanks in advance for any good explanations.", "output": "It is very easy to make mistakes like a, b = a, b and not a, b = b, a,\n\nIf simultaneous assignment were not available then you would have to do something else instead. An alternative approach might look something like this:\ntmp = a\na = b\nb = tmp\n\nThat's much easier to get wrong."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: fmt.Sprintf passing an array of arguments\n\nQuestion:\nSorry for the basic question. I'd like to pass a slice as arguments to fmt.Sprintf. Something like this:\nvalues := []string{\"foo\", \"bar\", \"baz\"}\nresult := fmt.Sprintf(\"%s%s%s\", values...)\n\nAnd the result would be foobarbaz, but this obviously doesn't work.\n(the string I want to format is more complicated than that, so a simple concatenation won't do it :)\nSo the question is: if I have am array, how can I pass it as separated arguments to fmt.Sprintf? Or: can I call a function passing an list of arguments in Go?", "output": "As you found out on IRC, this will work:\nvalues := []interface{}{\"foo\", \"bar\", \"baz\"}\nresult := fmt.Sprintf(\"%s%s%s\", values...)\n\nYour original code doesn't work because fmt.Sprintf accepts a []interface{} and []string can't be converted to that type, implicitly or explicitly."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to use C++ in Go\n\nQuestion:\nIn the new Go language, how do I call C++ code? In other words, how can I wrap my C++ classes and use them in Go?", "output": "Update: I've succeeded in linking a small test C++ class with Go\nIf you wrap you C++ code with a C interface you should be able to call your library with cgo (see the example of gmp in $GOROOT/misc/cgo/gmp). \nI'm not sure if the idea of a class in C++ is really expressible in Go, as it doesn't have inheritance.\nHere's an example:\nI have a C++ class defined as:\n// foo.hpp\nclass cxxFoo {\npublic:\n  int a;\n  cxxFoo(int _a):a(_a){};\n  ~cxxFoo(){};\n  void Bar();\n};\n\n// foo.cpp\n#include <iostream>\n#include \"foo.hpp\"\nvoid\ncxxFoo::Bar(void){\n  std::cout<<this->a<<std::endl;\n}\n\nwhich I want to use in Go. I'll use the C interface\n// foo.h\n#ifdef __cplusplus\nextern \"C\" {\n#endif\n  typedef void* Foo;\n  Foo FooInit(void);\n  void FooFree(Foo);\n  void FooBar(Foo);\n#ifdef __cplusplus\n}\n#endif\n\n(I use a void* instead of a C struct so the compiler knows the size of Foo)\nThe implementation is:\n//cfoo.cpp\n#include \"foo.hpp\"\n#include \"foo.h\"\nFoo FooInit()\n{\n  cxxFoo * ret = new cxxFoo(1);\n  return (void*)ret;\n}\nvoid FooFree(Foo f)\n{\n  cxxFoo * foo = (cxxFoo*)f;\n  delete foo;\n}\nvoid FooBar(Foo f)\n{\n  cxxFoo * foo = (cxxFoo*)f;\n  foo->Bar();\n}\n\nwith all that done, the Go file is:\n// foo.go\npackage foo\n// #include \"foo.h\"\nimport \"C\"\nimport \"unsafe\"\ntype GoFoo struct {\n     foo C.Foo;\n}\nfunc New()(GoFoo){\n     var ret GoFoo;\n     ret.foo = C.FooInit();\n     return ret;\n}\nfunc (f GoFoo)Free(){\n     C.FooFree(unsafe.Pointer(f.foo));\n}\nfunc (f GoFoo)Bar(){\n     C.FooBar(unsafe.Pointer(f.foo));\n}\n\nThe makefile I used to compile this was:\n// makefile\nTARG=foo\nCGOFILES=foo.go\ninclude $(GOROOT)/src/Make.$(GOARCH)\ninclude $(GOROOT)/src/Make.pkg\nfoo.o:foo.cpp\n    g++ $(_CGO_CFLAGS_$(GOARCH)) -fPIC -O2 -o $@ -c $(CGO_CFLAGS) $<\ncfoo.o:cfoo.cpp\n    g++ $(_CGO_CFLAGS_$(GOARCH)) -fPIC -O2 -o $@ -c $(CGO_CFLAGS) $<\nCGO_LDFLAGS+=-lstdc++\n$(elem)_foo.so: foo.cgo4.o foo.o cfoo.o\n    gcc $(_CGO_CFLAGS_$(GOARCH)) $(_CGO_LDFLAGS_$(GOOS)) -o $@ $^ $(CGO_LDFLAGS)\n\nTry testing it with:\n// foo_test.go\npackage foo\nimport \"testing\"\nfunc TestFoo(t *testing.T){\n    foo := New();\n    foo.Bar();\n    foo.Free();\n}\n\nYou'll need to install the shared library with make install, then run make test. Expected output is:\ngotest\nrm -f _test/foo.a _gotest_.6\n6g -o _gotest_.6 foo.cgo1.go foo.cgo2.go foo_test.go\nrm -f _test/foo.a\ngopack grc _test/foo.a _gotest_.6  foo.cgo3.6\n1\nPASS"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: manual compiling doozerd fails\n\nQuestion:\nI installed doozerd sources in:\nhome/stephan/src/go/src/pkg/github.com/ha/doozerd\n\n$GOROOT = /home/stephan/src/go\n$GOPATH = /home/stephan/src/go/src/pkg/\nWhen I try to do ./all.sh in the doozerd checkout from github I get package could not be found locally errors.. :\n.\n    imports github.com/ha/doozerd/peer\n    imports github.com/ha/doozerd/web\n    imports code.google.com/p/go.net/websocket: /home/stephan/src/go/src/pkg/github.com/ha/doozerd/web/web.go:4:2: package could not be found locally\n.\n    imports github.com/ha/doozerd/peer\n    imports github.com/ha/doozerd/consensus\n    imports code.google.com/p/goprotobuf/proto: /home/stephan/src/go/src/pkg/github.com/ha/doozerd/server/conn.go:4:2: package could not be found locally\n.\n    imports github.com/ha/doozer: /home/stephan/src/go/src/pkg/github.com/ha/doozerd/peer/peer.go:4:2: package could not be found locally\n\nI thought go would find the missing requirements, and install them itself.\nWhat am I missing?", "output": "$GOPATH =\n/home/stephan/src/go/src/pkg/ means the go tool looks for packages in \n/home/stephan/src/go/src/pkg/src/<import-path>, but you've put the sources in /home/stephan/src/go/src/pkg/github.com/ha/doozerd instead."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Send stdin keystrokes to channel without newline required\n\nQuestion:\nI'd like to send the user's keystrokes to a channel directly after each individual keystroke is made to stdin. \nI've attempted the code below, but this doesn't give the desired result because the reader.ReadByte() method blocks until newline is entered.\nfunc chars() <-chan byte {\n    ch := make(chan byte)\n    reader := bufio.NewReader(os.Stdin)\n    go func() {\n        for {           \n            char, err := reader.ReadByte()\n            if err != nil {\n                log.Fatal(err)\n            }\n            ch <- char\n        }\n    }()\n    return ch\n}\n\nThank you for any advice on how might I get each user input character to go immediately to the channel without the need for a newline character.", "output": "Stdin is line-buffered by default. This means it will not yield any input to you, until a newline is encountered. This is not a Go specific thing.\nHaving it behave in a non-buffered way is highly platform specific. As Rami suggested, ncurses is a way to do it. Another option is the much lighter go-termbox package.\nIf you want to do it all manually (on Linux at least), you can look at writing C bindings for termios or do syscalls directly in Go.\nHow platforms like Windows handle this, I do not know. You can dig into the source code for ncurses or termbox to see how they did it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: extracting directory hierarchy using go language\n\nQuestion:\nI'm trying to extract the directory hierarchy of a folder into a datastructure in go language. filepath.Walk seems to be the way to go but all I can do so far is to print the names of files and folders. Here's what I'm using:\nfunc main() {\n    visit := func(path string, info os.FileInfo, err error) error {\n        if info.IsDir() {\n            fmt.Println(\"dir:  \", path)\n        } else {\n            fmt.Println(\"file: \", path)\n        }\n        return nil\n    }\n\n    err := filepath.Walk(\"./\", visit)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nthis prints the names of folders like:\ndir:   folder1\nfile:  folder1/file1.txt\nfile:  folder1/file2.txt\nfile:  folder1/file3.txt\nfile:  folder1/file4.txt\ndir:   folder1/folder2\nfile:  folder1/folder2/file5.txt\nfile:  folder1/folder2/file6.txt\nfile:  folder1/folder2/file7.txt\nfile:  folder1/folder2/file8.txt\nfile:  folder1/folder2/file9.txt\n\nfor tree structure I thought about using something like:\ntype File struct {\n    Name string\n    Content string\n}\n\ntype Folder struct {\n    Name    string\n    Files   []File\n    Folders []Folder\n}\n\nbut of course any suggestions are welcomed.\nHow can I convert this to a tree structure in go? Is there an easier way to do this?", "output": "AFAIK there is nothing ready-made for this in the Go standard lib.\nTree structures lend themselves well to a recursive approach. I defined addFile and addFolder methods on your File and Folder types. Starting with a root folder, you can then call these methods in Walk. If you get a/b/c, we'll be calling root.addFile(a, b, c), a.addFile(b, c), b.addFile(c).\nI also changed Folder.Folders to a map, because filepath.Walk always gives us full paths, so we can split those and look up their components in the folder map.\nHere is some quick and dirty code that probably has bugs and doesn't do full error checking. It only works for the current directory, but that should be easy to fix.\nI also added a String() method on Folder, which is recognized by the compiler and will be used when printing out instances of the type.\npackage main\n\nimport (\n    \"log\"\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n)\n\ntype File struct {\n    Name string\n}\n\ntype Folder struct {\n    Name    string\n    Files   []File\n    Folders map[string]*Folder\n}\n\nfunc newFolder(name string) *Folder {\n    return &Folder{name, []File{}, make(map[string]*Folder)}\n}\n\nfunc (f *Folder) getFolder(name string) *Folder {\n    if nextF, ok := f.Folders[name]; ok {\n        return nextF\n    } else {\n        log.Fatalf(\"Expected nested folder %v in %v\\n\", name, f.Name)\n    }\n    return &Folder{} // cannot happen\n}\n\nfunc (f *Folder) addFolder(path []string) {\n    for i, segment := range path {\n        if i == len(path)-1 { // last segment == new folder\n            f.Folders[segment] = newFolder(segment)\n        } else {\n            f.getFolder(segment).addFolder(path[1:])\n        }\n    }\n}\n\nfunc (f *Folder) addFile(path []string) {\n    for i, segment := range path {\n        if i == len(path)-1 { // last segment == file\n            f.Files = append(f.Files, File{segment})\n        } else {\n            f.getFolder(segment).addFile(path[1:])\n            return\n        }\n    }\n}\n\nfunc (f *Folder) String() string {\n    var str string\n    for _, file := range f.Files {\n        str += f.Name + string(filepath.Separator) + file.Name + \"\\n\"\n    }\n    for _, folder := range f.Folders {\n        str += folder.String()\n    }\n    return str\n}\n\nfunc main() {\n    startPath := \".\"\n    rootFolder := newFolder(startPath)\n\n    visit := func(path string, info os.FileInfo, err error) error {\n        segments := strings.Split(path, string(filepath.Separator))\n        if info.IsDir() {\n            if path != startPath {\n                rootFolder.addFolder(segments)\n            }\n        } else {\n            rootFolder.addFile(segments)\n        }\n        return nil\n    }\n\n    err := filepath.Walk(startPath, visit)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    log.Printf(\"%v\\n\", rootFolder)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to loop through a UTF-8 string in Go?\n\nQuestion:\nI have a string in Chinese:\nx = \"你好\"\n\nI'd like to loop through it and do something with each character in it, something like:\nfor i, len := 0, len(x); i < len; i++ {\n    foo( x[i] ) // do sth.\n}\n\nI found that len(x) would return 6 instead of 2, after Google I found the method RuneCountInString which would return the real length of the string, but I still don't know how to loop to make x[i] get the right character, x[0] == '你' for example..\nThanks", "output": "Use range.\nx = \"你好\"\nfor _, c := range x {\n    // do something with c\n}\n\nIf you want random-access, you'll need to use code unit indexes rather than character indexes.  Fortunately, there is no good reason to need character indexes, so code unit indexes are fine.\nMost languages have the exact same problem.  For example, Java and C# use UTF-16, which is also a variable-length encoding (but some people pretend it isn't).\nSee the UTF-8 Manifesto for more information about why Go uses UTF-8."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What's Go's equivalent of argv[0]?\n\nQuestion:\nHow can I get my own program's name at runtime? What's Go's equivalent of C/C++'s argv[0]? To me it is useful to generate the usage with the right name.\nUpdate: added some code.\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc usage() {\n    fmt.Fprintf(os.Stderr, \"usage: myprog [inputfile]\\n\")\n    flag.PrintDefaults()\n    os.Exit(2)\n}\n\nfunc main() {\n    flag.Usage = usage\n    flag.Parse()\n\n    args := flag.Args()\n    if len(args) < 1 {\n        fmt.Println(\"Input file is missing.\");\n        os.Exit(1);\n    }\n    fmt.Printf(\"opening %s\\n\", args[0]);\n    // ...\n}", "output": "import \"os\"\nos.Args[0] // name of the command that it is running as\nos.Args[1] // first command line parameter, ...\n\nArguments are exposed in the os package http://golang.org/pkg/os/#Variables\nIf you're going to do argument handling, the flag package http://golang.org/pkg/flag is the preferred way. Specifically for your case flag.Usage\nUpdate for the example you gave:\nfunc usage() {\n    fmt.Fprintf(os.Stderr, \"usage: %s [inputfile]\\n\", os.Args[0])\n    flag.PrintDefaults()\n    os.Exit(2)\n}\n\nshould do the trick"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What web server do you use with Go for web service?\n\nQuestion:\nIf I wanted to create a web service using Go, what web server would I be using?\nMy web service needs to interact with Mysql, redis and memcached.  Are there stable libraries for each?", "output": "The net/http package in the standard library is stable and concurrent (goroutine per client).\nhttp.Handle(\"/foo\", fooHandler)\n\nhttp.HandleFunc(\"/bar\", func(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello, %q\", html.EscapeString(r.URL.Path))\n})\n\nlog.Fatal(http.ListenAndServe(\":8080\", nil))\n\nAfter reading Writing Web Applications you will have the necessary skills to write idiomatic web applications in Go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I declare an array(or equivalent) in Go\n\nQuestion:\nI want to do something like(it's valid)\nvar myArray [9][3]int\n\nbut when I do\nvar myArray [someIntVariable][anotherOne]int\n\nIt can't be used(I know why, so I'm not asking this.)\nBut is there any alternative to make this work?\nSorry for my bad English.", "output": "Does the following work for you?\nfunc make2dArray(m, n int) [][]int { \n   myArray := make([][]int, m) \n   for i := range myArray { \n      myArray[i] = make([]int, n) \n   } \n   return myArray \n} \n\nvar myArray := make2dArray(someIntVariable, anotherOne)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Setting up a Mercurial Repository for Go Packages\n\nQuestion:\nI am struggling to setup a local Mercurial repository for go packages.\nAll mercurial package directories can are under the following url:\nhttps://server.example.com/go-packages/\n\nI can clone a package via:\nhg clone https://server.example.com/go-packages/packagename\n\nThat works fine.\nWhen I want to install the package with the go command line:\ngo get server.example.com/go-packages/packagename\n\nI get the following error:\npackage server.example.com/go-packages/packagename: unrecognized import path \"server.example.com/go-packages/packagename\"\n\nBut when I do it as explained in http://golang.org/cmd/go/ :\ngo get server.example.com/go-packages/packagename.hg\n\nIt works perfectly. \nIn the above document they talk about a <meta> flag. So I created a index.html with the following entry:\n<html>\n    <head>\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n        <meta name=\"go-import\" content=\"import-prefix hg repo-root\">\n        <title>packagename</title>\n    </head>\n    <body>\n        <h1>packagename</h1>\n    </body>\n</html>\n\nUpdate:\nWhen I do a wget -O- https://server.example.com/go-packages/packagename/?go-get=1  --no-check-certificate I get:\n!DOCTYPE HTML>\n<html>\n    <head>\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n        <meta name=\"go-import\" content=\"import-prefix hg repo-root\">\n        <title>packagename</title>\n    </head>\n    <body>\n        <h1>packagename</h1>\n    </body>\n</html>\n\nUpdate 2\nI saw, that my content was wrong (copy paste error) now I changed it to:\n<html>\n    <head>\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n        <meta name=\"go-import\" content=\"server.example.com/go-packages/packagename hg https://server.example.com/go-packages/packagename\" />\n        <title>packagename</title>\n    </head>\n    <body>\n        <h1>packagename</h1>\n    </body>\n</html>\n\nWhere go-packages is a directory containing the mercurial repository packagename.\nBut still go get server.example.com/go-packages/packagename is not working.", "output": "After looking at this issue (and attached code review), and this thread:\n\nmake sure your \"import-prefix hg repo-root\" follows the right format\n\nThe import-alias-prefix must be a prefix or exact match of the\npackage being fetched with \"go get\".\nThe full-repo-root must be a full URL root to a repository containing\na scheme and not containing a \".vcs\" qualifier.\nThe vcs is one of \"git\", \"hg\", \"svn\", etc.\n\nmake sure the page fetch from https://<import>?go-get=1  is indeed you index.html page (not index.htm or any other DirectoryIndex directive, if this is setup in an httpd.conf file for instance)\n\n\nIf the import-alias-prefix is not an exact match for the import,\n  another HTTP fetch is performed, at the declared root (which does\n  not need to be the domain's root).\nFor example, assuming that \"camlistore.org/pkg/blobref\" declares\n  in its HTML head:\n<meta name=\"go-import\" content=\"camlistore.org git https://camlistore.org/r/p/camlistore\" />\n\n... then:\n$ go get camlistore.org/pkg/blobref\n\n... looks at the following URLs:\nhttps://camlistore.org/pkg/blobref?go-get=1\nhttp://camlistore.org/pkg/blobref?go-get=1\nhttps://camlistore.org/?go-get=1\nhttp://camlistore.org/?go-get=1\n\nUltimately it finds, at the root (camlistore.org/), the same go-import:\n<meta name=\"go-import\" content=\"camlistore.org git https://camlistore.org/r/p/camlistore\" />\n\n... and proceeds to trust it, checking out git //camlistore.org/r/p/camlistore\n  at the import path of \"camlistore.org\" on disk."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a comparison between Scala and Google 'Go' language (feature by feature)?\n\nQuestion:\nI wonder if someone can produce a comparison between Scala and Google 'Go' language (feature by feature, like concurrency models, collections, etc.)?", "output": "Better compare it to C (or C++ or D).\nAs far as I do understand the intent of this language is to replace C/C++ not Java/Scala (VM languages). Go has no exceptions, assertions, inheritance. This is only bearable for C programmers.\nI would like to see the new parts not present in other languages (or newly combined in Go). Especially how programs should be designed with the minimalistic type system."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Wildcards in the pattern for http.HandleFunc\n\nQuestion:\nWhen registering handlers in Go (language) is there any way to specify wildcards in the pattern?\nFor example:\nhttp.HandleFunc(\"/groups/*/people\", peopleInGroupHandler)\n\nWhere the * could be any valid URL string.  Or is the only solution to match /groups and figure the rest out from within the handler (peopleInGroupHandler) func?", "output": "The patterns for http.Handler and http.HandleFunc aren't regular expressions or globs. There isn't a way to specify wildcards. They're documented here.\nThat said, it's not too hard to create your own handler that can use regular expressions or any other kind of pattern you want. Here's one that uses regular expressions (compiled, but not tested):\ntype route struct {\n    pattern *regexp.Regexp\n    handler http.Handler\n}\n\ntype RegexpHandler struct {\n    routes []*route\n}\n\nfunc (h *RegexpHandler) Handler(pattern *regexp.Regexp, handler http.Handler) {\n    h.routes = append(h.routes, &route{pattern, handler})\n}\n\nfunc (h *RegexpHandler) HandleFunc(pattern *regexp.Regexp, handler func(http.ResponseWriter, *http.Request)) {\n    h.routes = append(h.routes, &route{pattern, http.HandlerFunc(handler)})\n}\n\nfunc (h *RegexpHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    for _, route := range h.routes {\n        if route.pattern.MatchString(r.URL.Path) {\n            route.handler.ServeHTTP(w, r)\n            return\n        }\n    }\n    // no pattern matched; send 404 response\n    http.NotFound(w, r)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Multiple return types with interface{} and type assertions (in Go)\n\nQuestion:\nI'm wondering what the correct syntax is for calling functions with multiple return values, one (or more) of which is of type interface{}.\nA function which returns interface{} can be called like this:\nfoobar, ok := myfunc().(string)\nif ok { fmt.Println(foobar) }\n\nbut the following code fails with the error multiple-value foobar() in single-value context:\nfunc foobar()(interface{}, string) {\n    return \"foo\", \"bar\"\n}\n\n\nfunc main() {\n    a, b, ok := foobar().(string)\n    if ok {\n        fmt.Printf(a + \" \" + b + \"\\n\") // This line fails\n    }\n}\n\nSo, what is the correct calling convention?", "output": "package main\n\nimport \"fmt\"\n\nfunc foobar() (interface{}, string) {\n    return \"foo\", \"bar\"\n}\n\nfunc main() {\n    a, b := foobar()\n    if a, ok := a.(string); ok {\n        fmt.Printf(a + \" \" + b + \"\\n\")\n    }\n}\n\nYou can only apply a type assertion to a single expression."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: http.Handle(Handler or HandlerFunc)\n\nQuestion:\nHow is the following function implemented?\nfunc handle(pattern string, handler interface{}) {\n    // ... what goes here? ...\n    http.Handle(pattern, ?)\n}\n\nhandle(\"/foo\", func(w http.ResponseWriter, r http.Request) { io.WriteString(w, \"foo\") }\nhandle(\"/bar\", BarHandler{})\n\nhandle() is passed either a function which matches the type of http.HandlerFunc or a type which implements the http.Handler interface.", "output": "Instead of resorting to reflection, I would do it this way:\nfunc handle(pattern string, handler interface{}) {\n    var h http.Handler\n    switch handler := handler.(type) {\n    case http.Handler:\n        h = handler\n    case func(http.ResponseWriter, *http.Request):\n        h = http.HandlerFunc(handler)\n    default:\n        // error\n    }\n    http.Handle(pattern, h)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What's wrong with the following go code that I receive 'all goroutines are asleep - deadlock!'\n\nQuestion:\nI'm trying to implement an Observer Pattern suggested here; Observer pattern in Go language\n(the code listed above doesn't compile and is incomplete). Here, is a complete code that compiles but I get deadlock error.\npackage main\n\nimport (\n    \"fmt\"\n)\n\ntype Publisher struct{\n    listeners []chan int\n}\n\ntype Subscriber struct{\n    Channel chan int\n    Name string\n}\n\nfunc (p *Publisher) Sub(c chan int){\n    p.listeners = append(p.listeners, c)\n}\n\nfunc (p *Publisher) Pub(m int, quit chan int){\n    for _, c := range p.listeners{\n        c <- m\n    }\n    quit <- 0\n}\n\nfunc (s *Subscriber) ListenOnChannel(){\n    data := <-s.Channel\n    fmt.Printf(\"Name: %v; Data: %v\\n\", s.Name, data)            \n}\n\nfunc main() {\n    quit := make(chan int)\n    p := &Publisher{}\n    subscribers := []*Subscriber{&Subscriber{Channel: make(chan int), Name: \"1\"}, &Subscriber{Channel: make(chan int), Name: \"2\"}, &Subscriber{Channel: make(chan int), Name: \"3\"}}\n    for _, v := range subscribers{\n        p.Sub(v.Channel)\n        go v.ListenOnChannel() \n    }\n\n    p.Pub(2, quit)\n\n    <-quit              \n}\n\nAlso, if I get rid of 'quit' completely, I get no error but it only prints first record.", "output": "The problem is that you're sending to quit on the same goroutine that's receiving from quit.\nquit has a buffer size of 0, which means that in order to proceed there has to be a sender on one side and a receiver on the other at the same time. You're sending, but no one's on the other end, so you wait forever. In this particular case the Go runtime is able to detect the problem and panic.\nThe reason only the first value is printed when you remove quit is that your main goroutine is exiting before your remaining two are able to print.\nDo not just increase channel buffer sizes to get rid of problems like this. It can help (although in this case it doesn't), but it only covers up the problem and doesn't truly fix the underlying cause. Increasing a channel's buffer size is strictly an optimization. In fact, it's usually better to develop with no buffer because it makes concurrency problems more obvious.\nThere are two ways to fix the problem:\n\nKeep quit, but send 0 on it in each goroutine inside ListenOnChannel. In main, make sure you receive a value from each goroutine before moving on. (In this case, you'll wait for three values.)\nUse a WaitGroup. There's a good example of how it works in the documentation."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Doesn't the fact that Go and Java use User space thread mean that you can't really take advantage of multiple core?\n\nQuestion:\nWe've been talking about threads in my operating system class a lot lately and one question has come to my mind. \nSince Go, (and Java) uses User-space thread instead of kernel threads, doesn't that mean that you can't effectively take advantages of multiple cores since the OS only allocates CPU time to the process and not the threads themselves?\nThis seems to confirm the fact that you can't\nWikipedia also seems to think so", "output": "What makes you think Go uses User-space threads?\nIt doesn't. It uses OS-threads and can take advantage of multiple cores.\nYou might be puzzled by the fact that by default Go only uses 1 thread to run your program. If you start two goroutines they run in one thread. But if one goroutine blocks for I/O Go creates a second thread and continues to run the other goroutine on the new thread.\nIf you really want to unlock the full multi-core power just use the GOMAXPROCS() function.\nruntime.GOMAXPROCS(4); //somewhere in main\nNow your program would use 4 OS-threads (instead of 1) and would be able to fully use a e.g. 4 core system."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Algorithm for finding the color between two others - in the colorspace of painted colors\n\nQuestion:\nWhen mixing blue and yellow paint, the result is some sort of green.\nI have two rgb colors:\nblue = (0, 0, 255)\nand yellow = (255, 255, 0)\nWhat is the algorithm for finding the rgb color that is the result of mixing the two colors, as they would appear when using paint? The resulting colors from the algorithm does not have to be terribly exact. For the example above it would only have to look like some sort of green.\nThanks in advance.\nEdit: This function, written in Go, worked for me, based on the answer from LaC.\nfunc paintMix(c1, c2 image.RGBAColor) image.RGBAColor { \n    r := 255 - ((255 - c1.R) + (255 - c2.R))\n    g := 255 - ((255 - c1.G) + (255 - c2.G))\n    b := 255 - ((255 - c1.B) + (255 - c2.B))\n    return image.RGBAColor{r, g, b, 255}\n}\n\nEdit #2 Allthought this manages to mix cyan and yellow, the mix between blue and yellow becomes black, which doesn't seem right. I'm still looking for a working algorithm.\nEdit #3 The answer from Mark Ransom worked pretty well, using the HLS colorspace. Thanks, Mark Random.\nEdit #4 It seems like the way forward for even better color mixing would be to use the Kubelka-Munk equation", "output": "Paint works by absorption. You start with white light (255,255,255) and multiply it by the absorption factors.\nBlue paint absorbs all red and green light that hits it.\nYellow paint absorbs all blue light that hits it.\nIn a perfect world, that means that combining yellow and blue paint would result in black paint, or at best a muddy gray. In practice the \"blue\" paint has a bias towards green, so you get a muddy green. I've never seen an example of mixing yellow and blue that produces a satisfactory green. Wikipedia goes into some of the complexities of this process: http://en.wikipedia.org/wiki/Primary_color#Subtractive_primaries\nI think what you are really asking is how to interpolate colors along a color wheel. This should be independent of whether the colors are absorptive as in paint, or emissive as in RGB displays.\nEdit: By working in the HSL color space you can get the kind of results you're looking for. Here's some code in Python that implements the algorithm; averaging hues is tricky, and is based on a previous answer of mine for averaging angles.\nfrom colorsys import rgb_to_hls,hls_to_rgb\nfrom math import sin,cos,atan2,pi\n\ndef average_colors(rgb1, rgb2):\n    h1, l1, s1 = rgb_to_hls(rgb1[0]/255., rgb1[1]/255., rgb1[2]/255.)\n    h2, l2, s2 = rgb_to_hls(rgb2[0]/255., rgb2[1]/255., rgb2[2]/255.)\n    s = 0.5 * (s1 + s2)\n    l = 0.5 * (l1 + l2)\n    x = cos(2*pi*h1) + cos(2*pi*h2)\n    y = sin(2*pi*h1) + sin(2*pi*h2)\n    if x != 0.0 or y != 0.0:\n        h = atan2(y, x) / (2*pi)\n    else:\n        h = 0.0\n        s = 0.0\n    r, g, b = hls_to_rgb(h, l, s)\n    return (int(r*255.), int(g*255.), int(b*255.))\n\n>>> average_colors((255,255,0),(0,0,255))\n(0, 255, 111)\n>>> average_colors((255,255,0),(0,255,255))\n(0, 255, 0)\n\nNote that this answer does not emulate paint mixing, for the reasons stated above. Rather it gives an intuitive mixing of colors that is not grounded in any physical world reality."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Exception handling in Google Go language\n\nQuestion:\nI am wondering... I have read about Go some time ago and I tried to program something in it. I seems quite interesting. But I have reached handling \"exceptions\" in this language. I have read about their approach and it seems reasonable. I would like to know what are the advantages of the standard exceptional approach over the Go's style? What are the pros and cons?\nEdit To be straight: I do not want to make any holy war about exceptions. I just wonder if this style of handling errors has any advantages? What are actual advantages of this style over standard exceptions? Is it worth wondering at all?", "output": "panic/recover is moral equivalent of try/catch exceptions. There is superficial difference (syntax) and a subtle, but important, difference of intended use.\nThe best explanations of problems with exceptions in general is \"Cleaner, more elegant, wrong\" and that's a good overview of pros/cons of exceptions vs. returning error codes.\nGo designers decided that error handling by returning error codes from functions is the idiomatic Go way and the language supports multiple return values to make it syntactically easy. While panic/recover is provided, the difference is not of functionality but intended use.\nOther languages exposing exceptions promote their use and in practice they are used frequently (sometimes even misused).\nGo discourages the use of panic/recover. You can do it but you're only supposed to do it in very limited scenarios.\nIf you look at Go's own standard library, most uses of panic are for signaling fatal errors, indicating either an internal error (i.e. bug) in the  library code or calling the library with wrong data (e.g. passing non-json data to json decoding functions).\nBut as the article you linked to points out: \"The convention in the Go libraries is that even when a package uses panic internally, its external API still presents explicit error return values.\"\nThis is different from languages like C#, Java, Python or C++, where a lot of standard library code can throw exceptions to signal errors. Those languages want you to use exceptions. Go discourages the use of panic/recover.\nTo summarize:\n\nidiomatic Go style is to use error codes to tell the caller about errors\nuse panic/recover only in rare cases:\n\n\nto \"crash\" your program when encountering internal inconsistency indicating bugs in your code. It's basically a debugging aid.\nif it dramatically simplifies error handling in your code (but if the code is to be used by others, never expose such panics to callers)\n\n\nIn practice the important thing is to use language's idiomatic style. In Go that's returning error codes and avoiding panic/recover. In C# that's using exceptions to signal some of the errors."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to convert [4]uint8 into uint32 in Go?\n\nQuestion:\nhow to convert go's type from uint8 to unit32?\nJust code:\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    uInt8 := []uint8{0,1,2,3}\n    var uInt32 uint32\n    uInt32 = uint32(uInt8)\n    fmt.Printf(\"%v to %v\\n\", uInt8, uInt32)\n}\n\n~>6g test.go && 6l -o test test.6 && ./test \ntest.go:10: cannot convert uInt8 (type []uint8) to type uint32", "output": "package main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n)\n\nfunc main() {\n    u8 := []uint8{0, 1, 2, 3}\n    u32LE := binary.LittleEndian.Uint32(u8)\n    fmt.Println(\"little-endian:\", u8, \"to\", u32LE)\n    u32BE := binary.BigEndian.Uint32(u8)\n    fmt.Println(\"big-endian:   \", u8, \"to\", u32BE)\n}\n\nOutput:\nlittle-endian: [0 1 2 3] to 50462976\nbig-endian:    [0 1 2 3] to 66051\n\nThe Go binary package functions are implemented as a series of shifts.\nfunc (littleEndian) Uint32(b []byte) uint32 {\n    return uint32(b[0]) | uint32(b[1])<<8 | uint32(b[2])<<16 | uint32(b[3])<<24\n}\n\nfunc (bigEndian) Uint32(b []byte) uint32 {\n    return uint32(b[3]) | uint32(b[2])<<8 | uint32(b[1])<<16 | uint32(b[0])<<24\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the theoretical max number of concurrent (simultaneous) HTTP connections in a Go server?\n\nQuestion:\nWhat is the upper limit on the number of concurrent HTTP connections that a very simple server implemented in Go can handle?", "output": "The number of concurrent HTTP connections is limited by available memory and by operating system limits.\nIn Linux, the soft operating system limits - such as the maximum number of open files - can be printed out and changed by using ulimit.\nIn terms of memory, each HTTP connection in a minimal Go HTTP server running on 32-bit Linux consumes 21 KiB of memory (the source code of this server, compilable with Go version 2013-03-23, is below). On 64-bit Linux, the memory consumption can be expected to be higher.\nOn a 32-bit system with 1GB of memory available to the server, 21 KiB means that about 50,000 simultaneous connections are possible. This does not include memory consumed by the Linux kernel.\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n    \"runtime\"\n    \"sync\"\n)\n\nvar isClient = flag.Bool(\"client\", false, \"Whether to start the HTTP server or the HTTP client\")\nvar N = flag.Int(\"n\", 1000, \"Number of concurrent HTTP requests\")\n\nvar wait = make(chan byte)\nvar counter = 0\nvar reachedN = make(chan byte)\n\nfunc handler(w http.ResponseWriter, req *http.Request) {\n    fmt.Fprintf(w, \"some text\")\n    counter++\n    if counter == *N {\n        reachedN <- 0\n    }\n    <-wait // Block this goroutine\n}\n\nfunc main() {\n    flag.Parse()\n    if *N <= 0 {\n        fmt.Fprintf(os.Stderr, \"invalid number of goroutines\")\n        os.Exit(1)\n    }\n\n    if *isClient {\n        // Initiate N http connections\n        var wg sync.WaitGroup\n        for i := 0; i < *N; i++ {\n            wg.Add(1)\n            go func(ii int) {\n                _, err := http.Get(\"http://127.0.0.1:12345\")\n                if err != nil {\n                    fmt.Fprintf(os.Stderr, \"client %d: %s\\n\", ii, err)\n                    os.Exit(1)\n                }\n                wg.Done()\n            }(i)\n        }\n        wg.Wait()\n    } else {\n        runtime.GOMAXPROCS(1) // No concurrency\n\n        // Read MemStats\n        var m0 runtime.MemStats\n        runtime.ReadMemStats(&m0)\n\n        go func() {\n            <-reachedN // Wait until there are *N concurrent requests\n\n            // Read MemStats\n            var m1 runtime.MemStats\n            runtime.ReadMemStats(&m1)\n\n            fmt.Printf(\"Number of HTTP connections:        %d\\n\", *N)\n            fmt.Printf(\"Memory consumption per connection: %.2f bytes\\n\", float64(m1.Sys-m0.Sys)/float64(*N))\n            os.Exit(1)\n        }()\n\n        http.HandleFunc(\"/\", handler)\n        err := http.ListenAndServe(\":12345\", nil)\n        if err != nil {\n        fmt.Fprintf(os.Stderr, \"server: %s\\n\", err)\n            os.Exit(1)\n        }\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: can't fetch the go language repository on Debian\n\nQuestion:\nI follow the installation guide at http://golang.org/doc/install.html, \nat first everything goes well, but problem comes at the \"fetch the repository\" step,\nthe guide says \"$ hg clone -u release https://go.googlecode.com/hg/ go\"\nI follow the command but system always say that's wrong\nso I read the help and modified it into \n\"$ hg clone -U release ..repo url... go\"\n(I don't see a lowercase u option but there's a U instead which means noupdate)\nbut still goes wrong\nso I modified it again \n\"$ hg clone -U r60 ..repo url... go\"\n(I think release actually means go release number?)\nok, now that works finally \nbut, when it's over\ncd to the go directory,hey,why all the files are hidden?!\nand different with the url directory, for ex there's no such a src directory\nso what am I doing wrong, and sorry for my english is not good\nthank you for your help\n\nfor as a new user I can't attach a image and can't have more than two links in one post, see the picture link below at the reply to Evan Shaw\nand in the guide page they say that I need to install python-setuptools python-dev and build-essential, because in ubuntu/debian users' distribution's package repository, the  will \"most likely be old and broken\", what that mean? Am I suppose to install the tool manually(but not a easy_install)?\n\nfor a new user I can't answer myself,I think jnml points out the best matched answer\nI thought this question is answerd,\nthe problem is that repository in Ubuntu/Debian for  is tool old,\nif you just easy_install  (apt-get install ) \nyou got version 1.0.1 , that's not match for the command gave on the go installation guide,\nso a simple way to work it out is(thanks jnml for pointing this out):\n\nhg clone\ncd go\nhg update release\n\nthat's done.\nbut I still wonder how can I get the latest version of  be installed on my Debian,but that's another question, \nThanks a lot to all of you who reply to me, thank you for your help!", "output": "hg -u (lower case) is definitely correct, check your version of mercurial.\n$ hg help clone\n...\noptions:\n\n -U --noupdate           the clone will include an empty working copy (only a repository)\n -u --updaterev REV      revision, tag or branch to check out\n...\n$"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go integration with Protocol Buffers?\n\nQuestion:\nAfter a quick look at the documentation, I immediately started to think about integration with existing languages and applications and was wondering whether support would be provided for Protocol Buffers?", "output": "They will be fully supported in the next release. Read their FAQ in docs"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google GO: routing request handling mystical declarations?\n\nQuestion:\nI'm dorking around with Google GO for the first time.  I've extended the \"hello world\" application to try to have paths defined in the init section.  Here's what I've done so far:\npackage hello\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/service\", serviceHandler)\n    http.HandleFunc(\"/site\", siteHandler)\n    http.HandleFunc(\"/\", handler)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hello, there\")\n}\n\nfunc serviceHandler( w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"this is Services\")\n}\n\nfunc siteHandler( w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"this is Sites\")\n}\n\nOnly the handler() callback is ever executed -- the others are ignored.  E.g.: http://myserver/service/foo prints Hello, there.  I had hoped that it would be this is Services.\nIs there a better way to do service routing?  Ideally, I would expect these to be separate scripts anyway, but it looks like Go has only one script, based on the fact that the app.yaml requires a special string _go_app in the script declaration.\nThanks!", "output": "According to the documentation at: http://golang.org/pkg/net/http/#ServeMux\npath specs that do not have a trailing slash only match that path exactly. Add a slash to the end like so: http.HandleFunc(\"/service/\", serviceHandler) and it will work as you expect."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I define my own type converters in Go?\n\nQuestion:\nI'm defining a type. I notice that Go has a type called uint8 and a function called uint8 which creates a uint8 value. \nBut when I try to do this for myself:\n12:    type myType uint32\n\n14:    func myType(buffer []byte) (result myType) { ... }\n\nI get the error\n./thing.go:14: myType redeclared in this block\n    previous declaration at ./thing.go:12\n\nIf I change it to func newMyType that works but it feels like I'm a second class citizen. Can I write type constructor functions with the same ident as type type?", "output": "uint8() isn't a function nor a constructor, but a type conversion.\nFor a primitive type (or other obvious conversions but I don't know the exact law), you don't need to create a constructor.\nYou can simply do this :\ntype myType uint32\nv := myType(33)\n\nIf you have operations to do when creating your value, you should use a \"make\" function : \npackage main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype myType uint32\n\nfunc makeMyType(buffer []byte) (result myType) {\n    result = myType(buffer[0]+buffer[1])\n    return\n}\n\nfunc main() {\n    b := []byte{7, 8, 1}\n    c := makeMyType(b)\n    fmt.Printf(\"%+v\\n\", b)\n    fmt.Println(\"type of b :\", reflect.TypeOf(b))\n    fmt.Printf(\"%+v\\n\", c)\n    fmt.Println(\"type of c :\", reflect.TypeOf(c))\n}\n\nNaming a function newMyType should only be used when returning a pointer."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reconfigurable function variables\n\nQuestion:\nI'm interested in reassigning factory functions for testing reasons within Go, to mitigate the risk of using a factory function within a given package when wanting to mock one of its types.\nI've seen people pass factory functions as arguments to a containing function, and creating a struct that holds factories as data members. Is it instead possible to keep a top-level function variable and someway overwrite one implementation with another within a given file? I've tried the below:\ntype AirportFactory func (string, int, int) Airport\n\nvar makeAirport AirportFactory = func(n string, x int, y int) Airport {\n    return airport{name: n, pos: Position{X: x, Y: y}}\n}\n\nmakeAirport = func(n string, x int, y int) Airport {\n    return airport{name:\"default\", pos:Position{X:0, Y:0}}\n}\n\nBut when I build the code, 6g gives me the following error on the closing line of the last assignment:\nnon-declaration statement outside function body\nThis makes it seem like vars of function types are const, at least at the top level. Is there any way to get around this?", "output": "They are not constant. You just can not assign to an already declared variable outside of a function. Something such as this will work:\nfunc changeAirport() {\n    makeAirport = func(n string, x int, y int) Airport {\n        return airport{name:\"default\", pos:Position{X:0, Y:0}}\n    }\n}\n\nAs far as go is concerned, the variable assignments outside of a function do not happen in any particular order. As a consequence, you can only do it once."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a Go profiler?\n\nQuestion:\nI played around with Go a bit shortly after it came out. There wasn't a profiler then; is there one now?", "output": "I use pprof package, and Google perftools."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: fgetpos available in Go? Want to find File.Position\n\nQuestion:\nI have a File and I want to find the file offset/position, what would be fgetpos in stdio. I can't seem to find it in http://golang.org/pkg/io/. Do I have to count it myself or is there a build in method?", "output": "You should be able to do a Seek() to 0 bytes from the current position, which returns the resulting position. I'm not 100% sure the result is the absolute position you're after, but I would expect it to be.\noffset, err := f.Seek(0, io.SeekCurrent)\nif err != nil {\n    // handle error\n}\n// offset is the current position"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to assert with a debug message in Go tests?\n\nQuestion:\nI want to do this:\ntest.FailNow(\"My Message\")\n\nbut test.T.FailNow doesn't take a message. I am currently doing:\nlog.Println(\"Expected exception but got none\")\ntest.FailNow()\n\nIs there a better way?", "output": "See: http://golang.org/pkg/testing/#T.Fatal (and Fatalf)\nThe docs say: \"Fatal is equivalent to Log() followed by FailNow().\""}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How does golang create a buffer to pass to a C dll function?\n\nQuestion:\nI need to invoke a C API from golang, which is from a dll.\nThe problem is the C func need a buffer, how to create the \nbuffer in golang, then i can pass the buffer to the C func?\nvoid fooGetString(char* buffer, int buffer length)", "output": "Something like this should work:\ns := make([]byte, 256)\nC.fooGetString((*C.char)(unsafe.Pointer(&s[0])), C.int(len(s)))"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go: XORKeyStream(): runtime error: invalid memory address or nil pointer dereference\n\nQuestion:\nWhen I try to run the following code (I'm trying to encrypt the byte array representation of a string, using AES in CFB mode) I get an invalid memory address or nil pointer dereference error, on the line sEnc.XORKeyStream(msgB, msgB). The documentation says the source and destination for XORKeyStream can be the same byte array (also tried using a separate destination, but no dice), but I can't figure out what's causing the error. I'm using the latest version of the Go App Engine SDK on OS X Lion.\nSince at this point I'm still trying to get the code to simply encrypt something, I'm just generating a random key and not bothering to store it yet.\nfunc generateKey(w http.ResponseWriter, r *http.Request) {\n    key := make([]byte, 32)\n    n, err := rand.Read(key)\n    err = err\n    if(err != nil) {\n        fmt.Fprint(w, err)\n        return\n    }\n    if(n != 32) {\n        fmt.Fprint(w, \"Not enough bytes read.\")\n        return\n    }\n    c, err := aes.NewCipher(key)\n    if(err != nil) {\n        fmt.Fprint(w, err)\n    }\n\n    iv := make([]byte, 32)\n    n, err = rand.Read(iv)\n    err = err\n    if(err != nil) {\n        fmt.Fprint(w, err)\n        return\n    }\n    if(n != 32) {\n        fmt.Fprint(w, \"Not enough bytes read.\")\n        return\n    }\n\n    sEnc := cipher.NewCFBEncrypter(c, iv)\n\n    msg := \"text to be encrypted\"\n    msgR := strings.NewReader(msg)\n    msgB := make([]byte, msgR.Len())\n    n, err = msgR.Read(msgB)\n    if(err != nil) {\n        fmt.Fprint(w, err)\n        return\n    }\n    if(n == 0) {\n        fmt.Fprint(w, \"No bytes read.\")\n        return\n    }\n    fmt.Fprint(w, msgB)\n    fmt.Fprint(w, \"<br>\")\n    sEnc.XORKeyStream(msgB, msgB)\n    fmt.Fprint(w, msgB)\n}\n\nThe error messages:\n\n2011/08/15 15:15:58 http: panic serving : runtime error: invalid\n  memory address or nil pointer dereference   runtime.panic\n  /private/tmp/appengine/google_appengine/goroot/src/pkg/runtime/proc.c:1041\n  runtime.panicstring\n  /private/tmp/appengine/google_appengine/goroot/src/pkg/runtime/runtime.c:116\n  runtime.sigpanic\n  /private/tmp/appengine/google_appengine/goroot/src/pkg/runtime/darwin/thread.c:470\n  server.generateKey server/server.go:66   http.HandlerFunc·ServeHTTP\n  /private/tmp/appengine/google_appengine/goroot/src/pkg/http/server.go:589\n  http.*ServeMux·ServeHTTP\n  /private/tmp/appengine/google_appengine/goroot/src/pkg/http/server.go:790\n  appengine_internal.handleFilteredHTTP\n  /private/tmp/appengine/google_appengine/goroot/src/pkg/appengine_sdk/go_appengine_sdk/appengine_internal/api_dev.go:58\n  http.HandlerFunc·ServeHTTP\n  /private/tmp/appengine/google_appengine/goroot/src/pkg/http/server.go:589\n  http.*conn·serve\n  /private/tmp/appengine/google_appengine/goroot/src/pkg/http/server.go:555\n  runtime.goexit\n  /private/tmp/appengine/google_appengine/goroot/src/pkg/runtime/proc.c:178\n  INFO     2011-08-15 15:15:58,310 dev_appserver.py:4248] \"GET\n  /genkey/aes256 HTTP/1.1\" 500 -\n\nI've posted the rest of the code to paste bin, but it's just the includes/init function, nothing all that interesting.", "output": "sEnc is nil as a result of an error. For cipher.NewCFBEncrypter, \"the iv must be the same length as the Block's block.\" The AES block size is 128 bits or 16 bytes? For example,\niv := make([]byte, c.BlockSize())"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: undefined vector.New\n\nQuestion:\nFrom this question\nHow do I use a (generic) vector in go?\nI tried to create a new vector but the compiler says it is undefined: \n$ 6g -V\n6g version release.r60.3 9516\n$ cat > vectest.go <<.\n> package main\n> \n> import vector \"container/vector\"\n> import \"fmt\"\n> \n> func main() {\n>      vec := vector.New(0);\n>      buf := make([]byte,10);\n>      vec.Push(buf);\n> \n>      for i := 0; i < vec.Len(); i++ {\n>      el := vec.At(i).([]byte);\n>      fmt.Print(el,\"\\n\");\n>      }\n> }\n> .\n$ 6g vectest.go \nvectest.go:7: undefined: vector.New\n\nWhat might be wrong ?", "output": "weekly.2011-10-18\nThe container/vector package has been deleted. Slices are better.\n  SliceTricks: How to do vector-esque things with slices.\n\nI revised your convertToLCD code to have better performance: 5,745 ns/op versus 19,003 ns/op.\npackage main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nconst (\n    lcdNumerals = `\n _     _  _     _  _  _  _  _ \n| |  | _| _||_||_ |_   ||_||_|\n|_|  ||_  _|  | _||_|  ||_| _|\n`\n    lcdWidth   = 3\n    lcdHeight  = 3\n    lcdLineLen = (len(lcdNumerals) - 1) / lcdWidth\n)\n\nfunc convertToLCD(n int) string {\n    digits := strconv.Itoa(n)\n    displayLineLen := len(digits)*lcdWidth + 1\n    display := make([]byte, displayLineLen*lcdHeight)\n    for i, digit := range digits {\n        iPos := i * lcdWidth\n        digitPos := int(digit-'0') * lcdWidth\n        for line := 0; line < lcdHeight; line++ {\n            numeralPos := 1 + lcdLineLen*line + digitPos\n            numeralLine := lcdNumerals[numeralPos : numeralPos+lcdWidth]\n            displayPos := displayLineLen*line + iPos\n            displayLine := display[displayPos : displayPos+lcdWidth]\n            copy(displayLine, string(numeralLine))\n            if i == len(digits)-1 {\n                display[displayLineLen*(line+1)-1] = '\\n'\n            }\n        }\n    }\n    return string(display)\n}\n\nfunc main() {\n    fmt.Printf(\"%s\\n\", convertToLCD(1234567890))\n}\n\nOutput:\n    _  _     _  _  _  _  _  _ \n  | _| _||_||_ |_   ||_||_|| |\n  ||_  _|  | _||_|  ||_| _||_|"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: null array problem in json\n\nQuestion:\nI have written a function which scans all the files/directory in a given directory and returns a json object. I need to display this json object on the UI using jstree. I have written the function in go using recursion to scan all the files and directories rooted at that particular folder. \nThis is the type I am using to construct the whole structure\ntype Directory struct {\n    Name string \"data\"\n    SubDirs []Directory \"children\"\n}\n\nNow jstree accepts data structs of the following format.\njson_data: {\n        data: [\n            \"f1\",\n            \"f2\",\n            {\n                data: \"f3\",\n                children: [\"f4\", \"f5\"]\n            }\n        ]\n }\n\nand not of the format :-\njson_data: {\n        data: [\n            {\n              \"data\": \"f1\",\n              \"children\": []\n            } \n            {\n              \"data\": \"f2\",\n              \"children\": []\n            } \n            {\n                data: \"f3\",\n                children: [\"f4\", \"f5\"]\n            }\n        ]\n }\n\n(when I pass the above data structure format, it doesn't work probably since the \"children\" thing is null)\nThus the data structure Directory I have maintained doesn't suffice to construct the directory structure.\nHow do I solve this problem of constructing the Directory tree homogeneously?", "output": "The final one is not even valid JSON. The spec defines that empty arrays are valid and allowed. Try:\n{\n    \"data\": [\n        {\n            \"data\": \"f1\",\n            \"children\": []\n        },\n        {\n            \"data\": \"f2\",\n            \"children\": []\n        },\n        {\n            \"data\": \"f3\",\n            \"children\": [\n                \"f4\",\n                \"f5\"\n            ]\n        }\n    ]\n}\n\nUse JSONLint to validate your JSON objects."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to implement BitSet with Go?\n\nQuestion:\nI didn't find a BitSet package in Go, so I tried to implement it.\nI'd like to use a array of uint64 to store the bits.\nI need the number of bits to allocate the uint64 array.\nWith Java, I can define a constructor that takes an integer.\nWhile Go doesn't provide constructor, how can I properly initialize \nthe BitSet 'object' when user call new()?", "output": "Declare bitSet as a private struct:\ntype bitSet struct {\n  len int\n  array []uint64\n}\n\nExpose the interface BitSet:\ntype BitSet interface {\n  Has(pos int) bool\n  Add(pos int) bool\n  Len() int\n}\n\nAlso expose a function NewBitSet:\nfunc NewBitSet(len int) BitSet {\n  return &bitSet{len, make(uint64, (len+7) / 8) }\n}\n\nThis is a Go way for encapsulation: share an interface, not the implementation."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you make gccgo compile pig.go?\n\nQuestion:\nThere is a file pig.go on the golang.org website: \n    http://golang.org/doc/codewalk/functions/ \n    in a box labeled doc/codewalk/pig.go\n\nCompiling it with gccgo version (Ubuntu/Linaro 4.6.1-9ubuntu3) 4.6.1\n    gccgo pig.go \n\ngives an error message about not finding math/rand\n    pig.go:9:11: error: import file ‘math/rand’ not found", "output": "Your version of gccgo implements an old version of the language. To compile Go 1 code, you need gccgo 4.7.1 or later.\nIf you can't or don't want to upgrade, you could probably just change the import from math/rand to rand and it will compile with gccgo 4.6.1. Not all programs will be so easy to backport, but this one happens to be."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What's wrong with my Priority Queue's Pop method?\n\nQuestion:\nBased on Rob Pike's load balancer demo, I implemented my own priority queue, but my Pop method is not right, can anyone tell me what's wrong?\npackage main\n\nimport (\n    \"fmt\"\n    \"container/heap\"\n)\n\ntype ClassRecord struct {\n    name  string\n    grade int\n}\n\ntype RecordHeap []*ClassRecord\n\nfunc (p RecordHeap) Len() int { return len(p) }\n\nfunc (p RecordHeap) Less(i, j int) bool {\n    return p[i].grade < p[j].grade\n}\n\nfunc (p *RecordHeap) Swap(i, j int) {\n    a := *p\n    a[i], a[j] = a[j], a[i]\n}\n\nfunc (p *RecordHeap) Push(x interface{}) {\n    a := *p\n    n := len(a)\n    a = a[0 : n+1]\n    r := x.(*ClassRecord)\n    a[n] = r\n    *p = a\n}\n\nfunc (p *RecordHeap) Pop() interface{} {\n    a := *p\n    *p = a[0 : len(a)-1]\n    r := a[len(a)-1]\n    return r\n}\n\nfunc main() {\n    a := make([]ClassRecord, 6)\n    a[0] = ClassRecord{\"John\", 80}\n    a[1] = ClassRecord{\"Dan\", 85}\n    a[2] = ClassRecord{\"Aron\", 90}\n    a[3] = ClassRecord{\"Mark\", 65}\n    a[4] = ClassRecord{\"Rob\", 99}\n    a[5] = ClassRecord{\"Brian\", 78}\n    h := make(RecordHeap, 0, 100)\n    for _, c := range a {\n        fmt.Println(c)\n        heap.Push(&h, &c)\n        fmt.Println(\"Push: heap has\", h.Len(), \"items\")\n    }\n    for i, x := 0, heap.Pop(&h).(*ClassRecord); i < 10 && x != nil; i++ {\n        fmt.Println(\"Pop: heap has\", h.Len(), \"items\")\n        fmt.Println(*x)\n    }\n}\n\nEDIT: besides the way cthom06 pointed out, another way to fix this is to create a pointer array as follows,\na := make([]*ClassRecord, 6)\na[0] = &ClassRecord{\"John\", 80}\na[1] = &ClassRecord{\"Dan\", 85}\n......", "output": "EDIT:\nOh I should've seen this right away.\nheap.Push(&h, &c)\n\nYou push the address of c, which gets reused on each iteration of range. Every record in the heap is a pointer to the same area in memory, which ends up being Brian. I'm not sure if this is intended behavior or a compiler bug, but\nt := c\nheap.Push(&h, &t)\n\nworks around it.\nAlso: Your for loop is wrong.\nfor h.Len() > 0 {\n    x := heap.Pop(&h...\n\nshould fix it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Differences between Coroutines and `goto`?\n\nQuestion:\nI always read about the horrible thing that \"goto\" is. But today, reading about the Google programming language Go, I see that it suports Coroutines (Goroutines).\nThe question is:\nCoroutine == GoTo \n\nOr\nCoroutine != GoTo?\n\nWhy?", "output": "Goroutines are not the same as a goto - they run in parallel with the main code.  When you state something like (from their example at http://golang.org/doc/effective_go.html)\ngo list.Sort();  // run list.Sort in parallel; don't wait for it. \n\nthe mainline code continues on - it doesn't wait for the sort to finish.  The sort routine starts up on its own lightweight thread of execution and when it finishes the sort that thread exits.\nA goto would cause the mainline code to branch to a separate execution path - so the statements after the goto would never get run."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Building with multiple files in GO (GO1)\n\nQuestion:\nDoes anyone know if it's possible to use the \"go build\" command to build from multiple files in a directory?  For example\nsrc/\n  file1.go\n  file2.go\n\nWhere file1.go contains the \"func main()\" method and file2 provides supporting functions.  I've tried by using the following import statements but I'm getting no where\nimport (\n  \"file2\"\n)\n\nimport (\n  file2 \"./file2\"\n)\n\nI'm wondering if this is a case that I need to modify the GOROOT environment variable to get this to work.  Or if I'm just being daft and missing something blindingly obvious.\nThanks", "output": "If file1.go and file2.go are part of the same package, this should work fine. You don't have to import files from the same package into each other. Their variables and functions are already shared.\nIf the files belong to different packages, they should be in different directories."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Initialize embedded struct in Go\n\nQuestion:\nI have the following struct which contains a net/http.Request:\ntype MyRequest struct {\n    http.Request\n    PathParams map[string]string\n}\n\nNow I want to initialize the anonymous inner struct http.Request in the following function:\nfunc New(origRequest *http.Request, pathParams map[string]string) *MyRequest {\n    req := new(MyRequest)\n    req.PathParams = pathParams\n    return req\n}\n\nHow can I initialize the inner struct with the parameter origRequest?", "output": "What about:\nfunc New(origRequest *http.Request, pathParams map[string]string) *MyRequest {\n        return &MyRequest{*origRequest, pathParams}\n}\n\nIt shows that instead of\nNew(foo, bar)\n\nyou might prefer just\n&MyRequest{*foo, bar}\n\ndirectly."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: vim - automatically formatting golang source code when saving\n\nQuestion:\nI'm using vim with the vim-golang plugin. This plugin comes with a function called :Fmt that \"reformats\" the source code using gofmt, a command-line executable.\nI want to invoke the :Fmt function each time that I save the file, so it is continuously re-formatted. I think this should be done with a autocmd directive. But I have two doubts:\n\nI could not find a way to execute the function. I tried writting Fmt and :Fmt at the end of the autocmd line, but it didn't seem to work. I think I miss something, like \"call\".\nI want this to happen only when saving a file of filetype 'go'. I don't know how to combine those two conditions - I can activate variables depending on the file type, and I can do small stuff, like removing trailing spaces, whenever a file is saved, but separatedly.\n\nSo this is what I have so far:\n\" I can set variables for go like this\nautocmd FileType go setlocal noexpandtab shiftwidth=4 tabstop=4 softtabstop=4 nolist\n\n\" I can clean trailing spaces(conserving cursor position) on save like this\nautocmd BufWritePre * kz|:%s/\\s\\+$//e|'z\n\n\" None of these worked:\nautocmd BufWritePre,FileType go Fmt\nautocmd BufWritePre,FileType go :Fmt", "output": "The FileType event doesn't fire on buffer writes; BufWritePre is the correct one, but you need to provide a file pattern, e.g. *.go:\nautocmd BufWritePre *.go Fmt\n\nThe only downside is that this duplicates the detection of the go filetype. You could delegate this by hooking into the FileType event, and then define the formatting autocmd for each Go buffer by using the special <buffer> pattern:\nautocmd FileType go autocmd BufWritePre <buffer> Fmt\n\nThis has the downside that if the filetype ever gets set multiple times, you'll run the formatting multiple times, too. That could be solved via a custom :augroup, but now it becomes really complex. Or, if you're really sure that this is the only BufWritePre autocmd for Go buffers, you could use :autocmd! BufWritePre ... (with a !)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can I introspect the name of the main.main package?\n\nQuestion:\nThis is a fairly niche problem, but I'm currently trying to write a conventions-based settings storage library with golang. It would be a great API boon if I could programmatically determine the running package name that wants to store something (eg \"github.net/author/projectname/pkg\") calling my library function.\nWith Python a similar thing could be achieved with the inspect module, or even with __main__.__file__ and a look at the file system.", "output": "You can get similar information if you use the following functions:\n\nruntime.Caller\nruntime.FuncForPC\n\nThe code may look like this:\npc, file, line, ok := runtime.Caller(1)\nif !ok { /*failed*/ }\nprintln(pc, file, line, ok)\n\nf := runtime.FuncForPC(pc)\nif f == nil { /*failed*/ }\nprintln(f.Name())\n\nIf I put the above code (with the 1st line changed into runtime.Caller(0)) into a (randomly chosen) Go library which I have installed in GOROOT, it prints:\n134626026 /tmp/go-build223663414/github.com/mattn/go-gtk/gtk/_obj/gtk.cgo1.go -4585 true\ngithub.com/mattn/go-gtk/gtk.Init\n\nOr it prints:\n134515752 /home/user/go/src/github.com/mattn/go-gtk/example/event/event.go 12 true\nmain.main\n\nThe filename on the 1st line, and the 2nd line, seem to contain the information you are looking for.\nThere are two problems:\n\nIt may give incorrect result if functions are automatically inlined by the compiler\nFor any function F defined in package main, the function name is just main.F. For example, if runtime.Caller(0) is called from main(), the function name is main.main even if the main() function is defined in a Go file found in GOROOT/src/github.com/mattn/go-gtk/.... In this case, the output from runtime.Caller is more useful than the output from runtime.FuncForPC."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why my golang lock free queue always stuck there?\n\nQuestion:\nHere is my code:\npackage main\n\nimport (\n    \"sync/atomic\"\n    \"unsafe\"\n    \"sync\"\n    \"fmt\"\n    \"time\"\n)\n\nconst (\n    MAX_DATA_SIZE = 100\n)\n\n// lock free queue\ntype Queue struct {\n    head unsafe.Pointer\n    tail unsafe.Pointer\n}\n// one node in queue\ntype Node struct {\n    val interface{}\n    next unsafe.Pointer\n}\n// queue functions\nfunc (self *Queue) enQueue(val interface{}) {\n    newValue := unsafe.Pointer(&Node{val: val, next: nil})\n    var tail,next unsafe.Pointer\n    for {\n        tail = self.tail\n        next = ((*Node)(tail)).next\n        if next != nil {\n            atomic.CompareAndSwapPointer(&(self.tail), tail, next)\n        }else if atomic.CompareAndSwapPointer(&((*Node)(tail).next), nil, newValue){\n            break\n        }\n    }\n}\n\nfunc (self *Queue) deQueue() (val interface{}, success bool){\n    var head,tail,next unsafe.Pointer\n    for {\n        head = self.head\n        tail = self.tail\n        next = ((*Node)(head)).next\n        if head == tail {\n            if next == nil {\n                return nil, false\n            }else {\n                atomic.CompareAndSwapPointer(&(self.tail), tail, next)\n            }\n        }else {\n            val = ((*Node)(next)).val\n            if atomic.CompareAndSwapPointer(&(self.head), head, next) {\n                return val, true\n            }\n        }\n    }\n    return\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(20)\n    queue := new(Queue)\n    queue.head = unsafe.Pointer(new(Node))\n    queue.tail = queue.head\n\n    for i := 0; i < 10; i++ {\n        go func() {\n            defer wg.Done()\n            for j := 0; j < MAX_DATA_SIZE; j++ {\n                t := time.Now()\n                queue.enQueue(t)\n                fmt.Println(\"enq = \", t)\n            }\n        }()\n    }\n\n    for i := 0; i < 10; i++ {\n        go func() {\n            ok := false\n            var val interface{}\n            defer wg.Done()\n            for j := 0; j < MAX_DATA_SIZE; j++ {\n                val,ok = queue.deQueue()\n                for !ok {\n                    val,ok = queue.deQueue()\n                }\n                fmt.Println(\"deq = \",val)\n            }\n        }()\n    }\n\n    wg.Wait()\n}\n\nThe problem is, sometimes the code runs ok, but sometimes it fails and just gets stuck with no response.\nIs there any problem in my code?", "output": "Here is the above re-written with channels as @mkb suggested (bar the infinite queue size).\nIt doesn't lock up.\nI'd suggest you use channels unless you have a really good reason not to as the Go team have spend a great deal of effort making them reliable, high performance and easy to use.\npackage main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"sync\"\n    \"time\"\n)\n\nconst (\n    MAX_DATA_SIZE = 100\n)\n\nfunc main() {\n    runtime.GOMAXPROCS(4)\n    var wg sync.WaitGroup\n    wg.Add(20)\n    queue := make(chan time.Time, 10)\n\n    for i := 0; i < 10; i++ {\n        go func() {\n            defer wg.Done()\n            for j := 0; j < MAX_DATA_SIZE; j++ {\n                t := time.Now()\n                queue <- t\n                fmt.Println(\"enq = \", t)\n            }\n        }()\n    }\n\n    for i := 0; i < 10; i++ {\n        go func() {\n            defer wg.Done()\n            for j := 0; j < MAX_DATA_SIZE; j++ {\n                val := <-queue\n                fmt.Println(\"deq = \", val)\n            }\n        }()\n    }\n\n    wg.Wait()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What kind of Garbage Collection does Go use?\n\nQuestion:\nGo is a garbage collected language:\nhttp://golang.org/doc/go_faq.html#garbage_collection\nHere it says that it's a mark-and-sweep garbage collector, but it doesn't delve into details, and a replacement is in the works... yet, this paragraph seems not to have been updated much since Go was released.\nIt's still mark-and-sweep? Is it conservative or precise? Is it generational?", "output": "Plans for Go 1.4+ garbage collector:\n\nhybrid stop-the-world/concurrent collector\nstop-the-world part limited by a 10ms deadline\nCPU cores dedicated to running the concurrent collector\ntri-color mark-and-sweep algorithm\nnon-generational\nnon-compacting\nfully precise\nincurs a small cost if the program is moving pointers around\nlower latency, but most likely also lower throughput, than Go 1.3 GC\n\nGo 1.3 garbage collector updates on top of Go 1.1:\n\nconcurrent sweep (results in smaller pause times)\nfully precise\n\nGo 1.1 garbage collector:\n\nmark-and-sweep (parallel implementation)\nnon-generational\nnon-compacting\nmostly precise (except stack frames)\nstop-the-world\nbitmap-based representation\nzero-cost when the program is not allocating memory (that is: shuffling pointers around is as fast as in C, although in practice this runs somewhat slower than C because the Go compiler is not as advanced as C compilers such as GCC)\nsupports finalizers on objects\nthere is no support for weak references\n\nGo 1.0 garbage collector:\n\nsame as Go 1.1, but instead of being mostly precise the garbage collector is conservative. The conservative GC is able to ignore objects such as []byte.\n\nReplacing the GC with a different one is controversial, for example:\n\nexcept for very large heaps, it is unclear whether a generational GC would be faster overall\npackage \"unsafe\" makes it hard to implement fully precise GC and compacting GC"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to import local Go package in GAE\n\nQuestion:\nHow to import local packages in Golang + GAE?\nI wanna something like this:\napp/\n-app.yaml\n-/my_app\n--my_app.go\n--/package1\n---package1.go\n\nListing of my_app.go:\npackage my_app\n\nimport (\n  \"http\"\n  \"./package1\"\n)\n\nfunc init() {\n  http.HandleFunc(\"/\", package1.index)\n}\n\nListing of package1.go:\npackage package1\n\nimport (\n  \"http\"\n  \"fmt\"\n)\n\nfunc index (w http.ResponseWriter, r * http.Request) {\n  fmt.Fprint(w, \"I'm index page =) \")\n}\n\nI this case I have an error like:\n/path/to/project/my_app/my_app.go:5: can't find import: ./package1\n2011/11/03 10:50:51 go-app-builder: Failed building app: failed running 6g: exit status 1\n\nThanks for help.", "output": "You either need to link or copy the packages to your application directory. The path relative to the root of the application directory should match the import path. To use package1, you should configure your app directory to look like this:\napp.yaml\nyourapp/yourapp.go\npackage1/package1.go\n\n\nfrom https://groups.google.com/d/msg/golang-nuts/coEvrWIJGTs/75GzcefKVcIJ"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What are Go arrays indexed by?\n\nQuestion:\nI am some 'memory allocator' type code, by using an array and indexes rather than pointers. I'm hoping that the size of the index of the array is smaller than a pointer. I care because I am storing 'pointers' as integer indexes in an array rather than 64-bit pointers. \nI can't see anything in the Go spec that says what an array is indexed by. Obviously it's some kind of integer. Passing very large values makes the runtime complain that I can't pass negative numbers, so I'm guessing that it's somehow cast to a signed integer. So is it an int32? I'm guessing it's not an int64 because I didn't touch the top bit (which would have been 2's compliment for a negative number).", "output": "Arrays may be indexed by any integer type.\nThe Array types section of the Go Programming Language Specification says that in an array type definition,\n\nThe length is part of the array's type and must be a constant\n  expression that evaluates to a non-negative integer value.\n\nIn an index expression such as a[x]:\n\nx must be an integer value and 0 <= x < len(a)\n\nBut there is a limitation on the magnitude of an index; the description of Length and capacity says:\n\nThe built-in functions len and cap take arguments of various types and\n  return a result of type int. The implementation guarantees that the\n  result always fits into an int.\n\nSo the declared size of an array, or the index in an index expression, can be of any integer type (int, uint, uintptr, int8, int16, int32, int64, uint8, uint16, uint32, uint64), but it must be non-negative and within the range of type int (which is the same size as either int32 or int64 -- though it's a distinct type from either)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a foreach loop in Go?\n\nQuestion:\nIs there a foreach construct in the Go language?\nCan I iterate over a slice or array using a for?", "output": "From For statements with range clause:\n\nA \"for\" statement with a \"range\" clause iterates through all entries\nof an array, slice, string or map, or values received on a channel.\nFor each entry it assigns iteration values to corresponding iteration\nvariables and then executes the block.\n\nAs an example:\nfor index, element := range someSlice {\n    // index is the index where we are\n    // element is the element from someSlice for where we are\n}\n\nIf you don't care about the index, you can use _:\nfor _, element := range someSlice {\n    // element is the element from someSlice for where we are\n}\n\nThe underscore, _, is the blank identifier, an anonymous placeholder."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I configure go command to use a proxy?\n\nQuestion:\nI want to run go install to install the tour, but I can't find the option to use a proxy for internet access. I don't need this just for the tour but for developing in Go in general. \nHow do I configure Go to use a proxy.", "output": "Go programs understand environment variables http_proxy and no_proxy, but that's not enough because go get uses source control managers for retrieving code. So you have to set HTTP proxy settings for your SCM too. Use this for Mercurial and this for Git.\nhttp_proxy value can be like http://user:password@host:port/. User, password, and port parts are optional. no_proxy is a comma-separated list of servers that should not be connected through proxy. Its value can be like foo.com,bar.net:4000.\nYou can set these environment variables in your bash_profile, but if you want to limit their usage to go, you can run it like this:\n$ http_proxy=127.0.0.1:8080 go get code.google.com/p/go.crypto/bcrypt\n\nIf that's what you always want, set this alias to avoid typing proxy part every time:\n$ alias go='http_proxy=127.0.0.1:8080 go'\n\nFrom now on you can use go normally, but it uses your HTTP proxy."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to wait on both channels and file descriptors at the same time in Go?\n\nQuestion:\nI know I can wait on multiple channels using the select {} syntax in Go, and wait on multiple file descriptors using syscall.Select() or similar functions.  But is it possible to wait on both channels at once?\nFor background, I want to have a goroutine that accepts for messages over a channel and forwards them over a socket connection (provided by gozmq), while simultaneously waiting for replies on the socket connection.\nDue to the thread safety requirements of the underlying library, the socket can only be accessed in one thread at a time, which is why I was wondering if there is a way to handle this from a single goroutine.", "output": "Selecting on both a channel and an file descriptor is not possible because the abstractions are at different levels. Channels are handled by the go runtime and file descriptors by the operating system. What you need is to make a bridge between them and this can be done with a net.Pipe().\nPretty much what you need to do is dedicate one goroutine to epoll()/select() to watch your zmq-sockets and a single \"wake up\" net.Pipe(). This is your poll server. Another goroutine listens on your read and write channels. When someone sends on the read or write channels, the second goroutine would send on the pipe to wake up the poll server.\nThis is how the net package in the standard library works. I highly recommend reading it for inspiration (or stealing... the BSD license is very liberal).\nHere is a description of pollServer from net itself. You may need to read the code to understand what this is saying, but this section from fd.go should be a good place to start looking.\n// A pollServer helps FDs determine when to retry a non-blocking\n// read or write after they get EAGAIN.  When an FD needs to wait,\n// send the fd on s.cr (for a read) or s.cw (for a write) to pass the\n// request to the poll server.  Then receive on fd.cr/fd.cw.\n// When the pollServer finds that i/o on FD should be possible\n// again, it will send fd on fd.cr/fd.cw to wake any waiting processes.\n// This protocol is implemented as s.WaitRead() and s.WaitWrite().\n//\n// There is one subtlety: when sending on s.cr/s.cw, the\n// poll server is probably in a system call, waiting for an fd\n// to become ready.  It's not looking at the request channels.\n// To resolve this, the poll server waits not just on the FDs it has\n// been given but also its own pipe.  After sending on the\n// buffered channel s.cr/s.cw, WaitRead/WaitWrite writes a\n// byte to the pipe, causing the pollServer's poll system call to\n// return.  In response to the pipe being readable, the pollServer\n// re-polls its request channels.\n//\n// Note that the ordering is \"send request\" and then \"wake up server\".\n// If the operations were reversed, there would be a race: the poll\n// server might wake up and look at the request channel, see that it\n// was empty, and go back to sleep, all before the requester managed\n// to send the request.  Because the send must complete before the wakeup,\n// the request channel must be buffered.  A buffer of size 1 is sufficient\n// for any request load.  If many processes are trying to submit requests,\n// one will succeed, the pollServer will read the request, and then the\n// channel will be empty for the next process's request.  A larger buffer\n// might help batch requests.\n//\n// To avoid races in closing, all fd operations are locked and\n// refcounted. when netFD.Close() is called, it calls syscall.Shutdown\n// and sets a closing flag. Only when the last reference is removed\n// will the fd be closed.\n\nGood luck re-implementing net. The good news at the end of all this your zmq-socket will be thread safe in go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Use of new vs var in Go\n\nQuestion:\nYou have a function with an argument, a pointer to a type.\ntype bar struct{...}\n\nfunc foo(arg *bar)\n\nIs there any difference between:\nvar b bar\nfoo(&b)\n\nand\nb := new(bar)\nfoo(b)\n\nThe use of new creates an allocation.", "output": "No, there is no difference, as, contrary to C, Go explicitly states that you can give a pointer to a locally created variable.\nFrom the documentation :\n\nNote that, unlike in C, it's perfectly OK to return the address of a\n  local variable; the storage associated with the variable survives\n  after the function returns"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: how do I check for errors when calling os.Open(<filename>) in Go?\n\nQuestion:\nI'm new to Go (spent 30mins so far!) and am trying to do File I/O.\n  file, ok := os.Open(\"../../sample.txt\")\n  if ok != nil {\n    // error handling code here\n    os.Exit(1)\n  }\n  ... \n\nWhen the call fails, shouldn't it return an error number? This call returns os.Error and it has no methods other than 'String()'. \nIs this the recommended way to check for errors in Go?", "output": "Typical Go code (which uses the os package) is not analyzing the returned error object. It just prints the error message to the user (who then knows what went wrong based on the printed message) or returns the error as-is to the caller.\nIf you want to prevent your program from opening a non-existent file, or want to check whether the file is readable/writable, I wound suggest to use the os.Stat function prior to opening the file.\nYour can analyze the Go type of the returned error, but this seems inconvenient:\npackage main\n\nimport \"fmt\"\nimport \"os\"\n\nfunc main() {\n    _, err := os.Open(\"non-existent\")\n    if err != nil {\n        fmt.Printf(\"err has type %T\\n\", err)\n        if err2, ok := err.(*os.PathError); ok {\n            fmt.Printf(\"err2 has type %T\\n\", err2.Error)\n            if errno, ok := err2.Error.(os.Errno); ok {\n                fmt.Fprintf(os.Stderr, \"errno=%d\\n\", int64(errno))\n            }\n        }\n\n        fmt.Fprintf(os.Stderr, \"%s\\n\", err)\n        os.Exit(1)\n    }\n}\n\nwhich prints:\nerr has type *os.PathError\nerr2 has type os.Errno\nerrno=2\nopen non-existent: no such file or directory"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using Go to write a library for an iPhone app\n\nQuestion:\nI'm considering using Go as a low-level, performant language alternative to C/Objective-C to implement a library for an iPhone App. Could either of the Go compilers generate a library that could be linked into a native iPhone app with the Go runtime, etc.? Is there an ARM port for Go or does gccgo/gcc support this? I imagine that since gccgo uses gcc as the back-end and Xcode uses gcc to compile iPhone apps that there is a strong chance that this is possible. If it's possible, how would I set that up in an Xcode project?\nHas anyone tried this or seen it discussed before? (When I do a Google search like \"compiling go code iphone\" the \"go\" part is completely unused and I get only stuff about iPhone development.)", "output": "Go doesn't support the iphone platform right now, but it does support ARM processors. There hasn't been much discussion about this on the mailing list though."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Implement an interface in the form of another\n\nQuestion:\nI wish to implement the fmt.Stringer interface's String method. However for a set of types deriving from Node, their String implementations would be a wrapper around a Print interface method they must provide. How can I provide String automatically for all types implementing Node? If I provide the default String on some base class, I lose access to the derived type (and thus the interface method Print).\ntype Node interface {\n    fmt.Stringer\n    Print(NodePrinter)\n}\n\ntype NodeBase struct{}\n\nfunc (NodeBase) String() string {\n    np := NewNodePrinter()\n    // somehow call derived type passing the NodePrinter\n    return np.Contents()\n}\n\ntype NodeChild struct {\n    NodeBase\n    // other stuff\n}\n\nfunc (NodeChild) Print(NodePrinter) {\n    // code that prints self to node printer\n}", "output": "Go explicitly declares that it's not possible:\n\nWhen we embed a type, the methods of that type become methods of the outer type, but when they are invoked the receiver of the method is the inner type, not the outer one.\n\nFor a solution, I recommend something like this:\nfunc nodeString(n Node) string {\n    np := NewNodePrinter()\n    // do stuff\n    n.Print(np)\n    return np.Contents()\n}\n\n// Now you can add String method to any Node in one line\nfunc (n NodeChild) String() string { return nodeString(n) }"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: how to put a backquote in a backquoted string?\n\nQuestion:\nis it possible to print back quotes in Go using back quotes : something like this:\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(```) // for example I can do it with double quotes \"\\\"\"\n}", "output": "package main\n\nimport \"fmt\"\n\nfunc main() {\n    // back ` quote\n    fmt.Println((`back ` + \"`\" + ` quote`))\n}\n\n\nRaw string literals are character\n  sequences between back quotes ``.\n  Within the quotes, any character is\n  legal except back quote. The value of\n  a raw string literal is the string\n  composed of the uninterpreted\n  characters between the quotes; in\n  particular, backslashes have no\n  special meaning and the string may\n  span multiple lines. String\n  literals"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to know TCP connection is closed in net package?\n\nQuestion:\nI'm implementing a small TCP server. How do I know if one of my clients closed? Should I just try to read or write and check if err is nil?", "output": "That thread \"Best way to reliably detect that a TCP connection is closed\", using net.Conn for 'c' (also seen in utils/ping.go or locale-backend/server.go or many other instances):\none := make([]byte, 1)\nc.SetReadDeadline(time.Now())\nif _, err := c.Read(one); err == io.EOF {\n  l.Printf(logger.LevelDebug, \"%s detected closed LAN connection\", id)\n  c.Close()\n  c = nil\n} else {\n  var zero time.Time\n  c.SetReadDeadline(time.Now().Add(10 * time.Millisecond))\n}\n\nFor detecting a timeout, it suggests:\nif neterr, ok := err.(net.Error); ok && neterr.Timeout() {\n  ...\n\n\nUpdate 2019: tuxedo25 mentions in the comments:\n\nIn go 1.7+, zero byte reads return immediately and will never return an error.\n  You must read at least one byte. \n\nSee commit 5bcdd63 and go issue 15735\n\nnet: don't return io.EOF from zero byte reads"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What if the gc were optional in go?\n\nQuestion:\nWould such a language be feasible or are there specific features in go that absolutely require some form of a gc?\nnote: I am not anti-gc, but coming from a C/C++ background and working on a real-time server application, I prefer to maintain some level of control how and when memory is reaped (can't have a 10s garbage-collection happening in the middle of a live run).\nAre my concerns realistic, given my requirements? Or is the go gc so good that my concerns are unfounded?\nGo's gc is my only reservation about attempting a port of my C++ real-time server to go.", "output": "Go with optional GC would require language changes. Here's a perfectly valid Go function that will make a C programmer's skin crawl:\nfunc foo() *int {\n    a := 1\n    return &a\n}\n\nThis is fine because the Go compiler will figure out that the variable a needs to be allocated on the heap. It will be garbage collected later and you don't have to care. (Well, ok, in some situations you might. But most of the time you don't.)\nYou can concoct all kinds of scenarios where the compiler will do things like this. It just wouldn't be the same without a garbage collector.\nThere are things you can do to help GC times, but to a certain extent you'll be nullifying the advantages of the language. I hesitate to recommend these practices, but are options:\n\nFree lists\nWith the unsafe package you can even write your own allocator and manually free memory, but you'd need a function for every type you want to allocate. Or use reflection to pass in the type you want to allocate, return an empty interface, and use type assertions to get concrete values out.\n\nThe bottom line is, Go probably isn't a good choice for applications with hard real-time requirements. That said, I also don't think you'll see anything approaching a 10 second garbage collection. Consider what your requirements really are and if you have any doubts, do some measurements.\nTry the latest Go code if you can. There are some garbage collector improvements and some compiler optimizations that cause fewer allocations. If your release time frame is shorter, though, you may be stuck with the current stable release for several months."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Coroutines or continuations for Web programming in Python and Ruby. Why not?\n\nQuestion:\nThe question is: why aren't continuations (in Ruby) and coroutines (in Python) more widely used for Web programming?\nServer-side web programming is made difficult by the problem of preserving state between requests. Two elegant, and related, solutions to this are continuations (as found in Scheme, Ruby and Smalltalk) and coroutines (as found in Python and Go).\nBruce Tate in his Beyond Java (O'Reilly, 2005) talked about Ruby on Rails and Seaside as exciting new developments in Web programming. To me, Seaside was the real breakthrough: using Smalltalk continuations, Seaside made it very easy to program complex request/response sequences. \nI know about Python coroutines being used in Tornado and Twisted to reduce callbacks, but that is somewhat low-level, compared to writing a view/controller in a single coroutine to handle a sequence of HTTP requests to complete an online purchase, for example.\nI wonder why these ideas that look so good on paper are not more widely deployed in Python and Ruby. Is it just a cultural matter? Limitations in the facilities as implemented in these languages? Or is there a fundamental flaw in these approaches in the context of Web development?", "output": "I've used Seaside and continuations are a beautiful model for developing client server webapps. They simplify traditional client/server applications that I couldn't believe \nwhy no other langugage was doing it.\nBut unfortunately webapps aren't what they used to be. \nInstead of the requesting only one page, now with ajax there are multiple requests at different times. That is why continuations aren't as useful as they used to be.\nEven Avi Bryant (original author of Seaside) has said that under ajax making callbacks easier (event driven programming) is more important than continuations.\nTake a look at this quora discussion for more:\nhttp://www.quora.com/Whats-the-best-continuation-based-web-framework"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Convert string to integer type in Go?\n\nQuestion:\nI'm trying to convert a string returned from flag.Arg(n) to an int. What is the idiomatic way to do this in Go?", "output": "For example strconv.Atoi.\nCode:\npackage main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    s := \"123\"\n\n    // string to int\n    i, err := strconv.Atoi(s)\n    if err != nil {\n        // ... handle error\n        panic(err)\n    }\n\n    fmt.Println(s, i)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go language benchmarks?\n\nQuestion:\nI see the claims that Go is supposed to be almost comparable in speed to C, but are there any benchmarks available yet?", "output": "There is a benchmark folder in the distribution. Check out $GOROOT/test/bench."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Where is the io library defined in Go?\n\nQuestion:\nSpecifically, where are io.reader and io.writer interfaces defined?", "output": "In the io package:\nhttp://golang.org/pkg/io/#Reader\nhttp://golang.org/pkg/io/#Writer"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Multiplex on queue.Queue?\n\nQuestion:\nHow can I go about \"selecting\" on multiple queue.Queue's simultaneously?\nGolang has the desired feature with its channels:\nselect {\ncase i1 = <-c1:\n    print(\"received \", i1, \" from c1\\n\")\ncase c2 <- i2:\n    print(\"sent \", i2, \" to c2\\n\")\ncase i3, ok := (<-c3):  // same as: i3, ok := <-c3\n    if ok {\n        print(\"received \", i3, \" from c3\\n\")\n    } else {\n        print(\"c3 is closed\\n\")\n    }\ndefault:\n    print(\"no communication\\n\")\n}\n\nWherein the first channel to unblock executes the corresponding block. How would I achieve this in Python?\nUpdate0\nPer the link given in tux21b's answer, the desired queue type has the following properties:\n\nMulti-producer/multi-consumer queues (MPMC)\nprovides per-producer FIFO/LIFO\nWhen a queue is empty/full consumers/producers get blocked\n\nFurthermore channels can be blocking, producers will block until a consumer retrieves the item. I'm not sure that Python's Queue can do this.", "output": "There are many different implementations of producer-consumer queues, like queue.Queue available. They normally differ in a lot of properties like listed on this excellent article by Dmitry Vyukov. As you can see, there are more than 10k different combinations possible. The algorithms used for such queues also differ widely depending on the requirements. It's not possible to just extend an existing queue algorithm to guarantee additional properties, since that normally requires different internal data structures and different algorithms.\nGo's channels offer a relatively high number of guaranteed properties, so those channels might be suitable for a lot of programs. One of the hardest requirements there is the support for reading / blocking on multiple channels at once (select statement) and to choose a channel fairly if more than one branch in a select statement is able to proceed, so that no messages will be left behind. Python's queue.Queue doesn't offer this features, so it's simply not possible to archive the same behavior with it. \nSo, if you want to continue using queue.Queue you need to find workarounds for that problem. The workarounds have however their own list of drawbacks and are harder to maintain. Looking for another producer-consumer queue which offers the features you need might be a better idea! Anyway, here are two possible workarounds:\nPolling\nwhile True:\n  try:\n    i1 = c1.get_nowait()\n    print \"received %s from c1\" % i1\n  except queue.Empty:\n    pass\n  try:\n    i2 = c2.get_nowait()\n    print \"received %s from c2\" % i2\n  except queue.Empty:\n    pass\n  time.sleep(0.1)\n\nThis might use a lot of CPU cycles while polling the channels and might be slow when there are a lot of messages. Using time.sleep() with an exponential back-off time (instead of the constant 0.1 secs shown here) might improve this version drastically.\nA single notify-queue\nqueue_id = notify.get()\nif queue_id == 1:\n  i1 = c1.get()\n  print \"received %s from c1\" % i1\nelif queue_id == 2:\n  i2 = c2.get()\n  print \"received %s from c2\" % i2\n\nWith this setup, you must send something to the notify queue after sending to c1 or c2. This might work for you, as long as only one such notify-queue is enough for you (i.e. you do not have multiple \"selects\", each blocking on a different subset of your channels).\nAlternatively you can also consider using Go. Go's goroutines and concurrency support is much more powerful than Python's limited threading capabilities anyway."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: private type with exported fields\n\nQuestion:\nIn day 2 of the go tutorial there is this exercise:\nWhy may it be useful to have a private type with exported fields?\nFor example:\npackage geometry\n\ntype point struct {\n    X, Y int;\n    name string;\n}\n\nNotice that point is lowercase and thus not exported, whereas the fields X and Y are uppercase and thus are. It seems to me, that in order to have access to one of the exported fields, you would have to be able to write something like.\np.X\n\nBut in order for that to be possible, p would have to have a declaration like such:\nvar p geomitry.point;\n\nor\np := new(geomitry.point);\n\nThis however is not possible (afaik), since the type declaration for point isn't exported.", "output": "But you could have a public constructor, right?\nSo if you had a NewGeometryPoint func defined, then you maybe could do (haven't tested against the compiler)\np := NewGeometryPoint(640,480);\nfmt.Println(\"X:\",p.X, \"Y:\",p.Y);"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a way to get the source code filename and line number in Go?\n\nQuestion:\nIn C/C++ you can use __FILE__ and __LINE__ to get access to the current file and line number. \nDoes Go provide something similar?", "output": "Indeed it does:\nhttp://golang.org/pkg/runtime/#Caller\nruntime.Caller can also be used to get the file name/line number of calling functions, too."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: iteration + casting in go\n\nQuestion:\ni have this snippet of code that use an iterator on a list\nfor x:= range s.faces.Iter(){\n    x.Render()\n}\n\nas the compiler points, x is of type interface{} and there isn't a method (i interface)Render() defined in my code.\nchanging to \nfor x:= range s.faces.Iter(){\n    x.(faceTri).Render()\n}\n\ncompile, because there is a method func (f faceTri) Render()\nbut upon execution this runtime error is raised:\npanic: interface conversion: interface is *geometry.faceTri, not geometry.faceTri\n(geometry is the package)\nso, anybody can point me to a resource that explain the go way to use iterators + casting?", "output": "That's actually called a type assertion in go, not a cast (casts are compile time conversions between certain compatible type, i.e. int -> int32).\nBased on the error you posted, you just have a tiny mistake in your code. The underlying type of x is *faceTri (a pointer to a faceTri structure), so the type assertion should be x.(*faceTri)\nEDIT:\nA few things to clarify and go beyond your question. A type assertion in go is not a cast, for example: interface_with_underlying_type_int.(int64) will panic, even though int can be cast to int64\nAlso, you can check a type assertion using the comma-ok idiom\nnot_interface, ok := some_interface.(some_type)\nok is a boolean indicating whether the conversion was successful, instead of causing a runtime panic."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Casting back to more specialised interface\n\nQuestion:\nI'm writing a game in go. In C++ I would store all my entity classes in an array of the BaseEntity class. If an entity needed to move about in the world it would be a PhysEntity which is derived from a BaseEntity, but with added methods. I tried to imitate this is go:\npackage main\n\ntype Entity interface {\n    a() string\n}\n\ntype PhysEntity interface {\n    Entity\n    b() string\n}\n\ntype BaseEntity struct { }\nfunc (e *BaseEntity) a() string { return \"Hello \" }\n\ntype BasePhysEntity struct { BaseEntity }\nfunc (e *BasePhysEntity) b() string { return \" World!\" }\n\nfunc main() {\n    physEnt := PhysEntity(new(BasePhysEntity))\n    entity := Entity(physEnt)\n    print(entity.a())\n    original := PhysEntity(entity)\n// ERROR on line above: cannot convert physEnt (type PhysEntity) to type Entity:\n    println(original.b())\n}\n\nThis will not compile as it cant tell that 'entity' was a PhysEntity. What is a suitable alternative to this method?", "output": "Use a type assertion. For example,\noriginal, ok := entity.(PhysEntity)\nif ok {\n    println(original.b())\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Replace all spaces in a string with +\n\nQuestion:\nI have a string and I want to replace every space in this string with a + I tired this by using:\ntw.Text = strings.Replace(tw.Text, \" \", \"+\", 1)\n\nBut that didn't worked for me...any solutions?\nFor example the string could look like:\nThe answer of the universe is 42", "output": "Use strings.ReplaceAll\ntw.Text = strings.ReplaceAll(tw.Text, \" \", \"+\")\n\n\nIf you're using an older version of go (< 1.12), use strings.Replace with -1 as limit (infinite)\ntw.Text = strings.Replace(tw.Text, \" \", \"+\", -1)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to use Go's time.Tick?\n\nQuestion:\nI want to print something at intervals.\nBut my code doesn't work, it throws an exception about deadlock.\nCould you please help me with it? http://play.golang.org/p/pyEoXU-6Ee\nfunc main() {\n    c := time.Tick(1 * time.Minute)\n    for now := range c {\n        fmt.Printf(\"%v \\n\", now)\n    }\n}", "output": "Play.golang.org has some strict rules to protect it. If you run this locally, it works."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: checking if array[key] isset? throw: index out of range\n\nQuestion:\nif i try to access key in array which does not exist i get\nthrow: index out of range with a stacktrace. \nHow do i check if tmp[key] \"is set\" ?", "output": "This accualy works:\nif len(url) > 1 {\n    tmp := strings.Split(url[1],\"=\",0);\n    if len(tmp) >1{\n        sess = tmp[1];\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: how do you read all the bytes that come on a tcp connection?\n\nQuestion:\nAfter you establish a connection and you want to read the bytes coming from the connection, how can you read all the bytes? From what I tried, I can read until it reaches a delimiter like a line break. But how is it possible to get everything including the line breaks? I'm trying to make a redis client in Go and the protocol separates results with \\r\\n, so in this case Buffer.ReadLine, or Buffer.ReadSlice didn't help.", "output": "To read all bytes from a Reader (like your TCP connection), you can use ioutil.ReadAll, which reads until an EOF is sent from the other side or an error occurs.\nPlease note that there are already some redis clients for go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I use the .Read function in Go?\n\nQuestion:\nTrying to use Go's http package, I can't work out the syntax of .Read. The following marked by HERE is the only thing I have got to compile, although I tried several other things which were all rejected by the compiler.\npackage main\nimport \"fmt\";\nimport \"http\";\nimport \"os\";\n\nfunc main () {\n    kinopiko_flair := \"http://stackoverflow.com/users/flair/181548.json\";\n    response, _, error := http.Get (kinopiko_flair);\n    if (error != nil) {\n        // I want to print out the error too.\n        fmt.Printf (\"Error getting %s\\n\", kinopiko_flair);\n        os.Exit (1);\n    }\n    fmt.Printf (\"Status is %s\\n\", response.Status);\n    var nr int;\n    var buf []byte;\n    nr, error = response.Body.Read (buf); // HERE\n    if (error != nil) {\n        // I want to print out the error too.\n        fmt.Printf (\"Error reading response.\\n\");\n        os.Exit (1);\n    }\n    response.Body.Close ();\n    fmt.Printf (\"Got %d bytes\\n\", nr);\n    fmt.Printf (\"Got '%s'\\n\", buf);\n}\n\nThe URL is OK, since wget gets it fine, but when I run this buf is just an empty string and nr is always zero. What do I need to do to get the data out of response? The compiler rejected .ReadAll and other things I tried.\nThe output looks like this:\n\nStatus is 200 OK\nGot 0 bytes\nGot ''", "output": "Try giving the slice buf a size, e.g.\n buf := make([]byte,128);\n\nReader reads up to len() of the buffer it is given.\nFrom io.go\n// Reader is the interface that wraps the basic Read method.\n//\n// Read reads up to len(p) bytes into p.  It returns the number of bytes\n// read (0 <= n <= len(p)) and any error encountered.\n// Even if Read returns n < len(p),\n// it may use all of p as scratch space during the call.\n// If some data is available but not len(p) bytes, Read conventionally\n// returns what is available rather than block waiting for more.\n//\n// At the end of the input stream, Read returns 0, os.EOF.\n// Read may return a non-zero number of bytes with a non-nil err.\n// In particular, a Read that exhausts the input may return n > 0, os.EOF."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Zip a byte array in Go\n\nQuestion:\nI am trying to take a chunk of bytes and compress them using the archive/zip package in Go. However, I can't understand it at all. Are there any examples of how it could be done and is there any explanation of that cryptic package?", "output": "Thanks to jamessan I did find the example (which doesn't exactly catch your eye). \nHere is what I come up with as the result:\nfunc (this *Zipnik) zipData() {\n\n    // Create a buffer to write our archive to.\n    fmt.Println(\"we are in the zipData function\")\n    buf := new(bytes.Buffer)\n\n    // Create a new zip archive.\n    zipWriter := zip.NewWriter(buf)\n\n    // Add some files to the archive.\n    var files = []struct {\n        Name, Body string\n    }{\n        {\"readme.txt\", \"This archive contains some text files.\"},\n        {\"gopher.txt\", \"Gopher names:\\nGeorge\\nGeoffrey\\nGonzo\"},\n        {\"todo.txt\", \"Get animal handling licence.\\nWrite more examples.\"},\n    }\n    for _, file := range files {\n    zipFile, err := zipWriter.Create(file.Name)\n        if err != nil {\n            fmt.Println(err)\n        }\n        _, err = zipFile.Write([]byte(file.Body))  \n        if err != nil {\n            fmt.Println(err)\n        }\n    }\n\n    // Make sure to check the error on Close.\n    err := zipWriter.Close()\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    //write the zipped file to the disk\n    ioutil.WriteFile(\"Hello.zip\", buf.Bytes(), 0777)    \n\n}\n\nI hope you find it useful :)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE Go, init() - call it multiple times?\n\nQuestion:\nI'm writing a Google App Engine Go application. In it, I want to handle some calls separately in different .go files. Should I call \"init()\" function separately in each of those files, or just declare it in one file and call some other functions for initialisation of each .go file?\nFor example, if I'd have two files, user.go:\npackage User\n\nimport(\n    \"http\"\n    \"fmt\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/\", hello)\n}\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hello, user!\")\n}\n\nAnd admin.go:\npackage Admin\n\nimport(\n    \"http\"\n    \"fmt\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/admin/\", hello)\n}\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hello, admin!\")\n}\n\nIs such an initialisation correct, or is it advised against something like this?", "output": "According to Go language specification:\n\nall initialization code is run in a single goroutine, and\ninit() functions within a single package execute in unspecified order\n\nIn your case, the packages User and Admin are independent (User does not import Admin, nor Admin imports User). This means that:\n\nthe two init() functions in User and Admin execute in unspecified order\n\n\nJoining the bodies of the two init() functions in a single init() function would look like this:\nfunc init() {\n    http.HandleFunc(\"/\", User.Hello)\n    http.HandleFunc(\"/admin/\", Admin.Hello)\n}\n\nNotice that it is irrelevant whether the program first registers \"/\" or \"/admin/\". So, the following code is also valid :\nfunc init() {\n    http.HandleFunc(\"/admin/\", Admin.Hello)\n    http.HandleFunc(\"/\", User.Hello)\n}\n\nFrom the above two snippets of code, we can see that it is OK for http.HandleFunc(\"/\", ...) and http.HandleFunc(\"/admin/\", ...) to be called in unspecified order.\n\nBecause \"/\" and \"/admin/\" can be registered in any order, and all init() functions run in a single goroutine, the answer to your question is: Yes, such an initialisation correct."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: WSDL/SOAP support on Go?\n\nQuestion:\nAre there any packages to support SOAP/WSDL on Go?", "output": "Nope.\nSOAP sucks, but I had to implement a server of an already-defined protocol that uses SOAP, so I listened with net/http and decoded/encoded envelopes with encoding/xml. In few minutes, I already served my first envelope with Go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Converting from decimal to hex\n\nQuestion:\nI want to convert a number to hex and store the result in a []byte up to length 4.\nHere's what I came up with, but it feels very roundabout.\npackage main\n\nimport (\n    \"encoding/hex\"\n    \"fmt\"\n)\n\nfunc main() {\n\n    hexstring := fmt.Sprintf(\"%x\", 12345678)\n    fmt.Println(hexstring)\n    hexbytes, _ := hex.DecodeString(hexstring)\n    for {\n        if len(hexbytes) >= 4 {\n            break\n        }\n        hexbytes = append(hexbytes, 0)\n    }\n    fmt.Println(hexbytes)\n}\n\nI think there must be a better way to do this using make([]byte, 4) and the encoding/binary package, but I couldn't get it to work. \nSandbox link: http://play.golang.org/p/IDXCatYQXY", "output": "Unless I've misunderstood your question, it isn't really about hex at all. You want to take a 32-bit integer, treat it as 4 bytes, and put those bytes into a []byte.\nFor this, you want the ByteOrder type (actually, its subtypes LittleEndian and BigEndian) from the encoding/binary package. Something like this:\npackage main\n\nimport (\n\"fmt\"\n\"encoding/binary\"\n)\n\nfunc main() {\n\n    x := 12345678\n    b := [4]byte{}\n    binary.LittleEndian.PutUint32(b[:], uint32(x))\n    fmt.Println(b)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Channels/Goroutines throwing error\n\nQuestion:\nI'm currently following this tutorial http://www.miek.nl/files/go/20120807-go.pdf and on chapter 7 it discusses channels/goroutines\nHowever the example code is throwing an error for me just after you run it.\npackage main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar c chan int\n\nfunc ready(w string, sec int) {\n    time.Sleep(time.Duration(sec) * time.Second)\n    fmt.Println(w, \"is ready!\")\n    c <- 1\n}\n\nfunc main() {\n    c := make(chan int)\n    go ready(\"Tea\", 2)\n    go ready(\"Coffee\", 1)\n    fmt.Println(\"Waiting...\")\n    <-c\n    <-c\n}\n\nHere is the output when you execute the code\ndaniel:go> go run goroutines.go \nWaiting...\nCoffee is ready!\nTea is ready!\nthrow: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\nmain.main()\n    /home/daniel/Dropbox/code/go/goroutines.go:21 +0xee\n\ngoroutine 2 [syscall]:\ncreated by runtime.main\n    /build/buildd/golang-1/src/pkg/runtime/proc.c:221\n\ngoroutine 3 [chan send (nil chan)]:\nmain.ready(0x80bb0d4, 0x3, 0x2, 0x0)\n    /home/daniel/Dropbox/code/go/goroutines.go:13 +0xe5\ncreated by main.main\n    /home/daniel/Dropbox/code/go/goroutines.go:18 +0x5e\n\ngoroutine 4 [chan send (nil chan)]:\nmain.ready(0x80bba30, 0x6, 0x1, 0x0)\n    /home/daniel/Dropbox/code/go/goroutines.go:13 +0xe5\ncreated by main.main\n    /home/daniel/Dropbox/code/go/goroutines.go:19 +0x80\n\ngoroutine 5 [timer goroutine (idle)]:\ncreated by addtimer\n    /build/buildd/golang-1/src/pkg/runtime/ztime_386.c:69\nexit status 2\n\nIs there something wrong with my code? \nAny help would be appreciated", "output": "Yes, just a typo:\npackage main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar c chan int\n\nfunc ready(w string, sec int) {\n    time.Sleep(time.Duration(sec) * time.Second)\n    fmt.Println(w, \"is ready!\")\n    c <- 1\n}\n\nfunc main() {\n    c = make(chan int) // previously c := make(chan int)\n    go ready(\"Tea\", 2)\n    go ready(\"Coffee\", 1)\n    fmt.Println(\"Waiting...\")\n    <-c\n    <-c\n}\n\nmain() didn't use the global c since it declared a new one.\nNotice that you don't have to make the channel inside main(), make it while declaring it:\nvar c = make(chan int)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google Go datastore interfaces\n\nQuestion:\nWhat are your thoughts on go-pgsql and thrift4go?\nI'd like to use Go with either Postgres or Hypertable for a project, but I'm curious as to how mature and complete these interfaces are.", "output": "I don't have specific experience with go-psql, but since there's no answer I'll write my thoughts.\nThere are issues with the current implementation, which might bite you (e.g. time resolution lower than seconds is ignored. What happens if you update a single field, but your ORM decides to include a time field within the query?).\nOther problem that I see is, there's no promise this project will be maintained as long as you wish.\nAnother approach is to build a very simple binding to the postgres C interface, and just use it. In that case, the abstraction is not very helpful, but definitely not leaky. And it might be enough.\nThat's what Russ Cox (from the core Go (golang) team) ended up doing for sqlite."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is channel buffer size?\n\nQuestion:\nI'm trying to create an asynchronous channel and I've been looking at http://golang.org/ref/spec#Making_slices_maps_and_channels. \nc := make(chan int, 10)         // channel with a buffer size of 10\n\nWhat does it mean that the buffer size is 10? What specifically does the buffer size represent/limit?", "output": "The buffer size is the number of elements that can be sent to the channel without the send blocking. By default, a channel has a buffer size of 0 (you get this with make(chan int)). This means that every single send will block until another goroutine receives from the channel. A channel of buffer size 1 can hold 1 element until sending blocks, so you'd get\nc := make(chan int, 1)\nc <- 1 // doesn't block\nc <- 2 // blocks until another goroutine receives from the channel"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Unmarshal Group with Nested XML-RPC in Go\n\nQuestion:\nI'm using Webfaction API and trying to unmarshal their response to obtain the session ID (12345abcde... below).\nHow do I access the specific value when its nested under several fields (namely, params>param)?\nCode below is at http://play.golang.org/p/krG4_fXVka\npackage main\n\nimport (\"encoding/xml\"\n        \"fmt\"\n        )\n\ntype Result struct {\n        XMLName xml.Name `xml:\"methodResponse\"`\n        Values []string `xml:\"params>param>value\"`\n}\n\nfunc main() {\ndata := `\n    <methodResponse>\n<params>\n    <param>\n        <value><array><data>\n            <value><string>12345abcde12345abcde12345</string></value>\n            <value><struct>\n                <member>\n                    <name>username</name>\n                    <value><string>trex</string></value>\n                </member>\n                <member>\n                    <name>home</name>\n                    <value><string>/home</string></value>\n                </member>\n                <member>\n                    <name>mail_server</name>\n                    <value><string>Mailbox1</string></value>\n                </member>\n                <member>\n                    <name>web_server</name>\n                    <value><string>Web12</string></value>\n                </member>\n                <member>\n                    <name>id</name>\n                    <value><int>1234</int></value>\n                </member>\n            </struct></value>\n        </data></array></value>\n    </param>\n</params>\n\n`\nv := Result{}\nerr := xml.Unmarshal([]byte(data), &v)\nif err != nil {\nfmt.Printf(\"error: %v\", err)\n        return\n}\nfmt.Printf(\"XMLName: %#v\\n\", v.XMLName)\nfmt.Printf(\"Values: %#v\\n\", v.Values)\n\n}", "output": "Not 100% clear on what you're trying to do, but this seems to break it down better?\ntype Member struct {\n    Name string `xml:\"name\"`\n    Value string `xml:\"value>string\"`\n}\n\ntype Result struct {\n        XMLName xml.Name `xml:\"methodResponse\"`\n        FirstValue string `xml:\"params>param>value>array>data>value>string\"`\n        Members []Member `xml:\"params>param>value>array>data>value>struct>member\"`\n}\n\nNote that the structure your parsing has a fairly insane level of depth. Might help to run the XML through a pretty printer that formats it for you with indent to see."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How does Go handle concurrent request on Google App Engine\n\nQuestion:\nI'm a little confused on how Go handles concurrent requests on Google App Engine. So I'm hoping someone can provide some clarity.\nHere are the facts that I have gathered:\n\nGo is single threaded on App Engine. - this is because it is possible to do arbitrary pointer arithmetic by creating race conditions with multiple threads\nGoroutines are multiplexed onto multiple OS threads so if one should block, such as while waiting for I/O, others continue to run.\n[App Engine has a] 10 concurrent limit [which] is enforced through a limit on concurrent threads on every runtime. Most of such cases, our scheduler will try to spin up a new instance.\n\nIf Go is single threaded on App Engine then point 3 is moot. This leaves 1 and 2. If Go on App Engine is single threaded and threads are required to continue execution while blocking for I/O, then it seems that an App Engine Go instance will block all goroutines while waiting on I/O.\nIs this correct? If not how does Go's concurrency really work on App Engine?\nTo help quantify things. If I were to hold a connection open for 30 seconds. How may concurrent connections could a single AE Go instance maintain?\nThank you.\n\nEDIT: here's the feature request which will allow Go Instance to\n  handle more then 10 concurrent request Allow configurable limit of\n  concurrent requests per\n  instance.\n  Please star it.", "output": "I was looking for an answer and happened upon this question/answers, but also ended up finding more official documentation on the matter.  According to a post by Andrew Gerrand and Johan Euphrosine this can be explicitly configured.\nFrom that post:\n\nThis configures each instance of the app to serve up to 100 requests concurrently (up from the default of 10). You can configure Go instances to serve up to a maximum of 500 concurrent requests."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Comparing value of nil pointer variable\n\nQuestion:\nI know that Go is little different to other languages in this respect, but I wondered if it would be worthwhile for the Go language to automatically test for nil pointers on comparisons and return unequal if only one of the values is nil (in a comparison) rather than creating a run-time error. Go is so great in so many areas I just thought it might do it. The case in point is as follows:\n\ntype cuForm struct {sName string; iUseCount int64; baForm []byte}\n\nvar pugForm *cuForm\n\n//***********************************************************\nfunc loadForm (sWanted string) (*cuForm, os.Error) {\n//***********************************************************\n\n    if (sWanted == pugForm.sName) {\n\nIn the above example, if pugForm is nil, a runtime error occurs. Obviously if only one of the values is nil, it cannot be equal - logically at least. There may well be a reason why this shouldn't be done, but I don't think history should be one reason.", "output": "The error message is: \"panic: runtime error: invalid memory address or nil pointer dereference.\" The actual error is a nil pointer dereference.\nWhen the pointer pugForm is nil then pugForm.sName is undefined. You want it to be a special value like null in SQL or NaN in floating-point. Now you need a special set of rules for all operations, not just equality.\nA nil pointer dereference is almost always wrong. The runtime should object if that happens. If it's not wrong, avoid the problem by testing for nil. Fix your error, don't try to pretend it didn't happen.\nWhat output do you expect from this program?\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var i int\n    var p *int\n    var b bool\n    b = i == *p\n    b = i <= *p\n    b = i >= *p\n    i += *p\n    i -= *p\n    i *= *p\n    i /= *p\n    i %= *p\n    i = *p << uint(i)\n    i = *p >> uint(i)\n    fmt.Println(i, p, b)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: libxml2 vs expat for an XMPP server\n\nQuestion:\nI'm trying to create an XMPP library (and later a server) from scratch in Go (although the language itself is irrelevant) as a means to learn what I can about the XMPP protocol and server software development in general.\nAs many of you know, XMPP is messaging protocol based on XML that depends on an enormous amount of short but frequent XML streams. I'm thinking that for such applications an event based XML parser should be better because I won't need DOM and all that (correct me if I'm wrong). Please keep in mind that this library is intended for servers so there might be many instances run at once; \nWhich one of the two has better performance and memory usage for that use case, libxml2 or expat?", "output": "There is a whole project devoted to answering the question of XML performance called XML Benchmark.\nThe short answer, in my opinion, is to use libxml2, but I have other considerations beyond pure performance, such as platform availability. That said, it is generally faster than expat according to the latest numbers, though it's fairly close in the great scheme of things.\nAnd yes, you want to use the SAX parser, not the DOM parser."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Deploying Go web applications with Apache\n\nQuestion:\nI can not find a mod_go for deploying Go web applications. Is there any other way to run web applications in Go with an Apache web server (or even IIS)?\nUpdate: Now after doing Go full time for nearly a year; doing this (Go with Apache) is nullifying the very purpose of Go (Performance in terms of being highly concurrent). And I'm using nginx as a reverse proxy for http/https and having my Go backends behind it nicely. Though you have to change your mindset on webapps a bit when using Go.", "output": "There's no mod_go. (At least I've not heard of such a thing.)\nA go web app by itself is a capable web server. You can listen to port 80 in your app and then directly run it on your server. Trust me: it really works!\nBut if you are not doing that (for reasons such as having other virtual servers on the same machine, load balancing, etc.), you can use a HTTP server such as nginx or Apache as a HTTP proxy in front of your Go app. I use nginx and it's great. Here's an outdated but still very useful guide on how to do that with nginx. I haven't done it with Apache, but this should help.\nI recommend your Go web app by itself or nginx as a HTTP proxy."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang: cross platform path.Dir\n\nQuestion:\nI'd like to use path.Dir() on Unix and Windows with a platform specific directory. Please take a look at the code:\npackage main\n\nimport (\n    \"fmt\"\n    \"path\"\n)\n\nfunc main() {\n    fmt.Println(`path.Dir(\"a/b/c\"): `, path.Dir(\"a/b/c\"))\n    fmt.Println(`path.Dir(\"c:\\foo\\bar.exe\"): `, path.Dir(`c:\\foo\\bar.exe`))\n}\n\nThis outputs \npath.Dir(\"a/b/c\"):  a/b\npath.Dir(\"c:\\foo\\bar.exe\"):  .\n\nI'd like to get for the second call to path.Dir() (windows) something like\nc:\\foo\n\nIs it possible to tell path.dir() to use Windows separators for my program running on windows? Or should I always convert the backslashes \\  to forward slashes (/)? What is the preferred strategy here?", "output": "I see where the \"problem\" is. This discussion at golang-nuts gave me the hint, that path.Dir() always uses / and filepath.Dir() is the function to be used for platform dependent manipulation.\npackage main\n\nimport (\n    \"fmt\"\n    \"path/filepath\"\n)\n\nfunc main() {\n    fmt.Println(`filepath.Dir(\"a/b/c\"): `, filepath.Dir(\"a/b/c\"))\n    fmt.Println(`filepath.Dir(\"c:\\foo\\bar.exe\"): `, filepath.Dir(`c:\\foo\\bar.exe`))\n}\n\non windows:\nfilepath.Dir(\"a/b/c\"):  a\\b\nfilepath.Dir(\"c:\\foo\\bar.exe\"):  c:\\foo"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to fork a process\n\nQuestion:\nI need help understanding how to demonize a process in Go.\npackage main\n\nimport (\n   \"fmt\"\n   \"os\"\n)\n\nfunc start() {\n   var procAttr os.ProcAttr \n   procAttr.Files = []*os.File{nil, nil, nil}\n   _, err := os.StartProcess(\"/Path/prog\", nil, &procAttr)\n   if err != nil {\n       fmt.Printf(\"%v\", err)\n   }\n}\n\n\nfunc main () {\n   start()\n} \n\nIf you start this code on the command line the program returns control, but is still connected with cmd. Closing the cmd closes the program.\nHow can I decouple it from the cmd?  Adding:\nprocAttr.Sys.HideWindow = true\n\nResults in this error: \"panic\" to wrong memory pointer", "output": "I asked in 'golang-nuts', and found out that Go has a link option:\ngo tool 8l -o output.exe -Hwindowsgui input.8"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go, basic access authentication\n\nQuestion:\nDoes Google Go support decoding of basic access authentication calls? How do I get the username and password from the http.Request?", "output": "Go does not seem to intercept basic authentication when it is typed as an URL in a browser, but it does allow one to get it from some other applications calling it.\nFor example, using a simple Python code for HTTP JSON RPC:\nfrom jsonrpc import ServiceProxy\naccess = ServiceProxy(\"http://user:pass@127.0.0.1:8080/\")\nprint access.getinfo()\n\nAnd in Go calling:\n// r *http.Request\nr.Header[\"Authorization\"]\n\nOne gets this string:\n[Basic dXNlcjpwYXNz]\n\nAnd\ndXNlcjpwYXNz\n\nBase-64 decoded gives\nuser:pass\n\nSo some basic authentication in Go is possible, although it might not be something one can rely on."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go, init custom type\n\nQuestion:\nSuppose, I am writing a minesweeper game, and i have a struct to hold the game field, that contains a 2D array with mines. Suppose, i want to initialize it with some mines. Is there a way to say gameField GameField = new(GameField, 30), similar to what i'd do in java?\nHere is some code to illustrate my point:\n\ntype GameField struct {\n  field [20][20] int\n}\nfunc (this *GameField) scatterMines(numberOfMines int) {\n  //some logic to place the numberOfMines mines randomly\n}\n\nWhat i want is to call an initializer and have that scatterMines func executed automatically.", "output": "A pattern I've seen in Go structs is a corresponding NewXxx method (e.g., image pkg):\ntype GameField struct {\n  field [20][20] int\n}\n\nfunc NewGameField(numberOfMines int) *GameField {\n  g := new(GameField)\n  //some logic to place the numberOfMines mines randomly\n  //...\n  return g\n}\n\nfunc main() {\n    g := NewGameField(30)\n    //...\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you time a function in Go and return its runtime in milliseconds?\n\nQuestion:\nHow do you time a function in Go and return its runtime in milliseconds?", "output": "Use the Go testing package to benchmark the function. For example,\npackage main\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\n// the function to be benchmarked\nfunc Function(n int) int64 {\n    n64 := int64(n)\n    return n64 * n64\n}\n\nfunc BenchmarkFunction(b *testing.B) {\n    n := 42\n    for i := 0; i < b.N; i++ {\n        _ = Function(n)\n    }\n}\n\nfunc main() {\n    br := testing.Benchmark(BenchmarkFunction)\n    fmt.Println(br)\n}\n\nOutput:\n500000000            4.22 ns/op\n\nYou can also use the Go gotest command to run benchmarks."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: In Go, how to write a multi-line statement?\n\nQuestion:\nIn python, we use backslash to indicate that the current statement continues to next line\nfor example,\na = b + c + s \\\n    + x + y\n\nor simply,\na = b + c + s +\n    x + y\n\nIs it possible to do that in Go language? Thanks", "output": "Sure it is, just put an operator at the end, for example:\na = b + c + s +\n    x + y\n\nAlso note that it's not possible to break the line before the operator. The following code is invalid:\na = b + c + s\n    + x + y\n\nThe rule is described here and in the specification."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to access resource files after the 'go' tool installed the executable?\n\nQuestion:\nLets assume that running go install -v importpath builds an executable and installs it into $GOPATH/bin/program. The go tool is unable to install resource files. When I run the program, I would like it to access some resource files that are under $GOPATH/src/importpath.\nWhat is the best way of accessing such resource files from the installed executable?", "output": "This question has been asked multiple times on the go-nuts mailing list. The go tool doesn't offer a direct way to distribute additional resources at the moment. However, there are two workarounds available:\n\nwrite a simple script (awk should be sufficient) to convert any file into a .go file which just contains a single string constant and embed the file directly into the binary. This approach is used by the Camlistore project for example (camlistored/ui/fileembed.go). go-bindata does similar things.\ngo-tour and many other projects are currently using the Import function of the go/build package to search through all src/ folders listed in $GOPATH and $GOROOT to find the correct path of the package sources. Example: http://code.google.com/p/go-tour/source/browse/gotour/local.go?r=996704f8ef9e63949b3bc4d94b613ec4a7b5d99a#53"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you create a new instance of a struct from its type at run time in Go?\n\nQuestion:\nIn Go, how do you create the instance of an object from its type at run time?  I suppose you would also need to get the actual type of the object first too?\nI am trying to do lazy instantiation to save memory.", "output": "In order to do that you need reflect.\npackage main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    // one way is to have a value of the type you want already\n    a := 1\n    // reflect.New works kind of like the built-in function new\n    // We'll get a reflected pointer to a new int value\n    intPtr := reflect.New(reflect.TypeOf(a))\n    // Just to prove it\n    b := intPtr.Elem().Interface().(int)\n    // Prints 0\n    fmt.Println(b)\n\n    // We can also use reflect.New without having a value of the type\n    var nilInt *int\n    intType := reflect.TypeOf(nilInt).Elem()\n    intPtr2 := reflect.New(intType)\n    // Same as above\n    c := intPtr2.Elem().Interface().(int)\n    // Prints 0 again\n    fmt.Println(c)\n}\n\nYou can do the same thing with a struct type instead of an int. Or anything else, really. Just be sure to know the distinction between new and make when it comes to map and slice types."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Filtering datastore results by parent entity\n\nQuestion:\nThis question as already been answered for Python: \nHow to get all records from GAE datastore with particular parent?\nHow do I do it in Go? I would like to do something like:\nt := new(TagRecord)\nk, err := datastore.DecodeKey(r.URL.Path[1:])\n...\n_, err = datastore.NewQuery(\"TagRecord\").\n  Filter(\"Parent =\", k). \n  Order(\"-CreatedAt\").\n  Limit(1).\n  Run(c).Next(t)\n\n...but this fails miserably with the following error:\ndatastore: query has no more results\n\nWhen I try filtering by other properties, including those hard coded into the filter and those passed through the URL, the query runs properly and populates t with the proper properties. With what humiliating simplicity can my problem be fixed?", "output": "What's tripping you up here is that querying by parent does not use Filter(). Instead, you use an ancestor constraint:\nq := datastore.NewQuery(\"TagRecord\").\n    Ancestor(k).\n    Order(\"-CreatedAt\").\n    Limit(1)\n\n// etc..."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can a Go struct inherit a set of values?\n\nQuestion:\nCan a Go struct inherit a set of values from a type of another struct?\nSomething like this.\ntype Foo struct {\n    Val1, Val2, Val3 int\n}\n\nvar f *Foo = &Foo{123, 234, 354}\n\ntype Bar struct {\n    // somehow add the f here so that it will be used in \"Bar\" inheritance\n    OtherVal string\n}\n\nWhich would let me do this.\nb := Bar{\"test\"}\nfmt.Println(b.Val2) // 234\n\nIf not, what technique could be used to achieve something similar?", "output": "Here's how you may embed the Foo struct in the Bar one :\ntype Foo struct {\n    Val1, Val2, Val3 int\n}\ntype Bar struct {\n    Foo\n    OtherVal string\n}\nfunc main() {\n    f := &Foo{123, 234, 354}\n    b := &Bar{*f, \"test\"}\n    fmt.Println(b.Val2) // prints 234\n    f.Val2 = 567\n    fmt.Println(b.Val2) // still 234\n}\n\nNow suppose you don't want the values to be copied and that you want b to change if f changes. Then you don't want embedding but composition with a pointer :\ntype Foo struct {\n    Val1, Val2, Val3 int\n}\ntype Bar struct {\n    *Foo\n    OtherVal string\n}\nfunc main() {\n    f := &Foo{123, 234, 354}\n    b := &Bar{f, \"test\"}\n    fmt.Println(b.Val2) // 234\n    f.Val2 = 567\n    fmt.Println(b.Val2) // 567\n}\n\nTwo different kind of composition, with different abilities."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: representing JSON policy in Go\n\nQuestion:\nI would like to Generate this JSON policy:\n{\"Statement\":[{\"Resource\":\"RESOURCE\",\"Condition\":{\"DateLessThan\":{\"AWS:EpochTime\":EXPIRES}}}]}\n\nThe solution I'm showing below produces the following JSON:\n{\"Statement\":{\"Resource\":\"example.com\",\"Condition\":{\"DateLessThan\":{\"AWS:EpochTime\":\"1234543\"}}}}\n\nHow do I change this so that \"Statement\": has an array value?\npackage main \nimport ( \n        \"json\" \n        \"fmt\" \n) \n\ntype S struct { \n        Statement Statement \n} \n\ntype Statement struct { \n        Resource  string \n        Condition Date \n} \n\ntype Date struct { \n        DateLessThan AWS \n} \n\ntype AWS struct { \n        EpochTime string \"AWS:EpochTime\" \n} \n\nfunc main() { \n        expires := \"1234543\" \n        resource := \"example.com\" \n        date := &AWS{EpochTime: expires} \n        date2 := &Date{DateLessThan:*date} \n        reso := &Statement{Resource: resource, Condition: *date2} \n        statement := &S{Statement: *reso} \n        result1, _ := json.Marshal(statement) \n        fmt.Printf(result1) \n}", "output": "Apply the following changes:\ntype S struct { \n    Statement []Statement \n}\n...\n    s_array := []Statement{*reso}\n    statement := &S{Statement: s_array}\n\nHopefully that should make it clear: you want a slice of Statement objects, rather than just a single Statement."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang import struct pointer\n\nQuestion:\nOk i have a main package and a http handler package. Essentially what i am trying to do is setup a global struct so that way i can call upon information in that struct at any time.\nBasic outline of my attempted example below:\nMain package imports handler function\nMain package calls handlerfunc\nHandlerfunc sets http.ResponseWriter and other items into UrlInfo struct\nHandlerfunc runs passed in function (without having to pass UrlStruct into function)\nRun function (home in this example)\nFunction home can call upon variable uinfo at any time cause its a pointer UrlInfo struct\nObviously this doesnt work, but this is essentially what i would like to do so that way im not having to pass all this info into my home function. Keeping it clean and simple.\nAny thoughts and ideas are welcome. Thanks.\nHandler Package\n\npackage handler\n\n// Struct containing http requests and variables\ntype UrlInfo struct {\n    Res http.ResponseWriter\n    Req *http.Request\n    Item string\n}\n\nfunc HandleFunc(handlepath string, runfunc func()) {\n    // Set handler and setup struct\n    http.HandleFunc(handlepath, func(w http.ResponseWriter, r *http.Request) {\n        url := new(UrlInfo)\n        url.Res = w\n        url.Req = r\n        url.Item = \"Item information\"\n\n        runfunc()\n    })\n}\n\nMain Package\n\nimport \"handler\"\n\nvar uinfo = &handler.UrlInfo{}\n\nfunc init() {\n    handler.HandleFunc(\"/home/\", home)\n}\n\nfunc home() {\n    fmt.Println(uinfo.Item)\n}", "output": "From what I gather from your question, you are attempting to define a single, global instance of a structure which, among other things, holds a reference to the current Request and ResponseWriter.\nIf this is the intention, I should warn you this is going to cause problems.\nGo's http package executes each request handler in a separate goroutine. This means that you can have arbitrarily many requests being handled simultaneously. Therefore they can not all refer to the same global structure safely and expect it to contain request information relevant only to that particular request. The global instance should not be used if you expect your server to be thread safe.\nKeeping the code clean by grouping extraneous parameters in a structure can be handy, but in your case, I do not believe you can (or should) avoid passing a new instance of UrlInfo structure directly to home() as a parameter. It will make things unnecessarily complex and unpredictable."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: making generic algorithms in go\n\nQuestion:\nI can't figure out a clean way to implement an algorithm that will work on any type.\nThe following code will produce errors trying to convert a string or a typed slice into interfaces, and you can't compare interface{} objects: invalid operation: result[0] > result[n - 1] (operator > not defined on interface)\nfunc main() {\n    c := Algo(\"abc\")\n    //...\n    c := Algo([3]int{1,2,3})\n    //...\n}\n\nfunc Algo(list []interface{}) chan []interface{} {\n    n := len(list)\n    out := make(chan []interface{})\n    go func () {\n        for i := 0; i < n; i++ {\n            result := make([]interface{}, n)\n            copy(result, list)\n            // an actually useful algorithm goes here:\n            if (result[0] > result[n-1]) {\n                result[0], result[n-1] = result[n-1], result[0]\n            }\n            out <- result\n        }\n        close(out)\n    }()\n    return out\n}\n\nAlthough it's a pain (I think it should be automatic), I can manually box and unbox typed slices into interface{}s, the real problem above is the comparison. And it just keeps getting more and more kludgy.\na := [3]int{1,2,3}\nb := make([]interface{}, len(a))\nfor i, _ := range a {\n    b[i] = a[i]\n}\n\nI've even thought of using vector.Vector, but so many people say never to use them.\nSo should I just implement the same algorithm for int slices and strings?  What about slices of myObject?  I can make an interface with a custom comparison func, but then how do I make it work with standard types?", "output": "You can do this in Go using interfaces.  A function that takes an interface type is generic in the sense that it doesn't care about the data representation of the underlying concrete type.  It does everything through method calls.\nTo make a generic version of your algorithm then, you have to identify all of the capabilities that the algorithm requires of the data objects and you have to define methods that abstract these capabilities.  The abstract method signatures become method sets of interfaces.\nTo make a type compatible with this kind of generic algorithm, you define methods on the type to satisfy the interface of the algorithm parameter.\nI'll take your example code and show one way to do this.  Most of the required capabilities happen to be covered by sort.Interface so I chose to embed it.  Only one other capability is needed, one to make a copy of the data.\ntype algoContainer interface {\n    sort.Interface\n    Copy() algoContainer\n}\n\nBelow is a complete working program made from your example code.\npackage main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\nfunc main() {\n    s1 := sortableString(\"abc\")\n    c1 := Algo(s1)\n    fmt.Println(s1, <-c1)\n\n    s2 := sortable3Ints([3]int{1,2,3})\n    c2 := Algo(&s2)\n    fmt.Println(s2, <-c2)\n}\n\ntype algoContainer interface {\n    sort.Interface\n    Copy() algoContainer\n}\n\ntype sortableString []byte\nfunc (s sortableString) Len() int { return len(s) }\nfunc (s sortableString) Swap(i, j int) { s[i], s[j] = s[j], s[i] }\nfunc (s sortableString) Less(i, j int) bool { return s[i] < s[j] }\nfunc (s sortableString) Copy() algoContainer {\n   return append(sortableString{}, s...)\n}\nfunc (s sortableString) String() string { return string(s) }\n\ntype sortable3Ints [3]int\nfunc (sortable3Ints) Len() int { return 3 }\nfunc (s *sortable3Ints) Swap(i, j int) {\n   (*s)[i], (*s)[j] = (*s)[j], (*s)[i]\n}\nfunc (s sortable3Ints) Less(i, j int) bool { return s[i] < s[j] }\nfunc (s sortable3Ints) Copy() algoContainer { c := s; return &c }\n\nfunc Algo(list algoContainer) chan algoContainer {\n    n := list.Len()\n    out := make(chan algoContainer)\n    go func () {\n        for i := 0; i < n; i++ {\n            result := list.Copy()\n            // actually useful:\n            if result.Less(n-1, 0) {\n                result.Swap(n-1, 0)\n            }\n            out <- result\n        }\n        close(out)\n    }()\n    return out\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Read in lines in a text file, sort, then overwrite file\n\nQuestion:\nI am trying to write a go function that will read in lines in a text file, sort them (alphabetize), and overwrite them back to the file. Right now, I am able to essentially emulate cat, but I can't seem to be able to manipulate the contents of the elements in read_line. \nfunc sort() {\n\n    ff, _ := os.OpenFile(file, os.O_RDWR, 0666)\n    f := bufio.NewReader(ff)\n    for {\n        read_line, _ := f.ReadString('\\n')\n        fmt.Print(read_line)\n        if read_line == \"\" {\n            break\n        }\n    }\n    ff.Close()\n}\n\nwhen i use ReadString, how can i store each line into a slice (or is there a better way to store them so i can manipulate them)? Then I would use the sort package in a manner similar to this:\nsorted := sort.Strings(lines) \n\nthen, to write to the file, i am using something similar to the following, although i have not included it because i have not yet gotten \"sort\" to work:\nio.WriteString(ff, (lines + \"\\n\"))\n\nThank you in advance for any suggestions!", "output": "For example,\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"sort\"\n)\n\nfunc readLines(file string) (lines []string, err os.Error) {\n    f, err := os.Open(file)\n    if err != nil {\n        return nil, err\n    }\n    defer f.Close()\n    r := bufio.NewReader(f)\n    for {\n        const delim = '\\n'\n        line, err := r.ReadString(delim)\n        if err == nil || len(line) > 0 {\n            if err != nil {\n                line += string(delim)\n            }\n            lines = append(lines, line)\n        }\n        if err != nil {\n            if err == os.EOF {\n                break\n            }\n            return nil, err\n        }\n    }\n    return lines, nil\n}\n\nfunc writeLines(file string, lines []string) (err os.Error) {\n    f, err := os.Create(file)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n    w := bufio.NewWriter(f)\n    defer w.Flush()\n    for _, line := range lines {\n        _, err := w.WriteString(line)\n        if err != nil {\n            return err\n        }\n    }\n    return nil\n}\n\nfunc main() {\n    file := `lines.txt`\n    lines, err := readLines(file)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    sort.Strings(lines)\n    err = writeLines(file, lines)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What ways does Go have to easily convert data into bytes or strings\n\nQuestion:\nI've been developing a couple apps using Google App Engine Go SDK that use Memcache as a buffer for loading data from the Datastore. As the Memcache is only able to store data as []byte, I often find myself creating functions to encode the various structures as strings, and also functions to reverse the process. Needless to say, it is quite tedious when I need to do this sort of thing 5 times over.\nIs there an easy way to convert any arbitrary structure that can be stored in Datastore into []byte in order to store it in Memcache and then load it back without having to create custom code for various structures in GAE Golang?", "output": "http://golang.org/pkg/encoding/gob or http://golang.org/pkg/encoding/json can turn arbitrary datatypes into []byte slices given certain rules apply to the datastructures being encoded. You probably want one of them gob will encode to smaller sizes but json is more easily shareable with other languages if that is a requirement."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Determining requester's IP address in RPC call\n\nQuestion:\nIn Go using the standard net/rpc functionality, I would like to determine what the IP address an inbound RPC request is coming from.  The underlying http functionality appears to provide this in the http.Request object, but I cannot see any way of getting at that from the default RPC handler (set using rpc.HandleHTTP).\nIs there some hidden mechanism for getting at the underlying http.Request, or do I have to do something fancier with setting up a different HTTP responder?", "output": "You can also use https://github.com/valyala/gorpc instead of net/rpc, which passes client address to RPC server handler - see http://godoc.org/github.com/valyala/gorpc#HandlerFunc for details."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to measure test coverage in Go\n\nQuestion:\nHas anyone succeeded in generating code coverage for Go unit tests? I can't find a tool for that on the web.", "output": "Note that Go 1.2 (Q4 2013, rc1 is available) will now display test coverage results:\n\nOne major new feature of go test is that it can now compute and, with help from a new, separately installed \"go tool cover\" program, display test coverage results.\nThe cover tool is part of the go.tools subrepository. It can be installed by running\n$ go get golang.org/x/tools/cmd/cover\n\nThe cover tool does two things.\n\nFirst, when \"go test\" is given the -cover flag, it is run automatically to rewrite the source for the package and insert instrumentation statements. The test is then compiled and run as usual, and basic coverage statistics are reported:\n$ go test -coverprofile fmtcoverage.html fmt\nok    fmt 0.060s  coverage: 91.4% of statements\n$\n\nSecond, for more detailed reports, different flags to \"go test\" can create a coverage profile file, which the cover program, invoked with \"go tool cover\", can then analyze.\n\n\n\nFrank Shearar mentions:\n\nThe latest versions of Go (2013/09/19) use:\ngo test -coverprofile <filename> <package name>\n\nDetails on how to generate and analyze coverage statistics can be found by running the commands\n$ go help testflag\n$ go tool cover -help\n\n\n\nIvan Black mentions in the comments:\n\ngo test -coverprofile cover.out and then\ngo tool cover -html=cover.out opens cover.out in your default browser\nI don't even want to wait for the browser to open, so I defined this alias:\nalias gc=grep -v -e \" 1$\" cover.out\n\nThat I just type gc, and have a list of all the lines not yet covered (here: with a coverage.out line not ending with \" 1\").\n\n\nUpdate 2022, possibly for Go 1.19\n\nproposal: extend Go's code coverage testing to include applications\n\n\nWhile the existing \"go test\" based coverage workflow will continue to be supported, the proposal is to add coverage as a new build mode for \"go build\".\nIn the same way that users can build a race-detector instrumented executable using \"go build -race\", it will be possible to build a coverage-instrumented executable using \"go build -cover\".\nMerging coverage profiles produced in different GOOS/GOARCH environments will be supported."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go interactive shell\n\nQuestion:\nPossible Duplicate:\nDoes Go provide REPL? \n\nDoes anyone know if there is an REPL (interactive go shell, similar to irb) available for go which allows the user to use import statements? I'd like to be able to do something like this:\n$igo import ( \n             \"log\"\n             \"mypackage/pkg\"\n            )\nlog.Print(\"hello, world!\")\npkg.Print(\"Hello\")\n...\n\nI've tried igo but that doesn't seem to support this yet.", "output": "There is go-eval from the same author as igo.\nIt's an improvement on the old exp/eval package.\nHowever, I was not able to import packages due to missing symbols, which is probably the reason for igo not supporting the import statement.\nIt's probably the best to go with compile/execute software as seen on play.golang.org."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go language's godoc on command prompt\n\nQuestion:\ngodoc fmt\n\nThis command displays the documentation of fmt package. But this has a lot of content and does not support paging control(/p) of command prompt.\n\n    godoc fmt /p\n\nPlease let me know how can I get paged documentation in command prompt.", "output": "you can try this:\ngodoc fmt | more\n\nmore is not specific for \"godoc\" and should work for the output of any command. press the spacebar to move to the next page."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: strange sqlite error in gosqlite (golang)\n\nQuestion:\nI got a strange error and can't find out whats going wrong.\nI use this function to save an incoming message:\nfunc (mdb *MailDB) SaveMail(mail *Mail){\n    conn, err := sqlite.Open(\"maildb.db\")\n    if err != nil {\n        log.Print(\"Unable to open the database: \", err)\n        return\n    }\n    defer conn.Close()\n    insertsql := fmt.Sprintf(`INSERT INTO mails (sender,subject,text,time) VALUES (\"%v\", \"%v\", \"%v\", %v) ;`,\n                    mail.Sender,mail.Subject,mail.Text,time.Now().Unix())\n    err = conn.Exec(insertsql)\n    if err!=nil {\n        log.Print(\"maildb insert fail @exec: \",err)\n        log.Print(insertsql)\n        return\n    }\n}\n\nI get this error:\n2012/05/09 10:10:20 maildb insert fail @exec: SQL error or missing database: unrecognized token: \"\"\"\n2012/05/09 10:10:20 INSERT INTO mails (sender,subject,text,time) VALUES (\"wLrOBizTcmS1MlqeXydUK9U6YJQ=\", \"abc\", \"321\n\", 1336551020) ;\n\n(after 321 is an '\\n' i dont know why its ommited here)\nThe strange thing is, that I can send the copy'n'pasted query in an sqlite console without problems.\ndo someone see whats going wrong?\nplease help!", "output": "I think your problem is using \" to delimit string literals while this is not standard SQL syntax, and not supported by sqlite as well.\nTo cite its manual:\n\nA string constant is formed by enclosing the string in single quotes ('). A single quote within the string can be encoded by putting two single quotes in a row - as in Pascal. C-style escapes using the backslash character are not supported because they are not standard SQL\n\nSo the obvious fix should be using\ninsertsql := fmt.Sprintf(`INSERT INTO mails (sender,subject,text,time) VALUES ('%v', '%v', '%v', %v) ;`, ...)\n\nAlso note that constructing the SQL statements like you do is naive and is subject to SQL injection attacks.  The proper way would be to first create a prepared statement, then bind its parameters to actual values and then executing it.  I have no experience with Go bindings to sqlite so I can't tell if they support the API I referred to but I think you should try to investigate this."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: web.go install error\n\nQuestion:\nI am trying to install web.go using goinstall github.com/hoisie/web.go, and I keep getting an error about the path.\ngoinstall: github.com/hoisie/web.go: git: no such file or directory\n\ngoinstall is working for sure because when I type in just goinstall I get the options list for it. Any ideas on what I am doing wrong?\nMetropolis", "output": "You need to install git (http://git-scm.com) in order to fetch packages from a git repository. \nCheers,\nFabian"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google Go Win: can't find import \"http\"\n\nQuestion:\nI downloaded Go for Windows (go.weekly.2012-01-27.windows-amd64.tar.gz), set the environment variables\nGOOS=windows\nGOROOT=c:\\go\nGOBIN=c:\\go\\bin\nGOARCH=386\n\nand was able to create a HelloWorld.exe. Now I've tried a very simple example that imports \"http\", but it doesn't find it. Do I need goinstall or add sth. to the PATH?", "output": "import \"net/http\" // was \"http\" in r60 IIRC"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Drop-in packages in Go?\n\nQuestion:\nHow would I go about having a package register some object (for instance a function) to a registry at load time such that adding a new package to the program will automatically add new functionality to the program without having to modify code in other packages?\nHere's a code sample which should illustrate what I'm trying to do.\nsrc/say/say.go:\npackage main\n\nimport (\n    \"os\"\n    \"reg\"\n)\n\nfunc main() {\n    if len(os.Args) != 2 {\n        os.Stderr.WriteString(\"usage:\\n    say <what_to_say>\\n\")\n        os.Exit(1)\n    }\n\n    cmd, ok := reg.GetFunc(os.Args[1])\n    if ok {\n        os.Stdout.WriteString(cmd())\n        os.Stdout.Write([]byte{'\\n'})\n    } else {\n        os.Stderr.WriteString(\"I can't say that!\\n\")\n        os.Exit(1)\n    }\n}\n\nsrc/reg/reg.go:\npackage reg\n\nvar registry = make(map[string]func() string)\n\nfunc Register(name string, f func() string) {\n    registry[name] = f\n}\n\nfunc GetFunc(name string) (func() string, bool) {\n    f, ok := registry[name]\n    return f, ok\n}\n\nsrc/hi/hi.go:\npackage hi\n\nimport (\n    \"reg\"\n}\n\nfunc init() {\n    reg.Register(\"hi\", func() string {\n        return \"Hello there!\"\n    })\n}\n\nWhen coding this up, I naively supposed that perhaps the package \"hi\" would be found by the go compiler and compiled into the binary.  Then, at load time, the init() function would run.  If that was how things worked, I'd have been able to drop in something like the following to add a new \"say no\" command:\nsrc/no/no.go:\npackage no\n\nimport (\n    \"reg\"\n)\n\nfunc init() {\n    reg.Register(\"no\", func() string {\n        return \"Not a chance, bub.\"\n    })\n}\n\nBut, it doesn't seem to work that way.\nI may just be thinking about the problem too much through a Pythonic lens, but is there some way to accomplish something somewhat like what I'm shooting for?  If not, I'll change my tack and I will have learned something new about the Go way of doing things.\nThanks in advance!", "output": "Since you must use import in order for the compiler add a package, my suggestion would be to do the following:\nInstead of using multiple drop-in packages, you could have only one single package with multiple drop-in files. Each command file is placed in the same package folder (cmds). This is possible since you are allowed to have multiple init in a package, and you would not have to make any edits to say.go, no matter how many new drop-in files you add.\npackage main\n\nimport (\n    \"os\"\n    \"reg\"\n    _ \"cmds\"\n)\n....\n\nAnd previous package no\n// Command no\npackage cmds\n\nimport (\n    \"reg\"\n)\n\nfunc init() {\n    reg.Register(\"no\", func() string {\n        return \"Not a chance, bub.\"\n    })\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What sort of projects should I use Go for?\n\nQuestion:\nThe Go language is a new programming language from Google. It is still in an experimental phase and I am having trouble figuring out how stable it is. What sort of projects would you risk using Go for?", "output": "As you said, it is still an experimental programming language so I would only use it for experimental projects, for now. The implementation is still young but more importantly the ecosystem around it is also not very mature. In other words you'll probably have a hard time finding frameworks and libraries to help speed up your development and may end up needing to code a lot more than if you had chosen a more mature language."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: One type is coerced into another, can a method to determine the type of the receiver?\n\nQuestion:\nIf types T1 and T2 are based on type T, and type T only comes into existence from a NewT1() or NewT2(), is there any way a function func (*T) WhoAmI() can know whether it \"really\" is a T1 or T2?\npackage main\n\nimport \"fmt\"\nimport \"reflect\"\n\ntype T struct{ s string }\n\nfunc (v *T) WhoAmI() string {\n\n    // pull type name with reflect\n    fmt.Println(reflect.TypeOf(v).Elem().Name()) // always prints \"T\"!\n\n    // todo: if I am actually T1\n    return \"T1\"\n    // todo: else if I am actually T2\n    return \"T2\"\n}\n\ntype T1 T\n\nfunc NewT1(s string) T1 { return T1{s} }\n\ntype T2 T\n\nfunc NewT2(s string) T2 { return T2{s} }\n\nfunc main() {\n    var t1 = T1{\"xyz\"}\n    var t2 = T2{\"pdq\"}\n    s1 := ((*T)(&t1)).WhoAmI() // would like to return \"T1\"\n    s2 := ((*T)(&t2)).WhoAmI() // would like to return \"T2\"\n    fmt.Println(s1, s2)\n}\n\n\nto speak technically:\nonce t1 type T1 is coerced into type T so func (*T) WhoAmI() can be called, does t1 completely lose the fact that its type is really T1?  if not, how do we reclaim the knowledge from the perspective of a method receiving type T?\nto speak generally:\nin other words, if one type is based on another, if a variable of the derived type is coerced into the base type to run a method, can that method learn the real type of the receiver who called it?", "output": "No, it's not possible. Creating a new type from an old one is not like creating a new class that inherits from a parent class in an class-based language. In your case T knows nothing about either T1 or T2 and if you're calling the WhoAmI method you have a receiver of type T by definition.\nYour design might work better with an interface. Try something more like this:\ntype T interface {\n    WhoAmI() string\n}\n\ntype T1 struct {\n    s string\n}\n\nfunc (t *T1) WhoAmI() string { return \"T1\" }\n\ntype T2 struct {\n    s string\n}\n\nfunc (t *T2) WhoAmI() string { return \"T2\" }\n\nTry it on the Go playground\nT1 and T2 both implement the interface T, so they can be used as type T."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: in golang, reflect pkg, 8g error \"undefined: reflect.NewValue\"\n\nQuestion:\nlittle confused with reflect pkg\nall of the examples us reflect.NewValue() to get the reflect.Value of a var, but \n\nfunc NewValue is not documented in http://golang.org/pkg/reflect/\nthe 8g compiler returns \"undefined: reflect.NewValue\"\n\nis NewValue() still supported? if not, how does one get reflect.Value from a var?\n\nthe Typeof and NewValue functions have been renamed to TypeOf and ValueOf.", "output": "The Go reflect package was substantially revised for the weekly.2011-04-13 and subsequent releases. For details, see revision 843855f3c026."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the role of the \"interface {}\" syntax in Go?\n\nQuestion:\nI've read through the Effective Go and Go Tutorials as well as some source, but the exact mechanism behind the interface {} syntax is Go is somewhat mysterious to me. I first saw it when trying to implement heap.Interface and it seems to be a container of some kind (reminds me of a monad a little) from which I can extract values of arbitrary type.\nWhy is Go written to use this?  Is it some kind of workaround for generics? Is there a more elegant way to get values from a heap.Interface than having to dereference them with heap.Pop(&h).(*Foo) (in the case of a heap pointers to type Foo)?", "output": "interface{} is a generic box that can hold everything. Interfaces in go define a set of methods, and any type which implements these methods conforms to the interface. interface{} defines no methods, and so by definition, every single type conforms to this interface and therefore can be held in a value of type interface{}.\nIt's not really like generics at all. Instead, it's a way to relax the type system and say \"any value at all can be passed here\". The equivalent in C for this functionality is a void * pointer, except in Go you can query the type of the value that's being held."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: cast from float32 to int in Go\n\nQuestion:\nI have tried several ways to cast a float to an int, what I want is to truncate a float so I only get the integer part.\nI'm using\nx := float32(3.1)\ny,_ := strconv.Atoi((strconv.Ftoa32(x,'f',0))) //y becomes 3\n\nBut if x is 3.9, y will become 4 because this function will round the float32 instead of truncating.\nIs there a way of truncating instead of rounding? and if so, is it possible to do it without involving strings? (like casting a float to int in C)", "output": "Just use int():\nx := float32(3.1)\nfmt.Println(int(x))\n\nWhich produces 3 as needed, without having to use string conversions or the like."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: what's your utf-8 console setting when programming Google Go under Windows\n\nQuestion:\nWe know google's Go default is UTF-8.\nI found in my Windows XP. It can not display correct about the UTF-8.\nThe following code display in wrong.\npackage main\n\nfunc main() {\n  println(\"中文\")\n}\n\nI've googled. It said use another font + reg + chcp 65001.\nBut, I failed.\nI've tried cmd and powershell v1 (it is the only provide version under XP).\nBoth can NOT display well.", "output": "Install MSYS\nDownload mintty and put mintty.exe in   c:\\MinGW\\msys\\1.0\\bin\nAdjust MinGW Shell icon, set target as C:\\MinGW\\msys\\1.0\\msys.bat -mintty, then click the icon\nMenu->Option->Text->Font, Locale,Character set(UTF-8)\nDownload go Windows 386\ncd /c/go/src ; mkdir  ; test your code here.\nBTW, setting vim with utf-8"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: \"used as value\" in function call\n\nQuestion:\nWhat's the proper way of calling functions when evaluating their values in conditional statements?\npackage main\nimport \"fmt\"\nfunc main(){\n        if sumThis(1,2) > sumThis(3,4){\n                fmt.Println(\"test\")\n        } else {\n                fmt.Println(\"derp\")\n        }\n}\nfunc sumThis(a, b int){\n        return a+b\n}\n\nthis returns error:\n./test4.go:4: sumThis(1, 2) used as value\n./test4.go:4: sumThis(3, 4) used as value\n./test4.go:11: too many arguments to return\n\nHow would you write this in Go?", "output": "You've forgotten to declare a return value. It should be:\nfunc sumThis(a, b int) int {\n// ..."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Handling multiple Clients over TCP\n\nQuestion:\nOkay, I just started learning golang and I like it so far. However I don't find their documentation good for go starters, Here is my problem.\nI wanted to write little server program that accepts connections and writes something to the client. No problem doing that so far.\nHowever as soon as the thing get a real functionality, I need to be able to handle multiple clients, which I though would also be a good exercise for goroutines.\nlistener, error := net.Listen(\"tcp\", remote)\ncon, error := listener.Accept()\ngo handleClient(&con);\nfunc handleClient(con *net.Conn) {\n\nI've cut most of the code out. The problem is, no matter what I try, I can't pass con.\ncon.RemoteAddr undefined (type *net.Conn has no field or method RemoteAddr)\n\n(found that in this example: http://raycompstuff.blogspot.com/2009/12/simpler-chat-server-and-client-in.html).\nSo i tried looking at the documentation, but it just gave me the source of the net package.\nRead trough the source, and figured it should be \nundefined: TCPConn\n\nHow can I pass the connection of a client to a goroutine, so i can handle multiple clients at once?", "output": "Ok, figured it out.\nThere is some guy who actually already wrote what I wanted to write in go.\nhttps://github.com/dustin/gomemcached/blob/master/mc_conn_handler.go\ngo handleClient(con);\nfunc handleClient(con net.Conn) {"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why is the content of slice not changed in GO?\n\nQuestion:\nI thought that in GO language, slices are passed by reference. But why the following code doesn't change the content of slice c? Am I missing something? Thank you. \npackage main\n\nimport (\n    \"fmt\"\n)\n\n\nfunc call(c []int) {\n    c = append(c, 1)\n    fmt.Println(c)\n}\n\nfunc main() {\n    c := make([]int, 1, 5)\n    fmt.Println(c)\n    call(c)\n    fmt.Println(c)\n}\n\nThe result printed is:\n\n[0]\n  [0 1]\n  [0]\n\nwhile I was expecting \n\n[0]\n  [0 1]\n  [0 1]", "output": "The length of the slice is kept in the slice header which is not passed by reference. You can think of a slice as a struct containing a pointer to the array, a length, and a capacity.\nWhen you appended to the slice, you modified index 1 in the data array and then incremented the length in the slice header. When you returned, c in the main function had a length of 1 and so printed the same data.\nThe reason slices work this way is so you can have multiple slices pointing to the same data. For example:\nx := []int{1,2,3}\ny := x[:2] // [1 2]\nz := x[1:] // [2 3]\n\nAll three of those slices point to overlapping data in the same underlying array."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: The maximum value for an int type in Go\n\nQuestion:\nHow does one specify the maximum value representable for an unsigned integer type?\nI would like to know how to initialize min in the loop below that iteratively computes min and max lengths from some structs.\nvar minLen uint = ???\nvar maxLen uint = 0\nfor _, thing := range sliceOfThings {\n  if minLen > thing.n { minLen = thing.n }\n  if maxLen < thing.n { maxLen = thing.n }\n}\nif minLen > maxLen {\n  // If there are no values, clamp min at 0 so that min <= max.\n  minLen = 0\n}\n\nso that the first time through the comparison, minLen >= n.", "output": "https://groups.google.com/group/golang-nuts/msg/71c307e4d73024ce?pli=1\nThe germane part:\n\nSince integer types use two's complement arithmetic, you can infer the \n  min/max constant values for int and uint. For example,\nconst MaxUint = ^uint(0) \nconst MinUint = 0 \nconst MaxInt = int(MaxUint >> 1) \nconst MinInt = -MaxInt - 1\n\n\nAs per @CarelZA's comment:\nuint8  : 0 to 255 \nuint16 : 0 to 65535 \nuint32 : 0 to 4294967295 \nuint64 : 0 to 18446744073709551615 \nint8   : -128 to 127 \nint16  : -32768 to 32767 \nint32  : -2147483648 to 2147483647 \nint64  : -9223372036854775808 to 9223372036854775807"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Tool to convert (translate) C to Go?\n\nQuestion:\nWhat tool to use to convert C source code into Go source code?\nFor example, if the C code contains:\nstruct Node {\n    struct Node *left, *right;\n    void        *data;\n};\n\nchar charAt(char *s, int i) {\n    return s[i];\n}\n\nthe corresponding Go code generated by the tool should be:\ntype Node struct {\n    left, right *Node\n    data        interface{}\n}\n\nfunc charAt(s string, i int) byte {\n    return s[i]\n}\n\nThe tool does not need to be perfect. It is OK if some parts of the generated Go code need to be corrected by hand.", "output": "I guess no such (C to Go source code conversion) tool exist today. You might consider to make your own converter. The question becomes: is it worth it, and how to do that?\nIt probably might not be worth the effort, because Go and C could be somehow interoperable. For example, if you use the  GCC 4.6 (or to be released 4.7, i.e. the latest snapshot) your probably can link C & Go code together, with some care.\nOf course, as usual, the evil is in the details.\nIf you want a converter, do you want the obtained Go code to be readable and editable (then the task is more difficult, since you want to keep the structure of the code, and you also want to keep the comments)? In that case, you probably need your own C parser (and it is a difficult task).\nIf you don't care about readability of the generated Go code, you could for example extend an existing compiler to do the work. For example, GCC is extensible thru plugins or thru MELT extensions, and you could customize GCC (with MELT, or your own C plugin for GCC) to transform Gimple representation (the main internal representation for instructions inside GCC) to unreadable Go code. This is somehow simpler (but still require more than a week of work).\nOf course, Go interfaces, channels and even memory management (garbage collected memory) has no standard C counterpart."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: go - Instructions for installing from the ubuntu ppa\n\nQuestion:\nI've installed golang-stable using the Go Language ppa for Ubuntu.\nThe Official Installation Instructions seem to ignore this option, and don't mention it at all.\nMy question is: does anyone know if anything else is needed after doing the sudo apt-get for this package? In particular, do I have to manually set any environment variables?\nI'm asking because I've been able to \"go get\" Go-SDL, but when I try to execute its test I get the following error:\n$ ./test\npanic: No such environment variable: GOPATH\n\nThis kind of confuses me. Shouldn't that variable be initialized already? Especially given that I have been able to compile and install a library.", "output": "The go command that you installed in /usr/lib/go/bin/ internally contains a default path that is used if the environment variable GOPATH is missing. In case of the Ubuntu package this default path points to /usr/lib/go. Thus the installation directory for Go-SDL is somewhere in /usr/lib/go/src. Installing Go-SDL in this way requires root priviledges.\nI recommend you setup GOPATH as described in http://golang.org/doc/code.html and reinstall Go-SDL. For example:\n# Uninstall Go-SDL from /usr/lib/go\nsudo go clean -i github.com/0xe2-0x9a-0x9b/Go-SDL/...\n\n# Setup GOPATH\nmkdir -p $HOME/go/src\nexport GOPATH=$HOME/go\n\n# Install Go-SDL into $GOPATH\ngo get -v github.com/0xe2-0x9a-0x9b/Go-SDL/...\n\nThe test from github.com/0xe2-0x9a-0x9b/Go-SDL needs to know GOPATH to find some resource files (based on How to access resource files after the 'go' tool installed the executable?)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go array initialization\n\nQuestion:\nfunc identityMat4() [16]float {\n    return {\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1 }\n}\n\nI hope you get the idea of what I'm trying to do from the example. How do I do this in Go?", "output": "func identityMat4() [16]float64 {\n    return [...]float64{\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1 }\n}\n\n(Click to play)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do Go web apps function from a server perspective?\n\nQuestion:\nI followed the directions on how to create web applications using Go, and I was able to get an application working great.\nOne thing I am confused about though is, when you run the application (./8.out), the terminal will sit there and listen on port 8080 until somebody accesses a page. \nDoes the terminal need to stay up all of the time to run the web application? Does the application act like apache? Does apache need to be run next to this app? Setting this up on a server environment seems very confusing to me right now because I dont understand what the best way to do this is.\nEDITED\nThanks for the replies. So if the Go app essentially acts like apache, is there a premade Go server app that has the verboseness of apache?", "output": "Does the terminal need to stay up all of the time to run the web application?\nIf you run it normally from a terminal, then yes. Better options are to run it in the background by adding a \"&\" to the end of the command line (okay), start it from init (better), or use a process monitor like supervise (best).\nDoes the application act like apache?\nEssentially, yes. It listens for HTTP requests and responds to them.\nDoes apache need to be run next to this app?\nNo, the Go application can handle the requests by itself. Some people run apache or some other server on the front end (listening to port 80) and forward requests to their application (listening on port 8080 or some other port) using mod_proxy.\nOne advantage to doing that are that you can run several different application servers in their own process. For example, you could use Ruby on Rails for the main site, and handle API requests with a Go program.\nAnother advantage is that your program doesn't need to be started as root to listen to port 80. You can just run as a normal user without worrying about dropping privileges after you open the connection.\nIs there a premade Go server app that has the verboseness of apache?\nAs far as I know, there are no go servers that would compare to Apache. Go is new enough that it will probably be awhile for something like that.\nThere are some frameworks that makes it easier to write web applications using the built-in HTTP server though. The only one I'm familiar with is web.go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Method sets for T and *T\n\nQuestion:\nThe Golang language specification states:\n\nThe method set of any other type T consists of all methods with receiver type T. The method set of the corresponding pointer type *T is the set of all methods with receiver *T or T (that is, it also contains the method set of T). \n\nWhy is this? Why do the methods receiving T belong to the method set for *T but not vice versa?", "output": "From the FAQ:\n\nIf an interface value contains a pointer *T, a method call can obtain a value by dereferencing the pointer, but if an interface value contains a value T, there is no useful way for a method call to obtain a pointer.\n\nBy the way, a method with pointer receiver can change its receiver, just like it can change a pointer parameter. Passing a non-pointer receiver as a pointer one (assuming this is possible), allows the method to change it, which should not.\nIt is recommended to use one consistent receiver type for all methods of a type and avoid mixing pointer and direct receivers. It is also recommended to use pointer receiver for large types."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Verifying that one interface satisfies another\n\nQuestion:\nI'm writing a specification for a toy package I'm writing, and while most of the spec is guaranteeing that various structs in the package satisfy the primary public interface, I am also interested in specifying the methods that the interface must require; I know this is more than a little pedantic, but I figured it would be a neat experiment, and would apply pressure to keep the public interface stable.\nThis is my first try:\ntype Roller interface {\n        Min()  int\n}\n\ntype minS struct {}\nfunc (m minS) Min() int {return 0}\nfunc (m minS) Max() int {return 0}\n\nfunc RollerSpec(c gospec.Context) {\n\n        var r Roller = minS{}\n\n        c.Specify(\"has a minimum value.\", func() {\n                _, ok := r.(interface{Min() int})\n                c.Expect(ok, Equals, true)\n        })\n\n        c.Specify(\"has a maximum value.\", func() {\n                _, ok := r.(interface{Max() int})\n                c.Expect(ok, Equals, true)\n        })\n\n        c.Specify(\"has an expected value.\", func() {\n                _, ok := r.(interface{Exp() int})\n                c.Expect(ok, Equals, true)\n        })\n\n        c.Specify(\"can be rolled.\", func() {\n                _, ok := r.(interface{Roll() int})\n                c.Expect(ok, Equals, true)\n        })\n}\n\nAs you can see, my Roller interface only requires Min() but minS implements both Min() and Max(). I pass the first two specs, even though Runner doesn't satisfy interface{Max() int} because the dummy type I use to test it does. Likewise, declaring r without a base type causes it to fail all specs.\nIt is obvious why Go would have type assertion between interfaces work on the actual stored type, but it's not what I'm looking for here. I've also checked the reflect package, but it seems like it only inspects structs as well. Is there a way to programmatically check whether an interface requires a given method without pulling in the parse package myself and crawling the parse tree for the method name?", "output": "Simply put you can't. There is no way to store just an interface since it's not a concrete type and reflection only works on concrete types. See the reflect package and it's documentation there.\nWhat you want to do seems unnecessary anyway. The interface is your spec. What it looks like you want to do is write a spec to describe your spec and once you do that the big question is where do you stop. It's turtles all the way down :-)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Generating Random Numbers in Go\n\nQuestion:\nI am trying to generate random numbers (integers) in Go, to no avail. I found the rand package in crypto/rand, which seems to be what I want, but I can't tell from the documentation how to use it. This is what I'm trying right now:\n    b := []byte{}\n    something, err := rand.Read(b)\n    fmt.Printf(\"something = %v\\n\", something)\n    fmt.Printf(\"err = %v\\n\", err)\n\nBut unfortunately this always outputs:\n    something = 0\n    err = <nil>\n\nIs there a way to fix this so that it actually generates random numbers? Alternatively, is there a way to set the upper bound on the random numbers this generates?", "output": "crypto/rand provides only binary stream of random data, but you can read integers from it using encoding/binary:\npackage main\n\nimport \"encoding/binary\"\nimport \"crypto/rand\"\n\nfunc main() {\n    var n int32\n    binary.Read(rand.Reader, binary.LittleEndian, &n)\n    println(n)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is websocket Send/Receive thread-safe (go routine-safe)?\n\nQuestion:\nWhen writing a websocket server in GO (in my case using the JSON codec), is it safe to have two different Go routines for handling sending and receiving of data on the same connection?\nSince websocket.JSON.Receive pauses and waits to receive data, I thought a separate Go routine for handling sending of data would be a working solution unless concurrent sending/receiving is not possible on the same connection.\nSo, is the working example below bad practice?\npackage main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"code.google.com/p/go.net/websocket\"\n)\n\nconst queueSize = 20\n\ntype Input struct {\n    Cmd    string\n}\n\ntype Output struct {\n    Cmd    string\n}\n\nfunc Handler(ws *websocket.Conn) {\n\n    msgWrite := make(chan *Output, queueSize)\n    var in Input\n\n    go writeHandler(ws, msgWrite)\n\n    for {\n\n        err := websocket.JSON.Receive(ws, &in)\n\n        if err != nil {\n            fmt.Println(err)\n            break\n        } else {\n            msgWrite <- &Output{Cmd: \"Thanks for your message: \" + in.Cmd}\n        }\n    }\n}\n\nfunc writeHandler(ws *websocket.Conn, out chan *Output) {\n    var d *Output\n    for {\n        select {\n        case d = <-out:\n            if err := websocket.JSON.Send(ws, &d); err != nil {\n                fmt.Println(err.Error())\n            } else {\n                fmt.Println(\"> \", d.Cmd)\n            }\n        }\n    }\n}\n\nfunc main() {\n    http.Handle(\"/echo\", websocket.Handler(Handler));\n    err := http.ListenAndServe(\":1235\", nil);\n    if err != nil {\n        panic(\"ListenAndServe: \" + err.Error())\n    }\n    fmt.Println(\"Server running\")\n}", "output": "Yes, you can call Send, Receive and Close on a websocket connection concurrently, like you can with all net.Conn's in Go. A short excerpt from the official docs:\n\nMultiple goroutines may invoke methods on a Conn simultaneously.\n\nAdditionally, the websocket package also introduces some Codecs for sending / writing Messages  or JSON data that might occupy multiple frames atomically. If you look at the source, you can see that the Send and Receive method of the Codec type will hold either the read or the write lock."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Golang conditional compilation\n\nQuestion:\nI've got a trouble with conditional compilation in Go 1.\nHere is my test code. Is there anything I misunderstand about the \"// +build\" constraint and the \"-tags\" flag?\nmain1.go\n// +build main1\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"This is main 1\")\n}\n\nmain2.go\n// +build main2\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"This is main 2\")\n}\n\nwhen running \"go build\", I still got compile error\n$ go build -tags 'main1'\n# test\n./main2.go:8: main redeclared in this block\n        previous declaration at ./main1.go:8", "output": "You must follow // +build XXX with a blank line.\nIn my brief search, I couldn't find where/if this is documented. But the source clearly calls it out"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Send email through unencrypted connection\n\nQuestion:\nI have a SMTP account that does not use encrypted connection. I can use the same account to send emails from C# and Python without problems but with Go I get the error:\nunencrypted connection\nThis is the code I am using:\npackage main\n\nimport (\n        \"log\"\n        \"net/smtp\"\n)\n\nfunc main() {\n        // Set up authentication information.\n        auth := smtp.PlainAuth(\n                \"\",\n                \"user@example.com\",\n                \"password\",\n                \"mail.example.com\",\n        )\n        // Connect to the server, authenticate, set the sender and recipient,\n        // and send the email all in one step.\n        err := smtp.SendMail(\n                \"mail.example.com:25\",\n                auth,\n                \"sender@example.org\",\n                []string{\"recipient@example.net\"},\n                []byte(\"This is the email body.\"),\n        )\n        if err != nil {\n                log.Fatal(err)\n        }\n}", "output": "The issue here is that smtp.PlainAuth refuses to send your password over an unencrypted connection. This is for your own protection. Something like smtp.CRAMMD5Auth would be a much better choice. When using CRAM-MD5, even over an unencrypted connection, your password is not exposed.\nIf you want to use plain authentication anyways, you would need to make your own version of smtp.PlainAuth. Luckily, this is a very easy thing to do. Just copy the 20 lines or so from the standard library and remove:\nif !server.TLS {\n    return \"\", nil, errors.New(\"unencrypted connection\")\n}\n\nhttp://golang.org/src/pkg/net/smtp/auth.go?s=1820:1882#L41 contains the code.\nIf you do not wish to copy code, you can reuse the standard library implementation by wrapping the smtp.Auth returned by the function in your own type. This way you intercept the *smtp.ServerInfo and trick the actual Auth mechanism (from the standard library) that there is an encrypted connection. Make sure to heavily comment to make it clear why you are doing what you are doing. Something like this (untested):\ntype unencryptedAuth struct {\n    smtp.Auth\n}\n\nfunc (a unencryptedAuth) Start(server *smtp.ServerInfo) (string, []byte, error) {\n    s := *server\n    s.TLS = true\n    return a.Auth.Start(&s)\n}\n\nauth := unencryptedAuth {\n    smtp.PlainAuth(\n        \"\",\n        \"user@example.com\",\n        \"password\",\n        \"mail.example.com\",\n    ),\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a better way to stop an infinite goroutine in Go?\n\nQuestion:\nI made a simple clock signal using goroutines:\nfunc clockloop(ch chan byte) {\n    count := 0\n    for {\n        time.Sleep(FRAMELEN)\n        count++\n    innerfor:\n        for count {\n            select {\n                case ch <- 1:\n                    count--\n                default:\n                    break innerfor\n            }\n        }\n    }\n}\n\nfunc MakeClock() chan byte {\n    clock := make(chan byte)\n    go clockloop(clock)\n    return clock\n}\n\nI know this clock is imprecise but that is irrelevant. What I want to know is what is the best way to stop this goroutine?\nIdeally, I would have liked it to stop as soon as any listeners to the channel go out of scope but I do know how to do that (much like a garbage collector but for goroutines). I have come up with two ways to stop it manually: (1) with a global stop variable that all such goroutines would check every loop and (2) with a stop channel. The disadvantage of each of these is I have to manually stop the goroutines.", "output": "A stop channel is a good way to do it.  A goroutine must stop itself.  There is no way to externally kill one.\nFor reference there is this thread on Go-Nuts where Ian says essentially this and Russ adds, \"Killing individual goroutines is a very unstable thing to do:\nit's impossible to know what locks or other resources those\ngoroutines had that still needed to be cleaned up for the\nprogram to continue running smoothly.\""}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a windowed setting option for the Go compiler?\n\nQuestion:\nI'm using Go (6g) to compile a GTK application and I want to know if there is a compiler/linker option to make it a Windows executable as opposed to console executable. MinGW has a -mwindows option for this and currently I'm having to manually alter the PE header with a hex editor which is annoying.", "output": "-ldflags 'flag list'    arguments to pass on each 5l, 6l, or 8l linker\n  invocation\nCompile packages and dependencies\n-Hwindowsgui (only in 6l/8l)    Write Windows PE32+ GUI binaries\nCommand ld\n\nAdd -ldflags -Hwindowsgui to the go build/get/install command line. For example,\ngo build -ldflags=\"-Hwindowsgui\" gtkapp.go"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: \"invalid character '1' after top-level value \" unmarshaling JSON\n\nQuestion:\nI am using json to store data on disk between program calls, the program runs fine for some time, but after that it displays error in json decoding, \"invalid character '1' after top-level value \". \nCan anyone suggest some solution to this problem ?", "output": "When you write the data to disk, are you making sure to pass os.O_TRUNC (or otherwise truncate the file) in the open flags? If not, the program will work fine until you write an object smaller than the last. But it's hard to debug code without seeing it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Permission denied accessing Bigquery with Go from GAE using the API key\n\nQuestion:\nI am trying to access data stored in Bigquery through an app I am developing on Google App Engine.  However each time I make a request I receive the error \"permission denied\".  \nI have added the application as a member of the API team for the project (I added the address @appspot.gserviceaccount.com) and I am accessing bigquery through the package code.google.com/p/google-api-go-client/bigquery/v2\nThe following code is how I append the API key to each query:\ntransport := KeyedTransport{Key: <api key>, Transport: http.DefaultTransport}\nclient := &http.Client{Transport: transport}\nerr := errors.New(\"reached\")\nb, err := bigquery.New(client)\n\n...\nquery := &bigquery.QueryRequest{\n            DefaultDataset: <perviously defined daset> \n            Query: <query that looks in a single table for a single result by a unique id>,\n            Kind: \"json\",\n            MaxResults: 1,\n\n\n...\n\nb.Jobs.Query(ProjectID, query).Do()\n\nand the following is defined for KeyedTransport\nfunc (t KeyedTransport)  RoundTrip(req *http.Request) (*http.Response, error){\n        u := *req.URL\n        args := u.Query()\n        args.Set(\"key\", t.Key)\n        u.RawQuery = args.Encode()\n\n        r, err := http.NewRequest(req.Method, u.String(), newBody)\n\n        resp, err := t.Transport.RoundTrip(r)\n        if err != nil{\n                return nil, errors.New(\"error: \"+err.Error())\n        }\n        return nil, errors.New(\"resp: \"+toJson(resp))\n\n}\n\nI have also ensured that the API key matches the one generated in Google API console.  It was generated by another member of the team and is labeled as \"Key for browser apps (with referers)\" if that helps.\nSeeing as this is giving me so much trouble, I would make the move to Oauth2 since that seems to be much better documented for Go, but I am looking at working with some organizations that will not want to require users to have a Google login.", "output": "I am not a Go expert, but it looks like you will also need to authorize your application to have access to the BigQuery API via an OAuth 2.0 flow that uses service accounts. The Python and Java runtimes for App Engine support \"App Engine Service Accounts\" using the AppAssertionCredentials class. \nHowever, it is also possible to enable server-to-server using JWT files generated through the Google developer console.\nIt may be possible to authorize access to BigQuery from the GAE Go runtime using server to server OAuth via a go-lang library that can handle JWT files (like this, perhaps)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Which scan to use to read floats from a string?\n\nQuestion:\nThis seems almost right but it chokes on the newline.\nWhat's the best way to do this?\npackage main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    var z float64\n    var a []float64\n    // \\n gives an error for Fscanf\n    s := \"3.25 -12.6 33.7 \\n 3.47\"\n    in := strings.NewReader(s)\n    for {\n        n, err := fmt.Fscanf(in, \"%f\", &z)\n        fmt.Println(\"n\", n)\n        if err != nil {\n            break\n        }\n        a = append(a, z)\n    }\n    fmt.Println(a)\n}\n\nOutput:\nn 1\nn 1\nn 1\nn 0\n[3.25 -12.6 33.7]\n\nUpdate:\nSee the answer from @Atom below.  I found another way which is to break if the error is EOF, and otherwise just ignore it.  It's just a hack, I know, but I control the source.\n    _, err := fmt.Fscanf(in, \"%f\", &z)\n    if err == os.EOF { break }\n    if err != nil { continue }", "output": "If you are parsing floats only, you can use fmt.Fscan(r io.Reader, a ...interface{}) instead of fmt.Fscanf(r io.Reader, format string, a ...interface{}):\nvar z float64\n...\nn, err := fmt.Fscan(in, &z)\n\nThe difference between fmt.Fscan and fmt.Fscanf is that in the case of fmt.Fscan newlines count as space. The latter function (with a format string) does not treat newlines as spaces and requires newlines in the input to match newlines in the format string.\nThe functions with a format string give more control over the form of input, such as when you need to scan %5f or %10s. In this case, if the input contains newlines and it implements the interface io.RuneScanner you can use the method ReadRune to peek the next character and optionally unread it with UnreadRune if it isn't a space or a newline."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google Go for Java platform?\n\nQuestion:\nJVM provides great performance - it's on the one hand. Golang sounds like a new paradigm and extremely productive - on the other hand. If we could bring together the best of two worlds - JVM performance and golang productivity - we could get a lot of benefits. Does anyone know any project that provides golang implementation in java?", "output": "A quick search came up with\nhttp://code.google.com/p/jgo/\nThis link suggest it's the main or only effort.\nhttp://en.wikipedia.org/wiki/List_of_JVM_languages"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Selecting a function from a list of functions in Golang\n\nQuestion:\nBasically if I have a slice or array of any arbitrary functions, how can I select only the ones that return int, or select only the ones that take ints?\nI figured that I would need to use the reflect package, but just reading the docs didn't really help me figure out exactly how to do it.", "output": "This program prints the functions taking an int as parameter or returning an int :\npackage main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    funcs := make([]interface{}, 3, 3) // I use interface{} to allow any kind of func\n    funcs[0] = func (a int) (int) { return a+1} // good\n    funcs[1] = func (a string) (int) { return len(a)} // good\n    funcs[2] = func (a string) (string) { return \":(\"} // bad\n    for _, fi := range funcs {\n        f := reflect.ValueOf(fi)\n        functype := f.Type()\n        good := false\n        for i:=0; i<functype.NumIn(); i++ {\n            if \"int\"==functype.In(i).String() {\n                good = true // yes, there is an int among inputs\n                break\n            }\n        }\n        for i:=0; i<functype.NumOut(); i++ {\n            if \"int\"==functype.Out(i).String() {\n                good = true // yes, there is an int among outputs\n                break\n            }\n        }\n        if good {\n            fmt.Println(f)\n        }\n    }\n}\n\nI think the code is self explanatory"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE Go Windows - \"Cannot run program\", \"is not a valid Win32 application\"\n\nQuestion:\nI've been trying to run a GAE Go project I developed on my Mac on my Windows machine with GoClipse after installing and configuring the appropriate SDKs and so forth. When attempting to run the project, I get this error:\n\nException occurred executing command line. Cannot run program\n  \"C:\\GoogleAppEngine\\dev_appserver.py\" (in directory\n  \"D:\\Golang\\workspace\\Project\\src\\pkg\"): CreateProcess\n  error=193, %1 is not a valid Win32 application\n\nHow can I fix that error in order to run my project?", "output": "While the below configuration works on the Mac as it has Python installed by default, Windows requires a different configuration.\nOn Mac the GoClipse External Tools Configuration would be:\nLocation: /GoogleAppEngine/dev_appserver.py\nWorking Directory: ${workspace_loc:/Project/src/pkg}\nArguments: .\n\nThe Windows configuration should look like:\nLocation: C:\\Python27\\Python.exe\nWorking Directory:\nArguments: C:\\GoogleAppEngine\\dev_appserver.py \"${workspace_loc:/Project/src/pkg}\""}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why slice length greater than capacity gives runtime error?\n\nQuestion:\nMade a slice where capacity is less than the length\n\n\n    package main\n\n    import fmt \"fmt\"\n\n    func main(){\n\n     type b []int\n     var k = make([]b, 10, 5)\n     fmt.Printf(\"%d\\n\",k[8])\n     }\n\n\nThis when tried to run gives following error.\n\n\n    panic: runtime error: makeslice: cap out of range\n\n    runtime.panic+0x9e /go/src/pkg/runtime/proc.c:1060\n            runtime.panic(0x453b00, 0x30020390)\n    runtime.panicstring+0x94 /go/src/pkg/runtime/runtime.c:116\n            runtime.panicstring(0x4afd6c, 0x40d80c)\n    runtime.makeslice+0x70 /go/src/pkg/runtime/slice.c:24\n            runtime.makeslice(0x44302c, 0xa, 0x0, 0x5, 0x0, ...)\n    main.main+0x45 C:/GOEXCE~1/basics/DATATY~1/slice.go:8\n            main.main()\n    runtime.mainstart+0xf 386/asm.s:93\n            runtime.mainstart()\n    runtime.goexit /go/src/pkg/runtime/proc.c:178\n            runtime.goexit()\n    ----- goroutine created by -----\n    _rt0_386+0xbf 386/asm.s:80\n\n\nMy question is can capacity be less than length?\nIf 'Yes' then why this error came? \nAnd if 'No'then why this is a runtime error and why not a compile time?", "output": "No, capacity cannot be less than length.\nA slice is a reference to a part of an array. A slice's capacity represents the size of that backing array. If its length is greater than its capacity, then what memory is it using?\nThe following invariant always holds for a slice s (unless you've done something unsafe):\n0 <= len(s) <= cap(s)\n\nYour code produces a runtime error rather than a compile-time error because the error cannot always be detected statically. In your case it could be, but consider this code:\npackage main\n\nimport (\n    \"fmt\"\n    \"rand\"\n)\n\nfunc main() {\n    k := make([]int, rand.Int(), rand.Int())\n    fmt.Println(k)\n}\n\nThe values passed to make cannot be known until runtime."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to define a function type which accepts any number of arguments in Go?\n\nQuestion:\nI try to write a function which takes any other function and wraps a new function around it. This is what I have tried so far:\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc protect (unprotected func (...interface{})) (func (...interface{})) {\n    return func (args ...interface{}) {\n        fmt.Println (\"protected\");\n        unprotected (args...);\n    };\n}\n\nfunc main () {\n    a := func () {\n        fmt.Println (\"unprotected\");\n    };\n    b := protect (a);\n    b ();\n}\n\nWhen I compile this I get the error:\ncannot use a (type func()) as type func(...interface { }) in function argument\n\nWhy is a function without arguments not compatible to a function with a variable number of arguments? What can I do to make them compatible?\nUpdate:\nThe protected function should be compatible with the original:\nfunc take_func_int_int (f func (x int) (y int)) (int) {\n    return f (1)\n}\n\nfunc main () {\n\n    a := func (x int) (y int) {\n        return 2 * x\n    }\n    b := protect (a)\n\n    take_func_int_int (a)\n    take_func_int_int (b)\n}", "output": "Types are pretty concrete in Go. You could try\na := func(_ ...interface{}) {\n    fmt.Println(\"unprotected\")\n}\n\nfunc (...interface{}) does not mean \"any function that takes any number of any kind of arguments\", it means \"only a function which takes a variable number of interface{} arguments\"\nAlternatively rather than func(...interface{}) you can just use interface{} and the reflect package. See http://github.com/hoisie/web.go for an example.\nEDIT: Specifically, this:\npackage main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc protect(oldfunc interface{}) (func (...interface{})) {\n    if reflect.TypeOf(oldfunc).Kind() != reflect.Func {\n        panic(\"protected item is not a function\")\n    }\n    return func (args ...interface{}) {\n        fmt.Println(\"Protected\")\n        vargs := make([]reflect.Value, len(args))\n        for n, v := range args {\n            vargs[n] = reflect.ValueOf(v)\n        }\n        reflect.ValueOf(oldfunc).Call(vargs)\n    }\n}\n\nfunc main() {\n    a := func() {\n        fmt.Println(\"unprotected\")\n    }\n    b := func(s string) {\n        fmt.Println(s)\n    }\n    c := protect(a)\n    d := protect(b)\n    c()\n    d(\"hello\")\n}\n\nOuput is\nProtected\nunprotected\nProtected\nhello\n\nEDIT: To answer the update\nLike I said above, types are pretty concrete in Go. The protect function returns a type func(...interface{}) which will never be assignable to func(int)int. I think you're probably either over-engineering your problem or misunderstanding it. However, here's a highly discouraged code snippet that would make it work.\nFirst change protect to also return values:\nfunc protect(oldfunc interface{}) (func (...interface{}) []interface{}) {\n    if reflect.TypeOf(oldfunc).Kind() != reflect.Func {\n        panic(\"protected item is not a function\")\n    }\n    return func (args ...interface{}) []interface{} {\n        fmt.Println(\"Protected\")\n        vargs := make([]reflect.Value, len(args))\n        for n, v := range args {\n            vargs[n] = reflect.ValueOf(v)\n        }\n        ret_vals := reflect.ValueOf(oldfunc).Call(vargs)\n        to_return := make([]interface{}, len(ret_vals))\n        for n, v := range ret_vals {\n                to_return[n] = v.Interface()\n        }\n        return to_return\n    }\n}\n\nThen make a convert function:\nfunc convert(f func(...interface{}) (func(int) int) {\n    return func(x int) int {\n        r := f(x)\n        return r[0].(int)\n    }\n}\n\nThen your call would look like\ntake_func_int_int(convert(b))\n\nBut I promise this isn't what you actually want to do.\nStep back and try to rework the problem. I've completely killed type-safety in these examples. What are you trying to accomplish?"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Redirect stdout pipe of child process in Go\n\nQuestion:\nI'm writing a program in Go that executes a server like program (also Go). Now I want to have the stdout of the child program in my terminal window where I started the parent program. One way to do this is with the cmd.Output() function, but this prints the stdout only after the process has exited. (That's a problem because this server-like program runs for a long time and I want to read the log output)\nThe variable out is of type io.ReadCloser and I don't know what I should do with it to achieve my task, and I can't find anything helpful on the web on this topic.\nfunc main() {\n    cmd := exec.Command(\"/path/to/my/child/program\")\n    out, err := cmd.StdoutPipe()\n    if err != nil {\n        fmt.Println(err)\n    }\n    err = cmd.Start()\n    if err != nil {\n        fmt.Println(err)\n    }\n    //fmt.Println(out)\n    cmd.Wait()\n} \n\nExplanation to the code: uncomment the Println function to get the code to compile, I know that Println(out io.ReadCloser) is not a meaningful function.\n (it produces the output &{3 |0 <nil> 0} ) These two lines are just required to get the code to compile.", "output": "Now I want to have the stdout of the child program in my terminal\n  window where I started the parent program.\n\nNo need to mess with pipes or goroutines, this one is easy.\nfunc main() {\n    // Replace `ls` (and its arguments) with something more interesting\n    cmd := exec.Command(\"ls\", \"-l\")\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    cmd.Run()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What language is the compiler of Go programming language written in?\n\nQuestion:\nI think the title is self explanatory.", "output": "Programming languages aren't programs, hence they're not \"written\" in any language. They are often described by formal grammars (e.g. BNF).\nInterpreters and compilers for programming languages are programs and so must be written in some kind of programming language.\nGo has at least two compilers, gc and gccgo. The former was written in C, but is now written in Go itself. While the latter is a gcc frontend written mainly in C++. Go's libraries are written in Go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE Go http post link\n\nQuestion:\nI have a web app on GAE written in Go that performs some calculations for the user. The website communicates with the server through a simple HTTP Post. I want to let the user be able to share a link to the result they obtained without changing much in my Go code.\nIs there some way to encode a HTTP Post message as a website url that would execute on the app engine as if the user sent the Post from the website?\nHow would the code for a button that would copy the proper link to user's clipboard (noting that the field values can change between page being loaded and user wanting the link, so hard-coding the values through GAE parser wouldn't work).", "output": "Use a GET instead of a POST. That's the point of GET : it generates a bookmarkable URL.\nGET should always be used for idempotent operations, unless the sent data contain secret information or are too large to be put into GET parameters."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Cross compile Go on OSX?\n\nQuestion:\nI am trying to cross-compile a go app on OSX to build binaries for windows and linux. I have read everything what I could find on the net. Closest example that I have found has been published on (apart from many unfinished discussions on go-nuts mailing list):\nhttp://solovyov.net/en/2012/03/09/cross-compiling-go/\nyet it does not work on my installation. I have go 1.0.2. As 1.0.2 is quite recent it looks to me that all above examples do not apply to this version.\nTried to do ./make.bash --no-clean with ENV vars set to 386/windows, it does build go, however it builds go for my installation which is darwin/amd64 and completely ignores what is set in ENV that suppose to build different compiler.\nAny advises how it can be done (if it can be done at all)?", "output": "With Go 1.5 they seem to have improved the cross compilation process, meaning it is built in now. No ./make.bash-ing or brew-ing  required. The process is described here but for the TLDR-ers (like me) out there: you just set the GOOS and the GOARCH environment variables and run the go build.\nFor the even lazier copy-pasters (like me) out there, do something like this if you're on a *nix system:\nenv GOOS=linux GOARCH=arm go build -v github.com/path/to/your/app\n\nYou even learned the env trick, which let you set environment variables for that command only, completely free of charge."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Load file metadata with go\n\nQuestion:\nDoes anyone know of a way to read the metadata and or properties of a file using the go language?", "output": "package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    fi, err := os.Stat(\"filename\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(fi.Name(), fi.Size())\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go bindings for Subversion\n\nQuestion:\nHas anyone written Go bindings for Subversion? By that I mean for programmatic access to the Subversion API. If not I'll consider writing some.\nI looked in these places:\n\nhttp://go-lang.cat-v.org/library-bindings\nhttp://godashboard.appspot.com/\nhttps://www.google.com/search?q=golang+subversion\nhttps://www.google.com/search?q=golang+svn", "output": "It looks like there aren't any existing SVN bindings, or at least nothing outstanding. Here are the results on GitHub, though perhaps that's not the best place to check for SVN tools. As @PW suggested, you might try invoking the system shell for SVN tasks. That might be suboptimal, but it depends on how much effort you'd want to put into developing bindings. If you do, they'll definitely be appreciated.\nGood luck!"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Function collisions in Go\n\nQuestion:\nGolang Initialization describes a way to attach methods to arbitrary object in the Go programming language.  As an example, they show a String method for a newly defined ByteSize type:\ntype ByteSize float64\nconst (\n    _ = iota;   // ignore first value by assigning to blank identifier\n    KB ByteSize = 1<<(10*iota);\n    MB;\n    GB;\n    TB;\n    PB;\n    YB;\n)\n\nThe ability to attach a method such as String to a type makes it possible for such values to format themselves automatically for printing, even as part of a general type.\nfunc (b ByteSize) String() string {\n    switch {\n    case b >= YB:\n        return fmt.Sprintf(\"%.2fYB\", b/YB)\n    case b >= PB:\n        return fmt.Sprintf(\"%.2fPB\", b/PB)\n    case b >= TB:\n        return fmt.Sprintf(\"%.2fTB\", b/TB)\n    case b >= GB:\n        return fmt.Sprintf(\"%.2fGB\", b/GB)\n    case b >= MB:\n        return fmt.Sprintf(\"%.2fMB\", b/MB)\n    case b >= KB:\n        return fmt.Sprintf(\"%.2fKB\", b/KB)\n    }\n    return fmt.Sprintf(\"%.2fB\", b)\n}\n\nWhat's not clear to me is the following:  if ByteSize and func (b ByteSize) String() string are both defined in a package somewhere, I import that package but want to customize the display of ByteSize by writing using my own string method, how does Go know whether to call my own string method or the previously defined string method?  Is it even possible to redefine string?", "output": "The intention is for you to wrap a type if you want new methods on it, so you would define\ntype MyByteSize ByteSize\nfunc (b MyByteSize) String() string{\n\n}\n\nYou can't define methods on a type outside of the module it was defined I believe."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: table of functions vs switch in golang\n\nQuestion:\nim am writing a simple emulator in go (should i? or should i go back to c?).\nanyway, i am fetching the instruction and decoding it. at this point i have a byte like 0x81, and i have to execute the right function.\nshould i have something like this\nfunc (sys *cpu) eval() {\n    switch opcode {\n    case 0x80:\n        sys.add(sys.b)\n    case 0x81:\n        sys.add(sys.c)\n    etc\n    }\n}\n\nor something like this\nvar fnTable = []func(*cpu) {\n    0x80: func(sys *cpu) {\n        sys.add(sys.b)\n    },\n    0x81: func(sys *cpu) {\n        sys.add(sys.c)\n    }\n}\nfunc (sys *cpu) eval() {\n    return fnTable[opcode](sys)\n}\n\n1.which one is better?\n2.which one is faster?\nalso\n3.can i declare a function inline?\n4.i have a cpu struct in which i have the registers etc. would it be faster if i have the registers and all as globals? (without the struct)\nthank you very much.", "output": "The first version looks better to me, YMMV.\nBenchmark it. Depends how good is the compiler at optimizing. The \"jump table\" version might be faster if the compiler doesn't try hard enough to optimize.\nDepends on your definition of what is \"to declare function inline\". Go can declare and define functions/methods at the top level only. But functions are first class citizens in Go, so one can have variables/parameters/return values and structured types of function type. In all this places a function literal can [also] be assigned to the variable/field/element...\nPossibly. Still I would suggest to not keep the cpu state in a global variable. Once you possibly decide to go emulating multicore, it will be welcome ;-)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: C callbacks and non-Go threads\n\nQuestion:\nHow does one call Go code in C from threads that weren't created by Go? \nWhat do I assign to a C function pointer such that threads not created by Go can call that pointer and enter into Go code?\n\nUpdate0\n\nI don't want to use SWIG.\nThe callbacks will be coming from threads Go hasn't seen before. Neither cgo/life nor anything in pkg/runtime demonstrates this behaviour AFAICT.", "output": "I'll assume you mean from C code compiled with gcc?\nIIRC, this either can't be done or can't easily be done using 6g+cgo and friends. Go uses a different calling convention (as well as the segmented stacks and such).\nHowever, you can write C code for [685]c (or even [685]a) and call into go easily using package·function() (you can even call methods IIRC). See the Source of the runtime package for examples.\nUpdate:\nComing back to this question after the update, and giving it some more thought. This can't be done in a standard fashion using 6c or cgo. Especially because the threads are not started by the go runtime, the current implementation would fail. The scheduler would suddenly have a thread under its control that it does not know about; additionally, that thread would be missing some thread-local variables the go runtime uses for managing stacks and some other things. Also, if the go function returns a value (or several) the C code can't access it on the currently supported platforms, as go returns values on the stack (you could access them with assembly though). With these things in mind, I do believe you could still do this using channels. It would require your C code to be a little too intimate with the inner workings of the go runtime, but it would work for a given implementation. While using channels may not be the solution you're looking for, it could possibly fit more nicely with the concepts of Go than callbacks. If your C code reimplemented at least the sending methods in The channel implementation (that code is written for 6c, so it would have to be adapted for gcc most likely, and it calls the go runtime, which we've determined can't be done from a non-go thread), you should be able to lock the channel and push a value to it. The go scheduler can continue to manage it's own threads, but now it can receive data from other threads started in C.\nAdmittedly, it's a hack; I haven't looked close enough, but it would probably take a few other hacks to get it working (I believe the channels themselves maintain a list of the goroutines that are waiting on them [EDIT: confirmed: runtime·ready(gp);], so you'd need something in your go code to wake up the receiving channel or to warranty the go code won't receive on the channel until you've already pushed a value). However, I can't see any reason this can't work, whereas there are definite reasons that running code generated by 6g on a thread created in C can't.\nMy original answer still holds though: barring an addition to the language or runtime, this can't yet be done the way you'd like (I'd love to be proven wrong here)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: map with string key and string or slice value?\n\nQuestion:\nNewbee warning.\nCan I make a map with a string key and \"anything\" as a value? The goal is to have a map of configuration data. This data can be either a single string (or boolean value or integer, but restricting this to a string is fine), or it can be an array of strings. Example: I'd like to store these items:\nlevels = 3\nextra-directories = [\"foo\",\"bar\",\"baz\"]\n\nThe first option is always a single value (a string would be OK for me). The second option is zero or more values. \nThe goal is to have a single map where I can store these values and when looking at the map, I could use switch x.(type) to find out what the value is.", "output": "interface{} is a type that accepts any type.\nconf := map[string] interface{} {\n    \"name\": \"Default\",\n    \"server\": \"localhost\",\n    \"timeout\": 120,\n}\n\nconf[\"name\"] is an interface{} not a string, and conf[\"timeout\"] is an interface{} not an int. You can pass conf[\"name\"] to functions that take interface{} like fmt.Println, but you can't pass it to functions that take string like strings.ToUpper, unless you know that the interface{}'s value is a string (which you do) and assert it's type: \nname := conf[\"name\"].(string)\nfmt.Println(\"name:\", strings.ToUpper(name))\nserver := conf[\"server\"].(string)\nfmt.Println(\"server:\", strings.ToUpper(server))\ntimeout := conf[\"timeout\"].(int)\nfmt.Println(\"timeout in minutes:\",  timeout / 60)\n\n\nAnother solution that might fit your problem is to define a struct:\ntype Config struct {\n    Name string\n    Server string\n    Timeout int\n}\n\nCreate configuration:\nconf := Config{\n    Name: \"Default\",\n    Server: \"localhost\",\n    Tiemout: 60,\n}\n\nAccess configuration:\nfmt.Println(\"name:\", strings.ToUpper(conf.Name))\nfmt.Println(\"server:\", strings.ToUpper(cnf.Server))\nfmt.Println(\"timeout in minutes:\",  conf.Timeout / 60)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I create a map[[16]byte][]string in Go?\n\nQuestion:\nThe Go spec states:\n\nThe comparison operators == and != (§Comparison operators) must be fully defined for operands of the key type; thus the key type must not be a struct, array or slice. If the key type is an interface type, these comparison operators must be defined for the dynamic key values; failure will cause a run-time panic.\n\nI wish to create a map of hash values which come from the Hash interface, which returns []byte, but for which all my hashes are done with the same algorithm (thereby I know that it would fit into [16]byte). How can I provide the appropriate interface such that the map type will allow []byte or [16]byte or some wrapper thereof to be used as a key?\nPresently my use generates the following error:\ndupes := make(map[[16]byte][]string)\n\nfinddups.go:55: invalid map key type [16]uint8\n\nUpdate (Mar 2012): Go1 allows [16]byte as key type.", "output": "A string type represents the set of UTF-8 encoded string values. Strings behave like arrays of bytes. See rules 2 and 4 for byte slices in the Conversions to and from a string type topic in the Conversions section of The Go Language Specification.\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    dupes := make(map[string][]string)\n\n    hash := []byte{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}\n    dupes[string(hash)] = []string{\"a\", \"b\"}\n    hash[len(hash)-1]++\n    dupes[string(hash)] = []string{\"b\", \"c\"}\n\n    fmt.Println(\"len:\", len(dupes))\n    for k, v := range dupes {\n        fmt.Println(\"key:\", []byte(k), \"value:\", v)\n    }\n}\n\nOutput:\nlen: 2\nkey: [0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 16] value: [b c]\nkey: [0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15] value: [a b]\n\nNote: This algorithm merely takes advantage of the rules for string types and conversions given in The Go Language Specification, which all implementations must satisfy. It's a \"trick\", just like var i int = '7' - '0' (for ASCII, EBCDIC, Unicode, etc.) is a \"trick\" to convert a numeric character '7' to an integer value 7, in Go and many other languages."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you express a \"null\" value in Go?\n\nQuestion:\nHow do you express a \"null\" value in Go?\ntype Node struct { \n    next *Node\n    data interface{}\n}\n\nAnd I want to say\nreturn &Node{ data: NULL, next: NULL }", "output": "The equivalent of NULL is nil, as you already discovered. Note, though, that you don't generally need to initialize things to nil or zero in Go, because by default all variables (including dynamically allocated ones) are set to “zero values” according to type (numbers zero, references nil). So in your example saying new(Node) would result in a Node with both fields nil."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Global variables / Get command line argument and print it\n\nQuestion:\nThis may sound stupid but how do I define a global variable in Go? const myglobalvariable = \"Hi there!\" doesn't really work...\nI just want to get the command line argument and after this I want to print it. I do this using this code snippet:\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\nfunc main() {\n    gettext();\n    fmt.Println(text)\n}\n\nfunc gettext() {\n    flag.Parse()\n    text := flag.Args()\n    if len(text) < 1 {\n        fmt.Println(\"Please give me some text!\")\n    }\n}\n\nThe problem is that it just prints an empty line so I thought about declaring a global variable using const myglobalvariable = \"Hi there!\" but I just get the error cannot use flag.Args() (type []string) as type ideal string in assignment...\n...I know this is a noob question so I hope you can help me...", "output": "Why do you need a global variable? For example,\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\nfunc main() {\n    text := gettext()\n    fmt.Println(text)\n}\n\nfunc gettext() []string {\n    flag.Parse()\n    text := flag.Args()\n    if len(text) < 1 {\n        fmt.Println(\"Please give me some text!\")\n    }\n    return text\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I use an custom int type with range in go?\n\nQuestion:\nI have\ntype DocId int\n\nfunc foo(documents []String) {\n    for i := range documents {\n        id := DocId(i)\n        ...\n    }\n}\n\nHow do I get rid of the explicit conversion line? DocIds are meant to be the type that indexes individual documents.\nWhat I want is more like:\nfunc foo(documents []String) {\n    for id := range documents {\n        ... // id gets used as the DocId that it damn well *IS*\n    }\n}\n\nWhich gives me 'invalid operation: ... (mismatched types int and DocId)' when I attempt to use the id from range as a DocId, even though DocId is an int.", "output": "Only untyped constant can be automatically converted in the right type.  \nYou can find examples where the cast is not needed like in this thread, for untyped constant. From the specs:\n\nif one operand is an untyped constant and the other operand is not, the constant is converted to the type of the other operand\n\nBut here, range explicitly assign  iteration values to the corresponding iteration variables (i int, T a[i]), which makes i and int. (from spec \"For statement\") \nFor all the other case, an explicit cast is required.\nThe \"Conversion\" section of the specs doesn't mention an \"automatic\" type conversion (as opposed to automatic interface conversion, which happens all the time: interface{}).\nThis thread adds\ntype A int\ntype B int\n\n...\n\nvar a A = 5\nvar b B = a    // Compiler ERROR!!!!!!\n\n\nEssentially, since (nearly) all types are unique, even two types with the same underlying representation and primitive operations are unassignable without a cast. [...]\n  This makes the language type-safe by forcing you to explicitly tell the compiler when you want the conversion to happen."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the correct way to install Google Go and App Engine SDK?\n\nQuestion:\nI've been playing with Go and GAE using GoClipse for a bit now on my Mac (since they won't run on Windows). Recently I noticed that when I goinstall a package from github it had some problems working. I figured I'd reinstall the whole thing and set it up properly. Go installed nicely, but when it came to integrating the GAE SDK it took me a couple hours of searching and came up with only this article:\nhttp://code.google.com/p/goclipse/wiki/GoClipseAndTheGoogleAppEngine\nBut since it tell you to move files from the go/scr folder (where goinstall installs packages), I reckon it is not the correct way to set everything up.\nCan anyone give me a clear, easy to follow step-by-step guide on how to install both Go and GAE SDK on a Mac?", "output": "The short answer is that Go and the GAE SDK do not integrate in the way that (I think) you are looking for.  The GAE SDK includes its own version of the Go toolchain that differs in some important ways to the standard tools.  Those differences are deep enough that it is unlikely you will derive much utility from trying to unify the two.  Here are the big differences:\n\nGAE does not support some packages from the standard lib e.g. \"unsafe\"\nGAE does not support CGO\nGAE often lags the main distribution by one or more major versions\nYou cannot use any binary libraries (go or otherwise) in a GAE project (you need source for everything)\ngoinstall is not intended for use with GAE projects\n\nBecause of this I treat my GAE and non-GAE tools as completely separate.  If you're only doing GAE development, you could do without the standard tools altogether."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using go-html-transform to preprocess HTML: Replace fails\n\nQuestion:\nFollowing on from this question on whitelisting HTML tags, I've been experimenting with Jeremy Wall's go-html-transform. In the hopes of improving searchable documentation I'm asking this here rather than pestering the author directly... hopefully this isn't too tool-specific for SO.\nApp Engine, latest SDK. Post.Body is a []byte. This works:\npackage posts\n\nimport (\n    // ...      \n    \"html/template\"\n    \"code.google.com/p/go-html-transform/html/transform\"\n    \"code.google.com/p/go-html-transform/h5\"\n)\n\n// ...\n\n// Pre-process post body, then return it to the template as HTML()\n// to avoid html/template's escaping allowable tags\nfunc (p *Post) BodyHTML() template.HTML {\n    doc, _ := transform.NewDoc(string(p.Body))\n    t := transform.NewTransform(doc)\n\n    // Add some text to the end of any <strong></strong> nodes.\n    t.Apply(transform.AppendChildren(h5.Text(\"<em>Foo</em>\")), \"strong\")\n    return template.HTML(t.String())\n}\n\nResult:\n<strong>Blarg.<em>Foo</em></strong>\n\nHowever, if instead of AppendChildren() I use something like the following:\nt.Apply(transform.Replace(h5.Text(\"<em>Foo</em>\")), \"strong\")\n\nI get an internal server error. Have I misunderstood the use of Replace()? The existing documentation suggests this sort of thing should be possible.", "output": "Running your transform code outside of App Engine, it panics and you can see a TODO in the source at that point.  Then it's not too much harder to read the code and see that it's going to panic if given a root node."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Benchmarking code with a StopWatch or similar\n\nQuestion:\nI'm trying to use Go package \"time\" to benchmark a function in my program. Been searching around, and people seem to use time.NanoSeconds() - but I think this function is no longer in the time package?\nWhat I need is an easy way to start and stop a timer, and print out the value.", "output": "Use the existing functionality of the testing package inside your *_test.go:\nfunc BenchmarkMyFunc(b *testing.B) {\n    for i := 0; i < b.N; i++ {\n        myBecnhmarkedFunction()\n    }\n}\n\nand invoke go test -bench RE (RE is a regexp to select the benches, like B as it means *B*) typically inside the package/tool directory\nOr explicitly from any place in your code - use the Benchmark function."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Import web.go error after using goinstall\n\nQuestion:\nWith halfdans advice, I was successfully able to use goinstall github.com/hoisie/web.go without any errors after installing git first. However, now when I try to compile the sample code given, go is not finding the web package. I get the error,\nmain.go:4: can't find import: web\n\nOn this code\npackage main\n\nimport (\n    \"web\"\n)\n\nfunc hello(val string) string { return \"hello \" + val }\n\nfunc main() {\n    web.Get(\"/(.*)\", hello)\n    web.Run(\"0.0.0.0:9999\")\n}\n\nIs there something special I need to do in order for it to recognize the package? I found the package source at $GOROOT/src/pkg/github.com/hoisie/web.go/web. I tried github.com/hoisie/web.go/web as the import and it still did not like that.", "output": "If you install web.go through goinstall, you need to do:\nimport \"github.com/hoisie/web.go\"\n\nGoinstall is still an experimental system. It would be nice if you didn't have to include the full path."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Assigning to map in golang\n\nQuestion:\nIn the following go snippet, what am I doing wrong?\ntype Element interface{}\n\nfunc buncode(in *os.File) (e Element) {\n    <snip>\n    e = make(map[string]interface{})\n    for {\n        var k string = buncode(in).(string)\n        v := buncode(in)\n        e[k] = v\n    }\n    <snip>\n}\n\nCompiling gives me this error:\ngopirate.go:38: invalid operation: e[k] (index of type Element)\n\nDouble ewe T eff?", "output": "In the buncode function you declare e Element, where type e Element interface{}. The variable e is a scalar value, which you are trying to index.\n\nTypes\nThe static type (or just type) of a variable is the type defined by\n  its declaration. Variables of interface type also have a distinct\n  dynamic type, which is the actual type of the value stored in the\n  variable at run-time. The dynamic type may vary during execution but\n  is always assignable to the static type of the interface variable. For\n  non-interface types, the dynamic type is always the static type.\n\nThe static type of e is Element, a scalar. The dynamic type of e is map[string]interface{}.\nHere's a revised, compilable version of your code.\ntype Element interface{}\n\nfunc buncode(in *os.File) (e Element) {\n    m := make(map[string]interface{})\n    for {\n        var k string = buncode(in).(string)\n        v := buncode(in)\n        m[k] = v\n    }\n    return m\n}\n\nWhy are you making the recursive calls to buncode?"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is go if/for/func block open brace position required to be on the same line?\n\nQuestion:\nDoes a go block following a for, func or if statement have to have the opening brace on the same line? I get a compile error if I move it down but I can't see in the language spec where they show that a block has to be structured like that. \n\nA block is a sequence of declarations and statements within matching\n  brace brackets.\nBlock = \"{\" { Statement \";\" } \"}\" .\nIfStmt = \"if\" [ SimpleStmt \";\" ] Expression Block [ \"else\" ( IfStmt |\n  Block ) ] .", "output": "From Effective Go, because of semicolon inference:\n\nOne caveat.\n  You should never put the opening brace of a control structure (if, for, switch, or select) on the next line.\n  If you do, a semicolon will be inserted before the brace, which could cause unwanted effects. Write them like this:\n\nif i < f() {\n    g()\n}\n\n\nnot like this:\n\nif i < f()  // wrong!\n{           // wrong!\n    g()\n}\n\n\nAs jnml comments,  the language syntax is correct for blocks.\nBut combined with Semicolon injection, it means you should really:\n\nalways put the brace on the same line than the if statement (or the 'if' won't do what you think it should)\nactually, always use gofmt and don't think about it (Preferably, gofmt your code each time you save it in your editor. It is fast and will make your code consistent with the rest of any Go code out there)\n\nEven the Go compiler will enforce that \"same line for brace\" rule, to avoid any unforeseen side-effect.\nSo the language reference doesn't say where to put the brace, but both gofmt and the compiler will make sure it is correctly placed for a if statement."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang: runtime error: invalid memory address or nil pointer dereference\n\nQuestion:\nI am new to golang and currently following this tutorial and source code here - http://golang.org/doc/articles/wiki/part2.go\nAfter building this file, I am getting \ncalvin$ ./mywebwiki2 \n2012/07/23 17:12:59 http: panic serving [::1]:58820: runtime error: invalid memory address or nil pointer dereference\n/usr/local/go/src/pkg/net/http/server.go:576 (0x3f202)\n    _func_003: buf.Write(debug.Stack())\n/private/tmp/bindist454984655/go/src/pkg/runtime/proc.c:1443 (0x10c79)\n/private/tmp/bindist454984655/go/src/pkg/runtime/runtime.c:128 (0x11745)\n/private/tmp/bindist454984655/go/src/pkg/runtime/thread_darwin.c:418 (0x148b5)\n/Users/calvin/work/gowiki/mywebwiki2.go:33 (0x2248)\n    viewHandler: fmt.Fprintf(w, \"<h1>%s</h1><div>%s</div>\", p.Title, p.Body)\n/usr/local/go/src/pkg/net/http/server.go:690 (0x331ae)\n    HandlerFunc.ServeHTTP: f(w, r)\n/usr/local/go/src/pkg/net/http/server.go:926 (0x34030)\n    (*ServeMux).ServeHTTP: mux.handler(r).ServeHTTP(w, r)\n/usr/local/go/src/pkg/net/http/server.go:656 (0x32fc1)\n    (*conn).serve: handler.ServeHTTP(w, w.req)\n/private/tmp/bindist454984655/go/src/pkg/runtime/proc.c:271 (0xed7f)\n2012/07/23 17:12:59 http: panic serving [::1]:58821: runtime error: invalid memory address or nil pointer dereference\n\nAny idea what I did wrong to be causing this apparent memory corruption?", "output": "There's an ignored err at line 36. The error probably says open .txt: no such file or directory if you tested in browser using URL http://localhost:8080/view/ or open foo.txt: no such file or directory if you tested in browser using URL http://localhost:8080/view/foo. In the later case there must be a file \"foo.txt\" in your working directory for this example code to work. After that the code seems to work for me locally.\nSomeone should probably fill an issue about the ignored error value."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How is declaring a new struct instance with \"var\" different from using \"new\" in Go?\n\nQuestion:\nThe following code creates a usable instance of the struct, Car. How is this different than using new(Car)?\nExample:\ntype Car struct {\n  make string\n}\n\nfunc Main() {\n  var car Car; // how is this different than \"car := new(Car)\"?\n\n  car.make = \"Honda\"\n}", "output": "One defines a Car variable, the other returns a pointer to a Car.\nvar car Car      // defines variable car is a Car\ncar2 := new(Car) // defines variable car2 is a *Car and assigns a Car to back it\n\ncar := new(Car) can be implemented in relation to var car Car like this:\nvar x Car\ncar := &x"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Modifying struct members through an interface in Go\n\nQuestion:\nI've come to a point in a Go project of mine where I'd like to create multiple subclasses of a base class, and be able to operate on instances of the subclasses through a base class/interface variable (I'm using the word \"class\" even though the concept doesn't really exist in Go).\nHere's what it might look like in C++ just to show what I mean:\n#include <iostream>\n\nusing namespace std;\n\nclass Base {\npublic:\n    int x,y;\n    virtual void DoStuff() {};\n};\n\nclass Thing : public Base {\npublic:\n    void DoStuff() { x = 55; y = 99; }\n};\n\n\nBase *gSomething;\n\nint main(int argc, char **argv) {\n    gSomething = new Thing();\n    gSomething->DoStuff();\n\n    cout << \"gSomething = {\" << gSomething->x << \", \" << gSomething->y << \"}\" << endl;\n\n    return 0;\n}\n\nThis would print \"gSomething = {55, 99}\".\nBeing new to Go I was hoping I could do something like this (which I felt was fairly clean):\npackage main\n\nimport \"fmt\"\n\ntype IBase interface {\n    DoStuff()\n}\n\n// The base \"class\"\ntype Base struct {\n    x, y int\n}\n\n// A more specific variant of Base\ntype Thing struct {\n    Base\n}\n\n\nfunc (o Base) DoStuff() {\n    // Stub to satisfy IBase\n}\n\nfunc (o Thing) DoStuff() {\n    o.x, o.y = 55, 99\n    fmt.Println(\"In Thing.DoStuff, o = \", o)\n}\n\nvar Something IBase\n\nfunc main() {\n     Something = new (Thing)\n\n    Something.DoStuff()\n    fmt.Println(\"Something = \", Something)\n}\n\nAlas, this doesn't work. It compiles, it appears to run properly, but I don't get the result I wanted. Here's the printout:\nIn Thing.DoStuff, o =  {{55 99}}\nSomething =  &{{0 0}}\nI was obviously hoping for the last print to say \"Something = &{{55 99}}\"\nAm I completely off on the design here (is this not possible to do in Go), or have I just missed some small detail?", "output": "Your func (o Thing) DoStuff() has a receiver of the type Thing struct and structs are passed by value in Go. If you want to modify the struct (and not a copy of it), you would have to pass it by reference. Change this line to func (o *Thing) DoStuff() and you should see the expected output."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a way to avoid the implementation of the full sort.Interface for slices of structs?\n\nQuestion:\nIf I have an array/slice of structs in Go and want to sort them using the sort package it seems to me that I need to implement the whole sort interface which contains 3 methods:\n\nLen\nSwap\nLess\n\nIt seems that Len and Swap should always have the same implementation no matter the type of struct is in the array.\nIs there a way to avoid having the implement Len and Swap every time or is this just a limitation from the lack of Generics in Go?", "output": "Your own answer is right. In your case of an array or slice the implementations of Len() and Swap() are simple. Like len() Go could provide a native swap() here. But the interface which is used now can also be used for more complex data structures like BTrees. It still allows the Sort() function to work (like my parallel quicksort, which uses the same sort interface)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Idiomatic way of handling interrupts in Go using ZeroMQ\n\nQuestion:\nI'm learning both Go and ZeroMQ at the moment and in that spirit I'm trying to contribute Go examples for the Zguide. I'm struggling a bit with the interrupt example. I'm unsure what the idiomatic way of handling the problem would be. \nThe solution I currently have is the following: I create a channel which receives the SIGINT signal.  When it does I write a bool on an other channel which is used in the main loop to break. The problem is, is that Recv is blocking, the loop never gets to check the loop condition. I circumvent the problem by passing the NOBLOCK constant to Recv. But I feel there is a better way as Recv should return a EINTR when interrupted (which it doesn't as far as I can tell). You readers are much better equipped to answer this question then I am, what do you think?\nFor your convenience the code I have so far:\npackage main\n\nimport (\n    \"os/signal\"\n    \"os\"\n    \"fmt\"\n    zmq \"github.com/alecthomas/gozmq\"\n)\n\nfunc listenForSignals(exit_channel chan bool) {\n    signal_channel := make(chan os.Signal)\n    signal.Notify(signal_channel)\n    <- signal_channel\n    fmt.Println(\"stopping\")\n    exit_channel <- true\n}\n\nfunc main() {\n    exit := make(chan bool)\n    exit_signal := false\n    go listenForSignals(exit)\n\n    context, _ := zmq.NewContext()\n    defer context.Close()\n\n    socket, _ := context.NewSocket(zmq.REP)\n    defer socket.Close()\n    socket.Bind(\"tcp://*:5555\")\n\n    for exit_signal == false {\n      select {\n      case exit_signal = <- exit:\n        fmt.Println(\"W: interrupt received, killing server...\")\n      default:\n        msgbytes, err := socket.Recv(zmq.NOBLOCK)\n        fmt.Printf(\"%s.\\n\", string(msgbytes))\n      }\n    }\n\n}\n\nEdit simplified the code somewhat based on feedback", "output": "If you are going to use a select statement to switch over channels, you should return the result of socket.Recv on a channel as well.  This also lets you run socket.Recv on a goroutine so the blocking nature isn't an issue.\nRealistically, you should probably also handle errors that you get as well.  That you can do by adding another channel to the whole shebang.\nfunc main() {\n    ...\n\n    data := make(chan []byte)\n    errors := make(chan error)\n    go function() {\n      for {\n        msgbytes, err := socket.Recv(0)\n        if err != nil {\n          errors <- err\n        } else {\n          data <- msgbytes\n        }\n      }\n    }()\n\n    for exit_signal == false {\n      select {\n      case exit_signal = <- exit:\n        fmt.Println(\"W: interrupt received, killing server...\")\n      case err := <- errors:\n        fmt.Println(\"Receive Error:\", err.Error())\n      case msgbytes := <- data:\n        fmt.Printf(\"%s.\\n\", string(msgbytes))\n      }\n    }\n\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Suitable tree data structure\n\nQuestion:\nWhich is the most suitable tree data structure to model a hierarchical (containment relationship) content. My language is bit informal as I don't have much theoretical background on these\n\nParent node can have multiple children.\nUnique parent\nTree structure is rarely changed, os it is ok to recreate than add/rearrange nodes.\nTwo way traversal\nmainly interested in, find parent, find children, find a node with a unique id \nEvery node has a unique id\nThere might be only hundreds of nodes in total, so performance may not be big influence\nPersistence may be good to have, but not necessary as I plan to use it in memory after reading the data from DB.\n\nMy language of choice is go (golang), so available libraries are limited. Please give a recommendation without considering the language which best fit the above requirement.\nhttp://godashboard.appspot.com/ lists some of the available tree libraries. Not sure about the quality and how active they are. I read god about\n\nhttps://github.com/petar/GoLLRB \nhttp://www.stathat.com/src/treap\n\nPlease let know any additional information required.", "output": "Since there are only hundreds of nodes, just make the structure the same as you have described.\n\nEach node has a unique reference to parent node.\nEach node has a list of child node.\nEach node has an id\nThere is a (external) map from id --> node. May not even necessary.\n\n2 way traversal is possible, since parent and child nodes are know. Same for find parent and find child.\nFind id can be done by traverse the whole tree, if no map. Or you can use the map to quickly find the node.\nAdd node is easy, since there is a list in each node. Rearrange is also easy, since you can just freely add/remove from list of child nodes and reassign the parent node.\nI'm answering this question from a language-agnostic aspect. This is a tree structure without any limit, so implementation is not that popular."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go channels and deadlock\n\nQuestion:\nI'm trying to understand the Go language. I tried to create two goroutines\nthat chain the flow between them using two channels:\nfunc main() {\nc1 := make(chan int)\nc2 := make(chan int)\n\ngo func() {\n    for i := range c1{\n        println(\"G1 got\", i)\n        c2 <- i\n    }\n}()\n\ngo func() {\n    for i := range c2 {\n        println(\"G2 got\", i)\n        c1 <- i\n    }\n}()\n\n\nc1 <- 1\n\ntime.Sleep(1000000000 * 50)\n}\n\nAs expected this code prints:\n G1 got 1\n G2 got 1\n G1 got 1\n G2 got 1\n ....\n\nUntil the main function exits.\nBut if I send another value to one of the channels from main, it suddenly blocks:\nfunc main() {\nc1 := make(chan int)\nc2 := make(chan int)\n\ngo func() {\n    for i := range c1{\n        println(\"G1 got\", i)\n        c2 <- i\n    }\n}()\n\ngo func() {\n    for i := range c2 {\n        println(\"G2 got\", i)\n        c1 <- i\n    }\n}()\n\n\nc1 <- 1\n\ntime.Sleep(1000000000 * 1)\n\nc1 <- 2\n\ntime.Sleep(1000000000 * 50)\n}\n\nIt outputs \nG1 got 1\nG2 got 1\nG1 got 1\nG2 got 1\nG1 got 2\n\nand then blocks until the main ends.\nThe value \"2\" sent to c1 arrives to the first goroutie, which sends it to c2, but the second\ngoroutine never receives.\n(Using buffered channels with size 1 (either c1 or c2) works in this example)\nWhy does it happen? When this happens in real code, how can I debug it?", "output": "Go channels created with make(chan int) are not buffered. If you want a buffered channel (that won't necessarily block), make it with make(chan int, 2) where 2 is the size of the channel.\nThe thing about unbuffered channels is that they are also synchronous, so they always block on write as well as read.\nThe reason it deadlocks is that your first goroutine is waiting for its c2 <- i to finish while the second one is waiting for c1 <- i to finish, because there was an extra thing in c1. The best way I've found to debug this sort of thing when it happens in real code is to look at what goroutines are blocked and think hard.\nYou can also sidestep the problem by only using synchronous channels if they're really needed."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Trouble with Queries/Datastore in Google App Engine - Go API\n\nQuestion:\nI'm playing with Google App Engine using the Go APIs and despite everything I've tried I can't get the Queries to return data that is in the datastore. I can see that Put() works as expected, and the entities are listable/accessible from inspection of the Admin Console available from dev_appserver.py\nThe struct I'm storing is defined this way:\ntype TweetData struct {\n    Id int64 `datastore:\",noindex\" json:\"id\"`\n    Text string `datastore:\",noindex\" json:\"text\"`\n    Screen_name string `json:\"screen_name\"`\n}\n\nAnd my calls to query it are such:\nfunc getDatastoreTweets(c appengine.Context, twitterUser string) []*TweetData {\n    q := datastore.NewQuery(\"TweetData\").Filter(\"Screen_name =\", twitterUser).Order(\"-Id\").Limit(10)\n\n    var oldTweets []*TweetData\n    if _, err := q.GetAll(c, &oldTweets); err != nil {\n        fmt.Printf(\"Getall had non-nil error! %v\\n\", err)\n    }   \n\n    return oldTweets\n}\n\nFor this query, err is never non-nil, but always returns 0 results, even when the Console tells me there are many. I've tried it without the Filter call as well, after the guestbook example the SDK provides, to no avail.\nIn case it's an issue with keys (unlikely if I understand correctly, because I'm querying on a property), the call to Put is as follows:\n// tweetData passed in via parameter...\nkey := datastore.NewIncompleteKey(c, \"TweetData\", nil)\n_, err := datastore.Put(c, key, &tweetData)\n\nAny help would be appreciated, thanks! ^_^", "output": "The query ask for ordering by Id desc, while the index field is un-indexed, you should either:\n\nrewrite the TweetData annotation to index Id field:\n\n\n    Id int64 `json:\"id\"`\n\n\nRemove the Order clause of your query:\n\n\n    q := datastore.NewQuery(\"TweetData\").Filter(\"Screen_name =\", twitterUser).Limit(10)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: authenticated http client requests from golang\n\nQuestion:\nI have the following code:\nclient := &http.Client{}\n\n/* Authenticate */\nreq, err := http.NewRequest(\"GET\", \"http://164.99.113.32/Authenticate\", nil)\nreq.SetBasicAuth(\"<username>\",\"<password>\")\nresp, err := client.Do(req)\nif err != nil {\n    fmt.Printf(\"Error : %s\", err)\n}\n\n/* Get Details */\nreq.URL, _ = url.Parse(\"http://164.99.113.32/Details\")\nresp, err = client.Do(req)\nif err != nil {\n    fmt.Printf(\"Error : %s\", err)\n}\n\nNow, the second http call is failing with a 401 access-denied error. A different REST client (a firefox plugin) correctly gets the details from the server, so I know that nothing is wrong on the server side. Do I need to pass some kind of session string or something that we got in the previous request ?", "output": "Okay. I have resolved this. I just needed to create a cookie jar.\nI am surprised that this is not handled by default by the golang http\nreq/client class.\nThe code that I had to use was:\ntype myjar struct {\n    jar map[string] []*http.Cookie\n}\n\nfunc (p* myjar) SetCookies(u *url.URL, cookies []*http.Cookie) {\n    fmt.Printf(\"The URL is : %s\\n\", u.String())\n    fmt.Printf(\"The cookie being set is : %s\\n\", cookies)\n    p.jar [u.Host] = cookies\n}\n\nfunc (p *myjar) Cookies(u *url.URL) []*http.Cookie {\n    fmt.Printf(\"The URL is : %s\\n\", u.String())\n    fmt.Printf(\"Cookie being returned is : %s\\n\", p.jar[u.Host])\n    return p.jar[u.Host]\n}\n\nand then in main:\n    jar := &myjar{}\n    jar.jar = make(map[string] []*http.Cookie)\n    client.Jar = jar\n\nWorks."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using rpc/jsonrpc in App Engine\n\nQuestion:\nI'm confused reading \"rpc\" and \"rpc/jsonrpc\" code and docs. We won't listen to a port to serve RPC requests on App Engine, I mean, we won't \"start a server\", so how it should work?", "output": "Answered by Brad Fitzpatrick on google-appengine-go mailing list:\n\nBasically, you can't.  That's only the first problem you'll hit.  The \n  second major problem you'll find is that you can't get at the\n  *http.Request  to get an appengine.Context to do anything useful with App Engine in your  RPC handler."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Explanation of Flags in Go\n\nQuestion:\nCan anyone explain flags in Go?\nflag.Parse()\nvar omitNewline = flag.Bool(\"n\", false, \"don't print final newline\")", "output": "See http://golang.org/pkg/flag/ for a full description.\nThe arguments for flag.Bool are (name string, value bool, usage string)\nname is the argument to look for, value is the default value and\nusage describes the flag's purpose for a -help argument or similar, and is displayed with flag.Usage().\nFor more detailed example check here"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Testing strategy for Go with Mongodb\n\nQuestion:\nI am trying to get a project started in Go and MongoDb. I am stumped when trying to figure out the best way to unittest my database interactions.", "output": "Normally people use database mocks, read here for the same answer in Java."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: maps - deleting data\n\nQuestion:\nHow does one delete data from a map in Go? For example, having\nm := map[string]string{ \"key1\":\"val1\", \"key2\":\"val2\" };\n\nI want to make m drop the \"key1\" without copying the entire map by iterating over its keys (which could get big in some uses). Is it enough to assign a nil value to \"key1\", or will that still keep the key in the map structure with an assigned value of nil? That is, if I later iterate over the keys of the map, will \"key1\" appear?", "output": "Deletion of map elements\nThe built-in function delete removes the element with key k from a map\n  m.\ndelete(m, k)  // remove element m[k] from map m\n\n\nFor example,\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    m := map[string]string{\"key1\": \"val1\", \"key2\": \"val2\"}\n    fmt.Println(m)\n    delete(m, \"key1\")\n    fmt.Println(m)\n}\n\nOutput:\nmap[key1:val1 key2:val2]\nmap[key2:val2]"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Cluster Computing in Go\n\nQuestion:\nIs there a framework for cluster computing in Go?  (I wish to bring together multiple PC's to for custom parallel computation, and wonder whether Go might be a suitable language to use).", "output": "I don't know the level of connectedness you plan to have in your cluster, but go's RPC package makes communication among nodes trivial. It will likely serve as the backbone of your work and you can build abstractions on top of it (for instance if you need to multicast requests to different nodes). The examples given in the doc assume your nodes will communicate over HTTP, but that bit is abstracted out in net/rpc to allow different transports.\nhttp://golang.org/pkg/net/rpc/"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a way to release unmanaged resources when a Go struct is collected?\n\nQuestion:\nI have a pointer to a C type wrapped by a Go struct, like so:\ntype Wrapper struct {\n    unmanaged *C.my_c_type\n}\n\nThe C type, in turn, has the following functions:\nmy_c_type* make_c_type();\nvoid free_c_type(my_c_type *ct);\n\nIs there a way that I can ensure that free_c_type is called whenever a Wrapper instance is finalized?", "output": "You can use runtime.SetFinalizer. This allows you to run a cleanup function when the object falls out of scope. It is not guaranteed to run. However, when freeing memory, that does not really matter. What does matter is that for a long running process, it is likely to keep the garbage in check.\nHere are some excerpts from the docs (entire paragraphs were removed):\n\nSetFinalizer sets the finalizer associated with x to f. When the garbage collector finds an unreachable block with an associated finalizer, it clears the association and runs f(x) in a separate goroutine. This makes x reachable again, but now without an associated finalizer. Assuming that SetFinalizer is not called again, the next time the garbage collector sees that x is unreachable, it will free x.\nThe finalizer for x is scheduled to run at some arbitrary time after x becomes unreachable. There is no guarantee that finalizers will run before a program exits, so typically they are useful only for releasing non-memory resources associated with an object during a long-running program. For example, an os.File object could use a finalizer to close the associated operating system file descriptor when a program discards an os.File without calling Close, but it would be a mistake to depend on a finalizer to flush an in-memory I/O buffer such as a bufio.Writer, because the buffer would not be flushed at program exit.\nA single goroutine runs all finalizers for a program, sequentially. If a finalizer must run for a long time, it should do so by starting a new goroutine."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: MIME type for transcoded stream\n\nQuestion:\nI wish to determine the MIME type of the contents of a pipe. The pipe is outputting a transcoded video stream, so there is no corresponding file extension.\nCan I determine the MIME type in these circumstances using say ffprobe -i pipe:0 or some equivalent? Is there a canonical mapping of codecs or container formats to MIME type?", "output": "You can use DetectContentType to guess the content type based on the magic numbers:\n  http://golang.org/pkg/net/http/#DetectContentType"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Panic recover in Go v.s. try catch in other languages\n\nQuestion:\nI've just read this post about Panic/Recover in Go and I'm not clear on how this differs from try/catch in other mainstream languages.", "output": "I  keep looking at this question trying to think of the best way to answer it. It's easiest to just point to the idiomatic uses for panic/recover as opposed to try/catch &| exceptions in other languages, or the concepts behind those idioms (which can be basically summed up as \"exceptions should only occur in truly exceptional circumstances\")\nBut as to what the actual difference is between them? I'll try to summarize as best I can.\nOne of the main differences compared to try/catch blocks is the way control flows. In a typical try/catch scenario, the code after the catch block will run unless it propagates the error. This is not so with panic/recover. A panic aborts the current function and begins to unwind the stack, running deferred functions (the only place recover does anything) as it encounters them.\nReally I'd take that even further: panic/recover is almost nothing like try/catch in the sense that try and catch are (or at least act like) control structures, and panic/recover are not.\nThis really stems out of the fact that recover is built around the defer mechanism, which (as far as I can tell) is a fairly unique concept in Go.\nThere are certainly more, which I'll add if I can actuate my thoughts a bit better."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can Go really be that much faster than Python?\n\nQuestion:\nI think I may have implemented this incorrectly because the results do not make sense. I have a Go program that counts to 1000000000:\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    for i := 0; i < 1000000000; i++ {}\n    fmt.Println(\"Done\") \n}\n\nIt finishes in less than a second. On the other hand I have a Python script:\nx = 0\nwhile x < 1000000000:\n    x+=1\nprint 'Done'\n\nIt finishes in a few minutes.\nWhy is the Go version so much faster? Are they both counting up to 1000000000 or am I missing something?", "output": "One billion is not a very big number. Any reasonably modern machine should be able to do this in a few seconds at most, if it's able to do the work with native types. I verified this by writing an equivalent C program, reading the assembly to make sure that it actually was doing addition, and timing it (it completes in about 1.8 seconds on my machine).\nPython, however, doesn't have a concept of natively typed variables (or meaningful type annotations at all), so it has to do hundreds of times as much work in this case. In short, the answer to your headline question is \"yes\". Go really can be that much faster than Python, even without any kind of compiler trickery like optimizing away a side-effect-free loop."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I unpack various form of integers in a byte buffer in Golang?\n\nQuestion:\nI need to extract various fields in a byte buffer. I came up with this solution:\nfunc (fs *FileSystem) readSB() {\n    // fs.f is a *os.File\n    buf := make([]byte, 1024)\n    fs.f.ReadAt(buf, 1024)\n\n    // Offset: type\n    var p *bytes.Buffer\n\n    // 0: uint32\n    p = bytes.NewBuffer(buf[0:])\n    binary.Read(p, binary.LittleEndian, &fs.sb.inodeCount)\n    // 4: uint32\n    p = bytes.NewBuffer(buf[4:])\n    binary.Read(p, binary.LittleEndian, &fs.sb.blockCount)\n    // 20: uint32\n    p = bytes.NewBuffer(buf[20:])\n    binary.Read(p, binary.LittleEndian, &fs.sb.firstDataBlock)\n    // 24: uint32\n    p = bytes.NewBuffer(buf[24:])\n    binary.Read(p, binary.LittleEndian, &fs.sb.blockSize)\n    fs.sb.blockSize = 1024 << fs.sb.blockSize\n    // 32: uint32\n    p = bytes.NewBuffer(buf[32:])\n    binary.Read(p, binary.LittleEndian, &fs.sb.blockPerGroup)\n    // 40: uint32\n    p = bytes.NewBuffer(buf[40:])\n    binary.Read(p, binary.LittleEndian, &fs.sb.inodePerBlock)\n}\n\nIs there a more better/idiomatic/straightforward way of doing this?\n\nI want to keep offsets explicit\nI want to read from the byte buffer, not seeking and reading from the file when possible.", "output": "You could avoid creating a new buffer every time by using .Next() to skip the bytes you don't want to read:\n{\n    // Offset: type\n    p := bytes.NewBuffer(buf)\n\n    // 0: uint32\n    binary.Read(p, binary.LittleEndian, &fs.sb.inodeCount)\n\n    // 4: uint32\n    binary.Read(p, binary.LittleEndian, &fs.sb.blockCount)\n\n    // Skip [8:20)\n    p.Next(12)\n\n    // 20: uint32\n    binary.Read(p, binary.LittleEndian, &fs.sb.firstDataBlock)\n\n    // 24: uint32\n    binary.Read(p, binary.LittleEndian, &fs.sb.blockSize)\n    fs.sb.blockSize = 1024 << fs.sb.blockSize\n\n    // Skip [28:32)\n    p.Next(4)\n\n    // 32: uint32\n    binary.Read(p, binary.LittleEndian, &fs.sb.blockPerGroup)\n\n    // Skip [36:40)\n    p.Next(4)\n\n    // 40: uint32\n    binary.Read(p, binary.LittleEndian, &fs.sb.inodePerBlock)\n}\n\nOr you could avoid reading chunk by chunk and create a header structure which you read directly using binary.Read:\ntype Head struct {\n    InodeCount      uint32  //  0:4\n    BlockCount      uint32  //  4:8\n    Unknown1        uint32  //  8:12\n    Unknown2        uint32  // 12:16\n    Unknown3        uint32  // 16:20\n    FirstBlock      uint32  // 20:24\n    BlockSize       uint32  // 24:28\n    Unknown4        uint32  // 28:32\n    BlocksPerGroup  uint32  // 32:36\n    Unknown5        uint32  // 36:40\n    InodesPerBlock  uint32  // 40:44\n}\n\nfunc main() {\n    var header Head\n\n    err = binary.Read(file, binary.LittleEndian, &header)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    log.Printf(\"%#v\\n\", header)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go, AppEngine: How to structure templates for application\n\nQuestion:\nHow are people handling the use of templates in their Go-based AppEngine applications?\nSpecifically, I'm looking for a project structure that affords the following:\n\nHierarchical (directory) structure of templates and partial templates\nAllow me to use HTML tools/editors on my templates (embedding template text in xxx.go files makes this difficult)\nAutomatic reload of template text when on dev server\n\nPotential stumbling blocks are:\n\ntemplate.ParseGlob() will not traverse recursively.\nFor performance reasons it has been recommended not to upload your templates as raw text files (because those text files reside on different servers than executing code).\n\nPlease note that I am not looking for a tutorial/examples of the use of the template package.  This is more of an app structure question.  That being said, if you have code that solves the above problems, I would love to see it.  Thanks in advance.", "output": "One of my favorite features of Go is the ability to easily add handlers inside of packages. This greatly simplifies the processes of writing modular code.\nFor Example:\nFile Structure\n|-- app.yaml\n|-- app\n|   +-- http.go\n|-- templates\n|   +-- base.html\n+-- github.com\n    +-- storeski\n        +-- appengine\n            |-- products\n            |   |-- http.go\n            |   +-- templates\n            |       |-- list.html\n            |       +-- detail.html \n            +-- account\n                |-- http.go\n                +-- templates\n                    |-- overview.html\n                    +-- notifications.html \n\nEach packages has a http.go file that takes ownership of a url prefix. For example the products package under github.com/storeski/appengine/products would own any inbound url starting with /products. \nWith this modular approach it is beneficial to store the templates within the products package. If you would like to maintain a consistant base template for the site you can establish a convention where you extend templates/base.html.\nExample\ntemplates/base.html\n<!DOCTYPE HTML>\n<html>\n  <head>\n    <title>{{.Store.Title}}</title>\n  </head>\n\n  <body>\n    <div id=\"content\">\n      {{template \"content\" .}}\n    </div>\n  </body>\n</html>\n\ngithub.com/storeski/appengine/products/templates/list.html\n{{define \"content\"}}\n  <h1> Products List </h1>\n{{end}}\n\ngithub.com/storeski/appengine/products/http.go\nfunc init() {\n  http.HandleFunc(\"/products\", listHandler)\n}\n\nvar listTmpl = template.Must(template.ParseFiles(\"templates/base.html\",\n  \"github.com/storeski/appengine/products/templates/list.html\"))\n\nfunc listHandler(w http.ResponseWriter, r *http.Request) {\n\n  tc := make(map[string]interface{})\n  tc[\"Store\"] = Store\n  tc[\"Products\"] = Products\n\n  if err := listTmpl.Execute(w, tc); err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n  }\n}\n\nThis approach is very exciting because it makes the sharing of apps/package trivial. If I write a package that handles authentication which takes ownership of the /auth url. Any developer that, then, adds the package to their product root instantly has all of the functionality. All they have to do is create a base template (templates/base.html) and direct their users to /auth."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Golang GAE - intID in struct for mustache\n\nQuestion:\nHere is an Example of the app. The essential code is in: golang-code/handler/handler.go (After the subject should appear an ID!)\nIm trying to build a little blog system in Golang on Google Appengine and use Mustache as template engine.\nSo, i have a struct: \ntype Blogposts struct {\n    PostTitle   string\n    PostPreview string\n    Content     string\n    Creator     string\n    Date        time.Time\n}\n\nThe data is passed to GAE via \n    datastore.Put(c, datastore.NewIncompleteKey(c, \"Blogposts\", nil), &blogposts)\n\nSo, GAE assigns automatically a intID (int64).\nNow I tried to get the latest blogposts\n// Get the latest blogposts\nc := appengine.NewContext(r)\nq := datastore.NewQuery(\"Blogposts\").Order(\"-Date\").Limit(10)\n\nvar blogposts []Blogposts\n_, err := q.GetAll(c, &blogposts)\n\nUntil there all things works fine, but when I try to access intID (or stringID, whatever) I dont have access to this :-(\n<h3><a href=\"/blog/read/{{{intID}}}\">{{{PostTitle}}}</a></h3>\n\n(PostTitle works, intID not, i've tried thousand of things, nothing worked :-( )\nAnyone an idea? This would be great!\nEdit:\nI use mustache.\nhttp://mustache.github.com/\nIn the code I use:\nx[\"Blogposts\"] = blogposts\ndata := mustache.RenderFile(\"templates/about.mustache\", x)\nsendData(w, data) // Equivalent to fmt.Fprintf\n\nAnd then the data can be accessed in the .mustache template with {{{Content}}} or {{{PostTitle}}} etc.", "output": "intID is an internal property of a Key not the struct, and is accessible through a getter:\nid := key.IntID()\n\nGetAll returns []*Key, which you're not using:\n_, err := q.GetAll(c, &blogposts)\n\nOne way to get around this is to create a viewmodel struct that has both your post and key info (untested, but this is the gist of it):\n  //... handler code ...\n\n  keys, err := q.GetAll(c, &blogposts)\n  if err != nil {\n    http.Error(w, \"Problem fetching posts.\", http.StatusInternalServerError)\n    return\n  }\n\n  models := make([]BlogPostVM, len(blogposts))\n  for i := 0; i < len(blogposts); i++ {\n    models[i].Id = keys[i].IntID()\n    models[i].Title = blogposts[i].Title\n    models[i].Content = blogposts[i].Content\n  }\n\n  //... render with mustache ...\n}\n\ntype BlogPostVM struct {\n  Id int\n  Title string\n  Content string\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Which files are compiled?\n\nQuestion:\nHow to know which files are going to be compiled and linked when you have several files which are specific to a system?", "output": "There are at least a couple of options:\n\nUse go build -n to list the commands that would be executed by a build, and then parse the output.\nUse the go/build package. Specifically, look at the Import function.\n\nI suggest the second method; if I understand your question correctly it does what you need. You specify a package to \"import\", and it returns a Package structure which contains, among other things, the set of Go, C, ASM files that will be compiled."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Call a Struct and its Method by name in Go?\n\nQuestion:\nI have found a function call MethodByName() here http://golang.org/pkg/reflect/#Value.MethodByName but it's not exactly what I want! (maybe because I don't know how to use it ... I cannot find any example with it). What I want is:\ntype MyStruct struct {\n//some feilds here\n} \nfunc (p *MyStruct) MyMethod { \n    println(\"My statement.\"); \n} \n\nCallFunc(\"MyStruct\", \"MyMethod\"); \n//print out \"My statement.\" \n\nSo I guess, first I need something like StructByName() and after that use it for MethodByName(), is that right!?", "output": "To call a method on an object, first use reflect.ValueOf. Then find the method by name, and then finally call the found method. For example:\npackage main\n\nimport \"fmt\"\nimport \"reflect\"\n\ntype T struct {}\n\nfunc (t *T) Foo() {\n    fmt.Println(\"foo\")\n}\n\nfunc main() {\n    var t T\n    reflect.ValueOf(&t).MethodByName(\"Foo\").Call([]reflect.Value{})\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to convert an int value to string in Go?\n\nQuestion:\ni := 123\ns := string(i) \n\ns is 'E', but what I want is \"123\"\nPlease tell me how can I get \"123\".\nAnd in Java, I can do in this way: \nString s = \"ab\" + \"c\"  // s is \"abc\"\n\nhow can I concat two strings in Go?", "output": "Use the strconv package's Itoa function.\nFor example:\npackage main\n\nimport (\n    \"strconv\"\n    \"fmt\"\n)\n\nfunc main() {\n    t := strconv.Itoa(123)\n    fmt.Println(t)\n}\n\nYou can concat strings simply by +'ing them, or by using the Join function of the strings package."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Tour of Go exercise #18: Slices, index out of range\n\nQuestion:\nI am working through the exercises in the Go tour and I have hit a snag that I can't figure out.\nI'm doing Exercise: Slices and I am getting this error:\n256 x 256\n\npanic: runtime error: index out of range [0] with length 0\n\ngoroutine 1 [running]:\nmain.Pic(0x100, 0x100)\n    /tmp/sandbox1628012103/prog.go:14 +0xcf\ngolang.org/x/tour/pic.Show(0xc0000001a0)\n    /tmp/gopath962180923/pkg/mod/golang.org/x/tour@v0.0.0-20201207214521-004403599411/pic/pic.go:32 +0x28\nmain.main()\n    /tmp/sandbox1628012103/prog.go:25 +0x25\n\nHere is my code:\npackage main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/tour/pic\"\n)\n\nfunc Pic(dx, dy int) [][]uint8 {\n    fmt.Printf(\"%d x %d\\n\\n\", dx, dy)\n\n    pixels := make([][]uint8, 0, dy)\n\n    for y := 0; y < dy; y++ {\n        pixels[y] = make([]uint8, 0, dx)\n\n        for x := 0; x < dx; x++ {\n            pixels[y][x] = uint8(x * y)\n        }\n    }\n\n    return pixels\n}\n\nfunc main() {\n    pic.Show(Pic)\n}", "output": "Slices\nFor a string, array, pointer to array, or slice a, the primary\n  expression\na[low : high]\nconstructs a substring or slice. The index expressions low and high\n  select which elements appear in the result. The result has indexes\n  starting at 0 and length equal to high - low. \nFor arrays or strings, the indexes low and high must satisfy 0 <= low\n  <= high <= length; for slices, the upper bound is the capacity rather\n  than the length.\nIndexes\nA primary expression of the form\na[x]\ndenotes the element of the array, slice, string or map a indexed by x.\n  The value x is called the index or map key, respectively. The\n  following rules apply:\nFor a of type A or *A where A is an array type, or for a of type S\n  where S is a slice type:\nx must be an integer value and 0 <= x < len(a)\n\na[x] is the array element at index x and the type of a[x] is\nthe element type of A\n\nif a is nil or if the index x is out of range, a run-time panic occurs\n\nMaking slices, maps and channels\nmake(T, n)       slice      slice of type T with length n and capacity n\nmake(T, n, m)    slice      slice of type T with length n and capacity m\n\n\ny must be an integer value and 0 <= y < len(pixel[]uint8). x must be an integer value and 0 <= x < len(pixel[][]uint8). For example,\npackage main\n\nimport \"tour/pic\"\n\nfunc Pic(dx, dy int) [][]uint8 {\n    pixels := make([][]uint8, dy)\n    for y := 0; y < dy; y++ {\n        pixels[y] = make([]uint8, dx)\n        for x := 0; x < dx; x++ {\n            pixels[y][x] = uint8(x * y)\n        }\n    }\n    return pixels\n}\n\nfunc main() {\n    pic.Show(Pic)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to force compiler to control value/pointer-to-value func arguments?\n\nQuestion:\nDealing with go's funcs I discovered that one can't force the compiler to control whether I pass a value or pointer-to-value argument when using 'generic' interface{} type.\nfunc f(o interface{}) {\n...\n}\n\nThe most obvious solution is to use the following modification:\nfunc f(o *interface{}) {\n...\n}\n\nAlthough this is successfully compiled I didn't find this step right. So, is there any means to state that I want to pass any pointer?", "output": "No. At compile time, interface{}, the empty interface, is any type.\n\nall types implement the empty\n  interface: interface{} Interface\n  types"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Priority in Go select statement workaround\n\nQuestion:\nI wish to have a go routine listening on two channels, blocked when both channels are drained. However, if both channels contains data, I want one to be drained before the other is handled.\nIn the working example below I wish all out to be drained before exit is handled. I use a select-statement which doesn't have any priority order. How might I get around the problem, making all 10 out-values be handled before the exit?\npackage main\n\nimport \"fmt\"\n\nfunc sender(out chan int, exit chan bool){\n    for i := 1; i <= 10; i++ {\n        out <- i\n    } \n    exit <- true\n}\n\nfunc main(){\n    out := make(chan int, 10)\n    exit := make(chan bool)\n\n    go sender(out, exit)\n\n    L:\n    for {\n        select {\n            case i := <-out:\n                fmt.Printf(\"Value: %d\\n\", i)\n            case <-exit:\n                fmt.Println(\"Exiting\")\n                break L\n        }\n    }\n    fmt.Println(\"Did we get all 10? Most likely not\")\n}", "output": "package main\n\nimport \"fmt\"\n\nfunc sender(out chan int, exit chan bool) {\n    for i := 1; i <= 10; i++ {\n        out <- i\n    }\n    exit <- true\n}\n\nfunc main() {\n    out := make(chan int, 10)\n    exit := make(chan bool)\n\n    go sender(out, exit)\n\n    for {\n        select {\n        case i := <-out:\n            fmt.Printf(\"Value: %d\\n\", i)\n            continue\n        default:\n        }\n        select {\n        case i := <-out:\n            fmt.Printf(\"Value: %d\\n\", i)\n            continue\n        case <-exit:\n            fmt.Println(\"Exiting\")\n        }\n        break\n    }\n    fmt.Println(\"Did we get all 10? I think so!\")\n}\n\nThe default case of the first select makes it non-blocking.  The select will drain the out channel without looking at the exit channel, but otherwise will not wait.  If the out channel is empty, it immediately drops to the second select.  The second select is blocking.  It will wait for data on either channel.  If an exit comes, it handles it and allows the loop to exit.  If data comes, it goes back up the top of the loop and back into drain mode."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Contains method for a slice\n\nQuestion:\nIs there anything similar to a slice.contains(object) method in Go without having to do a search through each element in a slice?", "output": "Mostafa has already pointed out that such a method is trivial to write, and mkb gave you a hint to use the binary search from the sort package. But if you are going to do a lot of such contains checks, you might also consider using a map instead.\nIt's trivial to check if a specific map key exists by using the value, ok := yourmap[key] idiom. Since you aren't interested in the value, you might also create a map[string]struct{} for example. Using an empty struct{} here has the advantage that it doesn't require any additional space and Go's internal map type is optimized for that kind of values. Therefore, map[string] struct{} is a popular choice for sets in the Go world."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How can we use channels in Go in place of mutex?\n\nQuestion:\nChannels combine communication—the exchange of a value—with synchronization—guaranteeing that two calculations (goroutines) are in a known state.\nHow is it possible to use the channels in Google Go to perform the functionality of mutex?\npackage main\n\nimport \"sync\"\n\nvar global int = 0\nvar m sync.Mutex\n\nfunc thread1(){\n    m.Lock()\n    global = 1\n    m.Unlock()\n}\n\nfunc thread2(){\n    m.Lock()\n    global = 2\n    m.Unlock()\n}\n\nfunc main(){\n   go thread1()\n   go thread2()\n}", "output": "An example of using a Channel as a Mutex:\npackage main\n\nvar global int = 0\nvar c = make(chan int, 1)\n\nfunc thread1(){\n    <-c // Grab the ticket\n    global = 1\n    c <- 1 // Give it back\n}\n\nfunc thread2(){\n    <-c\n    global = 2\n    c <- 1\n}\n\nfunc main() {\n   c <- 1 // Put the initial value into the channel\n   go thread1()\n   go thread2()\n}\n\nYou could also use chan struct{} instead of chan int to reduce the memory size. The value that goes into it is struct{}{} (type struct{} and an empty content {}). See Ivan black's comment for an example."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: In golang, is it possible to get reflect.Type from the type itself, from name as string?\n\nQuestion:\ntype t1 struct { i int; s string }\nvar v1 reflect.Type = /* how to set to t1's reflect.Type? */\n\n\nis it possible to get the reflect.Type of t1 without having to instantiate it?\nis it possible to get the reflect.Type of t1 from having its name \"t1\" as a string?", "output": "On 1, yes, kinda:\nvar v1 reflect.Type = reflect.TypeOf((*t1)(nil)).Elem()\nfmt.Println(v1)  // prints \"main.t1\"\n\nNo instantiation needed. However, Go doesn't have type literals, which is I think what you're asking for. To get the runtime value of a type, you need to have a value of some sort. If you don't want to or can't create the value at runtime, you can pull it from a typed nil. If you don't like the idea of looking this up every time, you can store this runtime type in a variable.\nOn 2, no, not really. This would require the Go runtime to maintain a map of all types in the current binary, which has a number of problems. You could create a type registry package, and register all types you may want to retrieve by string, but that's always going to be incomplete, and if you know what type you want, you can always just use TypeOf. The situation is made a bit more complicated by the fact that you can have anonymous types, and the name like \"t1\" isn't certain to be unique, as another package may have a type of the same name. It is possible for the Go runtime to provide a function that gives a type from a string name, but I doubt that will happen."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Filter out broken pipe errors\n\nQuestion:\nI'm getting an error returned from an io.Copy call, to which I've passed a socket (TCPConn) as the destination. It's expected that the remote host will simply drop the connection when they've had enough, and I'm not receiving anything from them.\nWhen the drop occurs, I get this error:\nwrite tcp 192.168.26.5:21277: broken pipe\n\nBut all I have is an error interface. How can I differentiate broken pipe errors from other kinds of error?\nif err.Errno == EPIPE...", "output": "The broken pipe error is defined in the syscall package. You can use the equality operator to compare the error to the one in syscall. Check http://golang.org/pkg/syscall/#constants for a complete list of syscall errors. Search \"EPIPE\" on the page and you will find all the defined errors grouped together. \nif err == syscall.EPIPE {\n    /* ignore */\n}\n\nIf you wish to get the actual errno number (although it is pretty useless) you can use a type assertion:\nif e, ok := err.(syscall.Errno); ok {\n    errno = uintptr(e)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: byte endian convert by using encoding/binary in Go\n\nQuestion:\nI got the runtime error message Write T1 binary.Read: invalid type main.T1\npackage main\n\nimport (\n    \"encoding/binary\"\n    \"net\"\n)\n\ntype T1 struct {\n    f1 [5]byte\n    f2 int\n}\n\nfunc main() {\n    conn, _ := net.Dial(\"tcp\", \":12345\")\n    l1 := T1{[5]byte{'a', 'b', 'c', 'd', 'e'}, 1234}\n    binary.Write(conn, binary.BigEndian, &l1)\n}\n\nI wish to use the endian auto convert function, how could I do?\nBy the way, is there more efficient way?", "output": "Use exported fixed size fields. For example,\npackage main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n)\n\ntype T struct {\n    F1 [5]byte\n    F2 int32\n}\n\nfunc main() {\n    var t1, t2 T\n    t1 = T{[5]byte{'a', 'b', 'c', 'd', 'e'}, 1234}\n    fmt.Println(\"t1:\", t1)\n    buf := new(bytes.Buffer)\n    err := binary.Write(buf, binary.BigEndian, &t1)\n    if err != nil {\n        fmt.Println(err)\n    }\n    err = binary.Read(buf, binary.BigEndian, &t2)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(\"t2:\", t2)\n}\n\nOutput:\nt1: {[97 98 99 100 101] 1234}\nt2: {[97 98 99 100 101] 1234}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What's the best way to get the path of the executable during runtime?\n\nQuestion:\nIf my go program can be executed in different ways (cron, monit, etc..), what's the most reliable way to get the directory that contains the executable, during runtime?\nIn python, this would be the variable:\nos.path.realpath(__file__)", "output": "It's probably the same as in C, in other words, there isn't a portable fool-proof method.  See How do I find the location of the executable in C?"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to order a list of different struct types in go\n\nQuestion:\nI've only been working with Go for a couple of days. I have a small variety of different structure types defined, each of which contains a date.\nSomehow I need to process those structures in date order, but that ordering has to span across the multiple different structure types. In a dynamically typed language like Python, it's easy to just create a hash of all the objects keyed by date (or hash of lists if they're not unique). In C, I can use unions of pointers or void*. But I'm stuck as to how do this in Go.\nI guess I could keep a sorted list of each type and do a manual mergesort as I go. Seems klunky?\nWhat I've read about handling this sort of situation seems to point to using interfaces, but I don't really see how to use them in this situation. \nFor the sake of argument, let's say I have something like:\ntype A struct {\n    Date string\n    Info string\n}\n\ntype B struct {\n    Date string\n    Info int\n}\n\n(Though in practice there are more structures, and they are more complex with multiple fields), and just need to print in date order the contents of an (unsorted) array of each of them. \nIs there some way to create a list (date, pointer) pairs to a non-uniform object type?\n\nPer first suggestion below:\npackage main\nimport \"fmt\"\n\ntype A struct {\n    Date string\n    Info string\n}\nfunc (x *A) GetDate() string {\n    return x.Date\n}\ntype B struct {\n    Date string\n    Info int\n}\nfunc (x *B) GetDate() string {\n    return x.Date\n}\n\ntype Dater interface {\n    GetDate() string\n}\n\ntype Daters []Dater\nfunc (s Daters) Len() int      { return len(s) }\nfunc (s Daters) Swap(i, j int) { s[i], s[j] = s[j], s[i] }\ntype ByDate struct{ Daters }\nfunc (s ByDate) Less(i, j int) bool {\n    return s.Daters[i].GetDate() < s.Daters[j].GetDate()\n}   \n\nfunc main() {\n    // lista and listb are just examples. They really come from elsewhere\n    lista := []A{{\"2012/08/01\", \"one\"}, {\"2012/08/03\", \"three\"}}\n    listb := []B{{\"2012/08/02\", 2}, {\"2012/08/04\", 4}}\n\n    x := make([]Dater, len(lista) + len(listb))\n    index := 0\n    for i := range(lista) {\n        x[index] = &lista[i]\n        index++\n    }\n    for i := range(listb) {\n        x[index] = &listb[i]\n        index++\n    }\n    sort.Sort(ByDate{x})\n    for _,v := range(x) {\n        fmt.Printf(\"%#v\\n\", v)\n    }\n}\n\nThat works! So the basic use of interface is fine, and I'm starting to understand\ninterfaces a little better - thank you!\nNote: The creation of x is pretty ugly. I can't see a cleaner / more idiomatic way?", "output": "Define a interface (say Dated) with a method (say getDate() that returns Date). Then have all structs (A, B, C) implementing Dated interface. Then you can define use []Dated to hold your type values.\nYou might want to check package 'time' and 'sort' to simplify the implementation."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Create a map of string to List\n\nQuestion:\nI'd like to create a map of string to container/list.List instances. Is this the correct way to go about it?\npackage main\n\nimport (\n    \"fmt\"\n    \"container/list\"\n)\n\nfunc main() {\n    x := make(map[string]*list.List)\n\n    x[\"key\"] = list.New()\n    x[\"key\"].PushBack(\"value\")\n\n    fmt.Println(x[\"key\"].Front().Value)\n}", "output": "Whenever I've wanted to use a List I've found that a slice was the right choice, eg\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    x := make(map[string][]string)\n\n    x[\"key\"] = append(x[\"key\"], \"value\")\n    x[\"key\"] = append(x[\"key\"], \"value1\")\n\n    fmt.Println(x[\"key\"][0])\n    fmt.Println(x[\"key\"][1])\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to handle i18n in Go?\n\nQuestion:\nI searched on web but I didn't find anything related to i18n and Go.\nI wish to use Go for develop web sites. What is the best way to handle internationalization?", "output": "go-i18n has some nice features:\n\nImplements CLDR plural rules.\nUses text/template for strings with variables.\nTranslation files are simple JSON."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang pointers on pointers as function parameters\n\nQuestion:\nI have the following function: \nfunc addCatsToMap(m map[string][]CatHouse, meowId int, treats Set, dog *Dog) {\n\n//if (complicated thing) add Cat to m\n\n}\n\nwhere Set, the type of treats, is an interface with the following definition:\ntype Set interface {\n  Add(value string)\n  Contains(value string) (bool)\n  Length() (int)\n  RemoveDuplicates()\n}\n\nQuestion:\nIs it true that m, treats, and dog are passed-by-reference, and meowId has it's value copied?\nI assume that:\n\nm is pass-by-reference because it's a map\ndog is a struct. So, I should pass the pointer to avoid copying the data", "output": "An interface type is simply a set of methods.  Notice that the members of an interface definition do not specify whether or not the receiver type is a pointer.  That is because the method set of a value type is a subset of the method set of its associated pointer type.  That's a mouthful.  What I mean is, if you have the following:\ntype Whatever struct {\n    Name string\n}\n\nand you define the following two methods:\nfunc (w *Whatever) Foo() {\n    ...\n}\n\nfunc (w Whatever) Bar() {\n    ...\n}\n\nThen the type Whatever has only the method Bar(), while the type *Whatever has the methods Foo() and Bar().  That means if you have the following interface:\ntype Grits interface {\n    Foo()\n    Bar()\n}\n\nThen *Whatever implements Grits but Whatever does not, because Whatever lacks the method Foo().  When you define the input to a function as an interface type, you have no idea whether it's a pointer or a value type.\nThe following example illustrates a function that takes an interface type in both ways:\npackage main\n\nimport \"fmt\"\n\ntype Fruit struct {\n    Name string\n}\n\nfunc (f Fruit) Rename(name string) {\n    f.Name = name\n}\n\ntype Candy struct {\n    Name string\n}\n\nfunc (c *Candy) Rename(name string) {\n    c.Name = name\n}\n\ntype Renamable interface {\n    Rename(string)\n}\n\nfunc Rename(v Renamable, name string) {\n    v.Rename(name)\n    // at this point, we don't know if v is a pointer type or not.\n}\n\nfunc main() {\n    c := Candy{Name: \"Snickers\"}\n    f := Fruit{Name: \"Apple\"}\n    fmt.Println(f)\n    fmt.Println(c)\n    Rename(f, \"Zemo Fruit\")\n    Rename(&c, \"Zemo Bar\")\n    fmt.Println(f)\n    fmt.Println(c)\n}\n\nyou could call Raname(&f, \"Jorelli Fruit\") but not Rename(c, \"Jorelli Bar\"), because both Fruit and *Fruit implement Renamable, while *Candy implements Renable and Candy does not.\nhttp://play.golang.org/p/Fb-L8Bvuwj"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google App Engine TCP/IP connection\n\nQuestion:\nI would like to set up a couple TCP/IP connections in GAE using Go. As I've searched it is impossible to get a static IP from the app engine, but can't find much data on other limitations.\nIs it possible to establish a TCP/IP connection in GAE, and if so, how long can it be used before it has to be re-established?", "output": "It is clearly mentioned here that you may not open a socket from within their sandboxed environment.\nNow HTTP is also based on TCP/IP, and you may \"fetch\" content using URLs (in Python it's urllib and urllib2, don't know much about Go). But raw SOCK_STREAM connections? NO.\nregards,\nYati Sagade"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Converting Go struct to JSON\n\nQuestion:\nI am trying to convert a Go struct to JSON using the json package but all I get is {}. I am certain it is something totally obvious but I don't see it.\npackage main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype User struct {\n    name string\n}\n\nfunc main() {\n    user := &User{name:\"Frank\"}\n    b, err := json.Marshal(user)\n    if err != nil {\n        fmt.Printf(\"Error: %s\", err)\n        return;\n    }\n    fmt.Println(string(b))\n}\n\nThen when I try to run it I get this:\n$ 6g test.go && 6l -o test test.6 && ./test \n{}", "output": "You need to export the User.name field so that the json package can see it. Rename the name field to Name.\npackage main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype User struct {\n    Name string\n}\n\nfunc main() {\n    user := &User{Name: \"Frank\"}\n    b, err := json.Marshal(user)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(string(b))\n}\n\nOutput:\n{\"Name\":\"Frank\"}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: efficient way to print out my format\n\nQuestion:\nI wish there is an efficient way to print out my format.\nAs I know convert to string may occur performance issue.\nIs there any better method?\npackage main\n\nimport \"fmt\"\n\ntype T struct {\n  order_no [5]byte\n  qty int32\n}\nfunc (t T)String() string {\n  return fmt.Sprint(\"order_no=\", t.order_no, \n    \"qty=\", t.qty)\n}\n\nfunc main() {\n        v := T{[5]byte{'A','0','0','0','1'}, 100}\n\n    fmt.Println(v)\n}    \n\nThe output is order_no=[65 48 48 48 49]qty=100\nI wish it will be order_no=A0001 qty=100.\nBTW, why func (t T)String() string work and func (t *T)String() string can not work.(on goplay)", "output": "package main\n\nimport \"fmt\"\n\ntype T struct {\n    order_no [5]byte\n    qty      int32\n}\n\nfunc (t T) String() string {\n    return fmt.Sprint(\n        \"order_no=\", string(t.order_no[:]),\n        \" qty=\", t.qty,\n    )\n}\n\nfunc main() {\n    v := T{[5]byte{'A', '0', '0', '0', '1'}, 100}\n    fmt.Println(v)\n}\n\nOutput:\norder_no=A0001 qty=100"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Mixing python with a faster language for optimization in GAE\n\nQuestion:\nI'm a newbie in the Python and GAE world and I have a question.\nWith Python the normal approach is to only optimize the code when needed, fixing the more urgent bottlenecks.\nAnd one of the ways to achieve that is by rewriting the most critical parts of the program in C.\nBy using GAE are we losing this possibility forever?\nSince Google's Go language is now (or it will be as soon as it is compiled more efficiently) the fastest language in GAE, will there be a way to mix Python and Go in the same app?\nWhat other ways could be used to achieve a similar result?", "output": "See Can I write parts of the Google App Engine code in Java, other parts in Python? for how to use multiple languages. \nBasically, each version of a given app can only use one runtime language. \nBut, you can have two different versions of your app, written in different languages, and they can pass information back and forth through the datastore.\nAlso, you can have two different apps, in two different languages, and you can have then pass information back and forth through requests."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to write `cat` in Go using pipes\n\nQuestion:\nI have an implementation of the Unix tool cat below. It reads a number of bytes from os.Stdin into a buffer, then writes those bytes out to os.Stdout.  Is there a way I can skip the buffer and just pipe Stdin directly to Stdout?\npackage main\n\nimport \"os\"\nimport \"io\"\n\nfunc main() {\n    buf := make([]byte, 1024)\n\n    var n int\n    var err error\n    for err != io.EOF {\n        n, err = os.Stdin.Read(buf)\n\n        if n > 0 {\n            os.Stdout.Write(buf[0:n])\n        }\n    }\n}", "output": "You can use io.Copy() (Documentation here)\nExample:\npackage main\n\nimport (\n    \"os\"\n    \"io\"\n    \"log\"\n)\n\nfunc main() {\n    if _, err := io.Copy(os.Stdout, os.Stdin); err != nil {\n        log.Fatal(err)\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Updating entity in Google Appengine datastore with Go\n\nQuestion:\nI am toying with GAE, Go and the datastore. I have the following structs:\ntype Coinflip struct {                                                                                                                                                                                                                      \n  Participants []*datastore.Key\n  Head         string\n  Tail         string\n  Done         bool\n}\n\ntype Participant struct {\n  Email string\n  Seen  datastore.Time\n}\n\n(For those wondering I store Participants as a slice off Key pointers because Go doesn't automatically dereferences entities.)\nNow I want to find a Participant with a particular Email address associated with a know Coinflip. Like so (this works):\ncoinflip, _ := find(key_as_string, context)\nparticipants, _ := coinflip.fetchParticipants(context) /* a slice of Participant*/\n\nvar found *Participant\nfor i := 0; i < len(participants) && found == nil; i++ {\n  if participants[i].Email == r.FormValue(\"email\") {\n    found = &participants[i]\n  }\n}\n(*found).Seen = datastore.SecondsToTime(time.Seconds())\n\nHow do I save *found to the datastore? I need the key apparently but the coupling between the Participant struct and the Key is very loose.\nI'm unsure how to proceed from here. Do I need to return the keys as well from the fetchParticipants call? The Java and Python GAE implementation seem quite a bit simpler (just call put() on the object).\nThanks in advance,", "output": "For interacting with data in Go, consider using our new library https://github.com/matryer/gae-records for an Active Record, data objects wrapper around the datastore.  It sorts out a lot of the hassle for you.\nFor example, it supports:\n// create a new model for 'People'\nPeople := gaerecords.NewModel(\"People\")\n\n// create a new person\nmat := People.New()\nmat.\n SetString(\"name\", \"Mat\")\n SetInt64(\"age\", 28)\n .Put()\n\n// load person with ID 1\nperson, _ := People.Find(1)\n\n// change some fields\nperson.SetInt64(\"age\", 29).Put()\n\n// load all People\npeeps, _ := People.FindAll()\n\n// delete mat\nmat.Delete()\n\n// delete user with ID 2\nPeople.Delete(2)\n\n// find the first three People by passing a func(*datastore.Query)\n// to the FindByQuery method\nfirstThree, _ := People.FindByQuery(func(q *datastore.Query){\n  q.Limit(3)\n})\n\n// build your own query and use that\nvar ageQuery *datastore.Query = People.NewQuery().\n  Limit(3).Order(\"-age\")\n\n// use FindByQuery with a query object\noldestThreePeople, _ := People.FindByQuery(ageQuery)\n\n// using events, make sure 'People' records always get\n// an 'updatedAt' value set before being put (created and updated)\nPeople.BeforePut.On(func(c *gaerecords.EventContext){\n  person := c.Args[0].(*Record)\n  person.SetTime(\"updatedAt\", datastore.SecondsToTime(time.Seconds()))\n})"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I return from func main in Go?\n\nQuestion:\nHow do I return from main with an exit code as I would in C? Context: I'm checking that there is a single command line argument, I will print usage and return an an error status code if the argument count, or argument is invalid.", "output": "Go uses the Exit function for that. Just pass the status code as an argument and you're done :)\nTo exit(1) with an error message you can use log.Fatal()/log.Fatalf()/log.Fatalln(): https://pkg.go.dev/log#Fatal"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using an interface within a struct in Go\n\nQuestion:\nIn trying to understand Go, I ran into this piece of code in websocket.go (snipped):\ntype frameHandler interface {\n    HandleFrame(frame frameReader) (r frameReader, err error)\n    WriteClose(status int) (err error)\n}\n\n// Conn represents a WebSocket connection.\ntype Conn struct {\n    config  *Config\n    request *http.Request\n    .\n    .\n    frameHandler\n    PayloadType        byte\n    defaultCloseStatus int\n}\n\nIn the Conn type the frameHandler stands there all alone? An interface without a name?\nLater on in the code they even try check if the poor interface is nil:\nConn(a).frameHandler == nil\n\nMy own guess is that the frameHandler within the struct is a type which matches the frameHandler interface, and on top of that will have the name frameHandler. Is this correct? Hehe, fun language anyhow.", "output": "This line:\n    frameHandler\n\nis roughly equivalent to this:\n    frameHandler frameHandler\n\nin that frameHandler is both the name of the field and its type. In addition, it adds all the fields and methods of the frameHandler to the Conn, so if conn is a Conn, then conn.WriteClose(0) means conn.frameHandler.WriteClose(0).\nAs the Go Programming Language Specification puts it:\n\nA field declared with a type but no explicit field name is an anonymous field (colloquially called an embedded field). Such a field type must be specified as a type name T or as a pointer to a non-interface type name *T, and T itself may not be a pointer type. The unqualified type name acts as the field name. // A struct with four anonymous fields of type T1, *T2, P.T3 and *P.T4\nstruct {\n    T1        // field name is T1\n    *T2       // field name is T2\n    P.T3      // field name is T3\n    *P.T4     // field name is T4\n    x, y int  // field names are x and y\n} The following declaration is illegal because field names must be unique in a struct type: struct {\n    T         // conflicts with anonymous field *T and *P.T\n    *T        // conflicts with anonymous field T and *P.T\n    *P.T      // conflicts with anonymous field T and *T\n} Fields and methods (§Method declarations) of an anonymous field are promoted to be ordinary fields and methods of the struct (§Selectors). The following rules apply for a struct type named S and a type named T: \nIf S contains an anonymous field T, the\n          method set of S includes the\n          method set of T.\n      \nIf S contains an anonymous field *T, the\n          method set of S includes the method set of *T\n          (which itself includes the method set of T).\n      \nIf S contains an anonymous field T or\n          *T, the method set of *S includes the\n          method set of *T (which itself includes the method\n          set of T).\n      \n A field declaration may be followed by an optional string literal tag, which becomes an attribute for all the fields in the corresponding field declaration. The tags are made visible through a reflection interface but are otherwise ignored. // A struct corresponding to the TimeStamp protocol buffer.\n// The tag strings define the protocol buffer field numbers.\nstruct {\n    microsec  uint64 \"field 1\"\n    serverIP6 uint64 \"field 2\"\n    process   string \"field 3\"\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go client for Google Drive SDK v2\n\nQuestion:\nhttps://developers.google.com/drive/v2/reference/files/list\nAre there Go examples using the code.google.com/p/google-api-go-client/drive/v2 package. Is there another location for it? or just not released yet?", "output": "It is not yet released, but you can build the client yourself, if you have the library installed with:\ngo get code.google.com/p/google-api-go-client/drive/v1\ncd $GOPATH/src/code.google.com/p/google-api-go-client\ngo run google-api-go-generator/gen.go -api=drive:v2\ngo install ./drive/v2\n\nI will submit a patch right now to get it added."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Formatting of Time in Go\n\nQuestion:\nI have a go program like this,\npackage main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\ns := strconv.Itoa64(time.Nanoseconds())\nfmt.Println(s)\n}\n\nHere, in my system, the output is 19 digits nanoseconds. Now, I want to get the time  like digits after 7 to 12 of those nanoseconds. Can anybody help how can it be possible in Go ?\nNB: I want digits from 7 to 12 because in my system, time differs between them means other digits are same, so for me not needed. And formatting inside println is not required because I give example just to clarify my code. Actually, I will use formatted time for another purpose. I need it in s :=.", "output": "s := strconv.Itoa64(time.Nanoseconds())[6:12]"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a way to convert integers to bools in go or vice versa?\n\nQuestion:\nIs there a builtin way to cast bools to integers or vice versa? I've tried normal casting, but since they use different underlying types, conversion isn't possible the classic way. I've poured over some of the specification, and I haven't found an answer yet.", "output": "Int to bool is easy, just x != 0 will do the trick. To go the other way, since Go doesn't support a ternary operator, you'd have to do:\nvar x int\nif b {\n    x = 1\n} else {\n    x = 0\n}\n\nYou could of course put this in a function:\nfunc Btoi(b bool) int {\n    if b {\n        return 1\n    }\n    return 0\n }\n\nThere are so many possible boolean interpretations of integers, none of them necessarily natural, that it sort of makes sense to have to say what you mean.\nIn my experience (YMMV), you don't have to do this often if you're writing good code. It's appealing sometimes to be able to write a mathematical expression based on a boolean, but your maintainers will thank you for avoiding it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: When should I define methods on values (instead of on pointers) in Go?\n\nQuestion:\nHaving defined\ntype MyInt int\n\nI would like to define a method .ShowMe() that just prints the value. I can define this either using *MyInt:\nfunc (this *MyInt) ShowMe() {\n    fmt.Print(*this, \"\\n\")\n}\n\nOr using MyInt:\nfunc (this MyInt) ShowMe() {\n    fmt.Print(this, \"\\n\")\n}\n\nIn what cases is it recommended to define methods on values, instead of on pointers?", "output": "There are two questions to ask yourself when making this decision:\n\nDo I want to be able to modify the receiver's value?\nWill copying the receiver's value be expensive?\n\nIf the answer to either of these questions is yes, then define the method on a pointer.\nIn your example, you don't need to modify the receiver's value and copying the receiver isn't expensive.\nFor deciding the answer to #2, my rule of thumb is: if the receiver is a struct with more than one field, pass by pointer. Otherwise pass by value."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Anybody tried to compile Go on Windows?, It appears to now support generating PE Format binaries\n\nQuestion:\nhttp://code.google.com/r/hectorchu-go-windows/source/list\nIf you could compile it successfully, I like to know the procedures of how to.", "output": "Assuming you are using Hector's source tree:\n\nInstall MinGW and MSYS, along with MSYS Bison and any other tools you think you'll find useful (vim, etc).\nInstall ed from the GNUWin32 project.\nInstall Python and Mercurial.\nClone the [hectorchu-go-windows mercurial repository](https://hectorchu-go-windows.googlecode.com/hg/ hectorchu-go-windows) to C:\\Go.\nRun an MSYS shell (or rxvt). The rest of these are bash commands...\n\n\nmkdir $HOME/bin\nexport PATH=$HOME/bin:$PATH\nexport GOROOT=C:\\\\Go\nexport GOARCH=386\nexport GOOS=mingw\ncd /c/Go/src\n./all.bash\nCorrect errors as it spits them out at you, repeat step 10 until it starts building.\n\n\nIt's the same idea as on Linux or MacOS, basically.\nHowever, I still stand by what I said in my comment above: this isn't necessarily going to generate anything that actually works yet. You'd be better served by waiting until this effort has merged into the main Go tree before tackling it, unless your interest is in assisting with the porting effort.\nUpdate: there is now a mostly-functional pre-built windows port available, for those not interested in building the compiler themselves. However, given the rate of change of the project, the lack of formal releases (other than the hg \"release\" tag), and the possibility of Hector's changes being merged into the main branch soon, keeping up with development via source builds is likely to produce better results over time."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to initialize members in Go struct\n\nQuestion:\nI am new to Golang so allocation in it makes me insane:\nimport \"sync\"\n\ntype SyncMap struct {\n        lock *sync.RWMutex\n        hm map[string]string\n}\nfunc (m *SyncMap) Put (k, v string) {\n        m.lock.Lock()\n        defer m.lock.Unlock()\n\n        m.hm[k] = v, true\n}\n\nand later, I just call:\nsm := new(SyncMap)\nsm.Put(\"Test, \"Test\")\n\nAt this moment I get a nil pointer panic. \nI've worked around it by using another one function, and calling it right after new():\nfunc (m *SyncMap) Init() {\n        m.hm = make(map[string]string)\n        m.lock = new(sync.RWMutex)\n}\n\nBut I wonder, if it's possible to get rid of this boilerplate initializing?", "output": "You just need a constructor. A common used pattern is\nfunc NewSyncMap() *SyncMap {\n    return &SyncMap{hm: make(map[string]string)}\n}\n\nIn case of more fields inside your struct, starting a goroutine as backend, or registering a finalizer everything could be done in this constructor.\nfunc NewSyncMap() *SyncMap {\n    sm := SyncMap{\n        hm: make(map[string]string),\n        foo: \"Bar\",\n    }\n\n    runtime.SetFinalizer(sm, (*SyncMap).stop)\n\n    go sm.backend()\n\n    return &sm\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to perform this in update in Go? (Google App Engine)\n\nQuestion:\nI need to update a datastore entity in a way that will not be broken by multiple concurrent users doing the same thing.\nI understand that I can't use SQL for updating the datastore but I'm not sure what else would work.\nThis is how I would achieve it in an RDBMS using SQL:\n-- Account.Balance   = current balance\n-- Account.Rate      = increase per second\n-- Account.CheckDate = the last time the balance was checked and updated\n\n-- so we need to find the number of seconds since the last check, \n-- update the balance by rate*seconds, then update the check datetime\n\nUPDATE    Account\nSET       Account.Balance = Account.Balance + ( DATEDIFF(S, GETDATE(), Account.CheckDate) * Account.Rate),\n          Account.CheckDate = GETDATE()\n\nI know that I can wrap all the operations in a single transaction, but how can I ensure that the update is not miscalculated because of multiple users without using a single update operation like the SQL shown?\nYou can probably see that several operations like:\n1. Read entity\n2. Update values\n3. Save entity\n\nmight fail because of several users doing the same thing    \nI'm guessing there are several possible ways to achieve this and I'm looking for the one which would work best for this and future requirements.\n================== ANSWER ==================\nWhen I got to this point I realised that as long as I update the balance and the check date at the same time, all will be fine.\nConcurrent updates will not break anything :)\nBut I thought I'd post it anyway!\nI'm still happy to see better solutions though...", "output": "Transactions may be used to atomically execute a sequence of datastore operations."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Conditional compilation in Go\n\nQuestion:\nI'm trying to write a Go wrapper using CGo for ENet.\nWhen I tried to compile my wrapper on a Mac the library was older and had a slightly different interface.  99% of the code is the same just a few C calls need to change.\nWhat is the best practice for dealing with a problem like this in Go?\nIs there some way to do conditional compilation or conditional imports?", "output": "Go does not have conditional compilation or conditional imports. Handle the type differences in C code.\nAre the [Go] authors opposed to preprocessing?"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can you explain Go Interfaces?\n\nQuestion:\nI dont get the whole types + Interfaces model(that replaces classes in other languages). If theres a simple way you could explain what they are about, it will be really appreciated.", "output": "Go interfaces are statically checked duck typing.\nThe difference between pure virtual classes in C++ or interfaces in java is that you don't declare the interface on the class that implements the interface, but on the method that receives the interface.\nFor example, I can create an interface with a Read and a Write method and call it ThingsDustinReadsAndWrites and have a function called doReadsAndWrites(rr ThingsDustinReadsAndWrites.  That can, in turn, receive a built-in http.ClientConn which has never heard of my interface, but implements it because it happens to have those methods."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Doesn't \"go get\" just fetch files and then cgo+\"go build\" them? Apparently not\n\nQuestion:\nI have a problem building a fairly simple local CGO project. Consider this very small CGO package of just 3 files (glut.go, support.c and support.h file) -- if I just go get it, these files are downloaded to\nC:\\Go\\src\\pkg\\github.com\\zombiezen\\Go-GLUT\\glut\n\nthen some secret magic happens and go get builds the following output file:\nC:\\Go\\pkg\\windows_amd64\\github.com\\zombiezen\\Go-GLUT\\glut.a\n\nHowever, if I copy the three source files to \\mytmp, cd into \\mytmp and go build -o glut.a glut.go, I get some 40-60 error messages like this one:\nC:\\Users\\roxor\\AppData\\Local\\Temp\\go-build191975110\\command-line-arguments\\_obj\\glut.cgo2.o: In function `_cgo_b46885fb7c57_Cfunc_goCreateMenu':\n./glut.go:195: undefined reference to `goCreateMenu'\n\nIf I run go get with the -x command-line argument, I can see that support.c is picked up during the build process and given to gcc:\ngcc -I . -g -O2 -m64 -mthreads -I $WORK\\github.com\\zombiezen\\Go-GLUT\\glut\\_obj\\ -o $WORK\\github.com\\zombiezen\\Go-GLUT\\glut\\_obj\\support.o -c .\\support.c\n\nHowever, with go build -x, this is not the case, support.c is skipped. Why? How do I call go build to work exactly like go get does?", "output": "Just doing go build instead of go build somefile.go does it. So obvious now …"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does Go provide REPL?\n\nQuestion:\nThe interactive environment is VERY helpful for a programmer. However, it seems Go does not provide it.  Is my understanding correct?", "output": "No, Go does not provide a REPL(read–eval–print loop).\nHowever, as already mentioned, Go Playground is very handy. The Go Authors are also thinking about adding a feature-rich editor to it.\nIf you want something local, consider installing hsandbox. Running it simply with hsandbox go will split your terminal screen (with screen) where you can write code at the top and see its execution output at the bottom on every save.\nThere was a gotry among standard Go commands, which used to evaluate expressions (with an optional package name), and could be run like gotry 1+2 and gotry fmt 'Println(\"hello\")' from shell. It is no longer available because not many people actually used it.\nI have also seen third party projects for building a REPL for Go, but now I can only find links to two of them: igo and go-repl. How well do they work I don't know.\nMy two cents: Speed of compilation makes writing a REPL possible for Go, as it has also helped building the tools mentioned here, but the same speed makes REPL less necessary. Every time I want to test something in Go that I can't run in Playground I open a simple .go file and start coding and simply run the code. This will be even easier when the go command in Go 1 makes one-command build process possible and way easier.\nUPDATE: Latest weekly release of Go added go command which can be used to very easily build a file: write your prog.go file and run go build prog.go && ./prog\nUPDATE 2: With Go 1 you can directly run go programs with go run filename.go\nUPDATE 3: gore is a new project which seems interesting."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Easy way to get the keys in a map in alphabetical order\n\nQuestion:\nIn Go, what's the easiest way to get the keys in a map sorted alphabetically? This is the shortest way I can do it:\npackage main\n\nimport \"container/vector\"\nimport \"fmt\"\nimport \"sort\"\n\nfunc main() {\n    m := map[string]string {\"b\":\"15\", \"z\":\"123123\", \"x\":\"sdf\", \"a\":\"12\"}\n    var keys vector.StringVector;\n    for k,_ := range ( m ) {\n            keys.Push(k)\n    }\n    sort.Sort( &keys )\n    fmt.Printf(\"%v\\n\", keys)\n}", "output": "You are sorting an array of strings using StringVector. To minimize overhead, you could sort an array of strings.\npackage main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\nfunc main() {\n    m := map[string]string{\"b\": \"15\", \"z\": \"123123\", \"x\": \"sdf\", \"a\": \"12\"}\n    mk := make([]string, len(m))\n    i := 0\n    for k, _ := range m {\n        mk[i] = k\n        i++\n    }\n    sort.Strings(mk)\n    fmt.Println(mk)\n}\n\nOutput:\n[a b x z]"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Unexpected EOF when sending POST request\n\nQuestion:\nI'm having some trouble sending a simple POST request with the http package:\nvar http_client http.Client\n\nreq, err := http.NewRequest(\"POST\", \"http://login.blah\", nil)\nif err != nil {\n  return errors.New(\"Error creating login request: \" + err.Error())\n}\nreq.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\nbody := fmt.Sprintf(\"?username=%s&password=%s&version=%d\", client.Username, client.Password, launcherVersion)\nfmt.Println(\"Body:\", body)\nreq.Body = ioutil.NopCloser(bytes.NewBufferString(body))\nreq.ParseForm()\nresp, err := http_client.Do(req)\n\nif err != nil {\n  return errors.New(\"Error sending login request: \" + err.Error())\n}\n\nI see the correct body from the print:\nBody: ?username=test&password=test&version=13\n\nBut after 60 seconds, I get:\nError sending login request: unexpected EOF\n\nI'm sure it has something to do with how I set the request body, because watching it with Wireshark shows me the request, which goes out right away, has a Content-Length of 0 with no body.\nPOST / HTTP/1.1\nHost: login.blah\nUser-Agent: Go http package\nContent-Length: 0\nContent-Type: application/x-www-form-urlencoded\nAccept-Encoding: gzip", "output": "Your body string looks like the end of an URL, just like it would be if you were sending your parameter in a GET request.\nThe server probably expects the body of your POST request to be in multipart/form-data format  as defined in http://www.w3.org/TR/html401/interact/forms.html#form-data-set\nI think you should either \n\nuse a multipart.Writer to build your body.\nuse PostForm as in the package example :\nresp, err := http.PostForm(\"http://example.com/form\",\n    url.Values{\"key\": {\"Value\"}, \"id\": {\"123\"}})"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE Golang - HTTP JSON RPC call works in the dev_appserver, but not on the App Engine?\n\nQuestion:\nI'm creating a Go Google App Engine application that will be making HTTP JSON RPC calls to a Bitcoin server. I got my code to work properly on the dev_appserver, but when deployed on GAE, the code seems to not work. I'm using a library available on GitHub, and call it like this:\nfunc GetInfo(id interface{})(map[string]interface{}, os.Error){\n    resp, err:=httpjsonrpc.Call(\"user:pass@111.1.1.1:18332\", \"getinfo\", id, nil)\n    if err!=nil{\n        log.Println(err)\n        return resp, err\n    }\n    return resp, err\n}\n\nWhich when called should give:\nmap[proxy: keypoololdest:1.327368259e+09 blocks:45385 keypoolsize:101 connections:11 version:50200 difficulty:8.88353262 generate:false hashespersec:0 paytxfee:0 balance:0 genproclimit:-1 testnet:true errors:]\n\nBut on GAE calling the function seems to be causing an error. What part of the code could be working on dev_appserver, but fail on GAE?", "output": "You should make you are using urlfetch.Transport to make HTTP calls in production as described in urlfetch documentation.\nInstead of doing:\nresp, err := http.Post(address,\n    \"application/json\", strings.NewReader(string(data)))\n\nYou should be doing:\nclient := urlfetch.Client(context)\nresp, error := client.Post(address,\n    \"application/json\", strings.NewReader(string(data)))\n\nAs you can see in the implementation, urlfetch.Client is just a shortcut to construct an http.Client that uses urlfetch.Transport."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Trying to write input from keyboard into a file in Golang\n\nQuestion:\nI am trying to take input from the keyboard and then store it in a text file but I am a bit confused on how to actually do it. \nMy current code is as follow at the moment:\n// reads the file txt.txt \nbs, err := ioutil.ReadFile(\"text.txt\")\nif err != nil {\n      panic(err)\n}\n\n// Prints out content\ntextInFile := string(bs)\nfmt.Println(textInFile)\n\n// Standard input from keyboard\nvar userInput string\nfmt.Scanln(&userInput)\n\n//Now I want to write input back to file text.txt\n//func WriteFile(filename string, data []byte, perm os.FileMode) error\n\ninputData := make([]byte, len(userInput))\n\nerr := ioutil.WriteFile(\"text.txt\", inputData, )\n\nThere are so many functions in the \"os\" and \"io\" packages. I am very confused about which one I actually should use for this purpose.\nI am also confused about what the third argument in the WriteFile function should be. In the documentation is says of type \" perm os.FileMode\" but since I am new to programming and Go I am a bit clueless.\nDoes anybody have any tips on how to proced?\nThanks in advance,\nMarie", "output": "// reads the file txt.txt \nbs, err := ioutil.ReadFile(\"text.txt\")\nif err != nil { //may want logic to create the file if it doesn't exist\n      panic(err)\n}\n\nvar userInput []string\n\nvar err error = nil\nvar n int\n//read in multiple lines from user input\n//until user enters the EOF char\nfor ln := \"\"; err == nil; n, err = fmt.Scanln(ln) {\n    if n > 0 {  //we actually read something into the string\n        userInput = append(userInput, ln)\n    } //if we didn't read anything, err is probably set\n}\n\n//open the file to append to it\n//0666 corresponds to unix perms rw-rw-rw-,\n//which means anyone can read or write it\nout, err := os.OpenFile(\"text.txt\", os.O_APPEND, 0666)\ndefer out.Close() //we'll close this file as we leave scope, no matter what\n\nif err != nil { //assuming the file didn't somehow break\n    //write each of the user input lines followed by a newline\n    for _, outLn := range userInput {\n        io.WriteString(out, outLn+\"\\n\")\n    }\n}\n\nI've made sure this compiles and runs on play.golang.org, but I'm not at my dev machine, so I can't verify that it's interacting with Stdin and the file entirely correctly. This should get you started though."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is \"net/http\"'s use of global variables considered a good practice in golang?\n\nQuestion:\nThe golang package \"net/http\" uses the global variable DefaultServeMux to register handlers. Is this considered a good practice or even an golang idiom? Is it a global variable after all?\nThe two main reasons not to use global variables are AFAIK 1) that they add to complexity and 2) are problematic in concurrent programs.\nMaybe 1) is not considered important in this case because the developer can choose not to use DefaultServerMux? What about 2)? Are global variables always thread/goroutine safe in Go? Still, I'm surprised that it's used in Go's standard library. I've never seen such practice in other languages / standard libraries.", "output": "Is it a global variable after all?\n\nYes. The variable is defined on root level, which makes it global throughout the package.\nHowever, this is not a global variable which stores all the sensible information\nof the net/http package. It is merely a convenience setup which uses the content of\nthe net/http package to provide an quickstart opportunity to the user.\nThis also means, that is does not add much complexity.\n\nIs this considered a good practice or even an golang idiom?\n\nIMO, it is good practice to aid the user with the usage of a package.\nIf you're finding that you could save the user some time by providing a \ngood default configuration, do so.\nHowever, you should be careful when you're about to export variables. \nThey should be made ready for concurrent access. \nThe DefaultServeMux (or better, the underlying ServeMux), for example, is using a mutex to be thread safe.\n\nAre global variables always thread/goroutine safe in Go?\n\nNo. Without proper synchronization (mutex, channel, ...), everything that is accessed concurrently is problematic and will most certainly blow everything to bits and pieces.\n\nI've never seen such practice in other languages / standard libraries.\n\nPython's logging module, for example, provides a function to retrieve the root logging object, which one can call methods on to customize the logging behaviour. This could be seen as a global object, as it is mutable and defined in the module."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Get the current process (executable) name in Go?\n\nQuestion:\nWhat I am looking for here is the equivalent of C's argv[0]. \nThe flag package only gives access to command line arguments, but not the executable name. \nWhile one can get the process with Getpid(), I haven't found something that will give me access to the whole command line. The syscall  command GetCommandLine() seems only to be available on Windows.", "output": "The traditional argv[0] in C is available in os.Args[0] in Go.  The flags package simply processes the slice os.Args[1:]"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Showing custom 404 error page with standard http package\n\nQuestion:\nAssuming that we have:\nhttp.HandleFunc(\"/smth\", smthPage)\nhttp.HandleFunc(\"/\", homePage)\n\nUser sees a plain \"404 page not found\" when they try a wrong URL. How can I return a custom page for that case?\nUpdate concerning gorilla/mux\nAccepted answer is ok for those using pure net/http package.\nIf you use gorilla/mux you should use something like this:\nfunc main() {\n    r := mux.NewRouter()\n    r.NotFoundHandler = http.HandlerFunc(notFound)\n}\n\nAnd implement func notFound(w http.ResponseWriter, r *http.Request) as you want.", "output": "I usually do this:\npackage main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", homeHandler)\n    http.HandleFunc(\"/smth/\", smthHandler)\n    http.ListenAndServe(\":12345\", nil)\n}\n\nfunc homeHandler(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != \"/\" {\n        errorHandler(w, r, http.StatusNotFound)\n        return\n    }\n    fmt.Fprint(w, \"welcome home\")\n}\n\nfunc smthHandler(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != \"/smth/\" {\n        errorHandler(w, r, http.StatusNotFound)\n        return\n    }\n    fmt.Fprint(w, \"welcome smth\")\n}\n\nfunc errorHandler(w http.ResponseWriter, r *http.Request, status int) {\n    w.WriteHeader(status)\n    if status == http.StatusNotFound {\n        fmt.Fprint(w, \"custom 404\")\n    }\n}\n\nHere I've simplified the code to only show custom 404, but I actually do more with this setup: I handle all the HTTP errors with errorHandler, in which I log useful information and send email to myself."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Max number of goroutines\n\nQuestion:\nHow many goroutines can I use painless? For example wikipedia says, in Erlang 20 million processes can be created without degrading performance.\nUpdate: I've just investigated in goroutines performance a little and got such a results:\n\nIt looks like goroutine lifetime is more then calculating sqrt() 1000 times ( ~45µs for me ), the only limitation is memory\nGoroutine costs 4 — 4.5 KB", "output": "If a goroutine is blocked, there is no cost involved other than:\n\nmemory usage\nslower garbage-collection\n\nThe costs (in terms of memory and average time to actually start executing a goroutine) are:\nGo 1.6.2 (April 2016)\n  32-bit x86 CPU (A10-7850K 4GHz)\n    | Number of goroutines: 100000\n    | Per goroutine:\n    |   Memory: 4536.84 bytes\n    |   Time:   1.634248 µs\n  64-bit x86 CPU (A10-7850K 4GHz)\n    | Number of goroutines: 100000\n    | Per goroutine:\n    |   Memory: 4707.92 bytes\n    |   Time:   1.842097 µs\n\nGo release.r60.3 (December 2011)\n  32-bit x86 CPU (1.6 GHz)\n    | Number of goroutines: 100000\n    | Per goroutine:\n    |   Memory: 4243.45 bytes\n    |   Time:   5.815950 µs\n\nOn a machine with 4 GB of memory installed, this limits the maximum number of goroutines to slightly less than 1 million.\n\nSource code (no need to read this if you already understand the numbers printed above):\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n    \"runtime\"\n    \"time\"\n)\n\nvar n = flag.Int(\"n\", 1e5, \"Number of goroutines to create\")\n\nvar ch = make(chan byte)\nvar counter = 0\n\nfunc f() {\n    counter++\n    <-ch // Block this goroutine\n}\n\nfunc main() {\n    flag.Parse()\n    if *n <= 0 {\n            fmt.Fprintf(os.Stderr, \"invalid number of goroutines\")\n            os.Exit(1)\n    }\n\n    // Limit the number of spare OS threads to just 1\n    runtime.GOMAXPROCS(1)\n\n    // Make a copy of MemStats\n    var m0 runtime.MemStats\n    runtime.ReadMemStats(&m0)\n\n    t0 := time.Now().UnixNano()\n    for i := 0; i < *n; i++ {\n            go f()\n    }\n    runtime.Gosched()\n    t1 := time.Now().UnixNano()\n    runtime.GC()\n\n    // Make a copy of MemStats\n    var m1 runtime.MemStats\n    runtime.ReadMemStats(&m1)\n\n    if counter != *n {\n            fmt.Fprintf(os.Stderr, \"failed to begin execution of all goroutines\")\n            os.Exit(1)\n    }\n\n    fmt.Printf(\"Number of goroutines: %d\\n\", *n)\n    fmt.Printf(\"Per goroutine:\\n\")\n    fmt.Printf(\"  Memory: %.2f bytes\\n\", float64(m1.Sys-m0.Sys)/float64(*n))\n    fmt.Printf(\"  Time:   %f µs\\n\", float64(t1-t0)/float64(*n)/1e3)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Function implementing interface\n\nQuestion:\nI want to know what is happening here.\nThere is the interface for a http handler:\ntype Handler interface {\n    ServeHTTP(*Conn, *Request)\n}\n\nThis implementation I think I understand.\ntype Counter int\n\nfunc (ctr *Counter) ServeHTTP(c *http.Conn, req *http.Request) {\n    fmt.Fprintf(c, \"counter = %d\\n\", ctr);\n    ctr++;\n}\n\nFrom my understanding it is that the type \"Counter\" implements the interface since it has a method that has the required signature. So far so good. Then this example is given:\nfunc notFound(c *Conn, req *Request) {\n    c.SetHeader(\"Content-Type\", \"text/plain;\", \"charset=utf-8\");\n    c.WriteHeader(StatusNotFound);\n    c.WriteString(\"404 page not found\\n\");\n}\n\n// Now we define a type to implement ServeHTTP:\ntype HandlerFunc func(*Conn, *Request)\nfunc (f HandlerFunc) ServeHTTP(c *Conn, req *Request) {\n    f(c, req) // the receiver's a func; call it\n}\n// Convert function to attach method, implement the interface:\nvar Handle404 = HandlerFunc(notFound);\n\nCan somebody elaborate on why or how these various functions fit together?", "output": "This:\ntype Handler interface {\n    ServeHTTP(*Conn, *Request)\n}\n\nsays that any type which satisfies the Handler interface must have a ServeHTTP method. The above would be inside the package http.\ntype Counter int\n\nfunc (ctr *Counter) ServeHTTP(c *http.Conn, req *http.Request) {\n    fmt.Fprintf(c, \"counter = %d\\n\", ctr);\n    ctr++;\n}\n\nThis puts a method on the Counter type which corresponds to ServeHTTP. This is an example which is separate from the following.\n\nFrom my understanding it is that the\n  type \"Counter\" implements the\n  interface since it has a method that\n  has the required signature.\n\nThat's right.\nThe following function by itself won't work as a Handler:\nfunc notFound(c *Conn, req *Request) {\n    c.SetHeader(\"Content-Type\", \"text/plain;\", \"charset=utf-8\");\n    c.WriteHeader(StatusNotFound);\n    c.WriteString(\"404 page not found\\n\");\n}\n\nThe rest of this stuff is just fitting the above so that it can be a Handler.\nIn the following, a HandlerFunc is a function which takes two arguments, pointer to Conn and pointer to Request, and returns nothing. In other words, any function which takes these arguments and returns nothing can be a HandlerFunc.\n// Now we define a type to implement ServeHTTP:\ntype HandlerFunc func(*Conn, *Request)\n\nHere ServeHTTP is a method added to the type HandlerFunc:\nfunc (f HandlerFunc) ServeHTTP(c *Conn, req *Request) {\n    f(c, req) // the receiver's a func; call it\n}\n\nAll it does is to call the function itself (f) with the arguments given.\n// Convert function to attach method, implement the interface:\nvar Handle404 = HandlerFunc(notFound);\n\nIn the above line, notFound has been finagled into being acceptable for the interface for Handler by artificially creating a type instance out of the function itself and making the function into the ServeHTTP method for the instance. Now Handle404 can be used with the Handler interface. It's basically a kind of trick."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why does go have := short assignments inside functions?\n\nQuestion:\nI don't quite understand the specific purpose of short assignments,\nwhy do this:\nx:= 10\n\nwhen this is also possible:\nvar x = 10\n\nIs there any specific use case where short assignments are more convenient\nThanks", "output": "if x, err := fn(); err != nil {\n    // do something\n}\n\nIn the above case, the variables are confined within the if statement. If you try to access err outside of the if statement, it won't be available. Likewise for x. There's various cases where maintaining scope like this might be useful, but I'd say the use of := is for given styles like the above with if, switch, for.\nFor some additional background, var also allows grouping, much like using import.\nvar (\n    y = 1\n    z = 2\n)\n\nwhich pushes the use-cases for var vs := further apart."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to use Go language with NetBeans IDE?\n\nQuestion:\nHow to setup Go language in NetBeans IDE?. \n(Like i am already using Python, C/C++, Java, Php, BASH already in one NetBeans IDE).", "output": "Although I've never used it, there appears to only be one Go plugin for NetBeans. Their official website says that it provides syntax highlighting and templates for Go. I'm not sure if it's everything you're looking for, but it appears to be the only option at this point in time."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to write modular (plug-in) applications with Go?\n\nQuestion:\nI understand that the Go programming language doesn't really support dynamic linking.  This makes me wonder, what would somebody do if they wanted to write an application that supported third party (or otherwise contributed) plug-ins?  \nIt seems the typical response is that Go compiles quickly, so just recompile, but I don't find this all that practical for system administrators.  The Apache web server for example, has an amazing number of modules that can be configured to be loaded (or not loaded) very easily.\nIs the only option left to use sockets or other IPC for plugins?", "output": "What I would do, is, set up an API through, say, channel over pipe. And tell the plugin author to issue an exe that communicate over this pipe.\nThis is similar to how Chrome works today.\nThis is a way to achieve that over netchan.\nNote: the netchan pacakage is deprecated, but the idea is to use RPC over unix pipes."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the Go equivalent of Python's \"is\" operator?\n\nQuestion:\nHow do I determine whether 2 variables refer to the same instance in Go? More specifically, that a mutation to the value of one variable would effect the value of the other variable also.\nTo further refine the question: How would I determine when 2 variables would satisfy the \"is\" operator per CPython:\na is b", "output": "In Python, all values are references (i.e. pointers) to objects. You can never get an object itself as a value. The is operator compares two values, which are pointers, for pointer equality; whereas the == operator compares two such pointers, for equality of the objects pointed to.\nIn Go, it's a little more complicated. Go has pointers, as well as other non-pointer types (boolean, number types, strings, arrays, slices, structs, functions, interfaces, maps, channels). It doesn't make sense to ask for pointer equality for non-pointer types. (What would it mean? What would it accomplish?)\nSo to have the equivalent situation as Python, let's put all of our values behind pointers, and so all variables are pointers. (There is a convention in many Go libraries of a \"New\" function that creates a pointer type; and the methods also operate on the pointer type; so this is compatible with that convention.) Then (if a and b are pointers) a == b in Go would compare two such pointers for pointer equality; and you can use *a == *b to compare the underlying values, if they are comparable.\nGo also has several non-pointer reference types: slices, maps, functions, and channels. Channels are comparable using == for whether they are the same channel. However, slices, maps, and functions cannot be compared; it may be possible using reflection though."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Access to another struct by value or by pointer\n\nQuestion:\nWhat difference there is when you access to another struct by value or by a pointer?\nWhen should be used each one of them?\ntype foo_ struct {\n    st uint8\n    nd uint8\n}\n\ntype bar struct {\n    rd  uint8\n    foo foo_\n}\n\ntype barP struct {\n    rd  uint8\n    foo *foo_\n}", "output": "If you declare or allocate a variable of type bar, you reserve and initialize to zero memory for both rd uint8 and foo foo_. There is always one variable of type foo_ embedded in a variable of type bar.\nvar b bar  // declare b\n\nIf you declare or allocate a variable of type barP, you reserve and initialize to zero memory for both rd uint8 and foo *foo_. A zero value pointer is a nil pointer. No variable of type foo_ is allocated; you must do that separately. There is either zero (foo == nil) or one variable of type foo_ pointed to by a variable of type barP. A variable of type barP may point to the same variable of type foo_ as other variables of type barP, sharing the same copy of the variable of type foo_. A change to a shared copy is seen by all variables that point to it. \nvar bp barP         // declare bp\nbp.foo = new(foo_)  // allocate bp.foo\n\nWhich one to use depends on the properties of type bar versus type barP. Which type more closely reflects the problem that you are trying to solve?\nFor example, consider this invoice problem. We always have a billing address; we are always going to ask for our money. However, we often ship to the billing address, but not always. If the shipping address is nil, use the billing address. Otherwise, use a separate shipping address. We have two warehouses, and we always ship from one or the other. We can share the two warehouse locations. Since we don't send an invoice until the order is shipped from the warehouse, the warehouse location will never be nil.\ntype address struct {\n    street string\n    city   string\n}\n\ntype warehouse struct {\n    address string\n}\n\ntype invoice struct {\n    name      string\n    billing   address\n    shipping  *address\n    warehouse *warehouse\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: In Go, how do I capture stdout of a function into a string?\n\nQuestion:\nIn Python, for example, I can do the following:\nrealout = sys.stdout\nsys.stdout = StringIO.StringIO()\nsome_function() # prints to stdout get captured in the StringIO object\nresult = sys.stdout.getvalue()\nsys.stdout = realout\n\nCan you do this in Go?", "output": "I agree you should use the fmt.Fprint functions if you can manage it. However, if you don't control the code whose output you're capturing, you may not have that option.\nMostafa's answer works, but if you want to do it without a temporary file you can use os.Pipe. Here's an example that's equivalent to Mostafa's with some code inspired by Go's testing package.\npackage main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nfunc print() {\n    fmt.Println(\"output\")\n}\n\nfunc main() {\n    old := os.Stdout // keep backup of the real stdout\n    r, w, _ := os.Pipe()\n    os.Stdout = w\n\n    print()\n\n    outC := make(chan string)\n    // copy the output in a separate goroutine so printing can't block indefinitely\n    go func() {\n        var buf bytes.Buffer\n        io.Copy(&buf, r)\n        outC <- buf.String()\n    }()\n\n    // back to normal state\n    w.Close()\n    os.Stdout = old // restoring the real stdout\n    out := <-outC\n\n    // reading our temp stdout\n    fmt.Println(\"previous output:\")\n    fmt.Print(out)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why are request.URL.Host and Scheme blank in the development server?\n\nQuestion:\nI'm very new to Go. Tried this first hello, world from the documentation, and wanted to read the Host and Scheme from the request:\npackage hello\n\nimport (\n    \"fmt\"\n    \"http\"\n)\n\nfunc init() {\n    http.HandleFunc(\"/\", handler)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Host: \" + r.URL.Host + \" Scheme: \" + r.URL.Scheme)\n}\n\nBut their values are both blank. Why?", "output": "Basically, since you're accessing the HTTP server not from an HTTP proxy, a browser can issue a relative HTTP request, like so:\nGET / HTTP/1.1\nHost: localhost:8080\n\n(Given that, of course, the server is listening on localhost port 8080).\nNow, if you were accessing said server using a proxy, the proxy may use an absolute URL:\nGET http://localhost:8080/ HTTP/1.1\nHost: localhost:8080\n\nIn both cases, what you get from Go's http.Request.URL is the raw URL (as parsed by the library). In the case you're getting, you're accessing the URL from a relative path, hence the lack of a Host or Scheme in the URL object.\nIf you do want to get the HTTP host, you may want to access the Host attribute of the http.Request struct. See http://golang.org/pkg/http/#Request\nYou can validate that by using netcat and an appropriately formatted HTTP request (you can copy the above blocks, make sure there's a trailing blank line after in your file). To try it out:\ncat my-http-request-file | nc localhost 8080\n\nAdditionally, you could check in the server/handler whether you get a relative or absolute URL in the request by calling the IsAbs() method:\nisAbsoluteURL := r.URL.IsAbs()"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google App Engine Go HTTP request to a slow page\n\nQuestion:\nI want to make a HTTP request using Google App Engine in Go to a slow-responding website. My code is:\nfunc request(w http.ResponseWriter, r *http.Request) {\n    c:=appengine.NewContext(r)\n    client := urlfetch.Client(c)\n    resp, err := client.Get(\"http://www.example.com\")\n    if err != nil {\n        log.Print(\"err %s\", err.String())\n        return\n    }\n    ...}\n\nAfter calling my website, I get such an error:\nAPI error 1 (urlfetch: INVALID_URL): ApplicationError: 5 timed out\n\nAfter looking a bi into it, I found some reference to Transport class that allows to wait for HTTP requests for up to 60 seconds, but I can't find any description or example on how to make that work.\nHow can I make a HTTP request in GAE Go that will have a deadline longer than 5 seconds?", "output": "I would recommend if possible, doing the urlfetch outside of your main request handler using Tasks Queue API.\nWhen constructing urlfetch.Transport, you should be able to override the default deadline like this:\nt := urlfetch.Transport{Context:c, DeadlineSeconds: 5.0}\nclient := http.Client{Transport: &t}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a function in Go to print all the current member names and values of an object?\n\nQuestion:\nI'm looking for something like PHP's print_r or python's dict. Anybody know if this function exists, or its something that needs to be implemented?", "output": "There is a reflect package in go.\nYou can find solution to your problem in the following article."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to efficiently concatenate strings in go\n\nQuestion:\nIn Go, a string is a primitive type, which means it is read-only, and every manipulation of it will create a new string.\nSo if I want to concatenate strings many times without knowing the length of the resulting string, what's the best way to do it?\nThe naive way would be:\nvar s string\nfor i := 0; i < 1000; i++ {\n    s += getShortStringFromSomewhere()\n}\nreturn s\n\nbut that does not seem very efficient.", "output": "New Way:\nFrom Go 1.10 there is a strings.Builder type, please take a look at this answer for more detail.\nOld Way:\nUse the bytes package. It has a Buffer type which implements io.Writer. \npackage main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n)\n\nfunc main() {\n    var buffer bytes.Buffer\n\n    for i := 0; i < 1000; i++ {\n        buffer.WriteString(\"a\")\n    }\n\n    fmt.Println(buffer.String())\n}\n\nThis does it in O(n) time."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: goroutines run out of memory UPD: go error handling\n\nQuestion:\nUPD: Turns out, it is a question about error handling in Go\nI have written a simple web crawler, that generates the addresses of web-pages on the \"main thread\", fetches the actual pages in one go-routine and gives the content back via a chan, and writes it to a file in another go-routine. However, after about 300,000 iterations of this process, i get the following error:\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x38 pc=0x22e9]</pre>\n\nThe error \"stacktrace\" is quite long, and unfotunately, I don't have it now (I will post it later, after repeating the experiment).\nIs there a need to somehow manage the memory, close the channels or something like that?\nBelow is the code with some omissions. \npackage main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"strconv\"\n)\n\nfunc main() {\n    channel := make(chan []byte)\n\n    for i:=0; i < 20; i++ {\n        go fetcher(generateLink(), channel)\n    }\n\n    for a:=0; ; a++ {\n        go writeToFile(strconv.Itoa(a), <-channel)\n        go fetcher(generateLink(), channel)\n        fmt.Println(strconv.Itoa(a))\n    }\n}\n\nfunc fetcher(url string, channel chan []byte) {\n\n    resp, err := http.Get(url)\n    if err != nil {\n        channel <- []byte(\"\")\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    channel <- body\n}\n\nfunc writeToFile(filename string, bytes []byte) {\n    ioutil.WriteFile(filename+\".html\", bytes, 0644)\n}\n\nfunc generateLink() string {\n    ...\n}", "output": "panic: runtime error: invalid memory address or nil pointer deference\n\nThis means you tried to use a nil pointer. This is a programmer error, not an out of memory error. Since I don't have access to the actual trace or code, there is no way I can help you further.\n\nEdit: After taking another look at your code I think I found a possible source of the error.\nresp, err := http.Get(url)\nif err != nil {\n    channel <- []byte(\"\")\n}\ndefer resp.Body.Close()\n\nYou end up referencing resp in order to get the field Body even when err != nil. If err !=nil, it is quite likely resp is nil."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to run my Go code in Android?\n\nQuestion:\nHow can i run this Go code in my Android? (in Fedora 15 its working).\npackage main\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, 世界\")\n}", "output": "You have to compile it for ARM, and thankfully it is very easy with Go's compilers:\n$ 5g main.go && 5l main.5\n\nThe executive binary (5.out) will be runnable on Android. Just copy it there and run with shell. More info here."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to use LevelDB in go?\n\nQuestion:\nFrom http://code.google.com/p/leveldb/, it seems not explicit or easy to use LevelDB with Go.\nBut I really want to know how to use it in Go.\nCould anyone give me a clue?", "output": "Use leveldb-go, ported by the Go Authors."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Easy secure connection over unsafe network (both endpoints fully controlled)\n\nQuestion:\nI need to connect client & server over untrusted network. I've considered using TLS (crypto/tls), but from what I understand, I first need to create a create a crypto/x509.Certificate. But I feel overwhelmed by all the parameters I need to pass to the x509.CreateCertificate() function - it says it needs all of the following fields: \n\nSerialNumber, Subject, NotBefore, NotAfter, KeyUsage, BasicConstraintsValid, IsCA, MaxPathLen, SubjectKeyId, DNSNames, PermittedDNSDomainsCritical, PermittedDNSDomains. \n\nI have full control over both endpoints, so I believe I don't need any expiration or invalidation support/parameters (I can change keys both on client and server at any time I want) - so I can probably skip NotBefore and NotAfter (? or do I have to set them anyway?). What should I put in all the other fields, and why, to avoid any vulnerabilities? Also, can I use the same private/public key pair for both ways authentication (client to server, and server to client), or do I have to use 2 pairs?\nOr, is there something simpler than TLS that I could use? Note however, that I need to two way authentication.\nEDIT:\nI created a simple library based on suggestions from the accepted answer, plus key generation code from generate_cert.go - see: \n\ngithub.com/akavel/tunnel", "output": "Owlstead is partly correct. Your best bet is creating self signed certificates using OpenSSL. However, I would then use the Go TLS library for encryption. Below is some code that may help you.\nCreating an x509 key pair\nI normally follow the instructions here. Summary of commands (do for both client and server):\nopenssl genrsa -des3 -out server.key 1024\nopenssl req -new -key server.key -out server.csr\ncp server.key server.key.org\nopenssl rsa -in server.key.org -out server.key\nopenssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt\n\nUsing Go's TLS library\nFirst, create a tls.Config. One TLS config will work on both client and server but some of the options only need to be set on one or the other:\ncert, err := tls.LoadX509KeyPair(cert, key)\nconfig := &tls.Config{\n    Certificates: []Certificates{cert},\n    ClientAuth: tls.RequireAnyClientCert, // Must be done on server\n    InsecureSkipVerify: true, // Must be done on client\n}\n\nOn the server, you need to setup a TLS listener. This sets it up on port 4443:\nlistener, err := tls.Listen(\"tcp\", \":4443\", config)\nfor {\n    conn, err := listener.Accept()\n    acceptConn(conn) // your code\n}\n\nOn the client:\nconn, err := tls.Dial(\"tcp\", serverAddr, config)\n\nThis will create an encrypted connection, but it will not verify the other side is who they say they are. The easiest way to do that is to give each server the public key of the other server and compare it to the server that has just connected. To find the public key on the other server, you need to:\nc := conn.(*tls.Conn) // convert net.Conn from listener to tls conn\nerr := c.Handshake() // ensure handshake is completed without error\nstate := c.ConnectionState()\npubKey, err := x509.MarshalPKIXPublicKey(state.PeerCertificates[0])\nbytes.Equal(pubKey, knownKey) // compare to known value"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you Mmap() a file bigger than 2GB in Go?\n\nQuestion:\nThe syscall.Mmap() call takes a length argument of type int, which is only good for 2GB. How do I mmap a bigger file then? \nNote: 64-bit system, so address space is not a problem.", "output": "Look in http://golang.org/src/pkg/syscall/syscall_unix.go at the Mmap method on mmapper. You should be able to copy that code and adapt it as required.\nOf course you won't be able to mmap to a []byte, since slice lengths are defined to be \"int\" (which is 32-bit everywhere at the moment). You could mmap to a larger element type (e.g. []int32), or just muck with the pointer to the memory, but it won't be a drop-in replacement to syscall.Mmap."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: When to close a file?\n\nQuestion:\nIs necessary to close a file when you only want create it? I'm supposed that it's only necessary in case of reading or writing.\n_, err := os.OpenFile(name, os.O_CREATE, 0640)", "output": "Will it work? Yes. The file will be created.\nShould you do it? No. It is a bad idea in general even though you can get away with it sometimes.\nOpening a file allocates resources like a file handle to your process. You should close it to free those resources. Otherwise they will be unavailable until the process dies."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How difficult is it to compile the Go programming language?\n\nQuestion:\nBasically what the title says: what's the process for compiling your average go* file? drop it on a compiler and execute the result?\n\n*note: The OP edited the question replacing \"go\" with \"C\", before it was rolled back. So some of the answers won't make sense.", "output": "Did you take a look at the Go tutorial at http://golang.org/doc/go_tutorial.html\n\n    Here's how to compile and run our program. With 6g, say,\n\n        $ 6g helloworld.go  # compile; object goes into helloworld.6\n        $ 6l helloworld.6   # link; output goes into 6.out\n        $ 6.out\n        Hello, world; or Καλημέρα κόσμε; or こんにちは 世界\n        $\n\n    With gccgo it looks a little more traditional.\n\n        $ gccgo helloworld.go\n        $ a.out\n        Hello, world; or Καλημέρα κόσμε; or こんにちは 世界"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go, go get, go install, local packages, and version control\n\nQuestion:\nI am having trouble understanding the workflow for creating a go project that has local packages.\nSay I create a new project, using git for version control, which has a main.go file and a tools.go file which will be in package utils. So I have a directory structure such as this:\n/myproject/\n   main.go\n   utils/\n     tools.go\n\nmain.go looks like this:\npackage main\nimport \"./utils\"\nfunc main() {\n    utils.DoSomthing()\n}\n\nand tools.go looks like this:\npackage utils;\nfunc DoSomething() {\n}\n\nEverything works just fine locally, using go build and go run. But this is being hosted on github, and I'd like to be able to have others use the go get command to install it. So the local package import must be changed to use the format \"github.com/user/project/utils\", which works, except now I have two copies of the source code, and the real problem is that the copy with the git history has an import that makes use of the downloaded copy. So if I'm working on the copy with the git history, any changes made to tools.go will go unnoticed, because it will be using the downloaded copy.\nSo I'm wondering if someone can explain the right way of using go get, version control, and package imports within the same project.", "output": "I've just written a short step-by-step guide on how I am using the new go tool and github.com. You might find it useful:\n1. Setup your GOPATH\nYou can set the environment variable GOPATH to any directory you like. If you have larger projects, it's probably a good idea to create a different GOPATH for each of them. I would recommend this approach especially for the deployment, so that updating a library for project A doesn't break project B which might require an earlier version of the very same library.\nAlso note that you can set your GOPATH to a list of directories, delimited by colons. So you might have a GOPATH containing all commonly used packages, and separate GOPATHS for each project with additonal packages or different versions of existing packages.\nBut unless your are working on a lot of different Go projects simultaneously, its probably enough to have just a single GOPATH locally. So, let's create one:\nmkdir $HOME/gopath\n\nThen you need to set two environment variables to tell the go tool where it can find existing Go packages and where it should install new ones. It's probably best to add the following two lines to your ~/.bashrc or ~/.profile (and do not forget to reload your .bashrc afterwards).\nexport GOPATH=\"$HOME/gopath\"\nexport PATH=\"$GOPATH/bin:$PATH\"\n\n2. Create a new project\nIf you want to create a new Go project which should be hosted at github.com later, you should create this project under $GOPATH/src/github.com/myname/myproject. It's important that the path matches the URL of the github.com repo, because the go tool will follow the same convention. So, let's create the project root and initialize a new git repository there:\nmkdir -p $GOPATH/src/github.com/myname/myproject\ncd $GOPATH/src/github.com/myname/myproject\ngit init\n\nBecause I do not like to type such long paths, I normally create symbolic links for the projects I am currently working on in my home folder:\nln -s $GOPATH/src/github.com/myname/myproject ~/myproject\n\n3. Write your application\nStart coding and don't forget to git add and git commit your files. Also, do not use relative imports like import \"./utils\" for sub-packages. They are currently undocumented and shouldn't be used at all, because they won't work with the go tool. Use imports like github.com/myname/myproject/utils instead.\n4. Publish your project\nCreate a new repository at github.com, upload your SSH public key if you haven't done that before and push your changes to the remote repository:\ngit remote add origin git@github.com:myname/myproject.git\ngit push origin master\n\n5. Continue working on your project\nIf you have set the GOPATH in your .bashrc and if you have created a symlink to your project in your home folder, you can just type cd myproject/ and edit some files there. Afterwards, you can commit the changes using git commit -a and send them to github.com by doing a git push."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go Tour Exercise #7: Binary Trees equivalence\n\nQuestion:\nI am trying to solve equivalent binary trees exercise on go tour. Here is what I did;\npackage main\n\nimport \"tour/tree\"\nimport \"fmt\"\n\n// Walk walks the tree t sending all values\n// from the tree to the channel ch.\nfunc Walk(t *tree.Tree, ch chan int) {\n    if t.Left != nil {\n        Walk(t.Left, ch)\n    }\n    ch <- t.Value\n    if t.Right != nil {\n        Walk(t.Right, ch)\n    }\n\n}\n\n// Same determines whether the trees\n// t1 and t2 contain the same values.\nfunc Same(t1, t2 *tree.Tree) bool {\n    ch1 := make(chan int)\n    ch2 := make(chan int)\n    go Walk(t1, ch1)\n    go Walk(t2, ch2)\n    for k := range ch1 {\n        select {\n        case g := <-ch2:\n            if k != g {\n                return false\n            }\n        default:\n            break\n        }\n    }\n    return true\n}\n\nfunc main() {\n    fmt.Println(Same(tree.New(1), tree.New(1)))\n    fmt.Println(Same(tree.New(1), tree.New(2)))\n}\n\nHowever, I couldn't find out how to signal if any no more elements left in trees. I can't use close(ch) on Walk() because it makes the channel close before all values are sent (because of recursion.) Can anyone lend me a hand here?", "output": "You could use close() if your Walk function doesn't recurse on itself. i.e.  Walk would just do:\nfunc Walk(t *tree.Tree, ch chan int) {\n    walkRecurse(t, ch)\n    close(ch)\n}\n\nWhere walkRecurse is more or less your current Walk function, but recursing on walkRecurse.\n(or you rewrite Walk to be iterative - which, granted, is more hassle)\nWith this approach, your Same() function have to learn that the channels was closed, which is done with the channel receive of the form\nk, ok1 := <-ch\ng, ok2 := <-ch\n\nAnd take proper action when ok1 and ok2 are different, or when they're both false\nAnother way, but probably not in the spirit of the exercise, is to count the number of nodes in the tree:\nfunc Same(t1, t2 *tree.Tree) bool {\n    countT1 := countTreeNodes(t1)\n    countT2 := countTreeNodes(t2)\n    if countT1 != countT2 {\n        return false\n    }\n    ch1 := make(chan int)\n    ch2 := make(chan int)\n    go Walk(t1, ch1)\n    go Walk(t2, ch2)\n    for i := 0; i < countT1; i++ {\n        if <-ch1 != <-ch2 {\n            return false\n        }\n    }\n    return true\n}\n\nYou'll have to implement the countTreeNodes() function, which should count the number of nodes in a *Tree"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Compile Go tip with extra packages\n\nQuestion:\nI'd like to try out the exp/regexp package. Currently Go tip's ./all.bash command compiles including only exp/regexp/syntax. I've been looking around the makefiles and I see it builds a Make.deps but couldn't figure out how it selects the packages that are included. What should I change to build Go with exp/regexp?", "output": "Duh, it was right in front of my eyes! Add the package dir to src/pkg/Makefile:\nDIRS=\\\n    archive/tar\\\n    archive/zip\\\n    asn1\\\n    ...\n    exp/regexp\\\n    ..."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to send an email with attachments in Go\n\nQuestion:\nI have found this library and have managed to send an attachment in an empty email but not to combine text and attachments. \nhttps://github.com/sloonz/go-mime-message \nHow can it be done?", "output": "I created gomail for this purpose. It supports attachments as well as multipart emails and encoding of non-ASCII characters. It is well documented and tested.\nHere is an example:\npackage main\n\nfunc main() {\n    m := gomail.NewMessage()\n    m.SetHeader(\"From\", \"alex@example.com\")\n    m.SetHeader(\"To\", \"bob@example.com\", \"cora@example.com\")\n    m.SetAddressHeader(\"Cc\", \"dan@example.com\", \"Dan\")\n    m.SetHeader(\"Subject\", \"Hello!\")\n    m.SetBody(\"text/html\", \"Hello <b>Bob</b> and <i>Cora</i>!\")\n    m.Attach(\"/home/Alex/lolcat.jpg\")\n\n    d := gomail.NewPlainDialer(\"smtp.example.com\", 587, \"user\", \"123456\")\n\n    // Send the email to Bob, Cora and Dan.\n    if err := d.DialAndSend(m); err != nil {\n        panic(err)\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: how to share variable between python and go language?\n\nQuestion:\ni need to know how share variable between two program,\nbasically the go program have to write a variable ,like a string, and the python program have to read this variable.\nPlease help me, thank you in advance.", "output": "use standard streams. use a simple printf type command to print the string to stdout.  then read it with a raw_input() in python.\nrun the two programs like so:\n./output | ./read.py"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the difference between panic and an assert?\n\nQuestion:\nGo doesn't provide assertions. They are undeniably convenient, but our experience has been that programmers use them as a crutch to avoid thinking about proper error handling and reporting.\n\nHowever it has print and println which does\n\npanic      like print, aborts execution after printing\n  panicln    like println, aborts execution after printing\n\nIsnt that the same thing as an assert? Why would they claim the above but have panic? i can see it leading to the same problems but adding an error msg to the end of it which can easily be abused. Am i missing something?", "output": "No, it's not. panic is like \"write then abort\", while an assert is like \"test and if it's false, write then abort\". There's no way they can keep you from doing an assert-like statement anyways."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go - System Time in pico-second\n\nQuestion:\nIs it possible in go to get system time in less than nano second means in pico-second or like that? Actually, I want to measure two consecutive events time gap which I can't catch in nano-second in our fast system.", "output": "The cost of calling profiling functions/instructions on modern hardware is larger (and mor espread and prone to deviance) than the interval you're going to measure. So even if you try, you'll get erroneous results.\nConsider tracking time lapse for 100 events, if that's at all possible."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Preferred declare / initialize method\n\nQuestion:\nI'm currently playing with Google Go.\nThere's a lot of ways to declare and/or initialize variables.\nCan someone explains pros/cons of each way (samples, as far as i know, below) :\n    var strArr0 *[10]string = new([10]string)\n\n    var strArr1 = new([10]string)\n\n    var strArr2 = make([]string,10)\n\n    var strArr3 [10]string\n\n    strArr4 := make([]string,10)\n\nWhat is your preferred syntax, and why ?\nThanks, SO folks !", "output": "I've numbered your examples 1-5, and I'll walk through them here. Hope this helps!\nvar strArr0 *[10]string = new([10]string)  // (1)\n\nThis allocates a new array of strings, of length 10, and returns a pointer to the array.\nvar strArr1 = new([10]string)  // (2)\n\nThis is exactly the same as 1. It's just shorthand, that works due to Go's type inference. It could be shortened further to:\nstrArr1 := new([10]string)  // (2a)\n\nWhere 1, 2, 2a all produce exactly the same result.\nvar strArr2 = make([]string,10)  // (3)\n\nThis makes a slice of strings, with length 10. A slice refers to some subset of an underlying array. From the golang spec:\n\nThe make() call allocates a new,\n  hidden array to which the returned\n  slice value refers.\n\nmake([]T, length, capacity)\n\n\nproduces the same slice as allocating an array and slicing it,\n   so these two examples result in the same slice:\n\nmake([]int, 50, 100)\nnew([100]int)[0:50]\n\n\n\nSo 3 is equivalent to any of the following:\nvar strArr2 = new([10]string)[0:10]  // Slicing an explicitly created array\nvar strArr2 []string = new([10]string)[0:10]  // Explicitly declaring the type of strArr2, rather than inferring\nstrArr2 := new([10]string)[0:10]  // Using the := shorthand instead of var\n\nnew or make are used depending on what type you're creating. make is used solely for slices, maps and channels. They used a different keyword to convey the idea that make is initializing some data structure under the hood, rather than just zeroing memory.\nThe next one is back to arrays rather than slices:\nvar strArr3 [10]string  // (4)\n\nThis is the same as 1, 2, and 2a.\nstrArr4 := make([]string,10)  // (5)\n\nSame as 3. := is just shorthand when initializing a variable and the type can be inferred.\n\nSo which to choose? This is up to your personal style a bit, but in general one choice is obviously going to maximise the clarity of your code e.g. using type inference when the type is obvious:\nfoo := bar.ToStringArray()\n\nor declaring the types when it's less so and the type will be useful to see:\nvar foo []string = bar.DoSomethingOpaque()\n\nOn slices versus arrays, you'll usually create whatever type is required for some function you're calling."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to copy array into part of another in Go?\n\nQuestion:\nI am new to Go, and would like to copy an array (slice) into part of another. For example, I have a largeArray [1000]byte or something and a smallArray [10]byte and I want the first 10 bytes of largeArray to be equal to the contents of smallArray. I have tried:\nlargeArray[0:10] = smallArray[:]\n\nBut that doesn't seem to work. Is there a built-in memcpy-like function, or will I just have to write one myself?\nThanks!", "output": "Use the copy built-in function.\npackage main\n\nfunc main() {\n    largeArray := make([]byte, 1000)\n    smallArray := make([]byte, 10)\n    copy(largeArray[0:10], smallArray[:])\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: \"method requires pointer receiver\" in Go Programming Language\n\nQuestion:\nI just saw a presentation of the Go programming language and thought I'd try to write a few lines. Everything worked fine until I tried to use an interface in this situation. How do I solve this?\npackage main\n\nimport \"fmt\"\n\ntype entity float32\n\nfunc (e *entity) inc() {\n    *e++\n}\n\ntype incer interface {\n    inc()\n}\n\nfunc doSomething(i incer) {\n    i.inc()\n}\n\nfunc main() {\n    fmt.Println(\"Hello, 世界\")\n\n    var e entity = 3\n    e.inc()\n    doSomething(e)\n    fmt.Println(e)\n}\n\nI get the compiler error:\nprog.go:24: cannot use e (type entity) as type incer in function argument:\nentity does not implement incer (inc method requires pointer receiver)\n\nI want to use a pointer so that the inc() will affect the enity outside the function. What is the syntax I should use?\n/Ricky", "output": "I think there is some confusion here. inc is a method of the type *entity, and not of the type entity (while you can call methods on values directly on pointers; you cannot generally call methods on pointers directly on values). What you may be confused about is why you could call e.inc(), instead of having to do (&e).inc(). This is a little-known special case documented at the bottom of the Calls section in the language specification, that says if x is addressable, and &x's method set contains m, then x.m() is shorthand for (&x).m(). This applies to this case because e is a variable, so it is addressable; but other expressions may not be addressable. I would recommend that you not use this shortcut, however, as it causes confusion; it makes you think that e conforms to the interface inter, while it does not."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What language use to write a gaming library, Go or Rust?\n\nQuestion:\nWhat language, between Go and Rust, would you use to create a library for games (no bindings)?\nGo is a simpler language that leans more heavily on garbage collection. Rust is a more complex language that can be safely used without the GC at all which is perfect for low-level systems programming.", "output": "I'm biased since I spent two summers working on Rust, but if you're willing to invest the necessary time to keep up with a rapidly changing language, Rust would be really good for games. It has a really nice set of built in concurrency primitives, so it would be easy to separate the different components such as the rendering engine, the AI, etc. and take advantage of multicore computers. It's also possible to avoid the need for garbage collection, so you don't have to worry about unpredictable GC pauses. It's designed to integrate nicely with existing C code, and many of the data types map directly onto C types. Rust's approach to polymorphism leads to some really nice assembly once LLVM is done with it.\nMany games nowadays are running in the web browser, which suggests that web browsers and games have similar requirements. Mozilla is designing Rust alongside its new parallel browser engine, which means the language will continue to evolve in ways that would work well for game programming too."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What's wrong with this usage of range?\n\nQuestion:\nI try to get a directory listing using this function:\npackage main;\nimport (\"fmt\"; \"os\"; \"io/ioutil\")\n\nfunc main() {\n    dir, _ := ioutil.ReadDir(\"..\")\n    var f os.FileInfo\n    for f = range dir {\n        fmt.Println(f.Name())\n    }\n}\n\nAccording to the documentation of ReadDir, it should return []os.FileInfo as the first return parameter. When I try to compile it, however, I get\ncannot assign type int to f (type os.FileInfo) in range: int does not implement os.FileInfo (missing IsDir method)\n\nWhat am I missing?", "output": "This should work:\nfor _, f = range dir {\n        fmt.Println(f.Name())\n    }\n\nYou ignore the index and only assign the dir entry.\nYou don't have to declare the var if you don't want. This would also work:\nfunc main() {\n    dir, _ := ioutil.ReadDir(\"..\")\n    for _, f := range dir {\n        fmt.Println(f.Name())\n    }\n}\n\nNote the ':=' after '_, f', instead of your 'f = '.\nThe issue doesn't comes from what ReadDir() returns, but comes from the range expression, which returns (index, value).\nFrom the Go Specs \"For Statements\":\nRange expression                          1st value          2nd value (if 2nd variable is present)\n\narray or slice  a  [n]E, *[n]E, or []E    index    i  int    a[i]       E"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to allocate 16GB of memory in Go?\n\nQuestion:\nI'm using the following simple Go code to allocate a 3D array of size 1024x1024x1024:\ngrid = make([][][]TColor, 1024)\nfor x = 0; x < 1024; x++ {\n    grid[x] = make([][]TColor, 1024)\n    for y = 0; y < 1024; y++ {\n        grid[x][y] = make([]TColor, 1024)\n    }\n}\n\nThat TColor struct is a 4-component float64 vector:\ntype TColor struct { R, G, B, A float64 }\n\nHalfway (x=477 and y=~600ish) through the allocation, the inner-most make() call panics with... runtime: out of memory: cannot allocate 65536-byte block (17179869184 in use)\nThis works fine with lower grid resolutions, ie 256³, 128³ etc. Now since the size of the struct is 4x4 bytes, that whole grid should require exactly 16 GB of memory. My machine (openSuse 12.1 64bit) has 32 GB of addressable physical (ie not-virtual) memory. Why can Go (weekly.2012-02-22) not allocate even half of this?", "output": "The struct has 4x8 bytes, not 4x4."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can't use packages in GoClipse\n\nQuestion:\nI started learning go.\nAfter my first try outs with the comand line, I installed Goclipse.\nWhen I creating a new Go Project in this Enviroment I get to following\nFile Structure:\n-bin\n-pgk\n   -windows_amd64\n- src\nFollowing this Example: http://code.google.com/p/goclipse/wiki/GettingStarted,\nI created first a Hello World Program, here I havn't any Problems.\nBut when I create under the pkg folder an new folder clock and at the\nfile ampm.go I get the following Error in the first line:\n\nMultiple markers at this line\n  - mkdir C:\\Windows\\go-build441906462: error 5 (FormatMessage failed with err=15100)\n  - 7 changed lines\n\nWhen I try to Import the clock package in my hello.go File, I get the\nerror, that he cant find the package clock.", "output": "You should try to manually compile things from the command line if you see errors in goclipse - I've noticed that sometimes it can't seem to recover from an error compiling a part of the program. You might also check the Go config in Eclipse if you've changed versions, since they moved files around. Cleaning the build and changing a file can force it to rebuild too.\nThe folder structure should be like this:\nproj\n--bin (for commands)\n----os_architecture \n--pkg (for compiled packages)\n----os_architecture \n--src\n----pkg\n------mypkgfolder\n----cmd\n\nYou can compile a package or command like: go build src/cmd/*.go"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reading image from HTTP request's body in Go\n\nQuestion:\nI'm playing with Go (first time ever) and I want to build a tool to retrieve images from Internet and cut them (even resize) but I'm stuck on the first step.\npackage main\n\nimport (\n  \"fmt\"\n  \"http\"\n)\n\nvar client = http.Client{}\n\nfunc cutterHandler(res http.ResponseWriter, req *http.Request) {\n  reqImg, err := client.Get(\"http://www.google.com/intl/en_com/images/srpr/logo3w.png\")\n  if err != nil {\n    fmt.Fprintf(res, \"Error %d\", err)\n    return\n  }\n  buffer := make([]byte, reqImg.ContentLength)\n  reqImg.Body.Read(buffer)\n  res.Header().Set(\"Content-Length\", fmt.Sprint(reqImg.ContentLength)) /* value: 7007 */\n  res.Header().Set(\"Content-Type\", reqImg.Header.Get(\"Content-Type\")) /* value: image/png */\n  res.Write(buffer)\n}\n\nfunc main() {\n  http.HandleFunc(\"/cut\", cutterHandler)\n  http.ListenAndServe(\":8080\", nil) /* TODO Configurable */\n}\n\nI'm able to request an image (let's use Google logo) and to get its kind and size.\nIndeed, I'm just re-writing the image (look at this as a toy \"proxy\"), setting Content-Length and Content-Type and writing the byte slice back but I get it wrong somewhere. See how it looks the final image rendered on Chromium 12.0.742.112 (90304):\n\nAlso I checked the downloaded file and it is a 7007 bytes PNG image. It should be working properly if we look at the request:\n\n\nGET /cut HTTP/1.1\n  User-Agent: curl/7.22.0 (i486-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.0e zlib/1.2.3.4 libidn/1.23 libssh2/1.2.8 librtmp/2.3\n  Host: 127.0.0.1:8080\n  Accept: /\nHTTP/1.1 200 OK\n  Content-Length: 7007\n  Content-Type: image/png\n  Date: Tue, 27 Dec 2011 19:51:53 GMT\n[PNG data]\n\nWhat do you think I'm doing wrong here?\nDisclaimer: I'm scratching my own itch, so probably I'm using the wrong tool :) Anyway, I can implement it on Ruby but before I would like to give Go a try.\nUpdate: still scratching itches but... I think this is going to be a good side-of-side project so I'm opening it https://github.com/imdario/go-lazor If it is not useful, at least somebody can find usefulness with the references used to develop it. They were for me.", "output": "I think you went too fast to the serve things part.\nFocus on the first step, downloading the image.\nHere you have a little program that downloads that image to memory.\nIt works on my 2011-12-22 weekly version, for r60.3 you just need to gofix the imports.\npackage main\n\nimport (\n    \"log\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nconst url = \"http://www.google.com/intl/en_com/images/srpr/logo3w.png\"\n\nfunc main() {\n    // Just a simple GET request to the image URL\n    // We get back a *Response, and an error\n    res, err := http.Get(url)\n\n    if err != nil {\n        log.Fatalf(\"http.Get -> %v\", err)\n    }\n\n    // We read all the bytes of the image\n    // Types: data []byte\n    data, err = ioutil.ReadAll(res.Body)\n\n    if err != nil {\n        log.Fatalf(\"ioutil.ReadAll -> %v\", err)\n    }\n\n    // You have to manually close the body, check docs\n    // This is required if you want to use things like\n    // Keep-Alive and other HTTP sorcery.\n    res.Body.Close()\n\n    // You can now save it to disk or whatever...\n    ioutil.WriteFile(\"google_logo.png\", data, 0666)\n\n    log.Println(\"I saved your image buddy!\")\n}\n\nVoilá!\nThis will get the image to memory inside data.\nOnce you have that, you can decode it, crop it and serve back to the browser.\nHope this helps."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Running Go tests in Eclipse\n\nQuestion:\nI have eclipse and goclipse installed, all is well, I can run a console app in the IDE.  It is possible to execute the unit tests in the IDE too?", "output": "The latest release of goclipse (0.7.6) does provide a means of doing testing using the \"testing\" package assuming you have followed the project structure recommended in C:/Go/doc/code.html in the installed file structure created when installing Go.\nUsing the Eclipse \"run external tools\" button create a new external tool configuration as follows:\n\non the Main tab the location is C:/Go/bin/go.exe\nthe argument is test\nthe working directory should point to the eclipse workspace folder containing the package that is to be tested (eg ${workspace_loc:/goProject/src/pnp}, where pnp is the name of the package NOT the name of the go file that contains the test).\n\nYou can now run the test by pressing the Run button in the usual manner, having given the configuration a sensible name eg: go test pnp.  You can now add further tests to the package in different go files (or the same one) and all the tests will be carried out in a manner that is expected."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there any automated conversion from Go to Python?\n\nQuestion:\nIs there any program to automatically convert Go source code to Python source code?", "output": "It's highly unlikely that you'll find a way to do such a conversion with output that is actually useful. Go is very new, and if anything it would make more sense for someone to convert the other way around."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to get a MD5 hash from a string in Golang?\n\nQuestion:\nThis is how I started to get a md5 hash from a string:\nimport \"crypto/md5\"\n\nvar original = \"my string comes here\"\nvar hash = md5.New(original)\n\nBut obviously this is not how it works. Can someone provide me a working sample for this?", "output": "Reference Sum，For me，following work well：\npackage main\n\nimport (\n    \"crypto/md5\"\n    \"fmt\"\n)\n\nfunc main() {\n    data := []byte(\"hello\")\n    fmt.Printf(\"%x\", md5.Sum(data))\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: markup for go language in appengine\n\nQuestion:\nIs there a markup library (such as markdown or reST) in go language? preferebly\n\nworking with html/template\navailable for appengine\n\nI have checked here and searched google but nothing seems to be showing up. (could be just bindings as well)", "output": "https://github.com/knieriem/markdown - A translation of peg-markdown (an implementation of Markdown in C, using a PEG grammar) into Go\nhttps://github.com/russross/blackfriday - Blackfriday: a markdown processor for Go\nBoth are pure Go and should work fine on App Engine, you should be able to expand templates either after of before rendering the markdown to HTML."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Call a method from a Go template\n\nQuestion:\nLet's say I have\ntype Person struct {\n  Name string\n}\nfunc (p *Person) Label() string {\n  return \"This is \" + p.Name\n}\n\nHow can I use this method from a html/template ? I would need something like this in my template:\n{{ .Label() }}", "output": "Just omit the parentheses and it should be fine. Example:\npackage main\n\nimport (\n    \"html/template\"\n    \"log\"\n    \"os\"\n)\n\ntype Person string\n\nfunc (p Person) Label() string {\n    return \"This is \" + string(p)\n}\n\nfunc main() {\n    tmpl, err := template.New(\"\").Parse(`{{.Label}}`)\n    if err != nil {\n        log.Fatalf(\"Parse: %v\", err)\n    }\n    tmpl.Execute(os.Stdout, Person(\"Bob\"))\n}\n\nAccording to the documentation, you can call any method which returns one value (of any type) or two values if the second one is of type error. In the later case, Execute will return that error if it is non-nil and stop the execution of the template."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Multiline command.go in SciTE\n\nQuestion:\nThe Short\nThis deals with SciTE and the go language in Windows (in particular, Windows 7). This is my first time using SciTE, so if there is another way to achieve my goal that is fine as well.\nGoal: With one key press, compile, link, and execute the newly created binary.\nThe Long\nI want to setup the compile/link/excecute under the \"go\" command in SciTE. This may be slightly confusing as it is also for the go language. Here is what I have so far:\ncommand.compile.*.go=8g $(FileNameExt)\ncommand.build.*.go=8l -o $(FileName).exe $(FileName).8\ncommand.go.*.go=$(FileName).exe\n\nWhat I would like is to have something like:\ncommand.go.*.go=\\\n8g $(FileNamExt)\\\n8l -o $(FileName).exe $(FileName).8\\\n$(FileName).exe\n\nIf this worked the way I intended it would compile the file, link it, and then run the executable. What happens is:\n8g hello.go8l -o hello.exe hello.8hello.exe\n\nWhen it should be:\n8g hello.go\n8l -o hello.exe hello.8\nhello.exe\n\nWhere each line is executed.", "output": "Write a batch script like so:\n@echo off\nif (%1 == \"\") (goto end)\n\nset gofile=%1%\nshift\n\n8g %gofile%.go\n8l -o %gofile%.exe %gofile%.8\n%gofile%.exe\n\n:end\n\nThe batch file can be anywhere, but let's say it's in 'C:\\one\\two\\three\\GO.bat' sans the quotes. In the SciTE property file change:\ncommand.go.*.go=$(FileName).exe\n\nto\ncommand.go.*.go=C:\\one\\two\\three\\GO.bat $(FileName)\n\nAnd when you hit F5 or click on \"Go\", it will compile, link, and execute the file."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Redeclare a variable from a different block in a short variable declaration\n\nQuestion:\nHow can I redeclare a variable from a different block in a short variable declaration?\nfunc f() (err os.Error) {\n    proc, err := os.StartProcess(blah blah blah)\n    // the new err masks the return value?\n}\n\nThere's a long thread about this, and an issue, but I'm interested in how to work around this for the time being.", "output": "The Go specification for short variable declarations is clear:\n\na short variable declaration may\n  redeclare variables provided they were\n  originally declared in the same block\n  with the same type, and at least one\n  of the non-blank variables is new.\n\nTherefore, in a short variable declaration, you can't redeclare variables originally declared in a different block.\nHere's an example of how to get around this restriction by declaring a local variable (e) in the inner block and assigning it (e) to a variable (err2) declared in an outer block.\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc f() (err1 os.Error, err2 os.Error) {\n    fi, err1 := os.Stat(\"== err1 os.Error ==\")\n    _ = fi\n    {\n        fi, e := os.Stat(\"== e os.Error ==\")\n        _ = fi\n        err2 = e\n    }\n    return\n}\n\nfunc main() {\n    err1, err2 := f()\n    fmt.Println(\"f() err1:\", err1)\n    fmt.Println(\"f() err2:\", err2)\n}\n\nOutput:\nf() err1: stat == err1 os.Error ==: no such file or directory\nf() err2: stat == e os.Error ==: no such file or directory\n\nHere's the previous example rewritten to use explicit regular variable declarations and named function parameters rather than implicit short variable declarations. Variable declarations can always be written explicitly as regular variable declarations or named function parameters; implicit short variable declarations are merely a shorthand for regular variable declarations.\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc f() (err1 os.Error, err2 os.Error) {\n    var fi *os.FileInfo\n    fi, err1 = os.Stat(\"== err1 os.Error ==\")\n    _ = fi\n    {\n        var fi *os.FileInfo\n        fi, err2 = os.Stat(\"== err2 os.Error ==\")\n        _ = fi\n    }\n    return\n}\n\nfunc main() {\n    err1, err2 := f()\n    fmt.Println(\"f() err1:\", err1)\n    fmt.Println(\"f() err2:\", err2)\n}\n\nOutput:\nf() err1: stat == err1 os.Error ==: no such file or directory\nf() err2: stat == err2 os.Error ==: no such file or directory\n\nIn your example, the short variable declaration of err redeclares the return parameter declaration of err; they are in the same block. Therefore, the new err does not mask the return parameter err."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Parallel distinct word count in Go\n\nQuestion:\nJakob Østergaard presented this challenge:\n\nWrite a program that reads text from standard-input, and returns (prints) the total number of distinct words found in the text.\n\nHow can we meet this challenge with parallel programming (preferably in Go, but a description in English will suffice)?", "output": "There are several possibilities, but I guess you mean \"efficiently\" ?\nThe general idea would be to split the text into manageable chunks, pile those chunks into a queue, and have multiple consumers handle the chunks.\nThis looks like a typical Map/Reduce application to me:\n          _ Worker_\n         /          \\\n        /            \\\nSplitter--- Worker ---Aggregator\n        \\            /\n         \\_ Worker _/\n\nIdeally the \"multiple\" queues would be a single one with multiple consumers, so that if one worker slows down the whole process does not slows as much.\nI would also use a signal from the Splitter to the Workers to let them know the input has been fully consumed and they can start send their results to the Aggregator."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why are there no generics in Go?\n\nQuestion:\nDoes anybody know why there is no real support for generics/templates/whatsInAName in Go? So there is a generic map, but that's supplied by the compiler, while a Go programmer can't write her own implementation. With all the talk about making Go as orthogonal as possible, why can I USE a generic type but not CREATE a new one?\nEspecially when it comes to functional programming, there are lambdas, even closures, but with a static type system lacking generics, how do I write, well, generic higher order functions like filter(predicate, list)? OK, Linked lists and the like can be done with interface{} sacrificing type safety.\nIt looks like generics will only be added to Go as an afterthought, if at all,. I do trust Ken Thompson to do way better than the Java implementers, but why keep generics out? Or are they planned and just not implemented yet?", "output": "Note: Generics were added to Go in version 1.18.\n\nYou will find the answer here: http://golang.org/doc/faq#generics\n\nWhy does Go not have generic types?\nGenerics may well be added at some point. We don't feel an urgency for them, although we understand some programmers do.\nGenerics are convenient but they come at a cost in complexity in the type system and run-time. We haven't yet found a design that gives value proportionate to the complexity, although we continue to think about it. Meanwhile, Go's built-in maps and slices, plus the ability to use the empty interface to construct containers (with explicit unboxing) mean in many cases it is possible to write code that does what generics would enable, if less smoothly.\nThis remains an open issue."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to include inline assembly in Go code?\n\nQuestion:\nIs it possible to include inline assembly in Go code?\nThis blog post shows compiling Go to a separate .s file and editing it, but not inline asm as part of a Go function like many C compilers support.", "output": "There is no support for inline assembly, but you can link with code written in assembly through C, compiling with cgo and using import \"C\", like in gmp.go. You could alternatively write in a style of assembly that is directly compatible with Go, like in asm_linux_amd64.s, that requires that function names start with \"·\".\nOr, you can use nasm and gccgo, my favorite way so far. (Note that Nasm does not seem to support functions starting with \"·\").\nHere's a working \"hello world\" example:\nhello.asm:\n; Based on hello.asm from nasm\n\n    SECTION .data       ; data section\nmsg:    db \"Hello World\",10 ; the string to print, 10=cr\nlen:    equ $-msg       ; \"$\" means \"here\"\n                ; len is a value, not an address\n\n    SECTION .text       ; code section\n\nglobal go.main.hello        ; make label available to linker (Go)\ngo.main.hello:\n\n    ; --- setup stack frame\n    push rbp            ; save old base pointer\n    mov rbp,rsp   ; use stack pointer as new base pointer\n\n    ; --- print message\n    mov edx,len     ; arg3, length of string to print\n    mov ecx,msg     ; arg2, pointer to string\n    mov ebx,1       ; arg1, where to write, screen\n    mov eax,4       ; write sysout command to int 80 hex\n    int 0x80        ; interrupt 80 hex, call kernel\n\n    ; --- takedown stack frame\n    mov rsp,rbp  ; use base pointer as new stack pointer\n    pop rbp      ; get the old base pointer\n\n    ; --- return\n    mov rax,0       ; error code 0, normal, no error\n    ret         ; return\n\nmain.go:\npackage main\n\nfunc hello();\n\nfunc main() {\n    hello()\n    hello()\n}\n\nAnd a handy Makefile:\nmain: main.go hello.o\n    gccgo hello.o main.go -o main\n\nhello.o: hello.asm\n    nasm -f elf64 -o hello.o hello.asm\n\nclean:\n    rm -rf _obj *.o *~ *.6 *.gch a.out main\n\nI call hello() twice in main.go, just to double check that hello() returns properly.\nNote that calling interrupt 80h directly is not considered good style on Linux, and calling functions written is C is more \"future proof\". Also note that this is assembly specifically for 64-bit Linux, and is not platform-independent in any way, shape or form.\nI know it's not a direct answer to your question, but it's the easiest route I know for using assembly with Go, in lack of inlining. If you really need inlining, it's possible to write a script that extracts inline assembly from source files and prepares it in a way that follows the pattern above. Close enough? :)\nQuick example for Go, C and Nasm: gonasm.tgz\nUpdate: Later versions of gccgo needs the -g flag and only \"main.hello\" is needed instead of \"go.main.hello\". Here is an updated example for Go, C and Yasm: goyasm.tgz"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Exec a shell command in Go\n\nQuestion:\nI'm looking to execute a shell command in Go and get the resulting output as a string in my program. I saw the Rosetta Code version:\npackage main\nimport \"fmt\"\nimport \"exec\"\n\nfunc main() {\n  cmd, err := exec.Run(\"/bin/ls\", []string{\"/bin/ls\"}, []string{}, \"\", exec.DevNull, exec.PassThrough, exec.PassThrough)\n  if (err != nil) {\n    fmt.Println(err)\n    return\n  }\n  cmd.Close()\n\nBut this doesn't capture the actual standard out or err in a way that I can programatically access - those still print out to the regular stdout / stderr. I saw that using Pipe as the out or err could help elsewhere, but no example of how to do so. Any ideas?", "output": "This answer does not represent the current state of the Go standard library. Please take a look at @Lourenco's answer for an up-to-date method!\n\nYour example does not actually read the data from stdout. This works for me.\npackage main\n\nimport (\n   \"fmt\"\n   \"exec\"\n   \"os\"\n   \"bytes\"\n   \"io\"\n)\n\nfunc main() {\n    app := \"/bin/ls\"\n    cmd, err := exec.Run(app, []string{app, \"-l\"}, nil, \"\", exec.DevNull, exec.Pipe, exec.Pipe)\n\n    if (err != nil) {\n       fmt.Fprintln(os.Stderr, err.String())\n       return\n    }\n\n    var b bytes.Buffer\n    io.Copy(&b, cmd.Stdout)\n    fmt.Println(b.String())\n\n    cmd.Close()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Exercise: Web Crawler - concurrency not working\n\nQuestion:\nI am going through the golang tour and working on the final exercise to change a web crawler to crawl in parallel and not repeat a crawl ( http://tour.golang.org/#73 ). All I have changed is the crawl function.\n    var used = make(map[string]bool)\n\n    func Crawl(url string, depth int, fetcher Fetcher) {\n        if depth <= 0 {\n            return\n        }\n        body, urls, err := fetcher.Fetch(url)\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        fmt.Printf(\"\\nfound: %s %q\\n\\n\", url, body)\n        for _,u := range urls {\n            if used[u] == false {\n                used[u] = true\n                Crawl(u, depth-1, fetcher)\n            }\n        }\n        return\n    }\n\nIn order to make it concurrent I added the go command in front of the call to the function Crawl, but instead of recursively calling the Crawl function the program only finds the \"http://golang.org/\" page and no other pages.\nWhy doesn't the program work when I add the go command to the call of the function Crawl?", "output": "The problem seems to be, that your process is exiting before all URLs can be followed\nby the crawler. Because of the concurrency, the main() procedure is exiting before\nthe workers are finished.\nTo circumvent this, you could use sync.WaitGroup:\nfunc Crawl(url string, depth int, fetcher Fetcher, wg *sync.WaitGroup) {\n    defer wg.Done()\n    if depth <= 0 {\n         return\n    }\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"\\nfound: %s %q\\n\\n\", url, body)\n    for _,u := range urls {\n        if used[u] == false {\n           used[u] = true\n           wg.Add(1)\n           go Crawl(u, depth-1, fetcher, wg)\n        }\n    }\n    return\n}\n\nAnd call Crawl in main as follows:\nfunc main() {\n    wg := &sync.WaitGroup{}\n\n    Crawl(\"http://golang.org/\", 4, fetcher, wg)\n\n    wg.Wait()\n}\n\nAlso, don't rely on the map being thread safe."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: List of currently running process in golang, Windows version\n\nQuestion:\nHow can I get the list of currently running processes in golang under Windows?\nI need something like: \nList of currently running process in Golang\nbut usable under Windows too.", "output": "I just implemented the function you need (EnumProcess as axw stated above).\nCheck out https://github.com/AllenDang/w32. You might want to wait until my pull request is through :)\nAn example on how to use: https://gist.github.com/3083408"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I retrieve file data over a socket in Go?\n\nQuestion:\nI've got two small programs communicating nicely over a socket where the receiving side is in Go. Everything works peachy when my messages are tiny enough to fit in the 1024 byte buffer and can be received in a single Read from the connection but now I want to transfer data from an image that is 100k+ or more. I'm assuming the correct solution is not to increase the buffer until any image can fit inside.\nPseudo-go:\nvar buf = make([]byte,1024)\nconn, err := net.Dial(\"tcp\", \":1234\")\n\nfor {\n    r, err := conn.Read(buf[0:])\n    go readHandler(string(buf[0:r]),conn)\n}\n\nHow can I improve my socket read routine to accept both simple messages of a few bytes and also larger data? Bonus points if you can turn the total image data into an io.Reader for use in image.Decode.", "output": "You can use io.ReadFull to read a []byte of a specific length. This assumes that you know beforehand how many bytes you need to read.\nAs for image.Decode, it should be possible to pass the conn directly to the image.Decode function. This assumes that you do not perform any reads from the connection until the image is decoded.\nYour code\nfor {\n    r, err := conn.Read(buf[0:])\n    go readHandler(string(buf[0:r]),conn)\n}\n\nseems to be suggesting that the goroutine you are starting is reading from conn This doesn't seem like a good idea, because you will end up having multiple concurrent reads from the connection (without having control over the order in which the reads will happen): one in the for-loop, another one in readHandler."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go: Can you use range with a slice but get references? (iteration)\n\nQuestion:\nSay I want to change a value for all objects in an array.\nI like the range syntax a lot more than just named for loops.\nSo I tried:\ntype Account struct {\n   balance int\n}\ntype AccountList []Account\nvar accounts AccountList\n...\n....\n// to init balances\nfor _,a := range( accounts ) {\n    a.balance = 100\n}\n\nThat did not work since a is a copy of the entries from the AccountList and we are thus updating the copy only.\nThis does work as I need it to:\nfor a := range( accounts ) {\n  accounts[a].balance = 100\n}\n\nBut that code has an extra lookup inside the for loop.\nIs there a way to do an iterator that gets references to the structs in the AccountList?", "output": "Just let the AccountList be []*Account. Then you'll get pointers to each Account inside the range."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to concat a string and float64 on go?\n\nQuestion:\nI am trying to solve this: http://tour.golang.org/#58\nHere is what I have done;\n#imports omitted\ntype ErrNegativeSqrt float64\n\nfunc (e ErrNegativeSqrt) Error() string {\n    return \"Cannot Sqrt negative number: \" + string(e)\n}\n\nfunc Sqrt(f float64) (float64, error) {\n    if f < 0 {\n        return 0, ErrNegativeSqrt(1)\n    }\n    # calculate z here...\n    return z, nil\n}\n# main omitted\n\nI have also tried e.String() and e.string() but those didn't work too...", "output": "Try using the fmt package\nimport \"fmt\"\n...\nreturn fmt.Sprint(\"Cannot Sqrt negative number \", float64(e))"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Test cases for go and appengine\n\nQuestion:\nI am using Go and appengine, and now I would like to do some test cases.\nI tried using gos standard test package, \nFiles (both \"package hello\"):\nhello/http.go\nhello/http_test.go\n\nProblem: I cannot run go test hello. The closest I have got is go test  hello/http_test.go which works if I do not make any calls to http.go, which is quite pointless. :)", "output": "An interesting development: as of 1.8.6 using service stubs for testing has been integrated into the SDK through the \"appengine/aetest\" package. This works largely like the above via a \"testing\" context. More info"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why does Go have a \"goto\" statement?\n\nQuestion:\nI was surprised to find that Go has a 'goto' statement. I've always been taught that 'goto' statements are a thing of the past and evil for it occludes the actual flow of a program, and that functions or methods are always a better way of controlling flow.\nI must be missing something. Why did Google include it?", "output": "When we actually check the source code of the Go standard library, we can see where gotos are actually well applied.\nFor example, in the math/gamma.go file, the goto statement is used:\n  for x < 0 {\n    if x > -1e-09 {\n      goto small\n    }\n    z = z / x\n    x = x + 1\n  }\n  for x < 2 {\n    if x < 1e-09 {\n      goto small\n    }\n    z = z / x\n    x = x + 1\n  }\n\n  if x == 2 {\n    return z\n  }\n\n  x = x - 2\n  p = (((((x*_gamP[0]+_gamP[1])*x+_gamP[2])*x+_gamP[3])*x+_gamP[4])*x+_gamP[5])*x + _gamP[6]\n  q = ((((((x*_gamQ[0]+_gamQ[1])*x+_gamQ[2])*x+_gamQ[3])*x+_gamQ[4])*x+_gamQ[5])*x+_gamQ[6])*x + _gamQ[7]\n  return z * p / q\n\nsmall:\n  if x == 0 {\n    return Inf(1)\n  }\n  return z / ((1 + Euler*x) * x)\n}\n\nThe goto in this case saves us from introducing another (boolean) variable used just for control-flow, checked for at the end. In this case, the goto statement makes the code actually better to read and easier follow (quite in contrary to the argument against goto you mentioned).\nAlso note, that the goto statement has a very specific use-case. The language specification on goto states that it may not jump over variables coming into scope (being declared), and it may not jump into other (code-)blocks."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Stick with PHP or learn Go-lang?\n\nQuestion:\nI have learned in my University time Pascal and C and RedHat Linux/Unix . \nTo get quickly one job, i started learning Microsoft Visual Basic 6.0 for speed in development etc. In that time, with C its like more time consuming and i was not confident to use it for job purpose, where most of the companies demand fast/rapid development.\nAfter that i had problems with my companies because they want web applications, then i started using PHP which is also great, because customers demand web projects and they expect Google like applications in short time frame, which is doable because PHP gives that speed and its huge community.\nTo explain my need for Go-lang is following:\n\nPHP the syntax is friendly compared to C/Pascal. \nI was very happy to learn Python, but its syntax is very much different then C. \nWhich just  not gonna work with me to accept and really learn it better and better. \nI have tried to learn Ruby, at-least so that i can have the knowledge of Python \nlike syntax, but i really skipped Ruby because of 2x time slower then PHP\n\nTherefore, \nIs Go-lang is the perfect choice for SPEED vs PHP vs Ruby, for Web development + Gtk?", "output": "Alas, I'd love to have 1 asset that I could use for all conditions but it's just not available in the world of computing. You're going to have to learn 2 or more.\nPHP is very widely used, so you might as well stick with it. If you can create decent webapps using it, go for it. I would suggest learning C/C++ too so you can write any high-performance modules using that and call them from your PHP code. That's probably the best of all worlds for your webapps.\nIf you wanted to write for desktops, I think you'll be best off learning C++ with Qt (and look at Wt) (as it appears you're a Linux dev), or C#/VB.NET for Windows. \nFor mobiles, learn C/C++ as you can write apps in that no matter which platform even if you have to put up with some platform-dependant extensions - you either have to learn Java for Android, Objective-C for iOS, or (well we're not quite sure what MS has planned for Windows Phone 8, but I hear they like native code again, that means C++/CX). You can see where I'm going with this!\nso anyway, if you're happy with PHP then keep with it. There is a ton of code out there that runs PHP so it's not like you're working with some bleeding-edge or hardly-used obscure language."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Dereferencing pointers in Go\n\nQuestion:\nI'm confused as to why line 15 is not valid. Why can't a pointer to a big.Int be dereferenced, whilst a pointer to an int can?\npackage main\n\nimport (\n    \"fmt\"\n    \"big\"\n)\n\nfunc main() {\n    var c *int = getPtr()\n    fmt.Println(c)\n    fmt.Println(*c)\n\n    var d *big.Int = big.NewInt(int64(0))\n    fmt.Println(d)\n\n    // does not compile - implicit assignment of big.Int\n    // field 'neg' in function argument\n    //fmt.Println(*d)\n}\n\nfunc getPtr() *int {\n    var a int = 0\n    var b *int = &a\n    return b\n}", "output": "It's because Int is a struct with unexported fields. When you pass a struct by value to a function, you're making a copy of it. The Go spec states that for this to be legal\n\n...either all fields of T must be\n  exported, or the assignment must be in\n  the same package in which T is\n  declared. In other words, a struct\n  value can be assigned to a struct\n  variable only if every field of the\n  struct may be legally assigned\n  individually by the program."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Efficient way to rotate a slice in golang\n\nQuestion:\nI need a function to efficiently reverse a slice in golang. (My concrete need is to reverse the prefix of a []byte).\nI checked the example from Effective Go with objdump -Sd and a lot of boiler plate is generated to check for array indexes. Even the swap is too inefficient.", "output": "Firstly, I have to say it: Profile first. Is this really a bottleneck in your code? If it is, you have a few options.\n1) Disable bounds checking. I think there's an undocumented compiler flag that turns of slice bounds checking. I can't find it at the moment though. (EDIT: -B according to OP).\n2) Write the routine in C (or assembler), you can write C for [586]c and link in your go package (you'll need to include some headers from $GOROOT/src/pkg/runtime), like so:\n#include \"runtime.h\"\nmypackage·swapslice(Slice s) {\n    int i, j;\n    //Not a real swap loop\n    for (i = 0, j = s.len - 1; i < j; i++, j--)\n        //swap s.arr[i] and s.arr[j];\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does golang TLS support IE8?\n\nQuestion:\nLatest Chrome/IE9/Firefox all work fine. IE8 complains that the page cannot be shown and it looks like that the connection is aborted. Here goes the quick test code.\npackage main\n\nimport (\n    \"time\"\n    \"fmt\"\n    \"net/http\"\n)\n\ntype Handler struct {\n}\n\nfunc (this *Handler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello, %q\", r.URL.Path)\n}\n\nfunc main() {\n    handler := &Handler{}\n    ss := &http.Server{\n        Addr: \":443\",\n        Handler: handler,\n        ReadTimeout: 10 * time.Second,\n        WriteTimeout: 10 * time.Second,\n        MaxHeaderBytes: 1 << 20,\n    }\n    ss.ListenAndServeTLS(\"cert.pem\", \"key.pem\")\n}\n\nNote that \"cert.pem\" and \"key.pem\" are generated by \"crypto/tls/generate_cert.go\". I tried a real certificate, and it did not work either.", "output": "moved from question as OP didn't made a proper answer\nThis problem can be resolved by this patch, \"0001-Allow-SSLv2-compatible-client-hello-so-SSLv2-compati.patch\", in issue http://code.google.com/p/go/issues/detail?id=3930.\nThis revision, http://code.google.com/p/go/source/detail?r=8048fe8f6f4b, however, does not solve the problem."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Read from initial stdin in Go?\n\nQuestion:\nI would like to read from the original stdin of a Go program. For example, if I did echo test stdin | go run test.go, I would want to have access to \"test stdin\". I've tried reading from os.Stdin, but if there's nothing in it, then it will wait for input. I also tried checking the size first, but the os.Stdin.Stat().Size() is 0 even when input is passed in.\nWhat can I do?", "output": "I think your question per se has no sensible answer because there's just no such thing as \"initial stdin\".  Unix-like OSs, and Windows implement the concept of \"standard streams\", which works like this (simplified): when a process is created, it automagically has three file descriptors (handles in Windows) open — stdin, stdout and stderr.  No doubts, you're familiar with this concept, but I'd like to stress the meaning of the word \"stream\" there — in your example, when you call\n$ echo 'test stdin' | ./stdin\n\nthe shell creates a pipe, spawns two processes (one for echo and one for your binary) and makes use of the pipe it created: the pipe's write FD is attached to the echo's stdout and the pipe's read FD is attached to your binary's stdin.  Then whatever the echo process pleases to write to its stdout is piped (sic!) to the stdin of your process.\n(In reality most today's shells implement echo as a built-in primitive but this does not in any way change the semantics; your could as well have tried /bin/echo instead, which is a real program.  Also note that I just used ./stdin to refer to your program — this is for clarity, as go run stdin.go would do exactly this, in the end.)\nNote several crucial things here:\n\nThe writing process (echo in your case) is not oblidged to write anything to its stdout (for instance, echo -n would not write anything to its stdout and exit successfully).\nIt's also able to make arbitrary delays writing its data (either because it wants to make such delays or because it has been preempted by the OS or sleeps in some syscall waiting on some busy system resource etc).\nThe OS buffers transfers over pipes, and often the code in the program does this, too—though it may not be apparent for an inexperienced programmer. This means what the writing process sends to a pipe, might come out in arbitrary chunks on the reading side.1\nThere are only two ways to know the writing side has no more data to send over the pipe:\n\nSomehow encode this in the data itself (this means using an agreed upon data transfer protocol between the writer and the reader).\nThe writer might close its side of the pipe which would result in the \"end of file\" condition on the reader side (but only after the buffer is drained and one another call to read is attempted, which fails).\n\n\n\nLet's wrap this up: the behaviour you're observing is correct and normal.  If you expect to get any data from stdin, you must not expect it to be readily available.  If you also don't want to block on stdin, then create a goroutine which would do blocking reads from stdin in an endless loop (but checking for the EOF condition) and pass collected data up over a channel (possibly after certain processing, if needed).\n1 This is why certain tools which usually occur between two pipes in a pipeline, such as grep, might have special options to make them flush their stdout after writing each line — read about the --line-buffered option in the grep manual page for one example.  People who are not aware of this \"full buffering by default\" semantics are puzzled why tail -f /path/to/some/file.log | grep whatever | sed ... seems to stall and not display anything when it's obvious the monitored file gets updated.\n\nAs a side note: if you were to run your binary \"as is\", like in\n$ ./stdin\n\nthat would not meant the spawned process would not have stdin (or \"initial stdin\" or whaveter), instead, its stdin would be connected to the same stream your shell receives your keyboard input from (so you could directly type something to your process's stdin).\nThe only sure way to have a process's stdin connected to nowhere is to use\n$ ./stdin </dev/null\n\non Unix-like OSes and\nC:\\> stdin <NUL\n\non Windows.  This \"null device\" makes the process see EOF on the first read from its stdin."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Specify names for parsed templates\n\nQuestion:\nI am trying to dynamically parse files using walk in a folder and I want to be able to set the path of the file \"path/file.html\". But my issue is if I have a file in a folder \"path/folder/files.html\" I can't do it because when I ExecuteTemplate the file name will be the same \"files.html\". Is it possible to name each template as I ParseFiles?\nIm ok with doing a file one at a time if trying to do them all at once wont work.\n// Parse file and send to responsewriter\nfunc View(w http.ResponseWriter, path string) {\n    temp, err := template.ParseFiles(\"application/views/\"+path+\".html\")\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    } else {\n        temp.ExecuteTemplate(w, path, nil)\n    }\n}", "output": "Walk the filesystem using filepath.Walk and a consumer method that will create templates with the full file paths as names:\npackage main\n\nimport (\n    \"fmt\"\n    \"html/template\"\n    \"os\"\n    \"path/filepath\"\n)\n\nfunc consumer(p string, i os.FileInfo, e error) error {\n    t := template.New(p)\n    fmt.Println(t.Name())\n    return nil\n}\n\nfunc main() {\n    filepath.Walk(\"/path/to/template/root\", filepath.WalkFunc(consumer))\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: AppEngine/Go app won't compile. What did I miss?\n\nQuestion:\nI am trying to test an AppEngine/Go application. I start dev_appserver.py and it begins serving the application, but when I go to localhost:8080 in my browser, I get:\nCompile error:\n/home/adam/foobar/server/app/server.go:5: can't find import: appengine/users\n\n2011/08/23 19:45:34 go-app-builder: Failed building app: failed running 8g: exit status 1\n\nI feel as though I need to do something to make the AppEngine-specific libraries available where GO expects them to be, but I don't really want to run goinstall on everything that comes in the AppEngine/Go SDK zip, do I? I seem to have missed an installation step, but for the life of me, I can't figure the sane and right thing to do.\nI am on Ubuntu, if that matters.", "output": "The Users API isn't appengine/users - it's appengine/user. From the example on the App Engine page:\nimport (\n    \"appengine\"\n    \"appengine/user\"\n)\n\nfunc welcome(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    u := user.Current(c)\n    if u == nil {\n        url := u.LoginURL(c, \"/\")\n        fmt.Fprintf(w, `<a href=\"%s\">Sign in or register</a>`, url)\n        return\n    }\n    url := user.LogoutURL(c, \"/\")\n    fmt.Fprintf(w, `Welcome, %s! (<a href=\"%s\">sign out</a>)`, u, url)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to replace a single character inside a string in Golang?\n\nQuestion:\nI am getting a physical location address from a user and trying to arrange it to create a URL that would use later to get a JSON response from Google Geocode API.\nThe final URL string result should be similar to this one, without spaces: \n\nhttp://maps.googleapis.com/maps/api/geocode/json?address=1600+Amphitheatre+Parkway,+Mountain+View,+CA&sensor=true\n\nI do not know how to replace white spaces in my URL string and have commas instead. I did read a little about the strings and regexp packages and I have created the following code:\npackage main\n\nimport (\n    \"fmt\"\n    \"bufio\"\n    \"os\"\n    \"http\"\n)\n\nfunc main() {\n    // Get the physical address\n    r := bufio.NewReader(os.Stdin)  \n    fmt.Println(\"Enter a physical location address: \")\n    line, _, _ := r.ReadLine()\n\n    // Print the inputted address\n    address := string(line)\n    fmt.Println(address) // Need to see what I'm getting\n\n    // Create the URL and get Google's Geocode API JSON response for that address\n    URL := \"http://maps.googleapis.com/maps/api/geocode/json?address=\" + address + \"&sensor=true\"\n    fmt.Println(URL)\n\n    result, _ := http.Get(URL)\n    fmt.Println(result) // To see what I'm getting at this point\n}", "output": "You can use strings.Replace.\npackage main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    str := \"a space-separated string\"\n    str = strings.Replace(str, \" \", \",\", -1)\n    fmt.Println(str)\n}\n\nIf you need to replace more than one thing, or you'll need to do the same replacement over and over, it might be better to use a strings.Replacer:\npackage main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\n// replacer replaces spaces with commas and tabs with commas.\n// It's a package-level variable so we can easily reuse it, but\n// this program doesn't take advantage of that fact.\nvar replacer = strings.NewReplacer(\" \", \",\", \"\\t\", \",\")\n\nfunc main() {\n    str := \"a space- and\\ttab-separated string\"\n    str = replacer.Replace(str)\n    fmt.Println(str)\n}\n\nAnd of course if you're replacing for the purpose of encoding, such as URL encoding, then it might be better to use a function specifically for that purpose, such as url.QueryEscape"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Looking for Go equivalent of scanf\n\nQuestion:\nI'm looking for the Go equivalent of scanf().\nI tried with following code:\n  1 package main\n  2 \n  3 import (\n  4     \"scanner\"\n  5     \"os\"\n  6     \"fmt\"\n  7 )\n  8 \n  9 func main() {\n 10     var s scanner.Scanner\n 11     s.Init(os.Stdin)\n 12     s.Mode = scanner.ScanInts\n 13     tok := s.Scan()\n 14     for tok != scanner.EOF {\n 15         fmt.Printf(\"%d \", tok)\n 16         tok = s.Scan()\n 17     }\n 18     fmt.Println()\n 19 }\n\nI run it with input from a text with a line of integers.\nBut it always output -3 -3 ...\nAnd how to scan a line composed of a string and some integers?\nChanging the mode whenever encounter a new data type?\nThe Package documentation:\n\nPackage scanner\nA general-purpose scanner for UTF-8\n  encoded text.\n\nBut it seems that the scanner is not for general use.\nUpdated code:\nfunc main() {\n    n := scanf()\n    fmt.Println(n)\n    fmt.Println(len(n))\n}\n\nfunc scanf() []int {\n    nums := new(vector.IntVector)\n    reader := bufio.NewReader(os.Stdin)\n    str, err := reader.ReadString('\\n')\n    for err != os.EOF {\n        fields := strings.Fields(str)\n        for _, f := range fields {\n            i, _ := strconv.Atoi(f)\n            nums.Push(i)\n        }   \n        str, err = reader.ReadString('\\n')\n    }   \n    r := make([]int, nums.Len())\n    for i := 0; i < nums.Len(); i++ {\n        r[i] = nums.At(i)\n    }   \n    return r\n}\n\nImproved version:\npackage main\n\nimport (\n    \"bufio\"\n    \"os\"\n    \"io\"\n    \"fmt\"\n    \"strings\"\n    \"strconv\"\n    \"container/vector\"\n)\n\nfunc main() {\n    n := fscanf(os.Stdin)\n    fmt.Println(len(n), n)\n}\n\nfunc fscanf(in io.Reader) []int {\n    var nums vector.IntVector\n    reader := bufio.NewReader(in)\n    str, err := reader.ReadString('\\n')\n    for err != os.EOF {\n        fields := strings.Fields(str)\n        for _, f := range fields {\n            if i, err := strconv.Atoi(f); err == nil {\n                nums.Push(i)\n            }   \n        }   \n        str, err = reader.ReadString('\\n')\n    }   \n    return nums\n}", "output": "Your updated code was much easier to compile without the line numbers, but it was missing the package and import statements.\nLooking at your code, I noticed a few things. Here's my revised version of your code.\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"strconv\"\n    \"strings\"\n    \"container/vector\"\n)\n\nfunc main() {\n    n := scanf(os.Stdin)\n    fmt.Println()\n    fmt.Println(len(n), n)\n}\n\nfunc scanf(in io.Reader) []int {\n    var nums vector.IntVector\n    rd := bufio.NewReader(os.Stdin)\n    str, err := rd.ReadString('\\n')\n    for err != os.EOF {\n        fields := strings.Fields(str)\n        for _, f := range fields {\n            if i, err := strconv.Atoi(f); err == nil {\n                nums.Push(i)\n            }\n        }\n        str, err = rd.ReadString('\\n')\n    }\n    return nums\n}\n\nI might want to use any input file for scanf(), not just Stdin; scanf() takes an io.Reader as a parameter.\nYou wrote: nums := new(vector.IntVector), where type IntVector []int. This allocates an integer slice reference named nums and initializes it to zero, then the new() function allocates an integer slice reference and initializes it to zero, and then assigns it to nums. I wrote: var nums vector.IntVector, which avoids the redundancy by simply allocating an integer slice reference named nums and initializing it to zero.\nYou didn't check the err value for strconv.Atoi(), which meant invalid input was converted to a zero value; I skip it.\nTo copy from the vector to a new slice and return the slice, you wrote:\nr := make([]int, nums.Len())\nfor i := 0; i < nums.Len(); i++ {\n    r[i] = nums.At(i)\n}\nreturn r\n\nFirst, I simply replaced that with an equivalent, the IntVector.Data() method: return nums.Data(). Then, I took advantage of the fact that type IntVector []int and avoided the allocation and copy by replacing that by: return nums."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I properly structure a package with sub packages in Go where a single type will be the receiver on most of the methods?\n\nQuestion:\nI'm currently in the design stage of writing a utility library that will make interaction with the x-go-binding a bit easier. (I've done this before with Python and xpyb.) For example, it will help with querying information defined in the EWMH spec and binding keys to callback functions. (And much more.) So as my initial idea for a package layout, consider:\n\nxutil\n\newmh\nkeybind\n\n\n\nWhere each is its own package. (Similar to how the standard library's image package is setup.)\nWhat's unique about my situation is that almost every x-go-binding call requires some combination of an xgb connection object or a root window identifier. Therefore, it makes sense to me to store this information in a struct like so:\ntype XUtilConnection struct {\n    conn xgb.Conn\n    root xgb.Id\n    // a few other things, like a mapping of events to callbacks\n}\n\nSo that I'd have a factory that could be used like so:\nxconn = xutil.NewXUtilConnection(blah blah)\n\nAnd it could be used like:\nxconn.get_active_window()\nxconn.bind_key(\"Shift-a\", my_callback_fun)\n\nThere may also be functions like:\nkeybind.get_keycode(\"a\")\newmh.get_atom(\"_NET_ACTIVE_WINDOW\")\n\nMy problem of course is that receivers, to my knowledge, can only be of types that have been declared in the same package. If I separate my packages, I cannot use my XUtilConnection type as a receiver in any of my sub-packages.\nI suspect that my answer is going to be making this one big package separated into different logical files, but I fear that this might lead to namespace clutter. (For example, implementing the EWMH spec is probably on the order of 100+ functions.)\nI am also aware that I could define a new container type in each sub-package for my XUtilConnection object. (I've heard that this should be a struct containing a single member XUtilConnection to avoid casting.) But this seems like a really messy situation to me, and would prevent the kind of semantics I'd like. (i.e., using an XUtilConnection struct to call methods in several different modules.)", "output": "I would suggest to use embedding.\nIn package xutil:\n\n  type XUtilConnection struct {\n      *ewmh.EWMH        // Embed all methods of *ewmh.EWMH\n      *keybind.KeyBind  // Embed all methods of *keybind.KeyBind\n  }\n\nIn package xutil/ewmh:\n\n  type EWMH struct {\n      Conn xgb.Conn\n      Root xgb.Id\n      // and any additional fields that are needed\n  }\n\n  // Some EWMH methods:\n  func (e *EWMH) GetAtom(name string) { ... }\n  func (e *EWMH) ...\n\nIn package xutil/keybind:\n\n  type KeyBind struct {\n      Conn xgb.Conn\n      Root xgb.Id\n      // and any additional fields that are needed\n  }\n\n  // Some keybind methods:\n  func (k *KeyBind) GetKeyCode(s string) { ... }\n  func (k *KeyBind) ...\n\nThis will enable you to directly call EWMH's and KeyBind's methods on values of type *XUtilConnection:\nvar c *XUtilConnection = ...\nc.GetAtom(\"_NET_ACTIVE_WINDOW\")  // Call (*emwh.EWMH).GetAtom(string)\nc.GetKeyCode(\"a\")                // Call (*keybind.KeyBind).GetKeyCode(string)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Get syscall.Handle from a Go *net.UDPConn on Windows?\n\nQuestion:\nHow do I obtain the underlying syscall.Handle for a *net.UDPConn on Windows? I want this handle to set the IP_MULTICAST_TTL via syscall.SetsockoptInt. On Linux I do the following:\nfunc setTTL(conn *net.UDPConn, ttl int) error {\n    f, err := conn.File()\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n    fd := int(f.Fd())\n    return syscall.SetsockoptInt(fd, syscall.SOL_IP, syscall.IP_MULTICAST_TTL, ttl)\n}\n\nBut on Windows, the implicit dup inside *net.UDPConn's File() fails with:\n\n04:24:49 main.go:150: dup: not supported by windows\n\nAnd in the source code is marked as  a to-do. How can I get this handle? Is there some other way to set the TTL if not?\nUpdate0\nI've submitted the shortcomings to the Go issue tracker:\n\nSetTTL for *net.UDPConn\nImplement dup for netFD on Windows", "output": "The short answer is impossible. But since that isn't an answer you want to hear, I will give you the right way and wrong way to solve the problem.\nThe right way:\n\nimplement dup() for Windows.\nsubmit to Go as a changeset\nwait for it to be released to use it\n\nObviously the right way has some issues... but I highly recommend doing it. Go needs windows developers to fix up these types of serious problems. The only reason this can't be done in Windows is no one implemented the function\nThe wrong way:\nUntil the patch you write gets accepted and released, you can fake it through unsafe. The way the following code works by mirroring the exact structure of a net.UDPConn. This included copying over all structs from net that make up a UDPConn. Then unsafe is used to assert that the local UDPConn is the same as net's UDPConn. The compiler can not check this and takes your word for it. Were the internals of net to ever change, it would compile but god knows what it would do.\nAll code is untested.\npackage reallyunsafenet\n\nimport (\n        \"net\"\n        \"sync\"\n        \"syscall\"\n        \"unsafe\"\n)\n\n// copied from go/src/pkg/net/fd_windows.go\ntype ioResult struct {\n        qty uint32\n        err error\n}\n\n// copied from go/src/pkg/net/fd_windows.go\ntype netFD struct {\n        // locking/lifetime of sysfd\n        sysmu   sync.Mutex\n        sysref  int\n        closing bool\n\n        // immutable until Close\n        sysfd       syscall.Handle\n        family      int\n        sotype      int\n        isConnected bool\n        net         string\n        laddr       net.Addr\n        raddr       net.Addr\n        resultc     [2]chan ioResult\n        errnoc      [2]chan error\n\n        // owned by client\n        rdeadline int64\n        rio       sync.Mutex\n        wdeadline int64\n        wio       sync.Mutex\n}\n\n// copied from go/src/pkg/net/udpsock_posix.go\ntype UDPConn struct {\n    fd *netFD\n}\n\n// function to get fd\nfunc GetFD(conn *net.UDPConn) syscall.Handle {\n        c := (*UDPConn)(unsafe.Pointer(conn))\n        return c.fd.sysfd\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go: transfer var into anonymous function\n\nQuestion:\nI am having trouble transferring a variable into an anonymous function. Is there a solution?\nimport  \"github.com/lxn/walk\"\n\n***\n\nvar openAction [12]*walk.Action\nfor i := 0; i < 12; i++ {\n\n    openBmp, err := walk.NewBitmapFromFile(_films[i][0])\n    if err != nil {\n        log.Printf(\"Open bitmap for buildBody() :%v\\n\", err)\n    }\n    openAction[i] = walk.NewAction()\n    openAction[i].SetImage(openBmp)\n    openAction[i].SetText(_films[i][2])\n    openAction[i].Triggered().Attach( func(){\n        exec(i)\n    })\n    mw.ToolBar().Actions().Add(openAction[i])\n}\n\nexec(i) where i always = 11", "output": "I think that this will get you what you want:\nopenAction[i].Triggered().Attach(func(x int) func() {\n    return func() { exec(x) }\n}(i))\n\nThe trick is to have your anonymous function return an anonymous function, and each created function will enclose each of the values of i."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Problems about `slice` and `append` in Go\n\nQuestion:\nI have written the following code. But I can't have it compiled. Here is my code:\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    tmp := make([]int, 10)\n    for i := 0; i < 10; i++ {\n        tmp[i] = i\n    }\n    res := mapx(foo, tmp)\n    fmt.Printf(\"%v\\n\", res)\n}\n\nfunc foo(a int) int {\n    return a + 10\n}\n\nfunc mapx(functionx func(int) int, list []int) (res []int) {\n    res = make([]int, 10)\n    for _, i := range(list) {\n        append(res, functionx(i))\n    }\n    return\n}\n\nMeanwhile the error message is also very confusing:\nprog.go:21: append(res, functionx(i)) not used\nBut if I replace append(res, functionx(i))(line 21) with res = append(res, functionx(i)), it works quite well. Can anybody help me?\nThank you!", "output": "Appending to and copying slices\nThe variadic function append appends zero or more values x to s of\n  type S, which must be a slice type, and returns the resulting slice,\n  also of type S.\nIf the capacity of s is not large enough to fit the additional values,\n  append allocates a new, sufficiently large slice that fits both the\n  existing slice elements and the additional values. Thus, the returned\n  slice may refer to a different underlying array.\nCalls\nIn a function call, the function value and arguments are evaluated in\n  the usual order. After they are evaluated, the parameters of the call\n  are passed by value to the function and the called function begins\n  execution. The return parameters of the function are passed by value\n  back to the calling function when the function returns.\n\nIn Go, arguments are passed by value.\nYou need to write res = append(res, functionx(i)) so that you don't discard the new value for res, which refers to a different slice and, possibly, a different underlying array.\nFor example,\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    res := []int{0, 1}\n    fmt.Println(res)\n    _ = append(res, 2) // discard\n    fmt.Println(res)\n    res = append(res, 2) // keep\n    fmt.Println(res)\n}\n\nOutput:\n[0 1]\n[0 1]\n[0 1 2]"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Goroutine sleep and deadlock in code. How to solve it?\n\nQuestion:\nhttp://play.golang.org/p/r92-KtQEGl\nI am trying to execute this code. It throws a deadlock error.\nWhat am I missing?\npackage main\n\nimport \"tour/tree\"\nimport \"fmt\"\n\n// Walk walks the tree t sending all values\n// from the tree to the channel ch.\nfunc Walk(t *tree.Tree, ch chan int){\n    var temp chan int\n    ch <- t.Value\n    if t.Left!=nil{go Walk(t.Left,temp)}\n    if t.Right!=nil{go Walk(t.Right,temp)}\n    for i := range temp{\n        ch <- i\n    }\n    close(ch)\n}\n\n// Same determines whether the trees\n// t1 and t2 contain the same values.\nfunc Same(t1, t2 *tree.Tree) bool", "output": "You need at least to initialize your channels (if the channel is nil, a range would block forever)\n  var temp chan int = make(chan int)\n  var ch chan int = make(chan int)\n\nSee http://play.golang.org/p/Gh8MZlyd3B (still deadlock but at least display results)\nThis version, using two temp channels, doesn't deadlock: http://play.golang.org/p/KsnmKTgZ83\npackage main\n\nimport \"tour/tree\"\nimport \"fmt\"\n\n// Walk walks the tree t sending all values\n// from the tree to the channel ch.\nfunc Walk(t *tree.Tree, ch chan int) {\n    var temp1 chan int = make(chan int)\n    var temp2 chan int = make(chan int)\n    ch <- t.Value\n    if t.Left != nil {\n        go Walk(t.Left, temp1)\n    }\n    if t.Right != nil {\n        go Walk(t.Right, temp2)\n    }\n    if t.Left != nil {\n        for i := range temp1 {\n            ch <- i\n        }\n    }\n    if t.Right != nil {\n        for i := range temp2 {\n            ch <- i\n        }\n    }\n    close(ch)\n}\n\n// Same determines whether the trees\n// t1 and t2 contain the same values.\nfunc Same(t1, t2 *tree.Tree) bool\n\nfunc main() {\n    var ch chan int = make(chan int)\n    go Walk(tree.New(1), ch)\n    for i := range ch {\n        fmt.Println(i)\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Default rules in Make\n\nQuestion:\nIs there a mechanism in make to allow for default global implicit rules that are available anywhere, similar to the built-in rules?\nMake provides some built-inimplicit rules for compiling C/C++/Fortran files, without even requiring a Makefile for simple cases.  However, when compiling other languages (e.g. Go programming language files), a Makefile is always required.  I would like to extend my Makeenvironment to have implicit rules available by default.", "output": "This is not normally desirable, as it would cause your Makefile to be less portable; it wouldn't work on somebody else's machine if they didn't have it set up that way.\nHowever, if you want to do this, create a \"global\" Makefile somewhere with your default rules for Go files, then add its path to the MAKEFILES environment variable. This global Makefile will be processed before any Makefile when you run \"make\", just as if you had included its source at the top of the file."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go Threads - STOP Execution\n\nQuestion:\nI have two goroutine like,\nRoutine 1 {\n// do something\n}\nRoutine 2 {\n // do something\n}\n main {\n // do something\n}\n\nIs it possible from in routine 1, if some condition met, stop whole program execution ? Stop  execution of main and Routine 2 ? Can give a simple example.", "output": "For example,\npackage main\n\nimport \"os\"\n\nfunc routine1() {\n    // set exit = true when ready to exit\n    exit := false\n    if exit {\n        os.Exit(0)\n    }\n}\n\nfunc routine2() {\n}\n\nfunc main() {\n    go routine1()\n    go routine2()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Get length to decoding Ascii85\n\nQuestion:\nascii85 has a function to get the maximum length of an encoding MaxEncodedLen().\nI think that it should have too a function to get the length at decoding like it has in Base64.\nhttp://golang.org/pkg/encoding/ascii85/", "output": "Here's a function to calculate Go package ascii85 MaxDecodedLen() for n encoded bytes.\nfunc MaxDecodedLen(n int) int {\n    const binWordLen = 4\n    return n * binWordLen\n}\n\nIf all four bytes of a unencoded group are zero, they are represented by a single byte, the character z, instead of by five exclamation points (!!!!!). In some implementations, an unencoded group of spaces may be represented by the single character y.\nascii85.Decode(), unlike ascii85.Encode(), has number of bytes consumed (nsrc) and flush parameters, in addition to a number of bytes written (ndst) parameter, which allows the programmer to decode multiple blocks or a single block piece-by-piece. Therefore, a destination buffer of less than the MaxDecodedLen() may be used."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go XML Marshalling and the Root Element\n\nQuestion:\nIn Go, you can marshall a struct to XML, e.g.:\npackage main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    )\n\ntype person struct {\n    Name string\n    Starsign string\n}\n\nfunc main() {\n    p := &person{\"John Smith\", \"Capricorn\"}\n    b,_ := xml.MarshalIndent(p,\"\",\"   \")\n    fmt.Println(string(b))\n}\n\nproduces output:\n<person>\n   <Name>John Smith</Name>\n   <Starsign>Capricorn</Starsign>\n</person>\n\nMy problem is, the person type is lower-case \"p\" because I want that to be private to the package. But I'd prefer the XML element to be uppercase: <Person>.  The fields within the struct can be marshalled to other names using tags (e.g. `xml:\"name\"`) against the structure fields but this doesn't seem to be an option for the structure type. \nI have a work-around using templates, but it would be nice to know a better answer.", "output": "According to the encoding/xml.Marshal documentation:\n\nThe name for the XML elements is taken from, in order of preference:\n\nthe tag on the XMLName field, if the data is a struct\nthe value of the XMLName field of type xml.Name\nthe tag of the struct field used to obtain the data\nthe name of the struct field used to obtain the data\nthe name of the marshalled type\n\n\nYou can use a tag on the XMLName field in the struct to override the person struct's XML tag name. In order to avoid putting it in your actual person struct, you can create an anonymous struct that embeds the person struct you are marshaling.\npackage main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\ntype person struct {\n    Name        string\n    Starsign    string\n}\n\nfunc marshalPerson(p person) ([]byte, error) {\n    tmp := struct {\n        person\n        XMLName struct{}    `xml:\"Person\"`\n    }{person: p}\n\n    return xml.MarshalIndent(tmp, \"\", \"   \")\n}\n\nfunc main() {\n    p := person{\"John Smith\", \"Capricorn\"}\n    b, _ := marshalPerson(p)\n    fmt.Println(string(b))\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: how to get the result of template-rendering\n\nQuestion:\nI'm quite new in golang.\nHere is my problem: I want to get the string result of a template.Execute, and I don't want to execute it directly to a http.ResponsWriter\nHere is my code and it does not seem to work well\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"template\"\n)\n\ntype ByteSlice []byte\n\nfunc (p *ByteSlice) Write(data []byte) (lenght int, err os.Error) {\n    *p = data\n    return len(data), nil\n}\n\nfunc main() {\n    page := map[string]string{\"Title\": \"Test Text\"}\n    tpl, _ := template.ParseFile(\"test.html\")\n    var b ByteSlice\n    tpl.Execute(&b, &page)\n    fmt.Printf(`\"html\":%s`, b)\n}\n\nAnd the text.html:\n<html>\n<body>\n    <h1>{{.Title|html}}</h1>\n</body>\n</html>\n\nBut what I got is \n\"html\":</h1>\n</body>\n</html>", "output": "ByteSlice's Write method is buggy. It should append the new data to what's already been written, but your version replaces the already written data. It's likely that the template code calls Write more than once, so you only end up printing the last thing that was written.\nInstead of creating ByteSlice, use bytes.Buffer."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to create a case insensitive map in Go?\n\nQuestion:\nI want to have a key insensitive string as key. \nIs it supported by the language or do I have to create it myself?\nthank you\nEdit: What I am looking for is a way to make it by default instead of having to remember to convert the keys every time I use the map.", "output": "Edit:  My initial code actually still allowed map syntax and thus allowed the methods to be bypassed.  This version is safer.\nYou can \"derive\" a type.  In Go we just say declare.  Then you define methods on your type.  It just takes a very thin wrapper to provide the functionality you want.  Note though, that you must call get and set with ordinary method call syntax.  There is no way to keep the index syntax or optional ok result that built in maps have.\npackage main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\ntype ciMap struct {\n    m map[string]bool\n}\n\nfunc newCiMap() ciMap {\n    return ciMap{m: make(map[string]bool)}\n}\n\nfunc (m ciMap) set(s string, b bool) {\n    m.m[strings.ToLower(s)] = b\n}\n\nfunc (m ciMap) get(s string) (b, ok bool) {\n    b, ok = m.m[strings.ToLower(s)]\n    return\n}\n\nfunc main() {\n    m := newCiMap()\n    m.set(\"key1\", true)\n    m.set(\"kEy1\", false)\n    k := \"keY1\"\n    b, _ := m.get(k)\n    fmt.Println(k, \"value is\", b)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Split string using regular expression in Go\n\nQuestion:\nI'm trying to find a good way to split a string using a regular expression instead of a string. Thanks\nhttp://nsf.github.io/go/strings.html?f:Split!", "output": "If you just want to split on certain characters, you can use strings.FieldsFunc, otherwise I'd go with regexp.FindAllString."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why \"go build\" cannot find package?\n\nQuestion:\nI installed a test0 package to $gopath\\pkg\\windows_386\\hello\\test0.a, but when i build a main package which depends on the test0 package, the compiler says: import \"hello/test0\": cannot find package.  \nwhy this happens?\nI have two go file:\n$gopath/src/hello.go\npackage main\n\nimport (\n    \"fmt\"\n    \"hello/test0\"\n)\n\nfunc main() {\n    fmt.Println(test0.Number)\n}\n\n$gopath/src/hello/test0/test0.go\npackage test0\n\nconst (\n    Number int = 255\n)\n\nAt first,  i run go install hello/test0, and it generated $gopath\\pkg\\windows_386\\hello\\test0.a\nthen, i delete the directory $gopath/src/hello\nfinally, i run go build hello.go, and the compiler sayed hello.go:5:2: import \"hello/test0\": cannot find package", "output": "That doesn't seem to be normally possible for the moment : https://code.google.com/p/go/issues/detail?id=2775\nMaybe for Go1.1\nA trick (that I didn't test) by Dave :\n\nFor a package called \"hello\", the go tool will look for .go sources in\n  $GOPATH/src/hello, and only rebuild if the timestamp of the .a file is\n  before the latest timestamp of the .go files. An easy way to fool it\n  into accepting just the .a file is to drop a dummy .go file in the\n  correct src directory and set its timestamp to before that of the .a\n  file.\n\n(this is a community answer, using what is said on golang-nuts)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go + Appengine Blobstore, resize image uploads\n\nQuestion:\nI'm trying to get my head around Go + Appengine. I have been using Blobstore to store users image uploads. Is there anyway I can download the image from the BlobStore and manipulate it?\nOr is there another solution?\nThe image lib is a bit limited. I would also like to convert others formats to jpeg.", "output": "Yes, you can pull a file out of the blobstore and take advantage of the image packages that are included with Go 1, including image/draw and image/jpeg. See The Go image package for an overview and the image/draw blog post. Assuming you already have the BlobInfo for an image you want to manipulate, you can get its raw data by passing the embedded BlobKey to blobstore.NewReader, giving you an io.Reader object. Pass that to e.g. png.Decode to get an image.Image. Do whatever manipulations you like, then to save it back to blobstore, get a Writer from blobstore.Create and hand it to jpeg.Encode. Finally call blobstore.Close and .Key to get a new BlobKey to save in the datastore.\nIf you want to do even more complex manipulations, there are several pure-Go libraries that you can upload with your app and use with image.Image. See for instance graphics-go and the \"Images and Graphics\" section of Libraries Written in Go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Relative import from parent directory\n\nQuestion:\nHow does one do a relative import from a parent directory?\nFrom meme/cmd/meme:\nimport \"../../../meme\"\n\nThis gives an ambiguous error:\nmatt@stanley:~/gopath/src/bitbucket.org/anacrolix/meme/cmd/meme$ go get bitbucket.org/anacrolix/meme/cmd/meme\n\ncan't load package: /home/matt/gopath/src/bitbucket.org/anacrolix/meme/cmd/meme/main.go:8:2: local import \"../../../meme\" in non-local package\n\nmatt@stanley:~/gopath/src/bitbucket.org/anacrolix/meme/cmd/meme$ echo $GOPATH\n\n/home/matt/gopath\n\nHow do I import locally from a parent directory?", "output": "Thanks for adding to your question.  First, an answer, then some explanation.  I built your code by,\n\ngo get, just as you had it.  (I ignored the error messages.)\nsetting the import line in main.go back to \"../../../meme\", as you wanted to do.\n(commenting out a little bit of code containing an unused variable.)\nthen in the meme/cmd/meme directory, either go run main.go or go build main.go worked.\n\nI was wrong in my comment earlier when I said go install works; I should have said go build.\nThe key however is that go build alone does not work; you must type go build main.go.  This is because the go command does not allow \"local imports in non-local packages.\"  You are right that spec is of little help here.  It weasels out saying, \"The interpretation of the ImportPath is implementation-dependent.\"  The current implementation behavior was set with CL 5787055, which was subsequently debated at length on Go-nuts.\n\"Local\" means indicated with a file system relative path.  Obviously a relative path starting with .. is local, so the trick is just getting the go command to treat main as a local package as well.  It apparently doesn't do this when you type go build, but does when you type go build main.go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why isn't fallthrough allowed in a type switch?\n\nQuestion:\nI'm wondering why fallthrough isn't allowed in a type switch statement in golang.\nAccording to the specification: \"The \"fallthrough\" statement is not permitted in a type switch.\", which doesn't explain much about WHY it isn't allowed.\nThe code attached is to simulate a possible scenario were a fallthrough in a type switch statement might have been useful.\nNotice! This code doesn't work, it will produce the error: \"cannot fallthrough in type switch\". I'm just wondering what possible reasons might have been for not allowing the fallthrough statement in a type switch.\n//A type switch question\npackage main\n\nimport \"fmt\"\n\n//Why isn't fallthrough in type switch allowed?\nfunc main() {\n    //Empty interface\n    var x interface{}\n\n    x = //A int, float64, bool or string value\n\n    switch i := x.(type) {\n    case int:\n        fmt.Println(i + 1)\n    case float64:\n        fmt.Println(i + 2.0)\n    case bool:\n        fallthrough\n    case string:\n        fmt.Printf(\"%v\", i)\n    default:\n        fmt.Println(\"Unknown type. Sorry!\")\n    }\n}", "output": "How would you expect fallthrough to work? In this type switch, the i variable has a type that depends on the particular case that's invoked. So in the case bool the i variable is typed as bool. But in case string it's typed as string. So either you're asking for i to magically morph its type, which isn't possible, or you're asking for it to be shadowed by a new variable i string, which will have no value because its value comes from x which is not, in fact, a string.\n\nHere's an example to try and illustrate the problem:\nswitch i := x.(type) {\ncase int:\n    // i is an int\n    fmt.Printf(\"%T\\n\", i); // prints \"int\"\ncase bool:\n    // i is a bool\n    fmt.Printf(\"%T\\n\", i); // prints \"bool\"\n    fallthrough\ncase string:\n    fmt.Printf(\"%T\\n\", i);\n    // What does that type? It should type \"string\", but if\n    // the type was bool and we hit the fallthrough, what would it do then?\n}\n\nThe only possible solution would be to make the fallthrough cause the subsequent case expression to leave i as an interface{}, but that would be a confusing and bad definition.\nIf you really need this behavior you can already accomplish this with the existing functionality:\nswitch i := x.(type) {\ncase bool, string:\n    if b, ok := i.(bool); ok {\n        // b is a bool\n    }\n    // i is an interface{} that contains either a bool or a string\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can GO be used as a scripting engine within an application?\n\nQuestion:\nCan GO be used as a scripting language within an application ? I can't find any informations about this: is there a dynamic link library version which could be interfaced from a Windows application with some standard methods such as Compile(), Execute and features such as callbacks, variables sharing etc ?", "output": "This might sound strange at first but go with me on this: I think it would be a perfect candidate for a scripting language because it's compile time is so fast....hear me out...\nMost scripting languages are interpreted, and so they do not require (or even provide in some cases) compilation. However compiled languages are safer in general because they can catch certain errors at compile time, which is better than, for example, catching a syntax error at runtime.\nWith Go, the compile time is so speedy that whatever program is running your Go code (e.g. a web server) could hypothetically compile the code on-demand if the code has changed, and otherwise use the compiled version. \nActually if you check out Google App Engine and download their dev web server for Go (https://developers.google.com/appengine/) you'll notice that their web server does exactly this. If you run through their Hello World tutorial for Go you'll notice that if you make changes to your code you won't need to recompile the Go code in order for the changes to take affect."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: init function for structs\n\nQuestion:\nI realize that Go does not have classes but pushes the idea of structs instead.\nDo structs have any sort of initialization function that can be called similar to a __construct() function of a class?\nExample:\ntype Console struct {\n    X int\n    Y int\n}\n\nfunc (c *Console) init() {\n    c.X = \"5\"\n}\n\n// Here I want my init function to run\nvar console Console\n\n// or here if I used\nvar console Console = new(Console)", "output": "Go doesn't have implicit constructors. You would likely write something like this.\npackage main\n\nimport \"fmt\"\n\ntype Console struct {\n    X int\n    Y int\n}\n\nfunc NewConsole() *Console {\n    return &Console{X: 5}\n}\n\nvar console Console = *NewConsole()\n\nfunc main() {\n    fmt.Println(console)\n}\n\nOutput:\n{5 0}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to disable a log.Logger\n\nQuestion:\nI have some heavily instrumented code that makes use of the log package. Now it's come time to turn off the logging, and I can't determine how to turn off the standard logger.\nHave I missed something? Should I be checking a flag before making log calls, or commenting them out in production?", "output": "For completely disabling logs, it's actually better to call log.SetFlags(0)Joril and set the output to a no-op io.Writer (i.e., log.SetOutput(ioutil.Discard))\nBut even after this, the operations will idle around 500-600 ns/op1\nThis can still be cut short (to around 100 ns/op) by using a custom Logger implementation, and implementing all the functions to be no-op -- as demonstrated here (only overriding Println for bervity).\nThe alternative to all these is to use a custom logging framework with levels and set it to complete OFF.\nNote though, one of the commonly used library for logging (logrus) has performance implications -- the same can be found in the benchmarks where it perform with 3K+ ns/op, regardless.\nBiased opinion: from the benchmarks, the library go-logging performs in par with the custom Logger implementation when setting the Level to -1, regardless of the backend and formatting\n(the benchmark source can be found here)\nthe output of the benchmark is as follows:\ntesting: warning: no tests to run\nPASS\nBenchmarkGoLogging-4                                             1000000          2068 ns/op\nBenchmarkGoLoggingNullBackend-4                                  5000000           308 ns/op\nBenchmarkGoLoggingNullBackendWithFancyFormatter-4                3000000           435 ns/op\nBenchmarkGoLoggingOffLevel-4                                    20000000           109 ns/op\nBenchmarkGoLoggingNullBackendAndOffLevel-4                      20000000           108 ns/op\nBenchmarkGoLoggingNullBackendWithFancyFormatterAndOffLevel-4    20000000           109 ns/op\nBenchmarkLog15-4                                                  200000          7359 ns/op\nBenchmarkLog15WithDiscardHandler-4                               2000000           922 ns/op\nBenchmarkLog15WithDiscardHandlerAndOffLevel-4                    2000000           926 ns/op\nBenchmarkLog15WithNopLogger-4                                   20000000           108 ns/op\nBenchmarkLog15WithNopLoggerDiscardHandlerA-4                    20000000           112 ns/op\nBenchmarkLog15WithNopLoggerAndDiscardHandlerAndOffLevel-4       20000000           112 ns/op\nBenchmarkLog-4                                                   1000000          1217 ns/op\nBenchmarkLogIoDiscardWriter-4                                    2000000           724 ns/op\nBenchmarkLogIoDiscardWriterWithoutFlags-4                        3000000           543 ns/op\nBenchmarkLogCustomNullWriter-4                                   2000000           731 ns/op\nBenchmarkLogCustomNullWriterWithoutFlags-4                       3000000           549 ns/op\nBenchmarkNopLogger-4                                            20000000           113 ns/op\nBenchmarkNopLoggerWithoutFlags-4                                20000000           112 ns/op\nBenchmarkLogrus-4                                                 300000          3832 ns/op\nBenchmarkLogrusWithDiscardWriter-4                                500000          3032 ns/op\nBenchmarkLogrusWithNullFormatter-4                                500000          3814 ns/op\nBenchmarkLogrusWithPanicLevel-4                                   500000          3872 ns/op\nBenchmarkLogrusWithDiscardWriterAndPanicLevel-4                   500000          3085 ns/op\nBenchmarkLogrusWithDiscardWriterAndNullFormatterAndPanicLevel-4   500000          3064 ns/op\nok      log-benchmarks  51.378s\ngo test -bench .  62.17s user 3.90s system 126% cpu 52.065 total\n\n#1: YMMV, tested on i7-4500U CPU @ 1.80GHz"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Parsing a Matrix from a File in Go\n\nQuestion:\nI'm having a file with the following contents:\n 1  2  3  4  5\n 6  0  0  0  7\n 8  0  0  0  9\n10  0  0  0 11\n12 13 14 15 16\n\nWhat I want is an multidimensional array (or slice) of [][]int. I tried to fiddle around with the scanner.Scanner library:\nscan.Init(f) // f is a file\nscan.Whitespace = 1<<'\\t' | 1<<'\\r' | 1<<' '\ntok := scan.Scan()\nfor tok != scanner.EOF {\n    // do something with tok\n    if tok == scanner.String {\n        fmt.Print(\"\\n\")\n    } else if tok == scanner.Int {\n        // Handle int value\n        // How do I get the matched token value?\n    }       \n\n    tok = scan.Scan()\n}\n\nI can't find a way to get the value of the token that was matched.\nSo two questions:\n\nHow do I get the value of any scanned token?\nHow can I dynamically create that two-dimensional slice/array before knowing it's exact size? (can be any size really)", "output": "I wouldn't use the scanner package (which is suited to parse context free grammars, similar to the Go language) for such a simple task of reading numbers from a file. I would either use:\n\na simple loop and fmt.Fscan, or\nioutil.ReadFile, strings.Split and strconv.Atoi\n\n\nHow can I dynamically create that two-dimensional slice/array before knowing it's exact size? (can be any size really)\n\nYou can't. Either read the file twice to know the exact size on your 2nd pass, or just use append to dynamically resize the underlying array of the slice. Calling append() multiple times also results in an amortized O(n) behavior, so that shouldn't be a problem."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Golang GAE - Federated Login examples\n\nQuestion:\nI'm trying to implement Federated Login using Google App Engine Go SDK, but the only examples I can find on the subject are about how to do this in Python and Java. I understand that I need to call this function to get the URL, but I'm not sure about the parameters to pass. Can someone provide examples of Federated Login in GAE Golang for a few major platforms (Facebook, Twitter, etc)?", "output": "Facebook and Twitter don't use OpenID for authentication. \nFacebook uses OAuth 2 - You'll need to use goauth2 to authenticate.\nTwitter uses: OAuth. You'll need to use goauth to authenticate.\nThat said if you are still wanting to use Federated Login for providers like Yahoo, Google, MySpace it would look like this:\nc := appengine.NewContext(r)\n// url is the OpenID url other possiblities include:\n//   - yahoo.com\n//   - myspace.com\n//   - aol.com\n//   - flickr.com/USERNAME\nurl := \"gmail.com\"\n// redirectURL is where you want the User to be redirected to after login.\nredirectURL := \"/callback\"\nloginUrl, err := user.LoginURLFederated(c, redirectURL, url)\n// Then redirect the user to the url.\nhttp.Redirect(w, r, loginUrl, http.StatusFound)\n\nFor Facebook and Twitter authentication you might look at the go.auth package. It might not work with App Engine but it might give you some clues.\nI'm also working on a solution to this problem in the HAL/auth package, but as of now it's incomplete. Here's how HAL handles app engine openid."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Strange type definition syntax in Golang (name, then type, then string literal)\n\nQuestion:\nI've been trying to find out how to use mgo (MongoDB driver for Go) and I came across this struct declaration:\ntype Something struct {\n    Id bson.ObjectId \"_id,omitempty\"\n    Name string\n}\n\nI don't quite understand the syntax of the first element (Id).  I understand that it's being declared as type bson.ObjectId, but what is the string literal doing there?\nMy question is not about the mgo driver functionality,\nbut about this strange <name> <type> <string_literal> syntax.\nI couldn't find anything on the Go specs, and I don't know how to google this either.", "output": "It's explained in the Struct types section of the language specification:\n\nA field declaration may be followed by an optional string literal\n  tag, which becomes an attribute for all the fields in the corresponding field declaration. The tags are made visible through a\n  reflection interface but are otherwise ignored.\n\n// A struct corresponding to the TimeStamp protocol buffer.\n// The tag strings define the protocol buffer field numbers.\nstruct {\n    microsec  uint64 \"field 1\"\n    serverIP6 uint64 \"field 2\"\n    process   string \"field 3\"\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Initialization method for slice type fails to initialize\n\nQuestion:\nI try to implement an initialization method for my own type. However after calling the method the variable is unchanged in main(). I probably haven't fully understood how slices work, here is my example code\npackage main\nimport \"fmt\"\n\ntype test [][]float64\n\nfunc (p *test) init(m, n int){\n    tmp := *p\n    tmp = make(test, m)\n    for i := 0; i < m; i++ {\n        tmp[i] = make([]float64, n)\n    }\n}\n\nfunc main(){\n    var t test\n    t.init(10,2)\n    fmt.Println(t)\n}\n\nI was under the impression that the content of the receiver type * can be changed, but this doesn't seem to be the case for slices. So how do I properly bind my initialization function to my type? I am pretty sure that there is an misunderstanding on my side....\nI tried several things like\nvar t *test = new(test)\n\nor \nfunc (p *test) init(m, n int){\n    tmp := *p\n    tmp = append(tmp, make(test, m)...)\n    for i := 0; i < m; i++ {\n        tmp[i] = append(tmp[i], make([]float64, n)...)\n    }\n}\n\nand so on but all failed..\nThe only working solution I currently know of is a unbound method which returns the pointer to a fresh slice. This will do for now, but I want to make this a prerequisite in an interface. So how can I bind it?", "output": "func (p *test) init(m, n int){\n    tmp = make(test, m)\n    for i := 0; i < m; i++ {\n        tmp[i] = make([]float64, n)\n    }\n    *p = tmp\n}\n\nYou were close.  The above does what you want.  But there's no reason to avoid a function that returns a fresh slice.  That's idiomatic and feels much like writing a constructor in other languages:\nfunc newTest(m, n int) test {\n    t = make(test, m)\n    for i := range t {\n        t[i] = make([]float64, n)\n    }\n    return t\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to implement interface method with return type is an interface in Golang\n\nQuestion:\nHere is my code:\ntype IA interface {\n    FB() IB\n}\n\ntype IB interface {\n    Bar() string\n}\n\ntype A struct {\n    b *B\n}\n\nfunc (a *A) FB() *B {\n    return a.b\n}\n\ntype B struct{}\n\nfunc (b *B) Bar() string {\n    return \"Bar!\"\n}\n\nI get an error:\ncannot use a (type *A) as type IA in function argument:\n    *A does not implement IA (wrong type for FB method)\n        have FB() *B\n        want FB() IB\n\nHere is the full code: http://play.golang.org/p/udhsZgW3W2\nI should edit the IA interface or modifi my A struct?\nWhat if I define IA, IB in a other package (so I can share these interface), I must import my package and use the IB as returned type of A.FB(), is it right?", "output": "Just change \nfunc (a *A) FB() *B {\n    return a.b\n}\n\ninto\nfunc (a *A) FB() IB {\n    return a.b\n}\n\nSurely IB can be defined in another package. So if both interfaces are defined in package foo and the implementations are in package bar, then the declaration is\ntype IA interface {\n    FB() IB\n}\n\nwhile the implementation is\nfunc (a *A) FB() foo.IB {\n    return a.b\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: bytes.Split separator as []byte(\"...\")\n\nQuestion:\nIn bytes_test.go I see:\n a := Split([]byte(tt.s), []byte(tt.sep), tt.n)\n\nwhere tt.s and tt.sep are strings. But when I try to do \n a := bytes.Split([]byte(\"test\"), []byte(\"e\"), 0)\n\nI get: \n cannot convert \"test\" (type ideal string) to type []uint8 in conversion\n cannot convert \"e\" (type ideal string) to type []uint8 in conversion", "output": "The following is valid code using the latest release -- release.2010-03-04 -- which includes, amongst other things, this change: \"There is one language change: the ability to convert a string to []byte or []int.  This deprecates the strings.Bytes and strings.Runes functions.\"\npackage main\n\nimport (\"bytes\"; \"fmt\")\n\nfunc main() {\n    a := bytes.Split([]byte(\"test\"), []byte(\"e\"), 0)\n    fmt.Println(a)\n}\n\nUpdate to a current release of Go: Installing Go : Keeping up with releases."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Appending items to a variadic function wrapper without reallocating a new slice\n\nQuestion:\nOk I need a small wrapper of fmt.Printf() for debugging conveniance :\n1/ \"too many arguments in call to fmt.Fprintln\" :\nfunc Debug (a ... interface{}) {\n    if debug {\n        fmt.Fprintln(out, prefix, sep, a...)\n    }\n}\n\n2/ \"name list not allowed in interface type\" :\nfunc Debug (a ... interface{}) {\n    if debug {\n        fmt.Fprintln(out, []interface{prefix, sep, a...}...)\n    }\n}\n\n3/ Works, but feels wrong :\nfunc Debug (a ... interface{}) {\n    if debug {\n        sl := make ([]interface{}, len(a) + 2)\n        sl[0] = prefix\n        sl[1] = sep\n        for i, v := range a {\n            sl[2+i] = v\n        }\n\n        fmt.Fprintln(out, sl...)\n    }\n}\n\nAny ideas to avoid allocating extra memory ?", "output": "I would just do two prints:\nfunc Debug(a ...interface{}) {\n    if debug {\n        fmt.Fprint(out, prefix, sep)\n        fmt.Fprintln(out, a...)\n    }\n}\n\nIf you believed you needed to make a single call to Fprint, you could do,\nfunc Debug(a ...interface{}) {\n    if debug {\n        fmt.Fprint(out, prefix, sep, fmt.Sprintln(a...))\n    }\n}\n\nEither way seems simpler that building a new slice."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Embedding instead of inheritance in Go\n\nQuestion:\nWhat is your opinion of this design decision? What advantages does it have and what disadvantages?\nLinks:\n\nEmbedding description", "output": "In a comment, you wondered if the embedding idea was enough to \"replace inheritance completely\".  I would say the answer to that question is \"yes\".  A few years ago I played very briefly with a Tcl OO system called Snit, which used composition and delegation to the exclusion of inheritance.  Snit is still vastly different from Go's approach, but in that one respect they have some common philosophical ground.  It's a mechanism for joining together pieces of functionality and responsibility, not a hierarchy for the classes.\nAs others have stated, it's really about what kind of programming practices the language designers want to support.  All such choices come with their own pros and cons; I don't think \"best practices\" is a phrase that necessarily applies here.  We will probably see someone develop an inheritance layer for Go eventually.  \n(For any readers familiar with Tcl, I felt Snit to be a slightly closer match to the \"feel\" of the language than [incr Tcl] was.  Tcl is all about the delegation, at least to my way of thinking.)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google TV Pairing Protocol -- SSL Handshake Error with Go (golang)\n\nQuestion:\nI'm writing a Go package for the Google TV Pairing Protocol. But I seem to be hitting a problem with the TLS handshake.\nsock, err := tls.Dial(\"tcp\", \"10.8.0.1:9552\", &tls.Config{InsecureSkipVerify: true})\n\nThat line gives me a handshake error. The exact error message is: remote error: handshake failure. If I try the same host/port via curl, it gives curl: (35) error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake failure as well.\nAny ideas? Is the Google TV expecting a client cert maybe? I haven't seen any references to the need for a client cert anywhere.\nIf anyone wants to help figure it out, here's the code:\nhttps://github.com/dustywilson/go-polo\nThe README file has the easy code to check it out. You will have to know the IP address for your Google TV box since this doesn't use mDNS. If you (someone, anyone) run this and you get different results, let me know.\nI've already gone through the Google TV Remote code at google-tv-remote. A more useful one is google-tv-pairing-protocol which is the equivalent Java/Android project to what I'm doing. Of course I've already poured over that code. I think it's a problem either with Go itself (unlikely), a problem with the Go TLS package not knowing how to read the Google TV's certificate (I know it was a problem a year ago), or a problem with my code (typically would be most likely, but I'm just not seeing it).\nBy the way, I'm testing this on a Logitech Revue and it has a self-signed SSL certificate.  It's not rooted or modified in any way.\nMy resulting code will be open source, of course.  Thanks for the assistance.", "output": "Client certs are generated by the Java remote client at runtime, and stored for future use.  Check out the code at:\nhttp://code.google.com/p/google-tv-remote/source/browse/src/com/google/android/apps/tvremote/KeyStoreManager.java\nYou might be running into an invalid cert.  According to the code, you need a specific CN.\n/* Returns the name that should be used in a new certificate.\n * The format is: \"CN=anymote/PRODUCT/DEVICE/MODEL/unique identifier\"\n */"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the purpose of a method that returns the receiver itself (Go)?\n\nQuestion:\nThis function in pkg go/token makes me wonder why we need a method that returns the receiver itself. \n// Token source positions are represented by a Position value.\n// A Position is valid if the line number is > 0.\n//\ntype Position struct {\n    Filename string; // filename, if any\n    Offset   int;    // byte offset, starting at 0\n    Line     int;    // line number, starting at 1\n    Column   int;    // column number, starting at 1 (character count)\n}\n\n\n// Pos is an accessor method for anonymous Position fields.\n// It returns its receiver.\n//\nfunc (pos *Position) Pos() Position { return *pos }", "output": "This is for the case where you are using anonymous fields to \"subclass\" the Position:\n\nA field declared with a type but no explicit field name is an anonymous field. Such a field type must be specified as a type name T or as a pointer to a type name *T, and T itself may not be a pointer type. The unqualified type name acts as the field name. \n\nSo if you subclass Position in this way, it may be desirable for callers to be able to access the \"parent\" Position structure (ex: if you want to call String() on the position itself, as opposed to the subtype). Pos() returns it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: ctag database for Go\n\nQuestion:\nHow to generate tags file for Go source\nIn mac, I installed exuberant ctags , and tried the below command in source directory\nctags -f gosource.tags -R `pwd`\n\nBut, it doesn't consider *.go files. Do I have to use -h option? But, isn't it only for header files, as per the manual?\nPlease give me the correct command so that I can use the tags file with vim. I also prefer absolute path so that I can keep the file anywhere\nThanks.\nEdit:\nI assumed current ctags support Go, seeing http://groups.google.com/group/golang-nuts/browse_thread/thread/3a4848db231b02c9.\nbut, http://ctags.sourceforge.net/languages.html  desn't have go listed.", "output": "Add the following to ~/.ctags\n--langdef=Go\n--langmap=Go:.go\n--regex-Go=/func([ \\t]+\\([^)]+\\))?[ \\t]+([a-zA-Z0-9_]+)/\\2/d,func/\n--regex-Go=/var[ \\t]+([a-zA-Z_][a-zA-Z0-9_]+)/\\1/d,var/\n--regex-Go=/type[ \\t]+([a-zA-Z_][a-zA-Z0-9_]+)/\\1/d,type/\n\n(From http://go-wise.blogspot.com/2011/09/using-ctags-with-go.html)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Using a string slice that is to be filled at runtime\n\nQuestion:\nI feel a little silly as this should be an easy one, however I just started with go and can't figure it out.\npackage main\n\nimport \"fmt\"\n\ntype Question struct {\n q []string\n a []string\n}\nfunc (item *Question) Add(q string, a string) {\n n := len(item.q)\n item.q[n] := q\n item.a[n] := a\n}\n\nfunc main() {\n var q Question\n q.Add(\"A?\", \"B.\")\n}\nWhen Compiling it gives the errors:\nq.go:11:12: error: expected ';' or '}' or newline\nq.go:12:12: error: expected ';' or '}' or newline\nthat refers to the opening brace of item.q[n] := q and the following line.\nI'm certain that I'm using slices incorrectly as it works fine with a simple string instead, but I'm not sure how to fix it.\nedit: I have re-implemented it using StringVectors as per Pat Notz's advice and it works well. The following is the working code:\npackage main\n\nimport (\n    fmt \"fmt\"\n    vector \"container/vector\"\n)\n\ntype Question struct {\n    q vector.StringVector\n    a vector.StringVector\n}\nfunc (item *Question) Add(q string, a string) {\n    item.q.Push(q)\n    item.a.Push(a)\n}\nfunc (item *Question) Print(index int) {\n    if index >= item.q.Len() {\n        return\n    }\n    fmt.Printf(\"Question: %s\\nAnswer: %s\\n\", item.q.At(index), item.a.At(index))\n}\nfunc main() {\n    var q Question\n    q.Add(\"A?\", \"B.\")\n    q.Print(0)\n}", "output": "You sidestepped the problems you were having using slices by delegating them to StringVector. I've revised your initial implementation, which used string slices, to become a valid, working program.\ntype Question struct {\n    q   []string\n    a   []string\n}\n\nThe type Question is a struct which has two elements, q and a, which are slices of an array of strings. A slice implicitly contains a pointer to the element of the array which begins the slice, the length of the slice, and the capacity of the slice.\nvar q Question\n\ndeclares q, allocating storage for the Question struct, and initializes the struct fields (slices q.q and q.a) to zero i.e. the slice pointers are nil, and the slice len() and cap() functions return zero. No storage is allocated for string arrays; we need to do that separately.\npackage main\n\nimport \"fmt\"\n\ntype Question struct {\n    q   []string\n    a   []string\n}\n\nfunc addString(ss []string, s string) []string {\n    if len(ss)+1 > cap(ss) {\n        t := make([]string, len(ss), len(ss)+1)\n        copy(t, ss)\n        ss = t\n    }\n    ss = ss[0 : len(ss)+1]\n    ss[len(ss)-1] = s\n    return ss\n}\n\nfunc (item *Question) Add(q string, a string) {\n    item.q = addString(item.q, q)\n    item.a = addString(item.a, a)\n}\n\nfunc main() {\n    var q Question\n    q.Add(\"A?\", \"B.\")\n    fmt.Println(\"Q&A\", q)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Lowercase JSON key names with JSON Marshal in Go\n\nQuestion:\nI wish to use the \"encoding/json\" package to marshal a struct declared in one of the imported packages of my application.\nEg.:\ntype T struct {\n    Foo int\n}\n\nBecause it is imported, all available (exported) fields in the struct begins with an upper case letter. But I wish to have lower case key names:\nout, err := json.Marshal(&T{Foo: 42})\n\nwill result in\n\n{\"Foo\":42}\n\nbut I wish to get\n\n{\"foo\":42}\n\nIs it possible to get around the problem in some easy way?", "output": "Have a look at the docs for encoding/json.Marshal.\nIt discusses using struct field tags to determine how the generated json is formatted.\nFor example:\ntype T struct {\n    FieldA int    `json:\"field_a\"`\n    FieldB string `json:\"field_b,omitempty\"`\n}\n\nThis will generate JSON as follows:\n{\n    \"field_a\": 1234,\n    \"field_b\": \"foobar\"\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Golang, GAE, redirect user?\n\nQuestion:\nHow can I redirect a page request in Go running on GAE, so that the user's address would display correctly without resorting to displaying a redirection page? For example, if user would type:\nwww.hello.com/1\n\nI'd want my Go application to redirect the user to:\nwww.hello.com/one\n\nWithout resorting to:\nfmt.Fprintf(w, \"<HEAD><meta HTTP-EQUIV=\\\"REFRESH\\\" content=\\\"0; url=/one\\\"></HEAD>\")", "output": "For a one-off:\nfunc oneHandler(w http.ResponseWriter, r *http.Request) {\n  http.Redirect(w, r, \"/one\", http.StatusMovedPermanently)\n}\n\nIf this happens a few times, you can create a redirect handler instead:\nfunc redirectHandler(path string) func(http.ResponseWriter, *http.Request) { \n  return func (w http.ResponseWriter, r *http.Request) {\n    http.Redirect(w, r, path, http.StatusMovedPermanently)\n  }\n}\n\nand use it like this:\nfunc init() {\n  http.HandleFunc(\"/one\", oneHandler)\n  http.HandleFunc(\"/1\", redirectHandler(\"/one\"))\n  http.HandleFunc(\"/two\", twoHandler)\n  http.HandleFunc(\"/2\", redirectHandler(\"/two\"))\n  //etc.\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE Golang - log.Print()?\n\nQuestion:\nWhere can one read logs created by calling function:\nlog.Print(\"Message\")\n\nThe tab \"Logs\" under Main seems to only display information about what URLs were called, but without any debug information that would be displayed by the application.", "output": "As described in the documentation, you should use the Context interface to log instead of log, if you want your logs to show up in the console.\nc := appengine.NewContext(r)\nc.Infof(\"Requested URL: %v\", r.URL)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go - time - milliseconds\n\nQuestion:\nI need the time in milliseconds for what could be a large volume of transactions, so I want something that is correct, and fast. Will the following work and do the job best? :\n\n    iMilli  := int((time.Nanoseconds() % 1e6) / 1e3)\n\nTIA", "output": "EDIT: Since this answer was first written, escape analysis code has been added to the Go compilers.  This allows the compiler to avoid unnecessary allocations in certain situations, including (probably) the one described below.  With the latest weeklies, therefore, it may be just as good to use a more straightforward call to time.Nanoseconds(). Please do your own profiling.\nMost of the time functions cause a heap allocation (that then subsequently needs to be collected, causing a pause in your application).  So if you're looking up the time frequently, which it sounds like you are, you'll need to use syscall.Gettimeofday() directly (it's the function that the other time functions end up calling anyway).  See the discussion here for more information:\nhttp://groups.google.com/group/golang-nuts/browse_thread/thread/f2209022f43efcca?pli=1\nThe solution I'm using is to pre-allocate a tv syscall.Timeval, and each time through my inner loop I do this:\nsyscall.Gettimeofday(&tv)\n\nYou can then get the milliseconds with:\n(int64(tv.Sec)*1e3 + int64(tv.Usec)/1e3)\n\nI've found this to perform a lot better than calling time.Nanoseconds() or one of the other higher-level time functions."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to chain operations in go using big package?\n\nQuestion:\nFor example, if I want to perform r = a * (b - c). I would do:\nvar r, a, b, c, t big.Int\n\nt.Sub(&b, &c)\nr.Mul(&a, &t)\n\nIn package documentation, it says that operations return result to allow chaining. But since the used variable isn't used as operator argument, but only to store result, how can I chain operations? In other words, how could I write my exemple using only one line of code, without temporary variable t?", "output": "For example, on Go 1,\npackage main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    var r, a, b, c big.Int\n    a = *big.NewInt(7)\n    b = *big.NewInt(42)\n    c = *big.NewInt(24)\n\n    // r = a * (b - c)\n    r.Mul(&a, r.Sub(&b, &c))\n\n    fmt.Println(r.String())\n}\n\nOutput:\n126"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go MinGW compiler complains about if-else statement\n\nQuestion:\nConsider the following (useless) Go function:\nfunc domagic(n int) int {\n    if n > 10 {\n        return n;\n    } else {\n        return 0;\n    }\n}\n\nThis gives me the following compiler error:\n\nmain.go:15: function ends without a return statement   \n\nHowever, if i return a value outside the if-else block (before the end of the function), it compiles without errors. \nIs this behavior by design, or is it something simply not yet implemented in the Go MinGW  compiler?", "output": "Simple googling for the exact compiler error message yields this bugtracker issue. So I'd not say it's \"by design\" as it looks more like \"it'd just happened to be implemented this way\".  See also this thread."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Are there any go libraries that provide associative array capability?\n\nQuestion:\nI'm looking for a go language capability similar to the \"dictionary\" in python to facilitate the conversion of some python code.\nEDIT: Maps worked quite well for this de-dupe application.  I was able to condense 1.3e6 duplicated items down to 2.5e5 unique items using a map with a 16 byte string index in just a few seconds.  The map-related code was simple so I've included it below.  Worth noting that pre-allocation of map with 1.3e6 elements sped it up by only a few percent:\nvar m = make(map[string]int, 1300000) // map with initial space for 1.3e6 elements\n\nct, ok := m[ax_hash]\nif ok {\n    m[ax_hash] = ct + 1\n} else {\n    m[ax_hash] = 1\n}", "output": "The map type. http://golang.org/doc/effective_go.html#maps\nThere is some difference from python in that the keys have to be typed, so you can't mix numeric and string keys (for some reason I forgot you can), but they're pretty easy to use.\ndict := make(map[string]string)\ndict[\"user\"] = \"so_user\"\ndict[\"pass\"] = \"l33t_pass1\""}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Byte slice manipulation\n\nQuestion:\nI'm writing a program that should parse and reply to network packets but I'm a bit annoyed because I can't do simple C style return (int)buffer[at]; with an array of bytes. Is there any better way to retrieve 4 bytes from byte[] as int32 than the following?\nfunc (packet *Packet) GetInt32(at int) int32 {\n    return int32(packet.buffer[at]) << 24 +\n        int32(packet.buffer[at+1]) << 16 +\n        int32(packet.buffer[at+2]) << 8 +\n        int32(packet.buffer[at+3])\n}\n\nIt works correctly but I was thinking if there was a better way to do this.", "output": "package main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n    \"math\"\n)\n\ntype Packet struct {\n    buffer []byte\n}\n\nfunc (p *Packet) Int32(i int) int32 {\n    return int32(binary.BigEndian.Uint32(p.buffer[i : i+4]))\n}\n\nfunc (p *Packet) Float32(i int) float32 {\n    return math.Float32frombits(binary.BigEndian.Uint32(p.buffer[i : i+4]))\n}\n\nfunc main() {\n    p := &Packet{buffer: []byte{0x01, 0x02, 0x00, 0x00, 0xFF, 0xFF, 0x07}}\n    fmt.Println(p.Int32(2), p.Float32(2))\n}\n\n\nOutput:  65535  9.1834e-41"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: If Go's interfaces aren't enforced, are they necessary?\n\nQuestion:\nThe Go language has interface types as features, analogous to C-style interfaces. Go's interface types, though, don't seem to be enforced -- they merely define protocol without actually being applied to a type. As they are not enforced, is it still a good idea to use interfaces?", "output": "Yes. Go doesn't allow you to build type-hierarchies, so interfaces are very important to allow some polymorphism. Consider the sort.Interface defined in the package sort: \ntype Interface interface {\n    // Len is the number of elements in the collection.\n    Len() int\n    // Less returns whether the element with index i should sort\n    // before the element with index j.\n    Less(i, j int) bool\n    // Swap swaps the elements with indexes i and j.\n    Swap(i, j int)\n}\n\nThe sort package contains a function sort(data Interface) that expects any object that implements this interface. Without interfaces, such form of polymorphism would not be possible in go. The fact that you don't have to explicitly annotate that your type implements this interface, is irrelevant.\nThe cool part about go is that you can even implement this interface on primitive types, as long as the type is defined in the same package. So the following code defines a sortable array of integers:\ntype Sequence []int\n\n// Methods required by sort.Interface.\nfunc (s Sequence) Len() int {\n    return len(s)\n}\nfunc (s Sequence) Less(i, j int) bool {\n    return s[i] < s[j]\n}\nfunc (s Sequence) Swap(i, j int) {\n    s[i], s[j] = s[j], s[i]\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: List of currently running process in Go\n\nQuestion:\nHow can I get the list of currently running processes in Go?\nThe OS package provides some functions: http://golang.org/pkg/os/\nbut doesn't give anything to see the list of running processes.", "output": "There is no such function in the standard library and most likely never will be.\nIn most cases, the list of processes isn't required by programs. Go programs usually want to wait for a single or a smaller number of processes, not for all processes. PIDs of processes are usually obtained by other means than searching the list of all processes.\nIf you are on Linux, the list of processes can be obtained by reading contents of /proc directory. See question Linux API to list running processes?"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Problems understanding usage of `interface{}` in Go\n\nQuestion:\nI'm trying to port an algorithm from Python to Go. The central part of it is a tree built using dicts, which should stay this way since each node can have an arbitrary number of children. All leaves are at the same level, so up the the lowest level the dicts contain other dicts, while the lowest level ones contain floats. Like this:\ntree = {}\ninsert(tree, ['a', 'b'], 1.0)\nprint tree['a']['b']\n\nSo while trying to port the code to Go while learning the language at the same time, this is what I started with to test the basic idea:\nfunc main() {\n    tree := make(map[string]interface{})\n    tree[\"a\"] = make(map[string]float32)\n    tree[\"a\"].(map[string]float32)[\"b\"] = 1.0\n    fmt.Println(tree[\"a\"].(map[string]float32)[\"b\"])\n}\n\nThis works as expected, so the next step was to turn this into a routine that would take a \"tree\", a path, and a value. I chose the recursive approach and came up with this:\nfunc insert(tree map[string]interface{}, path []string, value float32) {\n    node := path[0]\n    l := len(path)\n    switch {\n    case l > 1:\n        if _, ok := tree[node]; !ok {\n            if l > 2 {\n                tree[node] = make(map[string]interface{})\n            } else {\n                tree[node] = make(map[string]float32)\n            }\n        }\n        insert(tree[node], path[1:], value) //recursion\n    case l == 1:\n        leaf := tree\n        leaf[node] = value\n    }\n}\n\nThis is how I imagine the routine should be structured, but I can't get the line marked with \"recursion\" to work. There is either a compiler error, or a runtime error if I try to perform a type assertion on tree[node]. What would be the correct way to do this?", "output": "Go is perhaps not the ideal solution for generic data structures like this. The type assertions make it possible, but manipulating data in it requires more work that you are used to from python and other scripting languages.\nAbout your specific issue: You are missing a type assertion in the insert() call. The value  of tree[node] is of type interface{} at that point. The function expects type map[string]interface{}. A type assertion will solve that.\nHere's a working example:\npackage main\n\nimport \"fmt\"\n\ntype Tree map[string]interface{}\n\nfunc main() {\n    t := make(Tree)\n    insert(t, []string{\"a\", \"b\"}, 1.0)\n\n    v := t[\"a\"].(Tree)[\"b\"]\n    fmt.Printf(\"%T %v\\n\", v, v)\n\n    // This prints: float32 1\n}\n\nfunc insert(tree Tree, path []string, value float32) {\n    node := path[0]\n    len := len(path)\n\n    switch {\n    case len == 1:\n        tree[node] = value\n\n    case len > 1:\n        if _, ok := tree[node]; !ok {\n            tree[node] = make(Tree)\n        }\n\n        insert(tree[node].(Tree), path[1:], value) //recursion\n    }\n}\n\nNote that I created a new type for the map. This makes the code a little easier to follow. I also use the same 'map[string]interface{}` for both tree nodes and leaves. If you want to get a float out of the resulting tree, another type assertion is needed:\nleaf := t[\"a\"].(Tree)[\"b\"]  // leaf is of type 'interface{}`.\nval := leaf.(float32)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reading the inner text of an XML element using Go\n\nQuestion:\nI'm trying to read an XML file in Go using the xml package (http://golang.org/pkg/xml/).\nMy problem is that I'm not sure how to read an element's inner text. I load the document in the xml.Parser and then call parser.Token() to move through the file. I check to see what the token is using the following:\ntoken, err := parser.Token()\nif element, ok := token.(xml.StartElement); ok {\n  // process as a start element. I can read the element name and attributes here\n}\n\nif charData, ok := token.(xml.CharData); ok {\n  // process as text. How do I read the text data?\n}\n\nThe xml.CharData type is defined as:\ntype CharData []byte\n\nbut I can't seem to use the charData variable as an array of bytes to convert to a string. The only method defined for CharData is to copy the token, but that just gives another copy of a CharData variable. I've tried a few things but they don't compile:\ninnerText := string(charData)\ninnerText := string(charData[0:])\ninnerText := string(charData[0]) // this compiled but is not what I want\n\nIs there another way to treat the xml.CharData variable as a slice of bytes?", "output": "Based on the language spec, you should be able to do string([]byte(charData)).\n[]byte -> string is a special case for type conversion. Normally, the new type and original type must have the same underlying type (i.e. xml.CharData and []byte)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Data broadcasting between instances of distributed server\n\nQuestion:\nI'm trying to get some feedback on the recommendations for a service 'roster' in my specific application. I have a server app that maintains persistant socket connections with clients. I want to further develop the server to support distributed instances. Server \"A\" would need to be able to broadcast data to the other online server instances. Same goes for all other active instances. \nOptions I am trying to research:\n\nRedis / Zookeeper / Doozer - Each server instance would register itself to the configuration server, and all connected servers would receive configuration updates as it changes. What then?\n\nMaintain end-to-end connections with each server instance and iterate over the list with each outgoing data?\nSome custom UDP multicast, but I would need to roll my own added reliability on top of it.\n\nCustom message broker - A service that runs and maintains a registry as each server connects and informs it. Maintains a connection with each server to accept data and re-broadcast it to the other servers.\nSome reliable UDP multicast transport where each server instance just broadcasts directly and no roster is maintained.\n\nHere are my concerns:\n\nI would love to avoid relying on external apps, like zookeeper or doozer but I would use them obviously if its the best solution\nWith a custom message broker, I wouldnt want it to become a bottleneck is throughput. Which would mean I might have to also be able to run multiple message brokers and use a load balancer when scaling?\nmulticast doesnt require any external processes if I manage to roll my own, but otherwise I would need to maybe use ZMQ, which again puts me in the situation of depends.\n\nI realize that I am also talking about message delivery, but it goes hand in hand with the solution I go with. \nBy the way, my server is written in Go. Any ideas on a best recommended way to maintain scalability? \n* EDIT of goal *\nWhat I am really asking is what is the best way to implement broadcasting data between instances of a distributed server given the following:\n\nEach server instance maintains persistent TCP socket connections with its remote clients and passes messages between them.\nMessages need to be able to be broadcasted to the other running instances so they can be delivered to relavant client connections.\nLow latency is important because the messaging can be high speed.\nSequence and reliability is important.\n\n* Updated Question Summary *\nIf you have multiple servers / multiple end points that need to pub/sub between each other, what is a recommended mode of communication between them? One or more message brokers to re-pub messages to a roster of the discovered servers? Reliable multicast directly from each server?\nHow do you connect multiple end points in a distributed system while keeping latency low, speed high, and delivery reliable?", "output": "Assuming all of your client-facing endpoints are on the same LAN (which they can be for the first reasonable step in scaling), reliable UDP multicast would allow you to send published messages directly from the publishing endpoint to any of the endpoints who have clients subscribed to the channel. This also satisfies the low-latency requirement much better than proxying data through a persistent storage layer.\nMulticast groups\n\nA central database (say, Redis) could track a map of multicast groups (IP:PORT) <--> channels.\nWhen an endpoint receives a new client with a new channel to subscribe, it can ask the database for the channel's multicast address and join the multicast group.\n\nReliable UDP multicast\n\nWhen an endpoint receives a published message for a channel, it sends the message to that channel's multicast socket.\nMessage packets will contain ordered identifiers per server per multicast group. If an endpoint receives a message without receiving the previous message from a server, it will send a \"not acknowledged\" message for any messages it missed back to the publishing server.\nThe publishing server tracks a list of recent messages, and resends NAK'd messages.\nTo handle the edge case of a server sending only one message and having it fail to reach a server, server can send a packet count to the multicast group over the lifetime of their NAK queue: \"I've sent 24 messages\", giving other servers a chance to NAK previous messages.\n\nYou might want to just implement PGM.\nPersistent storage\nIf you do end up storing data long-term, storage services can join the multicast groups just like endpoints... but store the messages in a database instead of sending them to clients."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: how to call this C function from Go language (with Cgo tool)\n\nQuestion:\nHere is this C function declaration\nCURL_EXTERN CURLcode curl_easy_setopt(CURL *curl, CURLoption option, ...);\n\nhow do I call this function from Go?\ntype Easy struct {\n    curl unsafe.Pointer\n    code C.CURLcode\n}\n\nfunc (e *Easy)SetOption(option C.CURLoption, ...) {\n    e.code = C.curl_easy_setopt(e.curl, option, ????))\n}", "output": "You can't call it directly. CGO does not play well with vararg functions on the C side.\nIdeally, you could create a C wrapper which accepts a list of options you want to pass.\nThe C function should then expand that list into the variable arguments required by curl_easy_set_opt(). But I am not sure if that is possible or how to go about doing it.\nThe signature for your Go function is also incorrect:\ntype Option C.CURLoption\n\nfunc (e *Easy) SetOption(options ...Option) {\n    // 'options' is now accessible as a slice: []Option\n    // Turn this slice into a list of C.CURLoption pointers and pass it to\n    // your C wrapper.\n\n    if len(options) == 0 {\n        return // No use continuing.\n    }\n\n    // Here is one way to convert the option slice to a list\n    // that C can work with.\n    size := int(unsafe.Sizeof(options[0]))\n    list := C.malloc(C.size_t(size * len(options)))\n    defer C.free(unsafe.Pointer(list)) // Free this after use!\n\n    for i := range options {\n        ptr := unsafe.Pointer( uintptr(list) + uintptr(size * i) )\n        *(*C.CURLoption)(ptr) = C.CURLoption(options[i])\n    }\n\n    C.my_setopt_wrapper(e.curl, list, C.int(len(options)))\n}\n\nNote that the type of the option parameter has been changed to a go version of it. When someone uses your package, they have no access to the C.xxx types. So you should not use those in your public api. They are only meant for internal use in your package."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Terminating a Process Started with os/exec in Golang\n\nQuestion:\nIs there a way to terminate a process started with os.exec in Golang? For example (from http://golang.org/pkg/os/exec/#example_Cmd_Start), \ncmd := exec.Command(\"sleep\", \"5\")\nerr := cmd.Start()\nif err != nil {\n    log.Fatal(err)\n}\nlog.Printf(\"Waiting for command to finish...\")\nerr = cmd.Wait()\nlog.Printf(\"Command finished with error: %v\", err)\n\nIs there a way to terminate that process ahead of time, perhaps after 3 seconds?\nThanks in advance", "output": "Run and terminate an exec.Process:\n// Start a process:\ncmd := exec.Command(\"sleep\", \"5\")\nif err := cmd.Start(); err != nil {\n    log.Fatal(err)\n}\n\n// Kill it:\nif err := cmd.Process.Kill(); err != nil {\n    log.Fatal(\"failed to kill process: \", err)\n}\n\nRun and terminate an exec.Process after a timeout:\nctx, cancel := context.WithTimeout(context.Background(), 3 * time.Second)\ndefer cancel()\n\nif err := exec.CommandContext(ctx, \"sleep\", \"5\").Run(); err != nil {\n    // This will fail after 3 seconds. The 5 second sleep\n    // will be interrupted.\n}\n\nSee this example in the Go docs\n\nLegacy\nBefore Go 1.7, we didn't have the context package and this answer was different.\nRun and terminate an exec.Process after a timeout using channels and a goroutine:\n// Start a process:\ncmd := exec.Command(\"sleep\", \"5\")\nif err := cmd.Start(); err != nil {\n    log.Fatal(err)\n}\n\n// Wait for the process to finish or kill it after a timeout (whichever happens first):\ndone := make(chan error, 1)\ngo func() {\n    done <- cmd.Wait()\n}()\nselect {\ncase <-time.After(3 * time.Second):\n    if err := cmd.Process.Kill(); err != nil {\n        log.Fatal(\"failed to kill process: \", err)\n    }\n    log.Println(\"process killed as timeout reached\")\ncase err := <-done:\n    if err != nil {\n        log.Fatalf(\"process finished with error = %v\", err)\n    }\n    log.Print(\"process finished successfully\")\n}\n\nEither the process ends and its error (if any) is received through done or 3 seconds have passed and the program is killed before it's finished."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Observer pattern in Go language\n\nQuestion:\nThis problem is pretty common: an object should notify all its subscribers when some event occurs. In C++ we may use boost::signals or something else. But how to do this in Go language? It would be nice to see some working code example where a couple of objects are subscribed to a publisher and process notifications.\nThanks", "output": "This is actually pretty simple in Go. Use channels. This is the kind of thing they're made for.\ntype Publish struct {\n    listeners []chan *Msg\n}\n\ntype Subscriber struct {\n    Channel chan *Msg\n}\n\nfunc (p *Publisher) Sub(c chan *Msg) {\n    p.appendListener(c)\n}\n\nfunc (p *Publisher) Pub(m *Msg) {\n    for _, c := range p.listeners {\n        c <- Msg\n    }\n}\n\nfunc (s *Subscriber) ListenOnChannel() {\n    for {\n        data := <-s.Channel\n        //Process data\n    }\n}\n\nfunc main() {\n    for _, v := range subscribers {\n        p.Sub(v.Channel)\n        go v.ListenOnChannel()\n    }\n    //Some kind of wait here\n}\n\nObviously this isn't exactly a working code sample. But it's close."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Read text file into string array (and write)\n\nQuestion:\nThe ability to read (and write) a text file into and out of a string array is I believe a fairly common requirement. It is also quite useful when starting with a language removing the need initially to access a database. Does one exist in Golang?\ne.g. \nfunc ReadLines(sFileName string, iMinLines int) ([]string, bool) {\n\nand   \nfunc WriteLines(saBuff[]string, sFilename string) (bool) { \n\nI would prefer to use an existing one rather than duplicate.", "output": "As of Go1.1 release, there is a bufio.Scanner API that can easily read lines from a file.  Consider the following example from above, rewritten with Scanner:\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\n// readLines reads a whole file into memory\n// and returns a slice of its lines.\nfunc readLines(path string) ([]string, error) {\n    file, err := os.Open(path)\n    if err != nil {\n        return nil, err\n    }\n    defer file.Close()\n\n    var lines []string\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        lines = append(lines, scanner.Text())\n    }\n    return lines, scanner.Err()\n}\n\n// writeLines writes the lines to the given file.\nfunc writeLines(lines []string, path string) error {\n    file, err := os.Create(path)\n    if err != nil {\n        return err\n    }\n    defer file.Close()\n\n    w := bufio.NewWriter(file)\n    for _, line := range lines {\n        fmt.Fprintln(w, line)\n    }\n    return w.Flush()\n}\n\nfunc main() {\n    lines, err := readLines(\"foo.in.txt\")\n    if err != nil {\n        log.Fatalf(\"readLines: %s\", err)\n    }\n    for i, line := range lines {\n        fmt.Println(i, line)\n    }\n\n    if err := writeLines(lines, \"foo.out.txt\"); err != nil {\n        log.Fatalf(\"writeLines: %s\", err)\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why the length of the slice in http.Header returns 0?\n\nQuestion:\nFrom the source code of net/http. The definition of http.Header is map[string][]string. Right?\nBut why go run below code, I get the result:\n\n0\n2\n\nfunc main() {\n    var header = make(http.Header)\n    header.Add(\"hello\", \"world\")\n    header.Add(\"hello\", \"anotherworld\")\n    var t = []string {\"a\", \"b\"}\n    fmt.Printf(\"%d\\n\", len(header[\"hello\"]))\n    fmt.Print(len(t))\n}", "output": "if you try\nfmt.Println(header)\n\nyou'll notice that the key has been capitalized. This is actually noted in the documentation of net/http.\n// HTTP defines that header names are case-insensitive.\n// The request parser implements this by canonicalizing the\n// name, making the first character and any characters\n// following a hyphen uppercase and the rest lowercase.\n\nThis can be found in the comment on the field Header of type Request.\nhttp://golang.org/pkg/net/http/#Request\nComment should probably be moved though.."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Installing web.go errors\n\nQuestion:\nI'm trying to install web.go. I got the source and ran make, but I'm getting these errors:\ng -o _go_.6 cookie.go fcgi.go request.go scgi.go servefile.go status.go web.go \ncookie.go:33: c.Version undefined (type *http.Cookie has no field or method Version)\ncookie.go:34: c.Version undefined (type *http.Cookie has no field or method Version)\ncookie.go:54: c.Comment undefined (type *http.Cookie has no field or method Comment)\ncookie.go:55: c.Comment undefined (type *http.Cookie has no field or method Comment)\ncookie.go:78: c.Version undefined (type *http.Cookie has no field or method Version)\ncookie.go:79: c.Version undefined (type *http.Cookie has no field or method Version)\nweb.go:191: undefined: reflect.FuncValue\nweb.go:248: undefined: reflect.FuncValue\nweb.go:272: undefined: reflect.FuncType\nweb.go:591: undefined: reflect.FuncValue\ncookie.go:79: too many errors\nmake: *** [_go_.6] Error 1\n\nDoes anyone have any idea what the issue could be? I just install go, so it should be the most recent version. 6g -V gives 6g version weekly.2011-04-04 8038.\nThanks,\nJon", "output": "It sounds like you've inadvertantly checked out past the latest weekly and brought in some recent changes to reflection. Try running\nhg checkout -r weekly\n\nVerify by running\nhg identify\n\nwhich should output\ncd89452cfea3+ weekly/weekly.2011-04-04\n\nThen run all.bash again to rebuild everything and try goinstalling web.go again."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go network programming libs\n\nQuestion:\nI've decided to rewrite most of my distributed server programs in Go to replace the existing c# based ones.\nCan someone point me to a Go TCP libs or a Go general network programming lib.\nThanks\nEdi: ... and how do i complile this code is visual stuido 2008? Thanks", "output": "Here's the official API docs for the net package.\nRegarding how to compile: See the installation guide. As of yet there doesn't seem to be an obvious way to compile in VS:\n\nThe Go tool chain is written in C. To\n  build it, you need to have GCC, the\n  standard C libraries, the parser\n  generator Bison, and the text editor\n  ed installed.\n\nSo in order to develop on Windows, the easiest route would be to use cygwin."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is the go map structure thread-safe?\n\nQuestion:\nIs the Go map type thread safe? I have a program that has many goroutines reading and writing to a map type. If I need to implement a protection mechanism, what's the best way to do it?", "output": "You'd want to use goroutines and synchronize access to your maps via channels. Explanation from the FAQ:\n\nAfter long discussion it was decided that the typical use of maps did\n  not require safe access from multiple threads, and in those cases\n  where it did, the map was probably part of some larger data structure\n  or computation that was already synchronized. Therefore requiring that\n  all map operations grab a mutex would slow down most programs and add\n  safety to few. This was not an easy decision, however, since it means\n  uncontrolled map access can crash the program.\nThe language does not preclude atomic map updates. When required, such\n  as when hosting an untrusted program, the implementation could\n  interlock map access."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang output templates\n\nQuestion:\nhow to display the contents of the template?\npackage main\nimport (\n    \"fmt\"\n    \"html/template\"\n    \"os\"\n\n)\n\nfunc main() {\n    t := template.New(\"another\")\n    t,e:=t.ParseFiles(\"test.html\")\n    if(e!=nil){\n            fmt.Println(e);\n    }\n    t.Execute(os.Stdout, nil)\n\n}\n\nWhy does not?\ntest.html exists", "output": "You don't need to create a new template with New and then use ParseFiles on it. There is also a function ParseFiles which takes care of creating a new template behind the scenes.Here is an example:\npackage main\n\nimport (\n    \"fmt\"\n    \"html/template\"\n    \"os\"\n)\n\nfunc main() {\n    t, err := template.ParseFiles(\"test.html\")\n    if err != nil {\n            fmt.Println(err);\n    }\n    t.Execute(os.Stdout, nil)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why is this curl command not working?\n\nQuestion:\nHi there I just want to create a simple golang applications, which posts a new dent at identi.ca using\ncurl -u username:password http://example.com/api/statuses/update.xml -d status='Howdy!' -d lat='30.468' -d long='-94.743'\n\nThis is my code so far and imho this should work, but actually it isn't working, does anybody know how to fix this?\nEDIT: Nope: I don't get any error messages :/\npackage main\n\nimport(\n        \"fmt\"\n        \"os\"\n        \"bufio\"\n        \"exec\"\n)\nfunc main() {\n\nvar err os.Error\nvar username string\n\nprint(\"Username: \")\n_, err = fmt.Scanln(&username)\nif err != nil {\n    fmt.Println(\"Error: \", err)\n}\n\nvar password string\nprint(\"Password: \")\n_, err = fmt.Scanln(&password)\nif err != nil {\n    fmt.Println(\"Error: \", err)\n}\n\nvar status string\nprint(\"Status: \")\nin := bufio.NewReader(os.Stdin);\nstatus, err = in.ReadString('\\n');\nif err != nil {\n    fmt.Println(\"Error: \", err)\n}\n\nexec.Command(\"curl -u \" + username + \":\" + password + \"https://identi.ca/api/statuses/update.xml -d status='\" + status +  \"'\" + \"-d source='API'\").Run()", "output": "exec.Command() doesn't take the whole command line as a single argument. You need to call it as:\nexec.Command(\"curl\", \"-u\", username+\":\"+password, ...url..., \"-d\", \"status=\"+status, \"-d\", \"source=API\").Run()\n\nHow do you know if you get an error? You don't check the return value of Run().\nYou should actually separate the command creation from running it. This way you can set the process's stdout and stderr to something besides /dev/null, e.g.\nc := exec.Command(\"curl\", \"-u\", username+\":\"+password, \"https://identi.ca/api/statuses/update.xml\", \"-d\", \"status=\"+status, \"-d\", \"source=API\")\nc.Stdout = os.Stdout\nc.Stderr = os.Stderr\nerr = c.Run()\nif err != nil {\n    fmt.Println(\"Error: \", err)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Installing Go in Linux(Mint) and modifying bashrc\n\nQuestion:\nI want to install Google's Go Language on my Linux Mint machine. I'm new to Linux so its not easy to follow some of the instructions I have read. Namely, I have been told to edit/mod the bashrc file:\n export GOROOT=$HOME/gosource\n export GOARCH=amd64\n export GOOS=linux\n export GOBIN=$HOME/bin\n export PATH=$PATH:$GOBIN\n\nI don't know how to do this. I typed gedit ~/.bashrc\ninto the terminal and a blank page appeared. I put in the code and saved it. Then did\nhg clone -u https://go.googlecode.com/hg/ go\n\nto get the source code. Is this correct? Because I then tried to compile the code and a long list of errors appeared (which I don't have - I'm using a different PC at the mo unfortunately).\nBut if anyone can help me install Go, I'd appreciate it.\nSOLUTION:\nAside from various problems mentioned and solved in the answers below, I had forgotten to install the following\nsudo apt-get install bison ed gawk gcc libc6-dev make\n\nWHich is mentioned at the top of the golang.com install page.", "output": "Amongst other things, you tried to clone the repository to ~/go and edited ~/.bashrc to point $GOROOT to ~/gosource.\nRead the Go Getting Started instructions carefully. Either copy and paste commands or check what you type very carefully; check input very carefully before you hit enter. For commands, the $ sign represents the command prompt, don't type it. Remember, Linux is case sensitive and the distinction between / and \\ is important. Check the output of commands very carefully; does the ouput make sense. Run diagnostic commands like env, pwd, which, and uname. When you see scroll bars in a Stack Overflow answer, scroll through all the code and output.\nFirst, set up ~/.bashrc.\n$ gedit ~/.bashrc\n\nexport GOROOT=$HOME/go\nexport GOARCH=amd64\nexport GOOS=linux\nexport GOBIN=$GOROOT/bin\nexport PATH=$PATH:$GOBIN\n\nClose any open terminal windows and then open a new terminal window to check the new ~./bashrc and other values.\n$ env | grep '^\\(GO\\|HOME=\\|PATH=\\)'\nGOBIN=/home/peter/go/bin\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/home/peter/go/bin\nGOARCH=amd64\nHOME=/home/peter\nGOROOT=/home/peter/go\nGOOS=linux\n$ cd $GOROOT/src\n$ pwd\n/home/peter/go/src\n$ uname -a\nLinux peter 2.6.32-31-generic #61-Ubuntu SMP Fri Apr 8 18:25:51 UTC 2011 x86_64 GNU/Linux\n\nThen clone the repository to $GOROOT and you will clone to and compile from the same place.\n$ hg clone -u release https://go.googlecode.com/hg/ $GOROOT\nrequesting all changes\nadding changesets\nadding manifests\nadding file changes\nadded 8441 changesets with 31916 changes to 4421 files (+1 heads)\nupdating to branch release-branch.r57\n2702 files updated, 0 files merged, 0 files removed, 0 files unresolved\n$ cd $GOROOT/src\n$ ./all.bash\n< SNIP OUTPUT >\nALL TESTS PASSED\n---\nInstalled Go for linux/amd64 in /home/peter/go.\nInstalled commands in /home/peter/go/bin.\nThe compiler is 6g.\n$ which 6g\n/home/peter/go/bin/6g\n\nYou haven't posted your output, so I can only guess what your problems are.\nFor example, you say \"the directory is Go\", it should be \"go\"; since Linux is case sensitive, \"Go\" and \"go\" are different.\nIf you omit the $GOROOT destination from the hg clone command or $GOROOT is not set, hg clone will default to the hg directory. For example,\n$ env | grep '^GOROOT'\nGOROOT=\n$ hg clone -u release https://go.googlecode.com/hg/ $GOROOT\ndestination directory: hg\n\nSince you have GOARCH=amd64, you should be running a 64-bit version of Linux Mint on an x86_64 processor. What does your uname -a output say? You want the 6g and 6l programs to compile and link on an x86_64 processor, which should be in your $GOBIN directory, which should be in in your $PATH.\n$ env | grep '^\\(GOBIN\\|PATH=\\)'\nGOBIN=/home/peter/go/bin\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/home/peter/go/bin\n$ which 6g\n/home/peter/go/bin/6g\n\nYou should also have seen this by reading the end of your ./all.bash command output.\nALL TESTS PASSED\n---\nInstalled Go for linux/amd64 in /home/peter/go.\nInstalled commands in /home/peter/go/bin.\nThe compiler is 6g."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How does shared memory vs message passing handle large data structures?\n\nQuestion:\nIn looking at Go and Erlang's approach to concurrency, I noticed that they both rely on message passing.\nThis approach obviously alleviates the need for complex locks because there is no shared state.\nHowever, consider the case of many clients wanting parallel read-only access to a single large data structure in memory -- like a suffix array.\nMy questions:\n\nWill using shared state be faster and use less memory than message passing, as locks will mostly be unnecessary because the data is read-only, and only needs to exist in a single location?\nHow would this problem be approached in a message passing context? Would there be a single process with access to the data structure and clients would simply need to sequentially request data from it? Or, if possible, would the data be chunked to create several processes that hold chunks?\nGiven the architecture of modern CPUs & memory, is there much difference between the two solutions -- i.e., can shared memory be read in parallel by multiple cores -- meaning there is no hardware bottleneck that would otherwise make both implementations roughly perform the same?", "output": "Yes, shared state could be faster in this case.  But only if you can forgo the locks, and this is only doable if it's absolutely read-only.  if it's 'mostly read-only' then you need a lock (unless you manage to write lock-free structures, be warned that they're even trickier than locks), and then you'd be hard-pressed to make it perform as fast as a good message-passing architecture.\nYes, you could write a 'server process' to share it. With really lightweight processes, it's no more heavy than writing a small API to access the data.  Think like an object (in OOP sense) that 'owns' the data.  Splitting the data in chunks to enhance parallelism (called 'sharding' in DB circles) helps in big cases (or if the data is on slow storage).\nEven if NUMA is getting mainstream, you still have more and more cores per NUMA cell.  And a big difference is that a message can be passed between just two cores, while a lock has to be flushed from cache on ALL cores, limiting it to the inter-cell bus latency (even slower than RAM access).  If anything, shared-state/locks is getting more and more unfeasible.\n\nin short.... get used to message passing and server processes, it's all the rage.\nEdit: revisiting this answer, I want to add about a phrase found on Go's documentation:\n\nshare memory by communicating, don't communicate by sharing memory.\n\nthe idea is: when you have a block of memory shared between threads, the typical way to avoid concurrent access is to use a lock to arbitrate.  The Go style is to pass a message with the reference, a thread only accesses the memory when receiving the message.  It relies on some measure of programmer discipline; but results in very clean-looking code that can be easily proofread, so it's relatively easy to debug.\nthe advantage is that you don't have to copy big blocks of data on every message, and don't have to effectively flush down caches as on some lock implementations.  It's still somewhat early to say if the style leads to higher performance designs or not.  (specially since current Go runtime is somewhat naive on thread scheduling)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Append to a file in Go\n\nQuestion:\nSo I can read from a local file like so:\ndata, error := ioutil.ReadFile(name)\n\nAnd I can write to a local file\nioutil.WriteFile(filename, content, permission)\n\nBut how can I append to a file? Is there a built in method?", "output": "This answers works in Go1:\nf, err := os.OpenFile(filename, os.O_APPEND|os.O_WRONLY|os.O_CREATE, 0600)\nif err != nil {\n    panic(err)\n}\n\ndefer f.Close()\n\nif _, err = f.WriteString(text); err != nil {\n    panic(err)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to pipe several commands in Go?\n\nQuestion:\nHow can I pipe several external commands together in Go? I've tried this code but I get an error that says exit status 1.\npackage main\n\nimport (\n    \"io\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    c1 := exec.Command(\"ls\")\n    stdout1, err := c1.StdoutPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err = c1.Start(); err != nil {\n        log.Fatal(err)\n    }\n    if err = c1.Wait(); err != nil {\n        log.Fatal(err)\n    }\n\n    c2 := exec.Command(\"wc\", \"-l\")\n    c2.Stdin = stdout1\n\n    stdout2, err := c2.StdoutPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err = c2.Start(); err != nil {\n        log.Fatal(err)\n    }\n    if err = c2.Wait(); err != nil {\n        log.Fatal(err)\n    }\n\n    io.Copy(os.Stdout, stdout2)\n}", "output": "StdoutPipe returns a pipe that will be connected to the command's\n  standard output when the command starts. The pipe will be closed\n  automatically after Wait sees the command exit.\n\n(from http://golang.org/pkg/os/exec/#Cmd.StdinPipe )\nThe fact you do c1.Wait closes the stdoutPipe.\nI made a working example (just a demo, add error catching!) :\npackage main\n\nimport (\n    \"bytes\"\n    \"io\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    c1 := exec.Command(\"ls\")\n    c2 := exec.Command(\"wc\", \"-l\")\n\n    r, w := io.Pipe() \n    c1.Stdout = w\n    c2.Stdin = r\n\n    var b2 bytes.Buffer\n    c2.Stdout = &b2\n\n    c1.Start()\n    c2.Start()\n    c1.Wait()\n    w.Close()\n    c2.Wait()\n    io.Copy(os.Stdout, &b2)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How does one avoid \"invalid memory address or null pointer dereference\" errors?\n\nQuestion:\nI'm wondering how I can structure this example code to help avoid null pointer dereference panics:\npackage main\n\nimport \"fmt\"\n\ntype Astruct struct {\n    Number int\n    Letter string\n}\n\ntype Bstruct struct {\n    foo int\n    AStructList *[]Astruct\n}\n\ntype Cstruct struct {\n    Bstruct\n}\n\nfunc (a *Astruct) String() string {\n    return fmt.Sprintf(\"Number = %d, Letter = %s\", a.Number, a.Letter)\n}\n\nfunc main() {\n    astructlist := make([]Astruct, 3)      // line 1\n    for i := range astructlist {           // line 2\n        astructlist[i] = Astruct{i, \"a\"}   // line 3\n    }                                      // line 4\n    c := new(Cstruct)\n    c.Bstruct = Bstruct{100, &astructlist} // line 6\n\n    for _, x := range(*c.Bstruct.AStructList) {\n        fmt.Printf(\"%s\\n\", &x)\n    }\n}\n\nIf I omit lines 1-4 and 6 of main(), I get a null pointer dereference panic. Short of checking if c != nil, is there a way to avoid these panics?\nThanks in advance for any help!", "output": "In this particular case, you could use idiomatic Go. Change AStructList *[]Astruct to AStructList []*Astruct. For example,\npackage main\n\nimport \"fmt\"\n\ntype Astruct struct {\n    Number int\n    Letter string\n}\n\ntype Bstruct struct {\n    foo         int\n    AStructList []*Astruct\n}\n\ntype Cstruct struct {\n    Bstruct\n}\n\nfunc (a *Astruct) String() string {\n    return fmt.Sprintf(\"Number = %d, Letter = %s\", a.Number, a.Letter)\n}\n\nfunc main() {\n    astructlist := make([]*Astruct, 3)            // line 1\n    for i := range astructlist {                  // line 2\n        astructlist[i] = &Astruct{i, \"a\"}         // line 3 \n    }                                             // line 4\n    c := new(Cstruct)\n    c.Bstruct = Bstruct{100, astructlist}         // line 6\n\n    for _, x := range c.Bstruct.AStructList {\n        fmt.Printf(\"%s\\n\", x)\n    }\n}\n\nIn general, it's your responsibility to either assign a non-nil value to a pointer or test for nil before its use. When you allocate memory without explicitly intializing it, it's set to the zero value for the type, which is nil for pointers.\n\nThe zero value\nWhen memory is allocated to store a value, either through a\n  declaration or a call of make or new, and no explicit initialization\n  is provided, the memory is given a default initialization. Each\n  element of such a value is set to the zero value for its type: false\n  for booleans, 0 for integers, 0.0 for floats, \"\" for strings, and nil\n  for pointers, functions, interfaces, slices, channels, and maps. This\n  initialization is done recursively, so for instance each element of an\n  array of structs will have its fields zeroed if no value is specified."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I access struct fields that are part of a vector.Vector?\n\nQuestion:\nI am looking for help understanding how to access struct fields that are inside a container.vector.Vector.\nThe following code:\npackage main\n\nimport \"fmt\"\nimport \"container/vector\"\n\nfunc main() {\n    type Hdr struct {\n        H string\n    }\n    type Blk struct {\n        B string\n    }\n\n    a := new(vector.Vector)\n\n    a.Push(Hdr{\"Header_1\"})\n    a.Push(Blk{\"Block_1\"})\n\n    for i := 0; i < a.Len(); i++ {\n        fmt.Printf(\"a.At(%d) == %+v\\n\", i, a.At(i))\n        x := a.At(i)\n        fmt.Printf(\"%+v\\n\", x.H)\n    }\n}\n\nProduces the error prog.go:22: x.H undefined (type interface { } has no field or method H)\nremoving lines 21 and 22 produces:\na.At(0) == {H:Header_1}\na.At(1) == {B:Block_1}\n\nSo, how exactly does one access 'H' or 'B'? It seems like I need to convert those interfaces to structs, but... I dunno. I'm at a loss.\nThanks for any help.", "output": "Use a Go type switch or type assertion to distinguish between the Hdr and Blk types. For example,\npackage main\n\nimport (\n    \"fmt\"\n    \"container/vector\"\n)\n\nfunc main() {\n    type Hdr struct {\n        H string\n    }\n    type Blk struct {\n        B string\n    }\n\n    a := new(vector.Vector)\n\n    a.Push(Hdr{\"Header_1\"})\n    a.Push(Blk{\"Block_1\"})\n\n    for i := 0; i < a.Len(); i++ {\n        fmt.Printf(\"a.At(%d) == %+v\\n\", i, a.At(i))\n        x := a.At(i)\n        switch x := x.(type) {\n        case Hdr:\n            fmt.Printf(\"%+v\\n\", x.H)\n        case Blk:\n            fmt.Printf(\"%+v\\n\", x.B)\n        }\n    }\n}\n\nHowever, effective the weekly.2011-10-18 release:\n\nThe container/vector package has been deleted. Slices are better:\n  SliceTricks.\n\nTherefore, for the latest releases,\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    type Hdr struct {\n        H string\n    }\n    type Blk struct {\n        B string\n    }\n\n    var a []interface{}\n\n    a = append(a, Hdr{\"Header_1\"})\n    a = append(a, Blk{\"Block_1\"})\n\n    for i := 0; i < len(a); i++ {\n        fmt.Printf(\"a[%d]) == %+v\\n\", i, a[i])\n        x := a[i]\n        switch x := x.(type) {\n        case Hdr:\n            fmt.Printf(\"%+v\\n\", x.H)\n        case Blk:\n            fmt.Printf(\"%+v\\n\", x.B)\n        }\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can I create a new function using reflection in Go?\n\nQuestion:\nI have an idea to use interfaces in Go to define RPC style interfaces. So for a given service, I might create an interface like this:\ntype MyService interface{\n  Login(username, password string) (sessionId int, err error)\n  HelloWorld(sessionId int) (hi string, err error)\n}\n\nWhat I would like to do is use reflection to implement that interface, translating method calls into RPC calls, Marshaling the input parameters, and Unmarshaling the results back into the output of the method. I know that if I can get a []interface{} of the input parameters I can use reflection to make the service call. However I don't see any way to use reflection to dynamically create a value that would implement the interface by calling my reflection-using functions. Does anyone know of a way to do this, even using unsafe?", "output": "You can not create a type with attached methods via reflection, as to instantiate an object of that type.\nYou could possibly achieve this with a lot of hackery through the unsafe package. But even then, it'd be a massive pain.\nIf you elaborated more on the problem you're trying to solve, the community could come up with alternatives ways of solving it.\nEdit (23. July 2015): starting with Go 1.5 there's reflect.FuncOf and reflect.MakeFunc, which do exactly what you want."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Idiomatic way to do conversion/type assertion on multiple return values in Go\n\nQuestion:\nWhat is the idiomatic way to cast multiple return values in Go?\nCan you do it in a single line, or do you need to use temporary variables such as I've done in my example below?\npackage main\n\nimport \"fmt\"\n\nfunc oneRet() interface{} {\n    return \"Hello\"\n}\n\nfunc twoRet() (interface{}, error) {\n    return \"Hejsan\", nil\n}\n\nfunc main() {\n    // With one return value, you can simply do this\n    str1 := oneRet().(string)\n    fmt.Println(\"String 1: \" + str1)\n\n    // It is not as easy with two return values\n    //str2, err := twoRet().(string) // Not possible\n    // Do I really have to use a temp variable instead?\n    temp, err := twoRet()\n    str2 := temp.(string)\n    fmt.Println(\"String 2: \" + str2 )\n\n\n    if err != nil {\n        panic(\"unreachable\")\n    }   \n}\n\nBy the way, is it called casting when it comes to interfaces?\ni := interface.(int)", "output": "You can't do it in a single line.\nYour temporary variable approach is the way to go.\n\nBy the way, is it called casting when it comes to interfaces?\n\nIt is actually called a type assertion.\nA type cast conversion is different:\nvar a int\nvar b int64\n\na = 5\nb = int64(a)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What's the correct organisation for Go projects using Git (or any VCS)?\n\nQuestion:\nMy GOPATH is /Users/joe/go. I am working on a project called myproj, which is a package called myproj.\nIf I want to be able to write import \"myproj\" then the directory structure I need is:\n$GOPATH/src/myproj/myproj.go\n$GOPATH/src/myproj/myproj_test.go\n...\n\nHowever, I can't seem to make this fit with Git. If I look at an example package from Google I see the following format:\ngo.example/hello/hello.go\ngo.example/LICENSE\n\nWhere go.example is the name of the repo.\nSo the actual package directories are found inside the repository. If I put the contents of this repository in a directory on my $GOPATH, e.g. \n$GOPATH/src/go.example/hello/hello.go\n$GOPATH/src/go.example/LICENSE\n\nthen I will have to type import \"go.example/hello\" rather than import \"hello\".\nComing back to my project, I need to package this up in a Git repository then I need a container directory. So my current file structure is:\n$GOPATH/src/myproj                        # The dir for the git repo\n$GOPATH/src/myproj/.git\n$GOPATH/src/myproj/LICENSE                # Files in the base of the repo\n$GOPATH/src/myproj/myproj/myproj.go       # Package files in package dir\n$GOPATH/src/myproj/myproj/myproj_test.go  \n\nI need the outer myproj directory to bound the git repository and I need the inner one to be the package directory. The upshot is that I need to type import \"myproj/myproj\" rather than import \"myproj\".\nHow do I fix this? Do I have to add multiple $GOPATHS, one for each project I'm developing?\nThanks in advance.", "output": "First off:\n\nDo I have to add multiple $GOPATHs, one for each project I'm developing?\n\nNo, you don’t need multiple $GOPATHs at all.\nThey are a tool for managing your (potentially several) projects. When you set up a new project environment which you already know will have some dependencies - potentially unique to that project, or which should be similiar to other peoples setups, you create a new project folder and set it as the GOPATH. That way, you can also use (= check out) specific versions of a library for that project, while using other versions for your other projects in other project folders (= GOPATHs).\nAs for your path issue: Go follows a generic paradigm of author/project (or organization/project). This will prevent naming clashes when several people, authors and organizations, start projects with the same names. (The author may then use sub-folders, sub-projects in “his” folder as well ofc.)\nIf you are aware of this and still want to use only myproj as your package path, there is no problem in creating the git repository in that folder - in contrary to the example package you linked to.\n\nComing back to my project, I need to package this up in a Git repository then I need a container directory.\n\nWhat makes you think so then? Go does not need it. Git does neither.\nSo the following will work:\n/src/myproj/.git\n/src/myproj/myproj.go\n\nWhile it is not the encouraged practice, you can put the repository into your myproj folder.\n\nI tested this as follows:\nFOLDER\nFOLDER/src\nFOLDER/src/myproj\nFOLDER/src/myproj/myproj.go\nFOLDER/src/mainproj\nFOLDER/src/mainproj/main.go\n\nWith folder/src/myproj/myproj.go\npackage myproj\n\ntype My struct {\n    I int\n}\n\nand folder/src/mainproj/main.go\npackage main\n\nimport (\n    \"fmt\"\n    \"myproj\"\n)\n\nfunc main() {\n    my := myproj.My{7}\n    fmt.Printf(\"Works! %v\", my.I)\n}\n\nRunning\ncd FOLDER\nset GOPATH=FOLDER\ngo run src/mainproj/main.go\n\nwill output:\nWorks! 7\n\nNow, if you git init in the folder FOLDER/src/myproj, that does not matter to Go itself at all."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to stop a goroutine\n\nQuestion:\nI have a goroutine that calls a method, and passes returned value on a channel:\nch := make(chan int, 100)\ngo func(){\n    for {\n        ch <- do_stuff()\n    }\n}()\n\nHow do I stop such a goroutine?", "output": "EDIT: I wrote this answer up in haste, before realizing that your question is about sending values to a chan inside a goroutine.  The approach below can be used either with an additional chan as suggested above, or using the fact that the chan you have already is bi-directional, you can use just the one...\nIf your goroutine exists solely to process the items coming out of the chan, you can make use of the \"close\" builtin and the special receive form for channels.\nThat is, once you're done sending items on the chan, you close it.  Then inside your goroutine you get an extra parameter to the receive operator that shows whether the channel has been closed.\nHere is a complete example (the waitgroup is used to make sure that the process continues until the goroutine completes):\npackage main\n\nimport \"sync\"\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(1)\n\n    ch := make(chan int)\n    go func() {\n        for {\n            foo, ok := <- ch\n            if !ok {\n                println(\"done\")\n                wg.Done()\n                return\n            }\n            println(foo)\n        }\n    }()\n    ch <- 1\n    ch <- 2\n    ch <- 3\n    close(ch)\n\n    wg.Wait()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How exactly do interfaces work in Go?\n\nQuestion:\nAfter reading the spec, and the \"Effective Go\" section on them, I still don't quite understand how interfaces work in Go.\nLike, where do you define them? How does interface enforcement work? And is there a way to specify somewhere that an object implements an interface, as opposed to simply defining the methods in the interface?\nApologies for the beginner question; but I really am struggling to understand this.", "output": "There are some good posts on interfaces over at Russ Cox and Ian Lance Taylor's blog which i recommend checking out. They'll probably cover your questions and more ... \nI think a good conceptual example is the net package. There you'll find a connections interface(Conn), which is implemented by the TCPConn, the UnixConn, and the UDPConn. The Go pkg source is probably the best documentation for the Go language."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Golang/mgo: Cannot retrieve value of int field from MongoDB document\n\nQuestion:\nI am querying a collection that includes an integer value among it's values, and loading resulting documents into this struct:\ntype Subscription struct {\n    Id bson.ObjectId \"_id,omitempty\"\n    Listen string\n    Job string\n    TimeoutSeconds int\n    Data string\n}\n\n\nvar subscription Subscription\n\nsubscriptions := subscriptionsCol.Find(bson.M{\"listen\": \"example_channel\"}).Iter()\nfor subscriptions.Next(&subscription) {\n    log(\"Pending job: %s?%s (timeout: %d)\\n\",\n            subscription.Job, \n            subscription.Data, \n            subscription.TimeoutSeconds)\n}\n\nThis is what phpMoAdmin shows me:\n[_id] => MongoId Object (\n    [$id] => 502ed8d84eaead30a1351ea7\n)\n[job] => partus_test_job_a\n[TimeoutSeconds] => 30\n[listen] => partus.test\n[data] => a=1&b=9\n\nIt puzzles me that subscription.TimeoutSeconds contains always 0, when I'm positive I have   30 in the document I inserted in the collection.\nAll other values are retrieved OK.\nWhat's wrong with the int type?", "output": "Have you tried setting the \"key\" value for that field? \nUnmarshal\n\nThe lowercased field name is used as the key for each exported field,\n  but this behavior may be changed using the respective field tag.\n\ntype Subscription struct {\n    Id              bson.ObjectId    \"_id,omitempty\"\n    Listen          string\n    Job             string\n    TimeoutSeconds  int     \"TimeoutSeconds\"\n    Data            string\n}\n\nThe other fields are working fine because their lowercase value matches your Mongo fields in the collection, whereas TimeoutSeconds is using the TitleCase. What is happening is the int field is being left at its zero value, since the Unmarshal can't map a field to it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How does one use a variable name with the same name as a package in Go?\n\nQuestion:\nA common variable name for files or directories is \"path\".  Unfortunately that is also the name of a package in Go.  Besides, changing path as a argument name in DoIt, how do I get this code to compile?\npackage main\n\nimport (\n    \"path\"\n    \"os\"\n)\n\nfunc main() {\n    DoIt(\"file.txt\")\n}\n\nfunc DoIt(path string) {\n    path.Join(os.TempDir(), path)\n}\n\nThe error I get is:\n$6g pathvar.go \npathvar.go:4: imported and not used: path\npathvar.go:13: path.Join undefined (type string has no field or method Join)", "output": "The path string is shadowing the imported path. What you can do is set imported package's alias to e.g. pathpkg by changing the line \"path\" in import into pathpkg \"path\", so the start of your code goes like this\npackage main\n\nimport (\n    pathpkg \"path\"\n    \"os\"\n)\n\nOf course then you have to change the DoIt code into:\npathpkg.Join(os.TempDir(), path)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to subclass a window in Windows? (using Go)\n\nQuestion:\nI want to sub-class the actual window to detect when its size has changed. \nThis is the code relevant where I've tried to subclassing it, using CallWindowProcW and SetWindowLongW, but it does not show any message when I maximize the window, so I'm supposed I've set wrongly some of those procedures. How to do it?\nvar oldWindowProc uintptr\n\nfunc windowProc(hwnd syscall.Handle, msg uint32, wparam, lparam uintptr) (rc uintptr) {\n    switch msg {\n    case WM_SIZE:\n        fmt.Println(\"Size\")\n        if wparam == SIZE_MAXIMIZED {\n            fmt.Println(\"Changed!\")\n        }\n    default:\n        return CallWindowProcW(oldWindowProc, hwnd, msg, wparam, lparam)\n    }\n    return 0\n}\n\nfunc main() {\n    oldWindowProc, _ = SetWindowLongW(syscall.Stdin, GWLP_WNDPROC,\n        syscall.NewCallback(windowProc))\n\n    for {\n\n    }\n}", "output": "I don't know much about winapi, but it seems your code closely resembles an example of go-winapi wrapper\nAnd using that wrapper lib, this modified version seems to work for me:\n(Full code)\nsnip\n// window procedure\nfunc WndProc(hwnd winapi.HWND, msg uint32, wparam uintptr, lparam uintptr) uintptr {\n    switch msg {\n    case winapi.WM_SIZE:\n        if wparam == SIZE_MAXIMIZED {\n            fmt.Println(\"Changed!\")\n        }\n    }\n    // call original procedure\n    return winapi.CallWindowProc(uintptr(oldWndProc), hwnd, msg, wparam, lparam)\n}\n\nI am sure you could look at that wrapper lib and derive the more direct way of doing it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go - convert string which represent binary number into int\n\nQuestion:\nI wrote a stupid solution for this, any better recipe?\nAs you can see lots of useless conversions there.\npackage main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"math\"\n)\n\nfunc conv(str string) int {\n    l := len(str)\n    result := 0.0\n    for i,n := range str {\n        number,_ := strconv.Atof64(string(n))\n        result += math.Exp2(float64(l-i-1))*number\n    }\n    return int(result)\n}\n\nfunc main() {\n    fmt.Println(conv(\"1001\"))\n}", "output": "You want the strconv.ParseInt function, which converts from an arbitrary base, into a given bit size.\npackage main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    if i, err := strconv.ParseInt(\"1001\", 2, 64); err != nil {\n        fmt.Println(err)\n    } else {\n        fmt.Println(i)\n    }\n}\n\nPlayground"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: OpenGL Vertex Buffer doesn't draw anything in golang\n\nQuestion:\nI tried to use this tutorial with Golang: http://www.opengl-tutorial.org/beginners-tutorials/tutorial-2-the-first-triangle/\nThe go-version opens the window and makes the background blue, but it doesn't show the triangle. The c-version does show it.\nThis is the code in Go:\nerr := glfw.Init()\nif err != nil {\n    log.Fatal(\"Failed to init GLFW: \" + err.Error())\n}\n\nerr = glfw.OpenWindow(1024, 768, 0,0,0,0, 32,0, glfw.Windowed)\nif err != nil {\n    log.Fatal(\"Failed to open GLFW window: \" + err.Error())\n}\n\nif gl.Init() != 0 {\n    log.Fatal(\"Failed to init GL\")\n}\n\ngl.ClearColor(0.0, 0.0, 0.3, 0.0)\n\n// create vertexbuffer\ngVertexBufferData := []float32{-1.0,-1.0,0.0, 1.0,-1.0,0.0, 0.0,1.0,0.0}\nvertexBuffer := gl.GenBuffer()\nvertexBuffer.Bind(gl.ARRAY_BUFFER)\ngl.BufferData(gl.ARRAY_BUFFER, len(gVertexBufferData), gVertexBufferData, gl.STATIC_DRAW)\n\nfor {\n    // clear screen\n    gl.Clear(gl.COLOR_BUFFER_BIT)\n\n    // first attribute buffer: vertices\n    var vertexAttrib gl.AttribLocation = 0\n    vertexAttrib.EnableArray()\n    vertexBuffer.Bind(gl.ARRAY_BUFFER)\n    var f float32 = 0.0\n    vertexAttrib.AttribPointer(\n        3,     // size\n        false, // normalized?\n        0,     // stride\n        &f) // array buffer offset\n\n    // draw the triangle\n    gl.DrawArrays(gl.TRIANGLES, 0, 3)\n\n    vertexAttrib.DisableArray()\n\n    glfw.SwapBuffers()\n}\n\nAnd this is the code in c which works:\nif(!glfwInit())\n    return -1;\n\nif(!glfwOpenWindow( 1024, 768, 0,0,0,0, 32,0, GLFW_WINDOW ))\n    return -1;\n\nif(glewInit() != GLEW_OK)\n    return -1;\n\nglClearColor(0.0f, 0.0f, 0.3f, 0.0f);\n\nGLuint VertexArrayID;\nglGenVertexArrays(1, &VertexArrayID);\nglBindVertexArray(VertexArrayID);\n\nstatic const GLfloat g_vertex_buffer_data[] = { \n    -1.0f, -1.0f, 0.0f,\n    1.0f, -1.0f, 0.0f,\n    0.0f,  1.0f, 0.0f,\n};\nGLuint vertexbuffer;\nglGenBuffers(1, &vertexbuffer);\nglBindBuffer(GL_ARRAY_BUFFER, vertexbuffer);\nglBufferData(GL_ARRAY_BUFFER, sizeof(g_vertex_buffer_data), g_vertex_buffer_data, GL_STATIC_DRAW);\n\nwhile(1) {\n    glClear( GL_COLOR_BUFFER_BIT );\n\n    // 1rst attribute buffer : vertices\n    glEnableVertexAttribArray(0);\n    glBindBuffer(GL_ARRAY_BUFFER, vertexbuffer);\n    glVertexAttribPointer(\n        0,\n        3, // size\n        GL_FLOAT, // type\n        GL_FALSE, // normalized?\n        0, // stride\n        (void*)0 // array buffer offset\n    );\n\n    // Draw the triangle !\n    glDrawArrays(GL_TRIANGLES, 0, 3); // From index 0 to 3 -> 1 triangle\n\n    glDisableVertexAttribArray(0);\n\n    // Swap buffers\n    glfwSwapBuffers();\n}\n\nMaybe I give vertexAttrib.AttribPointer() the wrong arguments, because I'm not sure what to give it instead of (void*)0. I tried nil, but that caused the application to crash. &gVertexBufferData[0] doesn't work either.\nI'm using github.com/banthar/gl as glew-wrapper, go 1.0.2 and ubuntu 12.04 amd64.\nEDIT update:\nglGetError doesn't give any errors", "output": "I had the same problem and I managed to fix it after looking at your post, so first of all thanks a lot.\nI managed to display a triangle by using the work branch of banthar bindings with this call to AttribPointer:\nvertexAttrib.AttribPointer(\n        3,     // size\n        gl.FLOAT, //type\n        false, // normalized?\n        0,     // stride\n        nil) // array buffer offset\n\nand by passing the size in bytes to BufferData.\n[...]\ndata := []float32{0, 1, 0, -1, -1, 0, 1, -1, 0}\n[...]\ngl.BufferData(gl.ARRAY_BUFFER, len(data)*4, data, gl.STATIC_DRAW)\n[...]\n\nThere is probably a better way to pass the right length."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: text/template issue Parse() vs. ParseFiles()\n\nQuestion:\nI'm trying to do some simple work with the text/template package.  The sample given at the top of template is what I'm working with.\nHow do I write the 'parsed' file so template.ParseFiles() properly reads and executes it?\npackage main\n\nimport (\n    \"text/template\"\n    \"os\"\n)\n\ntype Inventory struct {\n    Material string\n    Count    uint\n}\n\nfunc main() {\n    sweaters := Inventory{\"wool\", 17}\n    tmpl, err := template.New(\"test\").Parse(\"{{.Count}} items are made of {{.Material}}\")\n    // tmpl, err := template.New(\"test\").ParseFiles(\"file.txt\")\n\n    if err != nil { panic(err) }\n    err = tmpl.Execute(os.Stdout, sweaters)\n    if err != nil { panic(err) }\n}\n\n/*\nContents of file.txt:\n{{.Count}} items are made of {{.Material}}\n\nError thrown:\npanic: template: test:1: \"test\" is an incomplete or empty template\n\ngoroutine 1 [running]:\nmain.main()\n    /tmp/templates/t.go:19 +0x21a\n\ngoroutine 2 [syscall]:\ncreated by runtime.main\n    /var/tmp/portage/dev-lang/go-1.0.1/work/go/src/pkg/runtime/proc.c:221\n*/\n\nI have a copy of this code posted at the golang playground here\nEdit #1:\nI've been doing some research on this issue... since it's the Execute() method that actually throws the exception, and not the ParseFiles() part, I checked the method definition:\n// Execute applies a parsed template to the specified data object,\n// and writes the output to wr.\nfunc (t *Template) Execute(wr io.Writer, data interface{}) (err error) {\n    defer errRecover(&err)\n    value := reflect.ValueOf(data)\n    state := &state{\n        tmpl: t,\n        wr:   wr,\n        line: 1,\n        vars: []variable{{\"$\", value}},\n    }\n    if t.Tree == nil || t.Root == nil {\n        state.errorf(\"%q is an incomplete or empty template\", t.name)\n    }\n    state.walk(value, t.Root)\n    return\n}\n\nSo, on a hunch, I dumped the value of t.Tree for the inline 'non-file' style, tmpl is: &parse.Tree{Name:\"test\", Root:(*parse.ListNode)(0xf840030700), funcs:[]map[string]interface {}(nil), lex:(*parse.lexer)(nil), token:[2]parse.item{parse.item{typ:6, val:\"\"}, parse.item{typ:9, val:\"{{\"}}, peekCount:1, vars:[]string(nil)} and\n when ran with ParseFiles(), tmpl is: (*parse.Tree)(nil).  I find it odd that one is a dereference, and one value is a pointer.  This may help solve the riddle", "output": "sweaters := Inventory{\"wool\", 17}\ntmpl, err := template.ParseFiles(\"file.txt\")\nif err != nil {\n    panic(err)\n}\nerr = tmpl.ExecuteTemplate(os.Stdout, \"file.txt\", sweaters)\nif err != nil {\n    panic(err)\n}\n\nIf you have many files, you can use ParseGlob:\ntmpl, err := template.ParseGlob(\"*.txt\")\nif err != nil {\n    panic(err)\n}\nerr = tmpl.ExecuteTemplate(os.Stdout, \"file.txt\", sweaters)\nif err != nil {\n    panic(err)\n}\nerr = tmpl.ExecuteTemplate(os.Stdout, \"file2.txt\", sweaters)\nif err != nil {\n    panic(err)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to get last-accessed date and time of file in Go?\n\nQuestion:\nDoes anyone know how to check for a file access date and time? The function returns the modified date and time and I need something that compares the accessed date time to the current date and time.", "output": "You can use os.Stat to get a FileInfo struct which also contains the last access time (as well as the last modified and the last status change time).\ninfo, err := os.Stat(\"example.txt\")\nif err != nil {\n     // TODO: handle errors (e.g. file not found)\n}\n// info.Atime_ns now contains the last access time\n// (in nanoseconds since the unix epoch)\n\nAfter that, you can use time.Nanoseconds to get the current time (also in nanoseconds since the unix epoch, January 1, 1970 00:00:00 UTC). To get the duration in nanoseconds, just subtract those two values:\nduration := time.Nanoseconds() - info.Atime_ns"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there an equivalent of goroutines in D?\n\nQuestion:\nI love Go, especially the goroutines. They are simple and efficient. After some digging, it seems that they are basically fibers multiplexed onto a pool of kernel threads (correct me if I'm wrong).\nThat being said, are there any standard libraries (or relatively popular and supported 3rd party additions) in D?\nThe main things I want are:\n\nLightweight- threads use too much memory and take too much CPU\nSimple- data-sharing isn't too important, but simple message passing is\nManaged- it would be nice for this to be at the run-time level\n\nThe main goal here is to make a web server as efficiently as possible to rival the speed of Node.js and Go. This means there could be many active connections (http, websockets, data streaming).\nI like things about the other platforms mentioned, but D is much more generalized. If it isn't too clunky, I would choose D over the others.", "output": "There's nothing exactly equivalent but there are two modules that may provide something similar enough for your needs:\n\nstd.concurrency provides message passing and guaranteed isolation unless the shared qualifier is used to gain very limited, explicit shared memory.  However, you don't (yet) get the multiplexing of fibers onto threads that goroutines provide.  Right now, every call to spawn starts a new OS thread.  Also, there's still some work to be done to make immutability usable enough to make this paradigm reach its full potential.  For more on this paradigm, see the free chapter of Andrei Alexandrescu's \"The D Programming Language\".\nstd.parallelism provides tasks.  It's geared towards parallelism, not concurrency.  (These are not the same thing even though you need concurrency to implement parallelism.)  Therefore, instead of message passing, a task simply executes with no communication with the calling thread and then returns its return value to the calling thread.  Additionally, if there are more tasks than threads, the excess tasks are queued, not multiplexed using fibers.\n\nEdit:  I originally designed and wrote std.parallelism and am willing to consider enhancement requests to suit needs such as yours, as long as they don't expand the scope of the module too far into general-case concurrency.  If std.parallelism does almost what you need but not quite, please post a feature request either here or on the digitalmars.d newsgroup.  \nAlso, even though I would likely not be the implementer of such a request, feel free to suggest enhancements to std.concurrency."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reading a non UTF-8 text file in Go\n\nQuestion:\nI need to read a text file that is encoded in GBK. The standard library in Go programming language assumes that all text is encoded in UTF-8.\nHow can I read files in other encodings?", "output": "Previously (as mentioned in an older answer) the \"easy\" way to do this involved using third party packages that needed cgo and wrapped the iconv library. That is undesirable for many reasons. Thankfully, for quite a while now there has been a superior all Go way of doing this using only packages provided by the Go Authors (not in the main set of packages but in the Go Sub-Repositories).\nThe golang.org/x/text/encoding package defines an interface for generic character encodings that can convert to/from UTF-8. The golang.org/x/text/encoding/simplifiedchinese sub-package provides GB18030, GBK and HZ-GB2312 encoding implementations.\nHere is an example of reading and writing a GBK encoded file. Note that the io.Reader and io.Writer do the encoding \"on the fly\" as data is being read/written.\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n\n    \"golang.org/x/text/encoding/simplifiedchinese\"\n    \"golang.org/x/text/transform\"\n)\n\n// Encoding to use. Since this implements the encoding.Encoding\n// interface from golang.org/x/text/encoding you can trivially\n// change this out for any of the other implemented encoders,\n// e.g. `traditionalchinese.Big5`, `charmap.Windows1252`,\n// `korean.EUCKR`, etc.\nvar enc = simplifiedchinese.GBK\n\nfunc main() {\n    const filename = \"example_GBK_file\"\n    exampleWriteGBK(filename)\n    exampleReadGBK(filename)\n}\n\nfunc exampleReadGBK(filename string) {\n    // Read UTF-8 from a GBK encoded file.\n    f, err := os.Open(filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n    r := transform.NewReader(f, enc.NewDecoder())\n\n    // Read converted UTF-8 from `r` as needed.\n    // As an example we'll read line-by-line showing what was read:\n    sc := bufio.NewScanner(r)\n    for sc.Scan() {\n        fmt.Printf(\"Read line: %s\\n\", sc.Bytes())\n    }\n    if err = sc.Err(); err != nil {\n        log.Fatal(err)\n    }\n\n    if err = f.Close(); err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc exampleWriteGBK(filename string) {\n    // Write UTF-8 to a GBK encoded file.\n    f, err := os.Create(filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n    w := transform.NewWriter(f, enc.NewEncoder())\n\n    // Write UTF-8 to `w` as desired.\n    // As an example we'll write some text from the Wikipedia\n    // GBK page that includes Chinese.\n    _, err = fmt.Fprintln(w,\n        `In 1995, China National Information Technology Standardization\nTechnical Committee set down the Chinese Internal Code Specification\n(Chinese: 汉字内码扩展规范（GBK）; pinyin: Hànzì Nèimǎ\nKuòzhǎn Guīfàn (GBK)), Version 1.0, known as GBK 1.0, which is a\nslight extension of Codepage 936. The newly added 95 characters were not\nfound in GB 13000.1-1993, and were provisionally assigned Unicode PUA\ncode points.`)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err = f.Close(); err != nil {\n        log.Fatal(err)\n    }\n}\n\nPlayground"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: go programming language bracket pair style\n\nQuestion:\nI'm just new to learn Go, when I try my first hello world with this style:\nfunc main()\n{\n      ...somemagic...\n}\n\nand the 6g compiler says that's wrong.\nBut with this style:\nfunc main(){\n      ...somemagic...\n}\n\nThat's OK.\nIs the first bracket pair style illegal in Go?", "output": "Yes. That's a result of automatic semicolon insertion in Go.\nBy the way, Go developers format their code using gofmt and follow that formatting."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: strconv.Itoa(time.Nanoseconds()) - Error\n\nQuestion:\nI write one go code like this, strconv.Itoa(time.Nanoseconds()). But, it is giving me this error \"cannot use time.Nanoseconds() (type int64) as type int in function argument\". How can I solve this ?", "output": "For example,\npackage main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"time\"\n)\n\nfunc main() {\n    t := strconv.FormatInt(time.Nanoseconds(), 10)\n    fmt.Println(t)\n}\n\nOutput:\n1322756865962046000"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reading and working with an external file in the Go programming language\n\nQuestion:\nI have been learning the Go programming language by doing some of the Project Euler problems. I am now on [problem 13] (http://projecteuler.net/problem=13). It contains an external file with 100 lines of 50 digit numbers. My question is: How can this file be read into a Go program and worked with? Does Go have a readlines function? I've read about the io and ioutil packages, and about all I can come up with is reading in the file and printing it; however, I am not sure how to work with the file... Can it be assigned to a variable? Is there a readlines function, etc...\nAny help would be appreaciated.\nHere is what I have so far:\npackage main\n\nimport \"fmt\"\nimport \"io/ioutil\"\n\nfunc main() {\n        fmt.Println(ioutil.ReadFile(\"one-hundred_50.txt\"))\n}", "output": "There are ways to read a file line by line (and there are examples if you search here on SO) but really ioutil.ReadFile is a good start there.  Sure you can assign it to a variable.  Look at the function signature for ReadFile and see how it returns both a byte slice and an error.  Assign both; check that the error is nil.  Print the error if it's not nil so you can see what's wrong.  Then once you have the bytes in a variable, try spitting it up by lines.  Try bytes.Split, or easier, convert it to a string and use strings.Split."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Name clashes in Go imports\n\nQuestion:\nConsider the Go code below.. \npackage main\n\nimport \"go/token\"\nimport \"python/token\"\n\nfunc main() {\n     x := token.INDENT\n}\n\nWhat is the best way to solve the ambiguity of token in the above code? Is there something similar to the python expression of import python.token as pytoken?", "output": "For example,\npackage main\n\nimport \"go/token\"\nimport pytoken \"python/token\"\n\nfunc main() {\n     g := token.INDENT    // \"go/token\"\n     p := pytoken.INDENT  // \"python/token\"\n}\n\nImport declarations"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Dialing a jsonrpc connection to bitcoin\n\nQuestion:\npackage main\n\nimport \"rpc/jsonrpc\"\nimport \"fmt\"\n\nfunc main() {\n    rc, e := jsonrpc.Dial(\"tcp\", \"user:pass@localhost:8332\")\n    if e != nil {fmt.Print(e);return;}\n\n    var blocks float64\n    rc.Call(\"getblockcount\", \"\", &blocks)\n    if e != nil {fmt.Print(e); return;}\n    fmt.Print(\"%f blocks\", blocks)\n}\n\nGives me the following error: \ndial tcp user:pass@localhost:8332: too many colons in address user:pass@localhost:8332\nHow do I authenticate my rpc connection?", "output": "testRequest := `{\"jsonrpc\": \"1.0\", \"id\":\"\", \"method\": \"help\", \"params\": []}`\n\nrequest, e := http.NewRequest(\"POST\", brpc.addr, strings.NewReader(testRequest))\nrequest.SetBasicAuth(brpc.user, brpc.pass)\n\nresponce, e := brpc.c.Do(request)\n// responce.Body has the result"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Cassandra datastore client in Go language\n\nQuestion:\nIs it possible to write client for Cassandra datastore in Go language?", "output": "The best Cassandra client is currently github.com/tux21b/gocql, however that's likely to change in the next few months."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to compile Go program consisting of multiple files?\n\nQuestion:\nI have a small program that consists of three files, all belonging to the same package (main). But when I do go build main.go the build doesn't succeed. When it was just one file (main.go), everything worked fine.\nNow that I took some effort to separate the code, it looks like the compiler is unable to find the stuff that was taken out of main.go and put into these two other files (that reside in the same directory as the main.go). Which results in undefined 'type' errors.\nHow to compile this program that consists of multiple files?", "output": "New Way (Recommended):\nPlease take a look at this answer.\nOld Way:\nSupposing you're writing a program called myprog :\nPut all your files in a directory like this\nmyproject/go/src/myprog/xxx.go\n\nThen add myproject/go to GOPATH\nAnd run \ngo install myprog\n\nThis way you'll be able to add other packages and programs in myproject/go/src if you want.\nReference : http://golang.org/doc/code.html\n(this doc is always missed by newcomers, and often ill-understood at first. It should receive the greatest attention of the Go team IMO)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Cannot use (*struct) as (*interface) in field value\n\nQuestion:\nI have the following code:\n// eventloop.go\ntype Object interface {\n    ActivateSlot(name string, parameters vector.Vector);\n}\n\n\n\n// main.go\nimport loop \"./eventloop\"\n\n// ...\n\nconst slotname = \"printer\"\n\ntype printer struct {\n    slot loop.Slot;\n}\n\nfunc (p *printer) Init() {\n    p.slot = loop.Slot{slotname, p}; // offending line\n}\n\nfunc (p *printer) ActivateSlot(name string, parameters vector.Vector) {\n    fmt.Println(\"Slot called: \", name); \n}\n\nWhen I try to compile, I get the following error:\njurily@jurily ~/workspace/go $ ./build.sh\nmain.go:23: cannot use p (type *printer) as type *eventloop.Object in field value\n\nIf I comment the offending line out, it compiles and runs fine. What's happening here? What am I missing?", "output": "Update:\nThis code compiles fine here (all in the same package):\ntype Object interface {\n    ActivateSlot(name string, parameters vector.Vector);\n}\ntype Slot struct {\n  name string;\n  stuff Object;\n}\n\nconst slotname = \"printer\"\ntype printer struct {\n    slot Slot;\n}\nfunc (p *printer) Init() {\n    p.slot = Slot{slotname, p}; // offending line\n}\nfunc (p *printer) ActivateSlot(name string, parameters vector.Vector) {\n    fmt.Println(\"Slot called: \", name);\n}\n\nIt seems that what you are missing is that *printer is of type Object, and you are trying to assign it to a field of type *Object, which is a different type.\nIn most cases you would write it like above - without pointers to interface types - but if you have to, you can make it compile like this:\ntype Slot struct {\n  name string;\n  stuff *Object;\n}\nfunc (p *printer) Init() {\n     var o Object = p;\n    p.slot = Slot{slotname, &o}; // offending line\n}\n\nSo p is an Object, you need to take the address of p to match the *Object specification."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How does Go update third-party packages?\n\nQuestion:\nLooking how actively golang packages grow and improve I wonder how the problem with package versions is solved?\nI see that one way is to store third-party packages under a project folder.\nBut what if I install it with go get?", "output": "go get will install the package in the first directory listed at GOPATH (an environment variable which might contain a colon separated list of directories). You can use go get -u to update existing packages.\nYou can also use go get -u all to update all packages in your GOPATH\nFor larger projects, it might be reasonable to create different GOPATHs for each project, so that updating a library in project A wont cause issues in project B.\nType go help gopath to find out more about the GOPATH environment variable."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Strange behavior of go routine\n\nQuestion:\nI just tried the following code, but the result seems a little strange. It prints odd numbers first, and then even numbers. I'm really confused about it. I had hoped it outputs odd number and even number one after another, just like 1, 2, 3, 4... . Who can help me?\npackage main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    go sheep(1)\n    go sheep(2)\n    time.Sleep(100000)\n}\n\nfunc sheep(i int) {\n    for ; ; i += 2 {\n        fmt.Println(i,\"sheeps\")\n    }\n}", "output": "More than likely you are only running with one cpu thread. so it runs the first goroutine and then the second. If you tell go it can run on multiple threads then both will be able to run simultaneously provided the os has spare time on a cpu to do so. You can demonstrate this by setting GOMAXPROCS=2 before running your binary. Or you could try adding a runtime.Gosched() call in your sheep function and see if that triggers the runtime to allow the other goroutine to run.\nIn general though it's better not to assume ordering semantics between operations in two goroutines unless you specify specific synchronization points using a sync.Mutex or communicating between them on channels."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Treatment of Arrays in Go\n\nQuestion:\nHaving read the following at http://golang.org/doc/effective_go.html#arrays...\n\n\nArrays are values. Assigning one array to another copies all the\n  elements.\nIn particular, if you pass an array to a function, it will receive a copy\n  of the array, not a pointer to it.\n\n\n... I expect in the following code that arr2 to be distinct from arr, and main()'s arr to be distinct from shuffle()'s arr. Can someone please explain why the following code shuffles arr2? I know Go is still a young language; perhaps the treatment of arrays has changed?\npackage main\n\nimport (\n        \"fmt\"\n        \"rand\"\n        \"time\"\n)\n\nfunc shuffle(arr []int) {\n        rand.Seed(time.Nanoseconds())\n        for i := len(arr) - 1; i > 0; i-- {\n                j := rand.Intn(i)\n                arr[i], arr[j] = arr[j], arr[i]\n        }\n}\n\nfunc main() {\n        arr := []int{1, 2, 3, 4, 5}\n        arr2 := arr\n        shuffle(arr)\n        for _, i := range arr2 {\n                fmt.Printf(\"%d \", i)\n        }\n}", "output": "I think your problem is that you're confusing arrays and slices.\nArrays are fixed-length lists of values. You're actually not using any arrays in your example. Arrays can be declared a few ways:\narr1 := [3]int{1, 2, 3}   // an array of 3 integers, 1-3\narr2 := [...]int{1, 2, 3} // same as the previous line, but we're letting\n                          // the compiler figure out the size of the array\nvar arr3 [3]int           // a zeroed out array of 3 integers\n\nYou're using slices. A slice is a reference to an underlying array. There are a few ways to allocate new slices:\nslice1 := []int{1, 2, 3}    // a slice of length 3 containing the integers 1-3\nslice2 := make([]int, 3)    // a slice of length 3 containing three zero-value integers\nslice3 := make([]int, 3, 5) // a slice of length 3, capacity 5 that's all zeroed out\n\nAny other slice assignments are just duplicating a reference to an array.\nNow that we've established that, the line\narr := []int{1, 2, 3, 4, 5}\n\ncreates a slice referencing an anonymous underlying array that contains the numbers 1-5.\narr2 := arr\n\nduplicates that reference -- it does not copy the underlying array. So there's one underlying array and two references to it. That's why the contents of arr2 change when you modify the contents of arr. They're referencing the same array."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: D or Go for clustered game server\n\nQuestion:\nI'm designing a game, but this question is applicable to any situation that requires bidirectional communication between nodes in a cluster and a main server.  I am pretty new to clusters, but I actively program in Go and occasionally in D.\nI really want to use a modern language (not C/C++), so I've chosen these two languages because:\n\nArray slices\nGood concurrency support\nCross platform & compiles natively (with multiple compiler implementations)\nGC (both working on a precise GC)\n\nI've read https://stackoverflow.com/questions/3554956/d-versus-go-comparison and  The D Programming Language for Game Development.\nAt a high level, my game will do most of the processing server side, with the client just rendering the game state from their perspective. The game is designed to scale, so it will need to act in a cluster. Components are mostly CPU bound, and update to a main server asynchronously, which shares game state with clients. Most computation depends on user input, so these events need to be sent down to individual components (hence bi-directional RPC).\nReasons I like D:\n\nManual memory management\nTemplates/CTFE\nCode safety (@safe, contracts, in/out)\n\nReasons I like Go:\n\nStandard library (pprof, RPC)\nGo routines\ngo tool (esp. go get -u to install/update remote dependencies)\n\nThe client will likely be written in D, but that shouldn't have an impact on the server.\nI am leaning towards D because manual memory management is baked into the language. While it doesn't have the nice libraries for RPC, I could theoretically implement that, but I cannot as elegantly implement manual memory management in Go.\nWhich would you use for this problem given the choice between the two languages?", "output": "I expect that either will work and that a lot of it depends on which you prefer, though if you're doing the client in D, I'd advise doing the server in D simply because then there are fewer languages involved. If you use two languages, then anyone working on your project generally has to know them both, and both Go and D are small enough in terms of their user base at this point that few people will know both - though if it's just you working on it, you obviously know both of them already.\nHowever, I would point out that if the problem with using D is the lack of an RPC library, then that isn't a problem, because D is supported by Apache Thrift. So, D does have a solid RPC library, even if it's not in its standard library (in fact, it was one of the fruits of D's first round of participation in Google's Summer of Code)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go - Example about crypto/rand\n\nQuestion:\nCould put a little example about the use of crypto/rand [1]? \nThe function Read has as parameter an array of bytes. Why? If it access to /dev/urandom to get the random data.\nfunc Read(b []byte) (n int, err os.Error)\n\n[1] http://golang.org/pkg/crypto/rand/", "output": "func Read(b []byte) (n int, err os.Error)\n\nRead is a helper function that calls Reader.Read. Reader is defined as: var Reader io.Reader.\ncrypto/rand/\nio.Reader is the interface that wraps the basic Read method.\nRead reads up to len(p) bytes into p. It returns the number of bytes read (0 <= n <= len(p)) and any error encountered. Even if Read returns n < len(p), it may use all of p as scratch space during the call. If some data is available but not len(p) bytes, Read conventionally returns what is available rather than block waiting for more.\nAt the end of the input stream, Read returns 0, os.EOF. Read may return a non-zero number of bytes with a non-nil err. In particular, a Read that exhausts the input may return n > 0, os.EOF.\ntype Reader interface {\n    Read(p []byte) (n int, err os.Error)\n}\n\nio/#Reader\nFor example, to read the first 16 random bytes,\npackage main\n\nimport (\n    \"fmt\"\n    \"crypto/rand\"\n)\n\nfunc main() {\n    b := make([]byte, 16)\n    n, err := rand.Read(b)\n    fmt.Println(n, err, b)\n}\n\nUsing a package init() function, crypto/rand defaults to using /dev/urandom.\n// Easy implementation: read from /dev/urandom.\n// This is sufficient on Linux, OS X, and FreeBSD.\nfunc init() { Reader = &devReader{name: \"/dev/urandom\"} }\n\ncrypto/rand/rand.go"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a Go Language equivalent to Perls' Dumper() method in Data::Dumper?\n\nQuestion:\nI've looked at the very similarly titled post (Is there a C equivalent to Perls' Dumper() method in Data::Dumper?), regarding a C equivalent to Data::Dumper::Dumper();. I have a similar question for the Go language.\nI'm a Perl Zealot by trade, and am a progamming hobbyist, and make use of Data::Dumper and similar offspring literally hundreds of times a day. I've taken up learning Go, because it looks like a fun and interesting language, something that will get me out of the Perl rut I'm in, while opening my eyes to new ways of doing stuffz... One of the things I really want is something like:\nfmt.Println(dump.Dumper(decoded_json))\n\nto see the resulting data structure, like Data::Dumper would turn the JSON into an Array of Hashes. Seeing this in Go, will help me to understand how to construct and work with the data. Something like this would be considered a major lightbulb moment in my learning of Go.\nContrary to the statements made in the C counterpart post, I believe we can write this, and since I'll be passing Dumper to Println, after compilation what ever JSON string or XML page I pass in and decode. I should be able to see the result of the decoding, in a Dumper like state... So, does any more know of anything like this that exists? or maybe some pointers to getting something like this done?", "output": "I found a couple packages to help visualize data in Go.\nMy personal favourite - https://github.com/davecgh/go-spew\nThere's also - https://github.com/tonnerre/golang-pretty"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Store hexdecimal value as byte results in missing\n\nQuestion:\nI tried to store a hexdecimal value like \nurl.Values{&#34;key&#34;: {&#34;Value&#34;}, &#34;id&#34;: {&#34;123&#34;}})\n&#34;\n\nin a []byte value on Google Appengine Datastore.\nfoo := Bar{\n    HexdecimalContent:    []byte(content)\n}\n\nIf I try to read this, all hexdecimal values    like &34; will result in a \"(MISSING)\" (other characters are shown correct!).\nNow I save the data encoded in base64. \nBut why, is it needed to encode it in base64?", "output": "You should consider using encoding/json package for serializing map types into the datastore\nvalues := map[string]string{\"key1\": \"value1\", \"key2\": \"value2\"}\nbytes, err := json.Marshal(values)\nif err != nil {\n    return err\n}   \nfoo := &Bar{Content: bytes}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go Tour Exercise #7: Walking the tree\n\nQuestion:\nI completed the go tour exercise for tree comparisons (#69) and was able to effectively compare two trees.\nHere is the code\npackage main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/tour/tree\"\n)\n\n// Walk walks the tree t sending all values\n// from the tree to the channel ch.\nfunc Walk(t *tree.Tree, ch chan int) {\n    if t == nil {\n        return\n    }\n    Walk(t.Left, ch)\n    ch <- t.Value\n    Walk(t.Right, ch)\n}\n\n// Same determines whether the trees\n// t1 and t2 contain the same values.\nfunc Same(t1, t2 *tree.Tree) bool {\n    c := make(chan int)\n    c2 := make(chan int)\n    go Walk(t1, c)\n    go Walk(t2, c2)\n    for i := 0; i < 10; i++ {\n        if <-c != <-c2 {\n            return false\n        }\n    }\n    return true\n}\n\nfunc main() {\n    fmt.Println(Same(tree.New(1), tree.New(1)))\n}\n\nThe part that confuses me is that if I switch around the order of the commands in the walk function to be\n    ch <- t.Value\n    Walk(t.Right,ch)\n    Walk(t.Left,ch)\n\nthe comparison no longer works. I tried printing out the results of Walk(tree.New(1),c) twice and oddly the first call printed\n    10,5,7,9...\n\nwhile the second call of Walk(tree.New(1),c) printed\n    7,9,10,8...\n\nWhy does calling the same function twice result in two different outputs when switching the order of the walk commands?", "output": "First you need to understand the properties of the tree. The tree is setup so that a number to the Left is always less than the current node's value. A number to the Right is always more.\nTherefore, if you wanted to find the smallest number, all you need to do is go \"Left\" at each node. If you go to the parent of the lowest number, you get the second lowest. The Right child of the second lowest may or may not be the third lowest. However, if you then take a Left at every chance from the Right child of the second lowest, you will end up at the third lowest. This is done until every node has been traversed. \nWhen you Walk() the tree, you are actually sorting the numbers.\nWalk(t.Left,ch)\nch <- t.Value\nWalk(t.Right,ch)\n\nThat goes Left, current, Right. Lowest, second lowest, third lowest.\nch <- t.Value\nWalk(t.Right,ch)\nWalk(t.Left,ch)\n\nThis goes current, Right, Left. Second lowest, third lowest, lowest. The issue with this ordering is that the order they come out depends on the order of the tree. In the first one, the elements in the tree, and not the order, are what mattered.\nWhat the Walk() function is really implementing is a portion of the tree sort algorithm. See: http://en.wikipedia.org/wiki/Tree_sort"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Profiling in GO - No symbols\n\nQuestion:\nI'm trying to profile a GO program using the procedure described here:\nhttp://blog.golang.org/2011/06/profiling-go-programs.html\n .\nHowever pprof shows addresses instead of function names in output:\n(pprof) top10\nTotal: 2113 samples\n     298  14.1%  14.1%      298  14.1% 0000000000464d34\n     179   8.5%  22.6%      179   8.5% 0000000000418e83\n     157   7.4%  30.0%      157   7.4% 0000000000418e60\n     112   5.3%  35.3%      112   5.3% 0000000000403293\n     101   4.8%  40.1%      101   4.8% 0000000000464d4f\n      83   3.9%  44.0%       83   3.9% 000000000040329c\n      77   3.6%  47.7%       77   3.6% 0000000000418e7a\n      62   2.9%  50.6%       62   2.9% 0000000000456a38\n      37   1.8%  52.3%       37   1.8% 0000000000418e41\n      37   1.8%  54.1%       37   1.8% 0000000000435f57\n\nHas anyone experienced that and found a fix?\nThere is a mention here of a 6prof tool to be used in alternative to the procedure described above. Does anyone know if it's still maintained and where to find it?\nI'm using go1.0.2 on Win7 64.\nThanks!", "output": "I fixed the perl script to work under Windows.\nDetails here: http://exneehilo.blogspot.com.au/2012/07/profiling-go-with-pprof-under-windows.html"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How are message-passing concurrent languages better than shared-memory concurrent languages in practice\n\nQuestion:\nI've been a Java developer for many years but never had to deal too much with concurrency issues until I started doing Android development, and suddenly started finding \"application not responding\" and apparent deadlock situations.  \nThis made me realize how hard it can be to understand and to debug some of these concurrency issues.  How do new languages such as Scala and Go improve concurrency?  How are they more understandable and how do they prevent concurrency bugs? Can someone provide real-world examples that demonstrates the advantages?", "output": "The three main contenders for simplifying concurrency are actors, software transactional memory (STM), and automatic parallelization. Scala has implementations of all three.\nActors\nActors find their most notable implementation in the language Erlang, which as far as I know is where the idea started*. Erlang is designed from the ground up around actors.  The idea is that actors themselves are black boxes to each other; they interact only by passing messages.\nScala has an implementation of actors in its library, and variants are available in external libraries. In the main library, the black-box-ness is not enforced, but there are easy-to-use methods for passing messages, and Scala makes it easy to create immutable messages (so you don't have to worry that you send a message with some content, and then change the content at some random time).\nThe advantage of actors is that you don't have to worry about complex shared state, which really simplifies the reasoning involved.  Also, you can decompose the problem into smaller pieces than threads and let the actor library figure out how to bundle actors into the appropriate number of threads.\nThe downside is that if you are trying to do something complex, you have a lot of logic to deal with for sending messages, handling errors, and so on, before you know it succeeds.\nSoftware Transactional Memory\nSTM is based on the idea that the most important concurrent operation is to grab some shared state, fiddle with it, and write it back.  So it provides a means of doing this; however, if it encounters some problem--which it typically delays detecting until the very end, at which point it checks to make sure the writes all went correctly--it rolls back the changes and returns a failure (or tries again).\nThis is both high-performance (in situations with only moderate contention, since usually everything goes just fine) and robust to most sorts of locking errors, since the STM system can detect problems (and even potentially do things like take access away from a lower-priority request and give it to a higher-priority one).\nUnlike actors, it's easier to attempt complex things, as long as you can handle failure.  However, you also have to reason correctly about the underlying state; STM prevents rare unintentional deadlocks via failing and retrying, but if you've simply made a logic error and a certain set of steps cannot complete, STM cannot allow it to.\nScala has a STM library that is not part of the standard library but is being considered for inclusion.  Clojure and Haskell both have well-developed STM libraries.\nAutomatic Parallelization\nAutomatic parallelization takes the view that you don't want to think about concurrency; you just want stuff to happen fast.  So if you have some sort of parallel operation--applying some complex operation to a collection of items, one at a time, and producing some other collection as a result, for instance--you should have routines that automatically do this in parallel.  Scala's collections can be used in this way (there is a .par method that converts a conventional serial collection into its parallel analog).  Many other languages have similar features (Clojure, Matlab, etc.).\n\nEdit: Actually, the Actor model was described back in 1973 and was probably motivated by earlier work in Simula 67 (using coroutines instead of concurrency); in 1978 came the related Communicating Sequential Processes. So Erlang's capabilities were not unique at the time, but the language was uniquely effective at deploying the actor model."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to return a function in scala\n\nQuestion:\nHow can I return a function side-effecting lexical closure1  in Scala? \nFor instance, I was looking at this code sample in Go:\n...    \n// fib returns a function that returns\n// successive Fibonacci numbers.\nfunc fib() func() int {\n    a, b := 0, 1\n    return func() int {\n        a, b = b, a+b\n        return b\n    }\n}\n...\nprintln(f(), f(), f(), f(), f())\n\nprints \n    1 2 3 5 8\nAnd I can't figure out how to write the same in Scala.\n1. Corrected after Apocalisp comment", "output": "Slightly shorter, you don't need the return.\ndef fib() = {\n    var a = 0\n    var b = 1\n    () => { \n        val t = a;\n        a = b\n        b = t + b\n        b\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go Makefile confusion\n\nQuestion:\nI'm writing a Go package, let's call it coolstuff. I want to include an example.go file that runs examples from the coolstuff API. But the default Makefile won't build the coolstuff package and example.go, complaining:\nexample.go:1: package main; expected coolstuff\nexample.go:3: can't find import: coolstuff\n\nHow can I a) compile the package, b) install the package so that any future code I write will know how to find coolstuff, and c) build example.go, which depends on coolstuff?\nDo I need two Makefiles, one for the package and one for example.go?", "output": "There are several ways to do that.\n1) That's not exactly what you have described, but it is possible to add a file called example_test.go to your coolstuff package. If you just goinstall your package, this file will be ignored, however when you are executing gotest inside your coolstuff package, then gotest will automatically build your package including all *_test.go files and run them. That`s in my opinion the easiest way, since you do not have to deal with several packages and you can also provide many independent examples / test cases. Future go versions will be able to add those examples to your godoc pkg documentation.\n2) If you feel uncomfortable about using Makefiles, then you might want to take a closer look at goinstall. You can set the GOPATH environment variable to define your own project directory. An example directory structure which is suitable for goinstall is given at the bottom of the page. (\"bar\" is similar to your \"coolstuff pkg there, and \"qux\" might be your \"example\"). goinstall will figure out all those build dependencies automatically for you.\n3) Using Makefiles is also possible. Creating two of them, one which is based on Make.pkg for your coolstuff package directory and another one which is based on Make.cmd for your example directory sounds like a good idea. You can find some examples of go Makefiles here."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Convert **T to *unsafe.Pointer in Go\n\nQuestion:\nHow do I convert a variable of type **T to *unsafe.Pointer?\nThe example below will give the compilation error:  \n\ncannot convert &ptr (type **s) to type *unsafe.Pointer\n\npackage main\n\nimport (\n    \"sync/atomic\"\n    \"unsafe\"\n)\n\ntype s struct {\n    value int\n}\n\nfunc main(){\n    var ptr *s\n    a := &s{42}\n\n    old := ptr\n    atomic.CompareAndSwapPointer(\n        (*unsafe.Pointer)(&ptr), // &unsafe.Pointer(ptr)\n        unsafe.Pointer(old),\n        unsafe.Pointer(a))\n}\n\nIf I switch (*unsafe.Pointer)(&ptr) to &unsafe.Pointer(ptr), I will get this compilation error:\n\ncannot take the address of unsafe.Pointer(ptr)\n\nPs. I choose to make an example with sync/atomic because that is one situation where you actually have to do such a conversion.\nEdit\nOne incorrect solution would be to use a temporary variable:\nup := unsafe.Pointer(ptr)\natomic.CompareAndSwapPointer(&up, ...\n\nWhile it compiles, the CAS will only swap what is stored in up and not in ptr. This is not the desired result, as zeebo@#go-nuts pointed out.", "output": "mcef@#go-nuts posted the answer how to convert **T:\n\n(*unsafe.Pointer)(unsafe.Pointer(ptr)), where ptr is of type **T.\n\nzeebo@#go-nuts provided a working example (posted here with permission):\npackage main\n\nimport (\n    \"fmt\"\n    \"sync/atomic\"\n    \"unsafe\"\n)\n\ntype T struct {\n    value int\n}\n\nfunc Swap(dest **T, old, new *T) bool {\n    udest := (*unsafe.Pointer)(unsafe.Pointer(dest))\n    return atomic.CompareAndSwapPointer(udest,\n        unsafe.Pointer(old),\n        unsafe.Pointer(new),\n    )\n}\n\nfunc main() {\n    x := &T{42}\n    n := &T{50}\n    fmt.Println(*x, *n)\n\n    p := x\n    Swap(&x, p, n)\n    fmt.Println(*x, *n)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Mutual Exclusion of Concurrent Goroutines\n\nQuestion:\nIn my code there are three concurrent routines. I try to give a brief overview of my code,\nRoutine 1 {\ndo something\n\n*Send int to Routine 2\nSend int to Routine 3\nPrint Something\nPrint Something*\n\ndo something\n}\n\nRoutine 2 {\ndo something\n\n*Send int to Routine 1\nSend int to Routine 3\nPrint Something\nPrint Something*\n\ndo something\n}\n\nRoutine 3 {\ndo something\n\n*Send int to Routine 1\nSend int to Routine 2\nPrint Something\nPrint Something*\n\ndo something\n}\n\nmain {\nroutine1\nroutine2\nroutine3\n}\n\nI want that, while codes between two do something (codes between two star marks) is executing, flow of control must not go to other goroutines. For example, when routine1 is executing the events between two stars (sending and printing events), routine 2 and 3 must be blocked (means flow of execution does not pass to routine 2 or 3 from routine 1). After completing last print event, flow of execution may pass to routine 2 or 3. Can anybody help me by specifying, how can I achieve this ? Is it possible to implement above specification by WaitGroup ? Can anybody show me by giving a simple example how to implement above specified example by using WaitGroup. Thanks.\nNB: I give two sending and two printing options, in fact there is lots of sending and printing.", "output": "If I have gotten it correctly, what you want is to prevent simultaneous execution of some part of each function and other functions. The following code does this: fmt.Println lines won't happen as other routines are running. Here's what happens: when execution gets to the print section, it waits until other routines end, if they are running, and while this print line is executing other routines don't start and wait. I hope that is what you are looking for. Correct me if I'm wrong about this.\npackage main\n\nimport (\n    \"fmt\"\n    \"rand\"\n    \"sync\"\n)\n\nvar (\n    mutex1, mutex2, mutex3 sync.Mutex\n    wg sync.WaitGroup\n)\n\nfunc Routine1() {\n    mutex1.Lock()\n    // do something\n    for i := 0; i < 200; i++ {\n        mutex2.Lock()\n        mutex3.Lock()\n        fmt.Println(\"value of z\")\n        mutex2.Unlock()\n        mutex3.Unlock()\n    }\n    // do something\n    mutex1.Unlock()\n    wg.Done()\n}\n\nfunc Routine2() {\n    mutex2.Lock()\n    // do something\n    for i := 0; i < 200; i++ {\n        mutex1.Lock()\n        mutex3.Lock()\n        fmt.Println(\"value of z\")\n        mutex1.Unlock()\n        mutex3.Unlock()\n    }\n    // do something\n    mutex2.Unlock()\n    wg.Done()\n}\n\nfunc Routine3() {\n    mutex3.Lock()\n    // do something\n    for i := 0; i < 200; i++ {\n        mutex1.Lock()\n        mutex2.Lock()\n        fmt.Println(\"value of z\")\n        mutex1.Unlock()\n        mutex2.Unlock()\n    }\n    // do something\n    mutex3.Unlock()\n    wg.Done()\n}\n\nfunc main() {\n    wg.Add(3)\n    go Routine1()\n    go Routine2()\n    Routine3()\n    wg.Wait()\n}\n\nUPDATE: Let me explain these three mutex here: a mutex is, as documentation says: \"a mutual exclusion lock.\" That means when you call Lock on a mutex your code just waits there if somebody else have locked the same mutex. Right after you call Unlock that blocked code will be resumed.\nHere I put each function in its own mutex by locking a mutex at the beginning of the function and unlocking it the end. By this simple mechanism you can avoid running any part of code you want at the same time as those functions. For instance, everywhere you want to have a code that should not be running when Routine1 is running, simply lock mutex1 at the beginning of that code and unlock at at the end. That is what I did in appropriate lines in Routine2 and Routine3. Hope that clarifies things."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I fill out the syscall.Sockaddr structure so that I can later use it with syscall.Bind?\n\nQuestion:\nUsing go on Windows I have a syscall.Handle called sock that I want to bind to an address specified in a syscall.Sockaddr structure called \"sa\".\nHow do I fill out the syscall.Sockaddr structure so that I can later use it with syscall.Bind?\nBTW, sock is a raw socket.\nvar sa syscall.Sockaddr // how to fill out this structure with my ip address???\n\ne := syscall.Bind(sock, sa)\n\nif e != nil {\n    fmt.Println(\"bind error\", e)\n}", "output": "A good rule of thumb when you're unsure of something in go is \"check the source\", especially where the syscall stuff is concerned. I suspect the lack of documentation is semi-intentional because as previously mentioned, it's not the recommended interface - better to use the net package for a portable solution :)\nOnce you get to the source ($GOROOT/src/pkg/syscall/syscall_windows.go), you'll notice that Sockaddr isn't a struct at all:\ntype Sockaddr interface {\n        sockaddr() (ptr uintptr, len int32, err error) // lowercase; only we can define Sockaddrs\n}\n\nSo lets look for structs that implement this interface:\nfunc (sa *SockaddrInet4) sockaddr() (uintptr, int32, error) {\nfunc (sa *SockaddrInet6) sockaddr() (uintptr, int32, error) {\nfunc (sa *SockaddrUnix) sockaddr() (uintptr, int32, error) {\n\nThe Inet6 and Unix implementations are just stubs in the version I'm looking at (1.0.2), but SockaddrInet4 is ready to go:\ntype SockaddrInet4 struct {\n        Port int\n        Addr [4]byte\n        raw  RawSockaddrInet4\n}\n\nJust need to fill in Port and Addr."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go as a backend for my compiler?\n\nQuestion:\nI want to make a compiler for my own programming language. Popular backend choices seem to be C, Java, LLVM, JVM bytecode, .Net bytecode, gcc, assembly... Here, I am considering the possibility of Go as a backend.\nGo is apparently a fast language, with garbage collection, and fast compile times. It is also portable and free (BSD-style licence). All those would make Go a good choice as a target of code generation, I think, maybe even better than the other options... So I am surprised I can't find anybody doing that already.\nWould Go be a good choice for code generation? Can you point at existing projects doing so, or explain why there are none? Or even better, do you have experience with using the Go language as a backend? Are there any downside I am unaware of?\n(I'm specifically interested in Go here. Don't just point at alternative backend options, there are questions answering that already.)", "output": "I'm not aware of any language project using Go as a back-end.\nGo is not designed to be a  compiler back-end and or an IR.\nGo is low level enough (bit like C except for e.g. the GC) to IMO be usable as a back-end for some languages/class of languages with semantics similar/comparable/close to what Go offers.\nWould love to know more about the language you're designing ;-)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Use pointer to a value as a slice\n\nQuestion:\nIs it possible to convert a pointer to certain value to a slice?\nFor example, I want to read single byte from io.Reader into uint8 variable. io.Reader.Read accepts a slice as its argument, so I cannot simply provide it a pointer to my variable as I'd do in C.\nI think that creating a slice of length 1, capacity 1 from a pointer is safe operation. Obviously, it should be the same as creating a slice from an array of length 1, which is allowed operation. Is there an easy way to do this with plain variable? Or maybe I do not understand something and there are reasons why this is prohibited?", "output": "A slice is not only a pointer, like an array in C. It also contains the length and capacity of the data, like this:\nstruct {\n  ptr *uint8\n  len int\n  cap int\n}\n\nSo, yes, you will need to create a slice. Simplest way to create a slice of the var a uint8 would be []uint8{a}\na := uint8(42)\nfmt.Printf(\"%#v\\n\", []uint8{a})\n\n(But after rereading your question, this is not a solution as all)\nBut if you wish to create the slice from the variable, pointing to the same space of memory, you could use the unsafe package. This is most likely to be discouraged.\nfmt.Printf(\"%#v\\n\", (*[1]uint8)(unsafe.Pointer(&a))[:] )"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to configure Go so it can access environment variables in OSX\n\nQuestion:\nI am developing on OSX 10.7.4.\nI have been experiencing some problems getting the \"go get\" command to work. In the course of trying to figure out what the problem was, I realized that Go was having trouble reading the $PATH environment variable.\nThe following script exhibits the problem:-\n(PATH is returned as an empty string, and syscall.Getenv returns ok=false)\npackage main\n\n\nimport (\n    \"os\"\n    \"syscall\"\n    \"fmt\"\n)\n\nfunc main() {\n\n    path := os.Getenv(\"PATH\")\n    fmt.Println(path)\n\n    syscall_path, ok := syscall.Getenv(\"PATH\")\n    fmt.Println(syscall_path)\n    fmt.Println(ok)\n\n}\n\nI cannot imagine that this is a bug, as it is too dramatic to have gone unnoticed. So my question is this: In what way am I being stupid now? \n:-)\nI.e. What do I need to do to enable Go to access environment variables?\n--Update:\nAs it turns out, it is actually a problem with my shell - Homebrew stopped working also, with the error message:\n/usr/local/Library/Homebrew/global.rb:95: private method `split' called for nil:NilClass (NoMethodError)\n    from /usr/local/bin/brew:10:in `require'\n    from /usr/local/bin/brew:10\n\nI think that the problem stemmed from my use of the fish shell, which does not seem to be setting up the environment as I might have expected.", "output": "As it turns out, it was a malformed ~/.config/fish/config.fish file that was to blame.\nI was using:\nset -g VARNAME value\n\nWhich instead should be:\nset VARNAME value"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Extracting substrings in Go\n\nQuestion:\nI'm trying to read an entire line from the console (including whitespace), then process it. Using bufio.ReadString, the newline character is read together with the input, so I came up with the following code to trim the newline character:\ninput,_:=src.ReadString('\\n')\ninputFmt:=input[0:len(input)-2]+\"\" //Need to manually add end of string\n\nIs there a more idiomatic way to do this? That is, is there already a library that takes care of the ending null byte when extracting substrings for you?\n(Yes, I know there is already a way to read a line without the newline character in go readline -> string but I'm looking more for elegant string manipulation.)", "output": "It looks like you're confused by the working of slices and the string storage format, which is different from what you have in C.\n\nany slice in Go stores the length (in bytes), so you don't have to care about the cost of the len operation : there is no need to count\nGo strings aren't null terminated, so you don't have to remove a null byte, and you don't have to add 1 after slicing by adding an empty string.\n\nTo remove the last char (if it's a one byte char), simply do\ninputFmt:=input[:len(input)-1]"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: strconv.Itoa64(1234) gives undefined in golang\n\nQuestion:\nThis is my code:\npackage main\nimport (\n    \"strconv\"\n    \"fmt\"\n)\nfunc main() {\n    t := strconv.Itoa64(1234)\n    fmt.Println(t)\n}\n\nProblem:\nWhy does it cause the following error message?\n\ncommand-line-arguments .\\test.go:7: undefined: strconv.Itoa64\n  [Finished in 0.2s with exit code 2]", "output": "This is because Itoa64 is not the name of a function in the strconv package. It looks like you really want.\nt := strconv.FormatInt(1234, 10)\n\nSee http://golang.org/pkg/strconv/#FormatInt"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Any sensible solution to the lack of array/slice covariance in Go?\n\nQuestion:\nThe problem I've just faced is what to do in the following case:\nfunc printItems(header string, items []interface{}, fmtString string) {\n  // ...\n}\n\nfunc main() {\n  var iarr = []int{1, 2, 3}\n  var farr = []float{1.0, 2.0, 3.0}\n  printItems(\"Integer array:\", iarr, \"\")\n  printItems(\"Float array:\", farr, \"\")\n}\n\nGo has no generics and doesn't allow to use collection covariance:\nprog.go:26: cannot use iarr (type []int) as type []interface { } in function argument      \nprog.go:27: cannot use farr (type []float) as type []interface { } in function argument\n\nIdeas?", "output": "There's not really a way to do this right now without either\n\nMaking your []int and []float both into []interface{}.\nMaking printItems accept interface{} instead of []interface{} and then use reflection, similar to what the fmt package does.\n\nNeither solution is pretty."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Looking for a C or C++ library providing a functionality similar to Google Go's channels\n\nQuestion:\n...for use in a multithreaded network server.\nI want to pass data around between multiple threads. Currently I'm using sockets, with the master thread blocking on select() and workers blocking on recv(), though I feel there probably are more advanced or prepackaged ways of handling this task in C++.", "output": "I would have worker threads waiting in a thread pool.  \nThen the master waiting on select (for both reads and writes).\nAs data comes the master adds jobs to the thread pool. As each job is added a thread wakes up executes the job and returns to the pool. This way you are not blocking threads waiting on specific ports with recv() and a fixed set of child threads can handle all incoming traffic.\nCurrentl libs that support this functionality in ready made objects:\n\nACE: http://www.cs.wustl.edu/~schmidt/ACE.html\nPoco: http://pocoproject.org/"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Concurrent routines in Go\n\nQuestion:\nI want to write three concurrent routines that sends integer to each other. Now, I have implemented two concurrent routines which sends integers to each other.\npackage main\nimport \"rand\"\n\nfunc Routine1(commands chan int, responses chan int) {\n    for i := 0; i < 10; i++ {\n        i := rand.Intn(100)\n  commands <- i\n  print(<-responses, \" 1st\\n\");\n}\nclose(commands)\n}\n\nfunc Routine2(commands chan int, responses chan int) {\nfor i := 0; i < 1000; i++ {\n    x, open := <-commands\n    if !open {\n        return;\n    }\n     print(x , \" 2nd\\n\");\n    y := rand.Intn(100)\n    responses <- y\n}\n}\n\nfunc main() \n{\n   commands := make(chan int)\n   responses := make(chan int)\n   go Routine1(commands, responses)\n   Routine2(commands, responses)\n}\n\nHowever, when I want to add another routine which wants to send and receive integers to/from the above routines, it gives errors like \"throw: all goroutines are asleep - deadlock!\". Below is my code:\npackage main\nimport \"rand\"\n\nfunc Routine1(commands chan int, responses chan int, command chan int, response chan int ) {\nfor i := 0; i < 10; i++ {\n    i := rand.Intn(100)\n  commands <- i\n  command <- i\n  print(<-responses, \" 12st\\n\");\n  print(<-response, \" 13st\\n\");\n}\nclose(commands)\n}\n\nfunc Routine2(commands chan int, responses chan int) {\nfor i := 0; i < 1000; i++ {\n    x, open := <-commands\n    if !open {\n        return;\n    }\n     print(x , \" 2nd\\n\");\n    y := rand.Intn(100)\n    responses <- y\n}\n}\n\nfunc Routine3(command chan int, response chan int) {\nfor i := 0; i < 1000; i++ {\n    x, open := <-command\n    if !open {\n        return;\n    }\n     print(x , \" 3nd\\n\");\n    y := rand.Intn(100)\n    response <- y\n}\n}\n\nfunc main() {\n   commands := make(chan int)\n   responses := make(chan int)\n   command := make(chan int)\n   response := make(chan int)\n   go Routine1(commands, responses,command, response )\n   Routine2(commands, responses)\n   Routine3(command, response)\n}\n\nCan anybody help me, where is my mistake ? And can anybody help me, is it possible to create bidirectional channel or is it possible to create a common channel for int, string etc ?", "output": "You haven't declared the command and response variables in the main function.\nfunc main() {\n    commands := make(chan int)\n    responses := make(chan int)\n    go Routine1(commands, responses, command, response)\n    Routine2(commands, responses)\n    Routine3(command, response)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can I use c++ in cgo?\n\nQuestion:\nIs it possible to mix in some C++ code in cgo?\nI tried this:\npackage main\n/* \n    #include <iostream>\n\n    extern \"C\" void test(const char* str)\n    {\n        std::cout << str;\n    }\n*/\n// #cgo CFLAGS: -x c++\n// #cgo LDFLAGS: -lstdc++\nimport \"C\"\n\nfunc main() {\n    C.test(C.CString(\"Testing!!!\"))\n}\n\nBut I get these errors:\nerror: 'char* CString(_GoString_)' cannot appear in a constant-exp\nerror: 'void test(const char*)' cannot appear in a constant-expres\nerror: invalid conversion from 'char* (*)(_GoString_)' to 'long long int' [-fpermissive]\nerror: invalid conversion from 'void (*)(const char*)' to 'long long int' [-fpermissive]\n\nI'm using go1.0.2 and MinGW-w64 4.7.1", "output": "@ephemient provided a link to the feature request for this in the Go bug tracker. That in turn provided a link back to How to use C++ in Go? here on Stack Overflow.  There's a good discussion there, but the takeaways for me were:\n\nThe link to the Go FAQ (Do Go programs link with C/C++ programs?):\n\n... The cgo program provides the mechanism for a “foreign function interface” to allow safe calling of C libraries from Go code. SWIG extends this capability to C++ libraries.\n\nThe link to The SWIG documentation for Go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I convert a go method to a func?\n\nQuestion:\nI have a package-level function (Frob) that takes a function as an argument.  For the function argument, I want to pass in a method (FrobMethod) with a particular struct instance as the receiver (myFrob).\nThe only way I've found to accomplish this is to use a func literal/closure that captures the target struct.  That requires repeating the func signature and arguments, which seems too verbose.  Is there a better way?\npackage main\n\nimport \"fmt\"\n\nfunc Frob( frobber func( int ) ( string ) ) {\n    fmt.Printf( \"Frob %s\\n\", frobber( 42 ) )\n}\n\ntype MyFrob struct {\n    Prefix string\n}\n\nfunc ( m MyFrob ) FrobMethod( n int ) ( string ) {\n    return fmt.Sprintf( \"%s %d\", m.Prefix, n )\n}\n\nfunc main() {\n\n    myFrob := MyFrob { Prefix: \"Hello\" }\n\n    // C# allows something like this:\n    //\n    //Frob( myFrob.FrobMethod )\n\n    Frob( func ( n int ) ( string ) {\n        return myFrob.FrobMethod( n )\n    } )\n}\n\n...a real-world example of this is HandleFunc in net/http.", "output": "As of Go 1.1, the C#-style method reference works:\nFrob( myFrob.FrobMethod )\n\nSee the Method expressions section of the Go Language Specification."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to reduce compiled file size?\n\nQuestion:\nLets compare c and go:\nHello_world.c :\n#include<stdio.h>\nint main(){\n    printf(\"Hello world!\");\n}\n\nHello_world.go:\npackage main\nimport \"fmt\"\nfunc main(){\n    fmt.Printf(\"Hello world!\")\n}\n\nCompile both:\n$gcc Hello_world.c -o Hello_c \n$8g Hello_world.go -o Hello_go.8\n$8l Hello_go.8 -o Hello_go\n\nand ... what is it?\n$ls -ls\n... 5,4K 2010-10-05 11:09 Hello_c\n... 991K 2010-10-05 11:17 Hello_go\n\nAbout 1Mb Hello world. Are you kidding me?\nWhat I do wrong?\n(strip Hello_go   -> 893K only)", "output": "Note: This answer is outdated\nPlease note that this answer is outdated. Please refer to the other higher-voted answers. I would like to delete this post, accepted answers can't be deleted though.\n\nIs it a problem that the file is larger? I don't know Go but I would assume that it statically links some runtime lib which is not the case for the C program. But probably that is nothing to worry about as soon as your program gets larger.\nAs described here, statically linking the Go runtime is the default. That page also tells you how to set up for dynamic linking."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go and a bad prime number algorithm\n\nQuestion:\nI wrote this prime number sieving algorithm and it doesn't run properly. I can't find the error in the algorithm itself. Could someone help me?\nThis is what it's supposed to print:\n[2 3 5 7 11 13 17 19 23 29]\n\nVersus what it actually prints:\n[3 5 7 11 13 17 19 23 25 29]\n\n.\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n var primes = sieve(makeNumbers(29))\n fmt.Printf(\"%d\\n\", primes);\n}\n\nfunc makeNumbers(n int) []int {\n var numbers = make([]int, n - 1)\n for i := 0; i < len(numbers); i++ {\n  numbers[i] = i + 2\n }\n return numbers\n}\n\nfunc sieve(numbers []int) []int {\n var numCopy = numbers\n var max = numbers[len(numbers)-1]\n var sievedNumbers = make([]int, 0)\n for i := 0; numCopy[i]*numCopy[i] <= max; i++ {\n  for j := i; j < len(numCopy); j++ {\n   if numCopy[j] % numCopy[i] != 0 || j == i {\n    sievedNumbers = append(sievedNumbers, numCopy[j])\n   }\n  }\n  numCopy = sievedNumbers\n  sievedNumbers = make([]int, 0) \n }\n return numCopy\n}", "output": "It should be \"for j := 0\" rather than \"for j := i\"."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I get the command line arguments in Go without the \"flags\" package?\n\nQuestion:\nI'm trying to write a GNU-style command-line parser for Go, since the flags package doesn't handle all these yet:\nprogram -aAtGc --long-option-1 argument-to-1 --long-option-2 -- real-argument\n\nObviously, I don't want to use the flags package, since I'm trying to replace it. Is there any other way to get to the command line?", "output": "Nevermind.\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    args := os.Args\n    fmt.Printf(\"%d\\n\", len(args))\n\n    for i := 0; i<len(args); i++ {\n        fmt.Printf(\"%s\\n\", args[i])\n    }\n}\n\nThe documentation is quite incomplete, though."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do I get around Go not having parametric polymorphism?\n\nQuestion:\nI'm a Go newcomer, but I have read that Go regulars do not miss parametric polymorphism. Every time I try to learn a new language I use the L99 list of problems to get some practice.\nEven if I try to write something as trivial as the first problem (which in Go would be a single statement, taking the last element of a slice), how would I write this as a function that takes a slice of any type and (using that single statement I referenced above) returns the last element of that slice?\nI figured even though the language does not have parametric polymorphism there must be some idiomatic 'Go' way of  doing this in order for Go regulars to claim they dont miss parametric polymorphism. Otherwise, if the example were more complex than just the last element of a list for instance, you would need a function to perform your task for every type. \nWhat am I missing?", "output": "You cite the \"99 lisp problems\", yet Lisp does not have parametric polymorphism or static types at all.\nMany statically-typed languages, like Objective-C, and Java before generics, have no parametric polymorphism. The solution is to just use a type that can accept all values, which in Go is interface{}, and cast when you need to get some specific type out of it.\nFor your specific question, how to take \"any type of slice\"; unfortunately, there is no interface that includes specifically slices, since slices do not have any methods; so you'll be stuck with using interface{}. Since you have an unknown slice type, you need to use reflection (the reflect package) to perform all the slice operations, including getting the length and capacity, appending, and accessing the element at a particular index.\nAnother alternative is that instead of using \"slice of any type\", just use \"slice of interface{}\" i.e. []interface{}, in all your code, then you can use the normal slice operators on it, and you can put any elements in, but cast when you get them out."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Golang/mgo: How can I ask MongoDB to use current time in a field?\n\nQuestion:\nI have this struct that matches the types of a MongoDB collection I'm using:\ntype AppInstance struct {\n    Id bson.ObjectId \"_id,omitempty\"\n    Url string\n    Priority int\n    LastSeen string\n}\n\nI want the LastSeen field to hold the time of the last interaction with that particular app.  So, the app registers itself setting current time (as a string).\nWhat I would like is Mongo to dynamically set its own current time into that field when it inserts, just like MySQL's NOW() function would do.\nI have this helper function: \nfunc mongoNow() bson.JavaScript {\n    return bson.JavaScript{Code: \n         \"return (new Date()).ISODate('YYYY-MM-DD hh:mm:ss');\"}\n}\n\nAnd I tried this:\nc := mongoSession.DB(\"myapp\").C(\"instances\")\nrand.Seed(time.Now().UnixNano())\nerr := c.Insert(\n   struct{Id, Serial, Priority, Url, LastSeen interface{}}{ \n      Id: bson.NewObjectId(), \n      Url: getInformedHost() + \":\" + getRunningPortString(), \n      Priority: rand.Int(), \n      LastSeen: mongoNow() }\n)\ncheckError(err, \"Could not register on MongoDB server.\", 3)\n\nthe LastSeen field gets stored as a script instead of evaluated:\n[_id] => MongoId Object (\n    [$id] => 502d6f984eaead30a134fa10\n)\n[id] => MongoId Object (\n    [$id] => 502d6f98aa443e0ffd000001\n)\n[priority] => 1694546828\n[url] => 127.0.0.1:8080\n[lastseen] => MongoCode Object (\n    [code] => (new Date()).ISODate('YYYY-MM-DD hh:mm:ss')\n    [scope] => Array (\n    )\n)\n\nSo, I think there are to questions:\nFirst, how can I insert the current time?\nSecond, how can I get some javascript evaluated instead of inserted?\nThe answer to the second one could be enough to answer the first one, but it might as well not be.", "output": "Don't store time as string. mgo supports time.Time which is like a Date object in Javascript:\ntype Event struct {\n    Id    bson.ObjectId \"_id,omitempty\"\n    Which string\n    Date  time.Time\n}\n\nInsert an event that happened now:\ne := Event{\n    Which: \"first event\",\n    Date: time.Now(),\n}\nc.Insert(e)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Any tricks to export Go docs to be served statically?\n\nQuestion:\nI'd like to use docs generated by godoc to be served statically (on App Engine) for a project I created. I see that godoc starts a server and apparently the package docs are all generated dynamically. But is there a workaround to save the docs to the filesystem or what other options do I have?", "output": "If you're using GitHub, there's a pretty nice project for this already: http://gopkgdoc.appspot.com/\nDocumentation's at the bottom of the page. It's open source and with a little effort, you may be able to get it to generate documentation from non-GitHub services."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: From flag how do you return an (int) instead of an (*int)?\n\nQuestion:\nThis program returns:\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\nfunc main() {\n    num_agents := flag.Int(\"a\", 10, \"number of agents\")\n    flag.Parse();\n\n    fmt.Printf(\"%#v\",num_agents)\n}\n\nOutputs\n(*int)(0x18600110)`\n\nHowever that is not what I want... What I want is the integer.\nSo according to the documentation seems I should use flag.IntVar(&pointer_to_variable_integer)\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\nfunc main() {\n    var num_agents int\n    flag.IntVar(&num_agents,\"a\", 10, \"number of agents\")\n    flag.Parse();\n\n    fmt.Printf(\"%#v\",num_agents)\n}\n\nHowever that doesn't seem right... Because I need to write 2 lines of code when 1 should do.\nsomehow it seems to me that\nnum_agents := flags.Int(\"a\", 10, \"number of agents\") \n\nShould return an int instead of *int.?\n Or maybe there is an easy way to cast from *int to int ??", "output": "Simply dereference the pointer:\nnum_agents := flags.Int(\"a\", 10, \"number of agents\")\nfmt.Println(*num_agents)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to perform file system scanning\n\nQuestion:\nI need to write a function which when given the path of a folder \nscans the files rooted at that folder. \nAnd then I need to display the directory structure at that folder. \n\nI know how to do 2 (I am going to use jstree to display it in the browser).", "output": "EDIT FOR 1.16:  Enough people still hit this answer, that I thought I'd update it for Go 1.16.\nThe function filepath.WalkDir introduced in Go 1.16 has better performance than filepath.Walk mentioned in the previous edit.  Here's a working example:\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"io/fs\"\n    \"path/filepath\"\n)\n\nfunc visit(path string, di fs.DirEntry, err error) error {\n    fmt.Printf(\"Visited: %s\\n\", path)\n    return nil\n}\n\nfunc main() {\n    flag.Parse()\n    root := flag.Arg(0)\n    err := filepath.WalkDir(root, visit)\n    fmt.Printf(\"filepath.WalkDir() returned %v\\n\", err)\n}\n\nEDIT: Enough people still hit this answer, that I thought I'd update it for the Go1 API.  This is a working example of filepath.Walk().  The original is below.\npackage main\n\nimport (\n  \"path/filepath\"\n  \"os\"\n  \"flag\"\n  \"fmt\"\n)\n\nfunc visit(path string, f os.FileInfo, err error) error {\n  fmt.Printf(\"Visited: %s\\n\", path)\n  return nil\n} \n\n\nfunc main() {\n  flag.Parse()\n  root := flag.Arg(0)\n  err := filepath.Walk(root, visit)\n  fmt.Printf(\"filepath.Walk() returned %v\\n\", err)\n}\n\nPlease note that filepath.Walk walks the directory tree recursively.\nThis is an example run:\n$ mkdir -p dir1/dir2\n$ touch dir1/file1 dir1/dir2/file2\n$ go run walk.go dir1\nVisited: dir1\nVisited: dir1/dir2\nVisited: dir1/dir2/file2\nVisited: dir1/file1\nfilepath.Walk() returned <nil>\n\nORIGINAL ANSWER FOLLOWS: The interface for walking file paths has changed as of weekly.2011-09-16, see http://groups.google.com/group/golang-nuts/msg/e304dd9cf196a218.  The code below will not work for release versions of GO in the near future.\nThere's actually a function in the standard lib just for this: filepath.Walk.\npackage main\n\nimport (\n    \"path/filepath\"\n    \"os\"\n    \"flag\"\n)\n\ntype visitor int\n\n// THIS CODE NO LONGER WORKS, PLEASE SEE ABOVE\nfunc (v visitor) VisitDir(path string, f *os.FileInfo) bool {\n    println(path)\n    return true\n} \n\nfunc (v visitor) VisitFile(path string, f *os.FileInfo) {\n    println(path)\n}\n\nfunc main() {\n    root := flag.Arg(0)\n    filepath.Walk(root, visitor(0), nil)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Equivalent of java finalize method\n\nQuestion:\nIs there any method like java finalize in Go? If I've a type struct like\n    type Foo struct {\n        f *os.File\n        ....\n    }\n\nfunc (p *Foo) finalize() {\n     p.f.close( )           \n}\n\nHow can I make sure that when Object is garbage collected, the file is closed?", "output": "runtime.SetFinalizer iirc. But its considered a bad thing and isn't guaranteed to run before program exit\nEDIT: As mentioned below, the current os package already calls runtime.SetFinalizer on files. However, SetFinalizer shouldn't be relied upon. As an example of why, I had a file-server-like application where I forgot to close open file. The process would usually get to about 300 open files before the GC picked them up and called their finalizer."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you replace a character in Go using the Regexp package ReplaceAll function?\n\nQuestion:\nI am not familiar with C-like syntaxes and would like to write code to find & replace, say, all 'A's to 'B's in a source string, say 'ABBA' with the Regexp package ReplaceAll or ReplaceAllString functions? How do I set up type Regexp, src and repl? Here's the ReplaceAll code snippet from the Go documentation: \n// ReplaceAll returns a copy of src in which all matches for the Regexp\n// have been replaced by repl.  No support is provided for expressions\n// (e.g. \\1 or $1) in the replacement text.\nfunc (re *Regexp) ReplaceAll(src, repl []byte) []byte {\n    lastMatchEnd := 0; // end position of the most recent match\n    searchPos := 0;    // position where we next look for a match\n    buf := new(bytes.Buffer);\n    for searchPos <= len(src) {\n        a := re.doExecute(\"\", src, searchPos);\n        if len(a) == 0 {\n            break // no more matches\n        }\n\n    // Copy the unmatched characters before this match.\n    buf.Write(src[lastMatchEnd:a[0]]);\n\n    // Now insert a copy of the replacement string, but not for a\n    // match of the empty string immediately after another match.\n    // (Otherwise, we get double replacement for patterns that\n    // match both empty and nonempty strings.)\n    if a[1] > lastMatchEnd || a[0] == 0 {\n        buf.Write(repl)\n    }\n    lastMatchEnd = a[1];\n\n    // Advance past this match; always advance at least one character.\n    _, width := utf8.DecodeRune(src[searchPos:len(src)]);\n    if searchPos+width > a[1] {\n        searchPos += width\n    } else if searchPos+1 > a[1] {\n        // This clause is only needed at the end of the input\n        // string.  In that case, DecodeRuneInString returns width=0.\n        searchPos++\n    } else {\n        searchPos = a[1]\n    }\n}\n\n// Copy the unmatched characters after the last match.\nbuf.Write(src[lastMatchEnd:len(src)]);\n\nreturn buf.Bytes();\n\n}", "output": "This is a routine to do what you want:\npackage main\nimport (\"fmt\"; \"regexp\"; \"os\"; \"strings\";);\nfunc main () {\n    reg, error := regexp.Compile (\"B\");\n    if error != nil {\n        fmt.Printf (\"Compile failed: %s\", error.String ());\n        os.Exit (1);\n    }\n    output := string (reg.ReplaceAll (strings.Bytes (\"ABBA\"),\n                      strings.Bytes (\"A\")));\n    fmt.Println (output);\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Error calling channel.Create on appengine with GO\n\nQuestion:\nI am using the sample code in the Channel Api Go Reference. When I run, I got the following error:\nchannel.Create:: Call error 1: call /channel.CreateChannel is not registered\nI could not find any reference to it. Does anyone know?", "output": "According to https://groups.google.com/forum/#!topic/google-appengine-go/cetKWCkoHfg it's a known error in AppEngine runtime: http://code.google.com/p/googleappengine/issues/detail?id=5279"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: json parsing of int64 in go; null values\n\nQuestion:\nI'm trying to parse a json stream in Go. I've created a simplified example:\n package main\n import (\n    \"encoding/json\"\n    \"fmt\"\n )\n\n var d = []byte(`{ \"world\":[{\"data\": 2251799813685312}, {\"data\": null}]}`)\n\n type jsonobj struct{ World []World }\n type World struct{ Data int64 }\n\n func main() {\n    var data jsonobj\n    jerr := json.Unmarshal(d, &data)\n    fmt.Println(jerr)\n }\n\nthis will give me \ngo run testmin.go\njson: cannot unmarshal null into Go value of type int64\n\nI've found a nullable int64 in the sql package, but json doesn't seem to be able to handle it. \nIs there a nullable int64 type that json can handle? If possible I'd be happy with the json null being translated to, -1 or MinValue. \nThank you for your input,\nFabian", "output": "Just use a *int64. A pointer can either be nil or it can point to an int64 with an associated value and they work fine with Go's JSON package."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why is my webserver in golang not handling concurrent requests?\n\nQuestion:\nThis simple HTTP server contains a call to time.Sleep() that makes\neach request take five seconds. When I try quickly loading multiple\ntabs in a browser, it is obvious that each request\nis queued and handled sequentially. How can I make it handle concurrent requests?\npackage main\n\nimport (\n   \"fmt\"\n   \"net/http\"\n   \"time\"\n)\n\nfunc serve(w http.ResponseWriter, r *http.Request) {\n   fmt.Fprintln(w, \"Hello, world.\")\n   time.Sleep(5 * time.Second)\n}\n\nfunc main() {\n   http.HandleFunc(\"/\", serve)\n   http.ListenAndServe(\":1234\", nil) \n}\n\nActually, I just found the answer to this after writing the question, and it is very subtle. I am posting it anyway, because I couldn't find the answer on Google. Can you see what I am doing wrong?", "output": "Your program already handles the requests concurrently. You can test it with ab, a benchmark tool which is shipped with Apache 2:\nab -c 500 -n 500 http://localhost:1234/\n\nOn my system, the benchmark takes a total of 5043ms to serve all 500 concurrent requests. It's just your browser which limits the number of connections per website.\nBenchmarking Go programs isn't that easy by the way, because you need to make sure that your benchmark tool isn't the bottleneck and that it is also able to handle that many concurrent connections. Therefore, it's a good idea to use a couple of dedicated computers to generate load."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go tutorial for Google App Engine: ImportError: No module named _md5\n\nQuestion:\nI'm trying to run the hello world tutorial for the Google app engine in Go language. The GAE SDK for go is based on python 2.5, which I installed. I then had to install openssl, but now when I try to run my sample application on the SDK, I get the following error:\nImportError: No module named _md5\n\nI even tried a simple import md5 & import hashlib from the python interpreter interface, and i still get the same error\n>>> import hashlib\nTraceback (most recent call last):\nFile \"<stdin>\", line 1, in <module>\nFile \"/usr/local/lib/python2.5/hashlib.py\", line 133, in <module>\nmd5 = __get_builtin_constructor('md5')\nFile \"/usr/local/lib/python2.5/hashlib.py\", line 60, in __get_builtin_constructor\nimport _md5\nImportError: No module named _md5\n\nDoes anybody know a workaround for this? Thank you!\nI have a feeling that this problem is really about python installation than anything else", "output": "Your problem has nothing to do with GAE, or the SDK. I have faced this before. If you tried to install your custom version of python (on Ubuntu), then you land up with such issues. You should uninstall the custom python using checkinstall. More details can be found about there here: Uninstall python built from source?. \nJust use the default python and you'll be fine!"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Setting opacity of image in golang\n\nQuestion:\nI have following code. That does paste a foreground image (logo.jpg) over background image (background.jpg)\nWhile pasting this foreground image, I want to set the opacity of this foreground image. I used DrawMask (http://golang.org/doc/articles/image_draw.html), but it seems I am missing something here. Please see the code below. Anyone has any idea?\npackage main\n\n    import (\n    \"os\"\n    \"image/draw\"\n    \"image\"\n    \"image/jpeg\"\n)\n\nfunc main() {\n//Background image\n    fImg1, _ := os.Open(\"background.jpg\")\n    defer fImg1.Close()\n    img1, _, _ := image.Decode(fImg1)\n\n//Logo to stick over background image\n    fImg2, _ := os.Open(\"logo.jpg\")\n    defer fImg2.Close()\n    img2, _, _ := image.Decode(fImg2)\n\n//Mask image (that is just a solid light gray image of same size as logo)\n    fmask, _ := os.Open(\"mask.jpg\")\n    defer fImg2.Close()\n    mask, _, _ := image.Decode(fmask)\n\n//Create a new blank image m\n    m := image.NewRGBA(image.Rect(0, 0, 1920, 1280))\n\n//Paste background image over m\n    draw.Draw(m, m.Bounds(), img1, image.Point{0,0}, draw.Src)\n\n//Now paste logo image over m using a mask (ref. http://golang.org/doc/articles/image_draw.html )\n\n//******Goal is to have opacity value 50 of logo image, when we paste it****\n    draw.DrawMask(m, m.Bounds(), img2, image.Point{-100,-100}, mask, image.Point{-100,-100}, draw.Src)\n\n     toimg, _ := os.Create(\"new.jpg\")\n     defer toimg.Close()\n\n     jpeg.Encode(toimg, m, &jpeg.Options{jpeg.DefaultQuality})\n}\n\nAbove code is helped by Sathish (http://stackoverflow.com/questions/12430874/image-manipulation-in-golang). Thanks Sathish.", "output": "I see two errors with your code.\n\nYou are setting the mask incorrectly. To get 50% opacity you want something like mask := image.NewUniform(color.Alpha{128}) where 128 is half way between 0 (transparent), and 255 (opaque). If you want more than 256 levels of opacity, see color.Alpha16.\nWhen calling draw.DrawMask(), you most likely want to use the draw.Over Op instead of draw.Src. Try them both out and you should see the difference.\n\nI also recommend m := image.NewRGBA(img1.Bounds()), but it is not wrong to do it manually."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go uses Go to parse itself?\n\nQuestion:\nI am starting a class project that regards adding some functionality to Go.\nHowever, I am thoroughly confused on the structure of Go. I was under the impression that Go used flex and bison but I can't find anything familiar in the Go source code. \nOn the other hand, the directory go/src/pkg/go has folders with familiar names (ast, token, parser, etc.) but all they contain are .go files. I'm confused!\nMy request is, of anyone familiar with Go, can you give me an overview of how Go is lexed, parsed, etc. and where to find the files to edit the grammar and whatnot?", "output": "The directory structure:\nsrc/cmd/5*   ARM\nsrc/cmd/6*   amd64 (x86-64)\nsrc/cmd/8*   i386 (x86-32)\n\nsrc/cmd/cc   C compiler  (common part)\nsrc/cmd/gc   Go compiler (common part)\nsrc/cmd/ld   Linker      (common part)\nsrc/cmd/6c   C compiler  (amd64-specific part)\nsrc/cmd/6g   Go compiler (amd64-specific part)\nsrc/cmd/6l   Linker      (amd64-specific part)\n\nLexer is written in pure C (no flex). Grammar is written in Bison:\nsrc/cmd/gc/lex.c\nsrc/cmd/gc/go.y\n\nMany directories under src/cmd contain a doc.go file with short description of the directory's contents.\nIf you are planning to modify the grammar, it should be noted that the Bison grammar sometimes does not distinguish between expressions and types."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What's wrong with my golang code?\n\nQuestion:\nPossible Duplicate:\nWhy my golang lock free queue always stuck there? \n\nHere's my whole source code :\npackage main\n\nimport (\n    \"sync/atomic\"\n    \"unsafe\"\n    \"sync\"\n    \"fmt\"\n    \"time\"\n    \"runtime\"\n)\n\nconst (\n    MAX_DATA_SIZE = 100\n)\n\n// lock free queue\ntype Queue struct {\n    head unsafe.Pointer\n    tail unsafe.Pointer\n}\n// one node in queue\ntype Node struct {\n    val interface{}\n    next unsafe.Pointer\n}\n// constructor\nfunc New() (q *Queue) {\n    queue := new(Queue)\n    queue.head = unsafe.Pointer(new(Node))\n    queue.tail = queue.head\n    return queue\n}\n// queue functions\nfunc (self *Queue) enQueue(val interface{}) {\n    newValue := unsafe.Pointer(&Node{val: val, next: nil})\n    var tail,next unsafe.Pointer\n    for {\n        tail = self.tail\n        next = ((*Node)(tail)).next\n        if atomic.CompareAndSwapPointer(&next, nil, newValue) {\n            atomic.CompareAndSwapPointer(&self.tail, tail, newValue)\n            break\n        }else{\n            for next != nil {\n                tail = next\n            }\n        }\n    }\n}\n\nfunc (self *Queue) deQueue() (val interface{}, success bool){\n    var head,next unsafe.Pointer\n    for {\n        head = self.head\n        next = ((*Node)(head)).next\n        if next == nil {\n            return nil, false\n        }else {\n            if atomic.CompareAndSwapPointer(&(self.head), head, next) {\n                val = ((*Node)(next)).val\n                return val, true\n            }\n        }\n    }\n    return nil, false\n}\n\nfunc main() {\n    //runtime.GOMAXPROCS(runtime.NumCPU())\n    fmt.Println(runtime.GOMAXPROCS(-1))\n    var wg sync.WaitGroup\n    wg.Add(20)\n    queue := New()\n    for i := 0; i < 10; i++ {\n        go func() {\n            defer wg.Done()\n            for j := 0; j < MAX_DATA_SIZE; j++ {\n                t := time.Now()\n                fmt.Println(\"enqueue111\")\n                fmt.Println(\"enq = \", t)\n                fmt.Println(\"enqueue222\")\n                queue.enQueue(t)\n            }\n        }()\n    }\n\n    for i := 0; i < 10; i++ {\n        go func() {\n            ok := false\n            var val interface{}\n            defer wg.Done()\n            for j := 0; j < MAX_DATA_SIZE; j++ {\n                val,ok = queue.deQueue()\n                for !ok {\n                    val,ok = queue.deQueue()\n                }\n                fmt.Println(\"deq = \",val)\n            }\n        }()\n    }\n\n    wg.Wait()\n}\n\nThe code is stucked at fmt.Println(\"enq = \", t) but i don't know why, it's so weird.", "output": "deQueue is looping infinitely on the fail case, which is blocking the CPU.  Goroutines don't yield while doing CPU work.  GOMAXPROCS needs to be >= 2 to get CPU parallelism.\njust for kicks, here's a threadsafe, nonblocking queue implementation using higher-order channels: https://gist.github.com/3668150"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to build an TCP listener or server on google appengine maybe in golang?\n\nQuestion:\nI'd like to build an TCP receiver/listener/server to run on Google App-Engine.  For example to receive messages over TCP on a specific port, similar to a syslog server, and process the request.  Something in Go language would be ideal, but really anything appengine supports.\nDoes anyone know if and how I can setup appengine to proccess TCP requests?", "output": "App Engine's designed to handle HTTP requests, which are TCP requests.  If you choose to use App Engine, you should probably design your server to handle HTTP requests.\nIf you need to run on a lower level, you're probably better off using something like Amazon which has tools like their elastic IPs that would make this much easier."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go: extensive memory usage when reusing map keys\n\nQuestion:\nAs part of my Go tutorial, I'm writing simple program counting words across multiple files. I have a few go routines for processing files and creating map[string]int telling how many occurrence of particular word have been found. The map is then being sent to reducing routine, which aggregates values to a single map. Sounds pretty straightforward and looks like a perfect (map-reduce) task for Go!\nI have around 10k document with 1.6 million unique words. What I found is my memory usage is growing fast and constantly while running the code and I'm running out of memory at about half way of processing (12GB box, 7GB free). So yes, it uses gigabytes for this small data set!\nTrying to figure out where the problem lies, I found the reducer collecting and aggregating data is to blame. Here comes the code:\nfunc reduceWords (input chan map[string]int, output chan int) {\n  total := make(map[string]int)\n  for wordMap := range input {\n    for w, c := range wordMap {\n      total[w] += c\n    }\n  }      \n  output <- len(total)\n}\n\nIf I remove the map from the sample above the memory stays within reasonable limits (a few hundred megabytes). What I found though, is taking copy of a string also solves the problem, i.e. the following sample doesn't eat up my memory:\nfunc reduceWords (input chan map[string]int, output chan int) {\n  total := make(map[string]int)\n  for wordMap := range input {\n    for w, c := range wordMap {\n      copyW := make([]byte, len(w)) // <-- will put a copy here!\n      copy(copyW, w)\n      total[string(copyW)] += c\n    }\n  }  \n  output <- len(total)\n}\n\nIs it possible it's a wordMap instance not being destructed after every iteration when I use the value directly? (As a C++ programmer I have limited intuition when comes to GC.) Is it desirable behaviour? Am I doing something wrong? Should I be disappointed with Go or rather with myself?\nThanks!", "output": "What does your code look like that turns files into strings?  I would look for a problem there.  If you are converting large blocks (whole files maybe?) to strings, and then slicing those into words, then you are pinning the entire block if you save any one word.  Try keeping the blocks as []byte, slicing those into words, and then converting words to the string type individually."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Build and reference my own local package in Go\n\nQuestion:\nI'm playing with Google Go and I'm having fun (!), but I'm having some problems with package subsystem.\nI'm running Go 1.0.1 on Mac OS X Lion. I've build also various single file programs without problems (I've also build a small webapp using html/templates without problems and it compiles and runs without any error).\nI've defined a \"reusable\" package (even.go):\npackage even\n\nfunc Even(i int) bool {\n    return i % 2 == 0\n}\n\nfunc Odd(i int) bool {\n    return i % 2 == 1\n}\n\nand a consumer program (useeven.go):\npackage main\n\nimport (\n    \"./even\"\n    \"fmt\"\n)\n\nfunc main() {\n    a := 5\n    b := 6\n\n    fmt.Printf(\"%d is even %v?\\n\", a, even.Even(a))\n    fmt.Printf(\"%d is odd %v?\\n\", b, even.Odd(b))\n}\n\nBut when I compile the \"library\" using\ngo build even.go\n\nI got nothing... No errors, no message... What happens?\nHow should I do this?", "output": "The answer to your question, \"How should I do this?\" is explained in How to Write Go Code.  It's really pretty important stuff and worth taking a look at.\nThe behavior of go build might seem puzzling, but is actually conventional for command line programs--no output means that the program ran successfully.  So what did it do?  For that your answer is in go help build\n\n... Otherwise build compiles the packages but discards the results,\n  serving only as a check that the packages can be built.\n\nWhat, you wanted more?  Of course.  \"How to Write Go Code\" explains good ways of doing this.  For a quick fix to your program, I'll explain that the go command expects each package and each executable program to be in a separate directory.  If you just make a directory called even, immediately under the location of useeven.go, and move even.go to it, then go run useeven.go should run just as you have it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why doesn't \"8g foo.go -o foo.8\" work for me in go language command line?\n\nQuestion:\nI'm trying to compile a hello-world app:\n8g test1.go -o test1.8\n\nError:\nopen -o: No such file or directory\n\nIrony here being that this works fine when I leave off -o:\n8g test1.go\n\nHow do you specify an object filename to go command line compiler 8g?\n(8g version release.r60 9481)", "output": "When 8g is run without arguments, it prints something like this:\ngc: usage: 8g [flags] file.go...\nflags:\n  ...\n  -m print optimization decisions\n  -o file specify output file\n  -p assumed import path for this code\n  ...\n\nNotice that [flags] are positioned in front of file.go. This ordering needs to be respected when passing arguments. This is unlike gcc which accepts options and files in any order."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE Go template.Execute, passing a struct with vector\n\nQuestion:\nI'm storing some data in a Go app in a struct's vector.Vector for convenience. I want to display all the data from the vector on Google App Engine webpage through template.Execute. Is it possible and how would I access the data in the parsed html file? Would it be easier if I used an array or slice instead?", "output": "Use slices.\n\nGo Weekly Snapshot History 2011-10-18\nThe container/vector package has been deleted. Slices are better:\n  SliceTricks."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Stringing together C and Python code in Go?\n\nQuestion:\nUpdate\n\nI'm trying to create a simple Go function which will simply take in a string of reddit-style Markdown and return the appropriate HTML.\nRight now, I know that having Discount installed is a prerequisite and that at least the following three files are used by reddit as wrappers around Discount:\n\nhttps://github.com/reddit/reddit/blob/master/r2/r2/lib/c/reddit-discount-wrapper.c\nhttps://github.com/reddit/reddit/blob/master/r2/r2/lib/c_markdown.py\nhttps://github.com/reddit/reddit/blob/master/r2/r2/lib/py_markdown.py\n\nBased on this, does anyone know how I can sort of glue all this together with Cgo and go-python to create a simple Markdown function? (independent of the rest of the reddit source code)", "output": "If all you want is Markdown, I don't see how Python fits into this. Maybe there's more to it, but if at all possible you should leave Python out of this. If there's a reason to use Python that wasn't in the question, I can edit this answer and address that.\nFirst, try this native Go Markdown package: https://github.com/knieriem/markdown\nIf that doesn't work, the next easiest thing is to take Discount (or any other Markdown library written in C, such as GitHub's Upskirt fork) and wrap it with cgo or SWIG."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Whitelist tags exempt from escaping using Go's html/template\n\nQuestion:\nPass a []byte into a template as the body of a message post on a forum-style web app. In the template, call a method to convert to string and along the way, switch out all newlines for line breaks:\n<p>{{.BodyString}}</p>\n\n...\nfunc (p *Post) BodyString() string {\n    nl := regexp.MustCompile(`\\n`)\n    return nl.ReplaceAllString(string(p.Body), `<br>`)\n}\n\nWhat you'll end up with:\nparagraphs <br> <br>in <br> <br>this <br> <br>post\n\nI don't want to pass the entire post in with HTML(p.Body), as it represents third party data from potentially untrustworthy sources. Is there a way to whitelist only some tags for formatting purposes using the vanilla Go1 template package?", "output": "I do think you want to parse the HTML.  The HTML parser in exp/html was deemed incomplete and so removed from Go 1, although the exp tree is still in the Go source tree and can be accessed by weekly tag, for example.  I don't know exactly what is incomplete.  I used it for a simple task once and it met my needs.  \nAlso of course, check the dashboard and see related SO post, Any smart method to get exp/html back after Go1?, mostly for the recomendation of http://code.google.com/p/go-html-transform/"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Reading from a url resource in Go\n\nQuestion:\nHow do we read from a url resource. I have used the https://github.com/Kissaki/rest.go api in the following example. Below is the example I use to write a string to the url http://localhost:8080/cool \nBut now I need to retrieve the data from the url, how do I read it back? \npackage main\n\nimport (\n    \"fmt\"\n    \"http\"\n    \"github.com/nathankerr/rest.go\"\n)\n\ntype FileString struct {\n    value string\n}\n\nfunc (t *FileString) Index(w http.ResponseWriter) {\n    fmt.Fprintf(w, \"%v\", t.value)\n}\n\nfunc main(){\n    rest.Resource(\"cool\", &FileString{s:\"this is file\"})    \n    http.ListenAndServe(\":3000\", nil)   \n}", "output": "if you just want to fetch a file over http you could do something like this i guess\nresp, err := http.Get(\"http://your.url.com/whatever.html\")\ncheck(err) // does some error handling\n\n// read from resp.Body which is a ReadCloser"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go- Copy all common fields between structs\n\nQuestion:\nI have a database that stores JSON, and a server that provides an external API to whereby through an HTTP post, values in this database can be changed. The database is used by different processes internally, and as such have a common naming scheme.\nThe keys the customer sees are different, but map 1:1 with the keys in the database (there are unexposed keys). For example:\nThis is in the database:\n{ \"bit_size\": 8, \"secret_key\": false }\n\nAnd this is presented to the client:\n{ \"num_bits\": 8 }\n\nThe API can change with respect to field names, but the database always has consistent keys.\nI have named the fields the same in the struct, with different flags to the json encoder:\ntype DB struct {\n    NumBits int  `json:\"bit_size\"`\n    Secret  bool `json:\"secret_key\"`\n}\ntype User struct {\n    NumBits int `json:\"num_bits\"`\n}\n\nI'm using encoding/json to do the Marshal/Unmarshal.\nIs reflect the right tool for this? Is there an easier way since all of the keys are the same? I was thinking some kind of memcpy (if I kept the user fields in the same order).", "output": "Here's a solution using reflection. You have to further develop it if you need more complex structures with embedded struct fields and such.\nhttp://play.golang.org/p/iTaDgsdSaI\npackage main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\ntype M map[string]interface{} // just an alias\n\nvar Record = []byte(`{ \"bit_size\": 8, \"secret_key\": false }`)\n\ntype DB struct {\n    NumBits int  `json:\"bit_size\"`\n    Secret  bool `json:\"secret_key\"`\n}\n\ntype User struct {\n    NumBits int `json:\"num_bits\"`\n}\n\nfunc main() {\n    d := new(DB)\n    e := json.Unmarshal(Record, d)\n    if e != nil {\n        panic(e)\n    }\n    m := mapFields(d)\n    fmt.Println(\"Mapped fields: \", m)\n    u := new(User)\n    o := applyMap(u, m)\n    fmt.Println(\"Applied map: \", o)\n    j, e := json.Marshal(o)\n    if e != nil {\n        panic(e)\n    }\n    fmt.Println(\"Output JSON: \", string(j))\n}\n\nfunc applyMap(u *User, m M) M {\n    t := reflect.TypeOf(u).Elem()\n    o := make(M)\n    for i := 0; i < t.NumField(); i++ {\n        f := t.FieldByIndex([]int{i})\n        // skip unexported fields\n        if f.PkgPath != \"\" {\n            continue\n        }\n        if x, ok := m[f.Name]; ok {\n            k := f.Tag.Get(\"json\")\n            o[k] = x\n        }\n    }\n    return o\n}\n\nfunc mapFields(x *DB) M {\n    o := make(M)\n    v := reflect.ValueOf(x).Elem()\n    t := v.Type()\n    for i := 0; i < v.NumField(); i++ {\n        f := t.FieldByIndex([]int{i})\n        // skip unexported fields\n        if f.PkgPath != \"\" {\n            continue\n        }\n        o[f.Name] = v.FieldByIndex([]int{i}).Interface()\n    }\n    return o\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Cost of creating a datastore.Key: Storing a key in struct versus an id and fetching from the datastore\n\nQuestion:\nConsider the following two alternatives.\nA) Storing the key in the struct.\ntype Point struct {\n    Place *datastore.Key\n    Lat   float64\n    Lon   float64\n}\n\nThen fetching using the key:\nplace := new(Place)\nif err := datastore.Get(c, k, point.Place); err != nil {\n    return err\n} \n\nB) Storing the id\ntype Point struct {\n    Place int64\n    Lat   float64\n    Lon   float64\n}\n\nThen fetching after creating the key.\nk := datastore.NewKey(c, \"Place\", \"\", point.Place, nil)\nplace := new(Place)\nif err := datastore.Get(c, k, place); err != nil {\n    return err\n} \n\nStoring the key instead of the id takes a bit more space. In order to see the tradeoff, it would be great to get a feeling for how much resources it takes to create a key. In other words, is it really cheap to create a key, or is it better to create it once and store it?\nWith a single key, it probably doesn't matter much, but let's say that I fetch a list of points, and for each point I want to retrieve the place (i.e. loop through the points to build an array of keys, and fetch them).\nEdit: I am not thinking about allocating IDs or keys here, only using them (i.e. all points and places are already in the datastore, the question is just whether to store the id or the entire key).\nEx animo,\nAlexander Yngling", "output": "Key is basically just a wrapper around a set of properties: kind, id/name, parent key(s), namespace.\nSo creating a Key from a kind and ID costs nothing, as this is a local operation (does not require Datastore).\nOTOH, Key allocation does cost as this creates a Key with unique ID and this needs to Query a Datastore under the hood."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go HTTP Post and use Cookies\n\nQuestion:\nI'm trying to use Go to log into a website and store the cookies for later use.\nCould you give example code for posting a form, storing the cookies, and accessing another page using the cookies?\nI think I might need to make a Client to store the cookies, by studying http://gotour.golang.org/src/pkg/net/http/client.go\npackage main\n\nimport (\"net/http\"\n        \"log\"\n        \"net/url\"\n        )\n\nfunc Login(user, password string) string {\n        postUrl := \"http://www.pge.com/eum/login\"\n\n        // Set up Login\n        values := make(url.Values)\n        values.Set(\"user\", user)\n        values.Set(\"password\", password)\n\n        // Submit form\n        resp, err := http.PostForm(postUrl, values)\n        if err != nil {\n                log.Fatal(err)\n        }\n        defer resp.Body.Close()\n\n        // How do I store cookies?\n        return \"Hello\"\n}\n\nfunc ViewBill(url string, cookies) string {\n\n//What do I put here?\n\n}", "output": "Go 1.1 introduced a cookie jar implementation net/http/cookiejar.\nimport (\n    \"net/http\"\n    \"net/http/cookiejar\"\n)\n\njar, err := cookiejar.New(nil)\nif err != nil { \n  // error handling \n}\n\nclient := &http.Client{\n    Jar: jar,\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go equivalent of PHP's 'implode'\n\nQuestion:\nWhat is the Go equivalent of PHP's 'implode'?", "output": "In the standard library: strings.Join\nfunc Join(a []string, sep string) string\n\nhttp://golang.org/pkg/strings/#Join\nCheers!"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you build the 8g and 6g Go compilers for Go\n\nQuestion:\nI'm writing software that will be somewhat widely deployed amongst Windows, Mac, and Linux systems on x86 and x86-64 architectures.  Whenever I set up the go compiler on my Mac and Linux systems I only ever get 6g built.  On Windows I just use the pre-built experimental binaries, which uses 8g.\nWhen I get around to setting up build servers, I assume I need to also build 8g so I can produce 32 bit builds as well.  How do I set up 8g, in particular on a Mac (since they can be x86 or x64 depending on how old they are)?", "output": "As another poster said, use GOARCH. What he didn't say is that you don't need multiple directories.\nRun all.bash twice, same GOROOT:\nGOARCH=amd64 ./all.bash\nGOARCH=386 ./all.bash\n\nWhen you build something with gomake set up GOARCH if the default doesn't suit you\nGOARCH=386 gomake\n\nUnfortunately goinstall doesn't honor GOARCH yet.\nNotice that gc compilers are always cross compiling. Once you have the compilers for the architecture you need, set GOOS and build the packages in $GOROOT/src/pkg, then you should be able to build your software targeting any operating system or architecture.\nGOARCH=386 GOOS=windows gomake"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to implement a counter when using golang's goroutine?\n\nQuestion:\nI'm trying to make a queue struct that have push and pop functions.\nI need to use 10 threads push and another 10 threads pop data, just like I did in the code below.\nQuestions:\n\nI need to print out how much I have pushed/popped, but I don't know how to do that.\nIs there anyway to speed up my code? The code is too slow for me.\n\npackage main\n\nimport (\n    \"runtime\"\n    \"time\"\n)\n\nconst (\n    DATA_SIZE_PER_THREAD = 10000000\n)\n\ntype Queue struct {\n    records string\n}\n\n\nfunc (self Queue) push(record chan interface{}) {\n    // need push counter\n    record <- time.Now()\n}\n\nfunc (self Queue) pop(record chan interface{}) {\n    // need pop counter\n    <- record\n}\n\nfunc main() {\n    runtime.GOMAXPROCS(runtime.NumCPU())\n    //record chan\n    record := make(chan interface{},1000000)\n    //finish flag chan\n    finish := make(chan bool)\n    queue := new(Queue)\n    for i:=0; i<10; i++ {\n        go func() {\n            for j:=0; j<DATA_SIZE_PER_THREAD; j++ {\n                queue.push(record)\n            }\n            finish<-true\n        }()\n    }\n    for i:=0; i<10; i++ {\n        go func() {\n            for j:=0; j<DATA_SIZE_PER_THREAD; j++ {\n                queue.pop(record)\n            }\n            finish<-true\n        }()\n    }\n    for i:=0; i<20; i++ {\n        <-finish\n    }\n}", "output": "There are a few things you should fix.\n\nThe methods on the Queue type should have pointer receivers. Otherwise, every method\ncall will create a copy of the current queue type and any changes to queue fields will\nnot persist beyond the method call itself.\nWaiting for all routines to finish, can be done using a sync.WaitGroup. This\nis specifically what it was designed for.\nMaintaining a thread-safe push/pop counter inside the queue type can be done by\nusing the sync/atomic package.\n\nAs far as speed goes, from your example, I am not quite sure what you are trying to achieve. Any optimizations might come up if you elaborate on that a little.\nHere is an example I modified from your code:\npackage main\n\nimport (\n    \"log\"\n    \"runtime\"\n    \"sync\"\n    \"sync/atomic\"\n    \"time\"\n)\n\nconst SizePerThread = 10000000\n\ntype Queue struct {\n    records string\n    count   int64\n}\n\nfunc (q *Queue) push(record chan interface{}) {\n    record <- time.Now()\n\n    newcount := atomic.AddInt64(&q.count, 1)\n    log.Printf(\"Push: %d\", newcount)\n}\n\nfunc (q *Queue) pop(record chan interface{}) {\n    <-record\n\n    newcount := atomic.AddInt64(&q.count, -1)\n    log.Printf(\"Pop: %d\", newcount)\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n\n    runtime.GOMAXPROCS(runtime.NumCPU())\n\n    record := make(chan interface{}, 1000000)\n    queue := new(Queue)\n\n    // We are launching 20 goroutines.\n    // Let the waitgroup know it should wait for as many\n    // of them to finish.\n    wg.Add(20)\n\n    for i := 0; i < 10; i++ {\n        go func() {\n            defer wg.Done()\n\n            for j := 0; j < SizePerThread; j++ {\n                queue.push(record)\n            }\n        }()\n\n        go func() {\n            defer wg.Done()\n\n            for j := 0; j < SizePerThread; j++ {\n                queue.pop(record)\n            }\n        }()\n    }\n\n    // Wait for all goroutines to finish.\n    wg.Wait()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go: Call a function passing pointer to array\n\nQuestion:\nI have spent a bit of time attempting to do this, and I think I need a global array (not slice), and I want to pass it as a pointer, not by value. The function receiving the pointer needs to test for nil, and if nil, read the array from disk, using eg: \"baForm, oOserr = ioutil.ReadFile(sFormName)\". The calling function may pass either a global array or an array local to the calling function which I presume will be garbage collected.\nThe reason for doing this is that I want a standard function to read the forms from disk, and often-used forms are stored globally. Despite whether some may think there is a better way, I still want to know how to achieve this ie: a) have global or local array, b) not pass by value, c) The global arrays will be read only once from disk and the local arrays will be read each time the function is called. TIA.", "output": "Here's a sample program that maintains a dynamic forms buffer based on use count. If the ReadForm function finds a form, it returns the address of the form and a nil error.\npackage main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"math\"\n    \"os\"\n    \"sync\"\n)\n\ntype Form struct {\n    Name     string\n    useCount int64\n    Data     []byte\n}\n\n// The capacity of the forms buffer.\nconst formsCap = 2\n\n// The forms buffer.\nvar (\n    forms     = make(map[string]*Form, formsCap)\n    formsLock sync.RWMutex\n)\n\nfunc ReadForm(name string) (form *Form, err os.Error) {\n    formsLock.RLock()\n    form, ok := forms[name]\n    formsLock.RUnlock()\n    if !ok {\n            form = &Form{name, 0, nil}\n    }\n    if form.Data == nil {\n        data, err := ioutil.ReadFile(name + \".form\")\n        if err != nil {\n            return nil, err\n        }\n        form = &Form{name, 0, data}\n        formsLock.Lock()\n        if len(forms) >= formsCap {\n            minForm := &Form{useCount: math.MaxInt64}\n            for i, f := range forms {\n                if f.useCount < minForm.useCount {\n                    minForm = f\n                }\n            }\n            minform.Data = nil\n        }\n        forms[name] = form\n        formsLock.Unlock()\n    }\n    form.useCount++\n    return form, nil\n}\n\nfunc main() {\n    // form files are named name.form e.g. form1.form\n    for _, name := range []string{\"form1\", \"form2\", \"form3\"} {\n        f, err := ReadForm(name)\n        if err != nil {\n            fmt.Println(err)\n        } else {\n            fmt.Println(string(f.Data))\n        }\n    }\n    fmt.Println(len(forms), forms)\n}\n\nEDIT: Map operations are not atomic. Revise the sample program to use a mutex for concurrent access to the forms map."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go - JSON-RPC - \"too many colons\"\n\nQuestion:\nI'm trying to call a HTTP JSON-RPC server for Bitcoin using Go (not on GAE), but I get error of\ndial tcp http://user:pass@127.0.0.1:8332: too many colons in address\n\nor\ndial ip http://user:pass@127.0.0.1:8332: lookup http://user:pass@127.0.0.1:8332: no such host\n\nI tried various network configurations, but couldn't get anything going. When I just typed the address into the browser, I got a response from the server:\n{\"result\":null,\"error\":{\"code\":-32700,\"message\":\"Parse error\"},\"id\":null}\n\nWhich looks like a proper response for an empty call.\nHow do I correctly call that HTTP JSON-RPC server in Go?", "output": "Use brackets around the host like this:\n[user:pass@127.0.0.1]:8332\n\nReference:\nhttp://golang.org/src/pkg/net/ipsock.go?s=2247:2304#L68"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go HTTP handler - handling more than two form actions\n\nQuestion:\nI have a webapp where I have code like:\nfunc handler (w res, r req) {\n  if req.Method == POST {\n    // create html form 2 with a submit button2\n    return ;\n  }\n  // create html form 1 with a submit button1\n  return\n} \n\nfunc main() {\n  handle(\"/\", handler)\n}\n\nNow, the root / is registered with the handler func. In the first request (GET), I create a form and send it to the user. If the user submits this form, I handle it under the \"POST\" method. Now, I create a different form in the post method handler, and now I want a way to do some operations based on what the user typed in this form2, when [s]he submits form2.\nWhat is the standard way with go to handle the form2 form submission ? I have done some asp programming earlier and we use form action to submit to a different asp file. How can I do some actions based on parsing the form2 submission request ?", "output": "If I'm understanding you correctly, you want a way of routing the same URL to different handlers based on the request method rather than just the path? If that's the case...\nFor comparison, using Python + Django, the way you're doing this is pretty standard:\ndef my_django_view(request):\n    if request.method == \"POST\":\n        try_to_process_posted_data()\n    elif request.method == \"GET\":\n        show_a_form_to_user()\n\nIf you are trying to do fancier things like URL routing based on path and request method (GET, POST, DELETE, ...), then you might be interested in something like Gorilla.mux\nIt provides some friendly URL routing methods:\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/\", YourGETHandlerFunc).Methods(\"GET\")\n    router.HandleFunc(\"/\", YourPOSTHandlerFunc).Methods(\"POST\")\n    http.Handle(\"/\", router)\n}\n\nIf you're looking for more resources for web development...\n\nMango: http://paulbellamy.com/2011/05/introducing-mango/\nWeb.go: http://www.getwebgo.com/tutorial\nTwister: https://github.com/garyburd/twister/blob/master/examples/hello/main.go"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: how to select for input on a dynamic list of channels in Go?\n\nQuestion:\nGo has a mechanism to do a blocking read from one of several channels, the select statement.  So you can say\nselect {\n    case <- c1:\n    case <- c2:\n}\n\nwill block until we get input from either of these two channels.  Very nice. \nBut this requires that I specify in the source code how many channels I want to poll.  What if I have a slice or array of channels and I want to block until I get input on any of them?", "output": "Just a thought, but you could use a multiplexing pattern, where you spawn off a goroutine with 2 channels that blocks on both and sends the output to a new channel. Then you can just build up a tree of these dynamically from your list that funnels everything down to a single channel, which you then read on."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Can functions be passed as parameters?\n\nQuestion:\nIn Java I can do something like \nderp(new Runnable { public void run () { /* run this sometime later */ } })\n\nand \"run\" the code in the method later. It's a pain to handle (anonymous inner class), but it can be done.\nDoes Go have something that can facilitate a function/callback being passed in as a parameter?", "output": "Yes, consider some of these examples:\npackage main\n\nimport \"fmt\"\n\n// convert types take an int and return a string value.\ntype convert func(int) string\n\n// value implements convert, returning x as string.\nfunc value(x int) string {\n    return fmt.Sprintf(\"%v\", x)\n}\n\n// quote123 passes 123 to convert func and returns quoted string.\nfunc quote123(fn convert) string {\n    return fmt.Sprintf(\"%q\", fn(123))\n}\n\nfunc main() {\n    var result string\n\n    result = value(123)\n    fmt.Println(result)\n    // Output: 123\n\n    result = quote123(value)\n    fmt.Println(result)\n    // Output: \"123\"\n\n    result = quote123(func(x int) string { return fmt.Sprintf(\"%b\", x) })\n    fmt.Println(result)\n    // Output: \"1111011\"\n\n    foo := func(x int) string { return \"foo\" }\n    result = quote123(foo)\n    fmt.Println(result)\n    // Output: \"foo\"\n\n    _ = convert(foo) // confirm foo satisfies convert at runtime\n\n    // fails due to argument type\n    // _ = convert(func(x float64) string { return \"\" })\n}\n\nPlay: http://play.golang.org/p/XNMtrDUDS0\nTour: https://tour.golang.org/moretypes/25 (Function Closures)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: I want to develop in Go on Windows and deploy to Google App Engine\n\nQuestion:\nI want to develop in the Go Language (go-lang) using Google App Engine to run my app and I use IntelliJ on Windows. How can I do this?", "output": "If you use the official installer, it is very easy to get Go up and running on Windows.\nEdit: The latest Zeus beta now has support for the Go Build, Format and Run commands and also does Go initellisene (i.e. auto complete)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to convert a string to a byte array which is compiled with a given charset in Go?\n\nQuestion:\nIn java, we can use the method of String : byte[] getBytes(Charset charset) .\nThis method Encodes a String into a sequence of bytes using the given charset, storing the result into a new byte array.\nBut how to do this in GO?\nIs there any similar way in Go can do this?\nPlease let me know it.", "output": "The standard Go library only supports Unicode (UTF-8, UTF-16, UTF-32) and ASCII encoding. ASCII is a subset of UTF-8.\nThe go-charset package (found from here) supports conversion to and from UTF-8 and it also links to the GNU iconv library.\nSee also field CharsetReader in encoding/xml.Decoder."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How does Go compile so quickly?\n\nQuestion:\nI've Googled and poked around the Go website, but I can't find an explanation for Go's extraordinary build times. Are they products of the language features (or lack thereof), a highly optimized compiler, or something else? I'm not trying to promote Go; I'm just curious.", "output": "Dependency analysis.\nThe Go FAQ used to contain the following sentence:\n\nGo provides a model for software\nconstruction that makes dependency\nanalysis easy and avoids much of the\noverhead of C-style include files and\nlibraries.\n\nWhile the phrase is not in the FAQ anymore, this topic is elaborated upon in the talk Go at Google, which compares the dependency analysis approach of C/C++ and Go.\nThat is the main reason for fast compilation. And this is by design."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google App Engine Go score counting and saving\n\nQuestion:\nI want to make a simple GAE app in Go that will let users vote and store their answers in two ways. First way will be raw data (Database store of \"voted for X\"), the second will be a running count of those votes (\"12 votes for X, 10 votes for Y\"). What is an effective way to store both of those values with the app being accessed by multiple people at the same time? If I retrieve the data from the Datastore, change it, and save it back for one instance, another might be wanting to do the same in parallel, and I`m not sure if the final result will be correct.", "output": "It seems like a good way to do that is to simply store all vote events as separate entities (the \"voted for X\" way) and use the Task Queue for the recalculation (the \"12 votes for X, 10 votes for Y\" way), so the recalculation is done offline and sequentially (without any races and other concurrency issues). Then you'd have to put the recalc task every once in a while to the queue so the results are updated.\nThe Task Queue doesn't allow adding another task with the same name as an existing one, but doesn't allow checking whether a specific task is already enqueued, so maybe simply trying adding a task with a same name to the queue will be enough to be sure that multiple recalc tasks are not there.\nAnother way would be to use a goroutine waiting for a poke from an input channel in order to recalculate the results. I haven't run such goroutines on App Engine so I'm not sure of the general behavior of this approach."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How does modular code work in Go?\n\nQuestion:\nNot having come from a C/compiled languages background, I'm finding it hard to get to grips with using Go's packages mechanism to create modular code.\nIn Python, to import a module and get access to it's functions and whatnot, it's a simple case of\nimport foo\n\nwhere foo.py is the name of the module you want to import in the same directory. Otherwise you can add an empty __init__.py into a subfolder and access the modules via\nfrom subfolder import foo\n\nYou can then access functions by simply referencing them through the module name, e.g. y = foo.bar(y). This makes it easy to separate logical pieces of code from one another.\n\nIn Go however, you specify the package name in the source file itself, e.g.\npackage foo\n\nat the top of the 'foo' module, which you can then supposedly import through\nimport (\n        \"foo\"\n              )\n\nand then refer to it through that, i.e. y := foo.Bar(x) . But what I can't wrap my head around is how this works in practice. The relevant docs on golang.org seem terse, and directed to people with more (any) experience using makefiles and compilers.\nCan someone please clearly explain how you are meant to modularise your code in Go, the right project structure to do so, and how the compilation process works?", "output": "Wiki answer,  please feel free to add/edit.\nModularization\n\nMultiple files in the same package\n\nThis is just what it sounds like.  A bunch of files in the same directory that all start with the same package <name> directive means that they are treated as one big set of code by Go.  You can transparently call functions in a.go from b.go.  This is mostly for the benefit of code organization.  \nA fictional example would be a \"blog\" package might be laid out with blog.go (the main file), entry.go, and server.go.  It's up to you.  While you could write a blog package in one big file, that tends to affect readability.\n\nMultiple packages\n\nThe standard library is done this way.  Basically you create modules and optionally install them into $GOROOT.  Any program you write can import \"<name>\" and then call <name>.someFunction()\nIn practice any standalone or shared components should be compiled into packages.  Back to the blog package above, If you wanted to add a news feed, you could refactor server.go into a package.  Then both blog.go and news.go would both import \"server\".\n\n\nCompilation\nI currently use gomake with Makefiles.  The Go installation comes with some great include files for make that simplify the creation of a package or a command.  It's not hard and the best way to get up to speed with these is to just look at sample makefiles from open source projects and read \"How to Write Go Code\"."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Determine Request Latency\n\nQuestion:\nI'm working on creating a version of Pastry natively in Go. From the design [PDF]:\n\nIt is assumed that the application\n  provides a function that allows each Pastry node to determine the “distance” of a node\n  with a given IP address to itself. A node with a lower distance value is assumed to be\n  more desirable. An application is expected to implements this function depending on its\n  choice of a proximity metric, using network services like traceroute or Internet subnet\n  maps, and appropriate caching and approximation techniques to minimize overhead.\n\nI'm trying to figure out what the best way to determine the \"proximity\" (i.e., network latency) between two EC2 instances programmatically from Go. Unfortunately, I'm not familiar enough with low-level networking to be able to differentiate between the different types of requests I could use. Googling did not turn up any suggestions for measuring latency from Go, and general latency techniques always seem to be Linux binaries, which I'm hoping to avoid in the name of fewer dependencies. Any help?\nAlso, I note that the latency should be on the scale of 1ms between two EC2 instances. While I plan to use the implementation on EC2, it could hypothetically be used anywhere. Is latency generally so bad that I should expend the effort to ensure the network proximity of two nodes? Keep in mind that most Pastry requests can be served in log base 16 of the number of servers in the cluster (so for 10,000 servers, it would take approximately 3 requests, on average, to find the key being searched for). Is the latency from, for example, EC2's Asia-Pacific region to EC2's US-East region enough to justify the increased complexity and the overhead introduced by the latency checks when adding nodes?", "output": "A common distance metric in networking is to count the number of hops (node-hops in-between) a packet needs to reach its destination. This metric was also mentioned in the text you quoted. This could give you adequate distance values even for the low-latency environment you mentioned (EC2 “local”).\nFor the go logic itself, one would think the net package is what you are looking for. And indeed, for latency tests (ICMP ping) you could use it to create an IP connection\nconn, err := net.Dial(\"ip4\", \"127.0.0.1\")\n\ncreate your ICMP package structure and data, and send it. (See Wikipedia page on ICMP; IPv6 needs a different format.) Unfortunately you can’t create an ICMP connection directly, like you can with TCP and UDP, thus you will have to handle the package structure yourself.\nAs conn of type Conn is a Writer, you can then pass it your data, the ICMP data you defined.\nIn the ICMP Type field you can specify the message type. Values 8, 1 and 30 are the ones you are looking for. 8 for your echo request, the reply will be of type 1. And maybe 30 gives you some more information.\nUnfortunately, for counting the network hops, you will need the IP packet header fields. This means, you will have to construct your own IP packets, which net does not seem to allow.\nChecking the source of Dial(), it uses internetSocket, which is not exported/public. I’m not really sure if I’m missing something, but it seems there is no simple way to construct your own IP packets to send, with customizable header values. You’d have to further check how DialIP sends packages with internetSocket and duplicate and adapt that code/concept. Alternatively, you could use cgo and a system library to construct your own packages (this would add yet more complexity though).\nIf you are planning on using IPv6, you will (also) have to look into ICMPv6. Both packages have a different structure over their v4 versions.\n\nSo, I’d suggest using simple latency (timed ping) as a simple(r) implementation and then add node-hops at a later time/afterwards, if you need it. If you have both in place, maybe you also want to combine those 2 (less hops does not automatically mean better; think long overseas-cables etc)."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Are there libCURL bindings for the Go language\n\nQuestion:\nI have searched web for libCURL bindings for Go language, but failed to find any... I also checked curl.haxx.se list of bindings with no success for Go. Are there any such project on net?\nIf such binding don't exists are where any alternative libraries or maybe you could provide some hints how I could implement my own bindings of libCURL?\nThanks", "output": "I tend to just use http.Client which does enough stuff for me not to need Curl:\nhttp://golang.org/pkg/http/#Client"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Iterating over all the keys of a map\n\nQuestion:\nIs there a way to get a list of all the keys in a Go language map?  The number of elements is given by len(), but if I have a map like:\nm := map[string]string{ \"key1\":\"val1\", \"key2\":\"val2\" };\n\nHow do I iterate over all the keys?", "output": "https://play.golang.org/p/JGZ7mN0-U-\nfor k, v := range m { \n    fmt.Printf(\"key[%s] value[%s]\\n\", k, v)\n}\n\nor\nfor k := range m {\n    fmt.Printf(\"key[%s] value[%s]\\n\", k, m[k])\n}\n\nGo language specs for for statements specifies that the first value is the key, the second variable is the value, but doesn't have to be present."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to get the number of characters in a string\n\nQuestion:\nHow can I get the number of characters of a string in Go?\nFor example, if I have a string \"hello\" the method should return 5. I saw that len(str) returns the number of bytes and not the number of characters so len(\"£\") returns 2 instead of 1 because £ is encoded with two bytes in UTF-8.", "output": "You can try RuneCountInString from the utf8 package.\n\nreturns the number of runes in p\n\nthat, as illustrated in this script: the length of \"World\" might be 6 (when written in Chinese: \"世界\"), but the rune count of \"世界\" is 2:\npackage main\n    \nimport \"fmt\"\nimport \"unicode/utf8\"\n    \nfunc main() {\n    fmt.Println(\"Hello, 世界\", len(\"世界\"), utf8.RuneCountInString(\"世界\"))\n}\n\nPhrozen adds in the comments:\nActually you can do len() over runes by just type casting.\nlen([]rune(\"世界\")) will print 2. At least in Go 1.3.\n\nAnd with CL 108985 (May 2018, for Go 1.11), len([]rune(string)) is now optimized. (Fixes issue 24923)\nThe compiler detects len([]rune(string)) pattern automatically, and replaces it with for r := range s call.\n\nAdds a new runtime function to count runes in a string.\nModifies the compiler to detect the pattern len([]rune(string))\nand replaces it with the new rune counting runtime function.\nRuneCount/lenruneslice/ASCII        27.8ns ± 2%  14.5ns ± 3%  -47.70%\nRuneCount/lenruneslice/Japanese     126ns ± 2%   60  ns ± 2%  -52.03%\nRuneCount/lenruneslice/MixedLength  104ns ± 2%   50  ns ± 1%  -51.71%\n\n\n\nStefan Steiger points to the blog post \"Text normalization in Go\"\n\nWhat is a character?\n\n\nAs was mentioned in the strings blog post, characters can span multiple runes.\nFor example, an 'e' and '◌́◌́' (acute \"\\u0301\") can combine to form 'é' (\"e\\u0301\" in NFD). Together these two runes are one character.\nThe definition of a character may vary depending on the application.\nFor normalization we will define it as:\n\na sequence of runes that starts with a starter,\na rune that does not modify or combine backwards with any other rune,\nfollowed by possibly empty sequence of non-starters, that is, runes that do (typically accents).\n\nThe normalization algorithm processes one character at at time.\n\nUsing that package and its Iter type, the actual number of \"character\" would be:\npackage main\n    \nimport \"fmt\"\nimport \"golang.org/x/text/unicode/norm\"\n    \nfunc main() {\n    var ia norm.Iter\n    ia.InitString(norm.NFKD, \"école\")\n    nc := 0\n    for !ia.Done() {\n        nc = nc + 1\n        ia.Next()\n    }\n    fmt.Printf(\"Number of chars: %d\\n\", nc)\n}\n\nHere, this uses the Unicode Normalization form NFKD \"Compatibility Decomposition\"\n\nOliver's answer points to UNICODE TEXT SEGMENTATION as the only way to reliably determining default boundaries between certain significant text elements: user-perceived characters, words, and sentences.\nFor that, you need an external library like rivo/uniseg, which does Unicode Text Segmentation.\nThat  will actually count  \"grapheme cluster\", where multiple code points may be combined into one user-perceived character.\npackage uniseg\n    \nimport (\n    \"fmt\"\n    \n    \"github.com/rivo/uniseg\"\n)\n    \nfunc main() {\n    gr := uniseg.NewGraphemes(\"!\")\n    for gr.Next() {\n        fmt.Printf(\"%x \", gr.Runes())\n    }\n    // Output: [1f44d 1f3fc] [21]\n}\n\nTwo graphemes, even though there are three runes (Unicode code points).\nYou can see other examples in \"How to manipulate strings in GO to reverse them?\"\n‍ alone is one grapheme, but, from unicode to code points converter, 4 runes:\n\n: women (1f469)\ndark skin (1f3fe)\nZERO WIDTH JOINER (200d)\nred hair (1f9b0)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: WebP encoder/decoder in go\n\nQuestion:\nIs there somewhere a complete WebP encoder and decoder compatible with current weekly (or forkable)?\nIs it comparable in speed to the standard png one ?", "output": "There is a package by this guy on GitHub that includes both an encoder and a decoder for WebP:\nhttps://github.com/chai2010/webp\nFrom the readme file:\npackage main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n\n    \"github.com/chai2010/webp\"\n)\n\nfunc main() {\n    var buf bytes.Buffer\n    var width, height int\n    var data []byte\n    var err error\n\n    // Load file data\n    if data, err = ioutil.ReadFile(\"./testdata/1_webp_ll.webp\"); err != nil {\n        log.Println(err)\n    }\n\n    // GetInfo\n    if width, height, _, err = webp.GetInfo(data); err != nil {\n        log.Println(err)\n    }\n    fmt.Printf(\"width = %d, height = %d\\n\", width, height)\n\n    // GetMetadata\n    if metadata, err := webp.GetMetadata(data, \"ICCP\"); err != nil {\n        fmt.Printf(\"Metadata: err = %v\\n\", err)\n    } else {\n        fmt.Printf(\"Metadata: %s\\n\", string(metadata))\n    }\n\n    // Decode webp\n    m, err := webp.Decode(bytes.NewReader(data))\n    if err != nil {\n        log.Println(err)\n    }\n\n    // Encode lossless webp\n    if err = webp.Encode(&buf, m, &webp.Options{Lossless: true}); err != nil {\n        log.Println(err)\n    }\n    if err = ioutil.WriteFile(\"output.webp\", buf.Bytes(), 0666); err != nil {\n        log.Println(err)\n    }\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: MongoDB in Go (golang) with mgo: How do I update a record, find out if update was successful and get the data in a single atomic operation?\n\nQuestion:\nI am using mgo driver for MongoDB under Go.\nMy application asks for a task (with just a record select in Mongo from a collection called \"jobs\") and then registers itself as an assignee to complete that task (an update to that same \"job\" record, setting itself as assignee).\nThe program will be running on several machines, all talking to the same Mongo.  When my program lists the available tasks and then picks one, other instances might have already obtained that assignment, and the current assignment would have failed.\nHow can I get sure that the record I read and then update does or does not have a certain value (in this case, an assignee) at the time of being updated?\nI am trying to get one assignment, no matter which one, so I think I should first select a pending task and try to assign it, keeping it just in the case the updating was successful.\nSo, my query should be something like:\n\"From all records on collection 'jobs', update just one that has assignee=null, setting my ID as the assignee.  Then, give me that record so I could run the job.\"\nHow could I express that with mgo driver for Go?", "output": "I hope you saw the comments on the answer you selected, but that approach is incorrect. Doing a select and then update will result in a round trip and two machines and be fetching for the same job before one of them can update the assignee. You need to use the findAndModify method instead: http://www.mongodb.org/display/DOCS/findAndModify+Command"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Enforcing type in \"generic\" code with empty interfaces\n\nQuestion:\nSorry for the ambiguous title.\nI'm reading this book http://algs4.cs.princeton.edu/home/ and I thought it would be good to implement the examples in Go as a learning exercise, however the book uses Java as its language to describe code in.\nOne of the first chapters discusses setting up some core datatypes/container style classes to re-use later on but I'm having trouble trying to hammer these into a Go setting, mainly because these datatypes seem to be enjoying the use of Java generics.\nFor example, I've written the following code\npackage bag\n\ntype T interface{}\ntype Bag []T\n\nfunc (a *Bag) Add(t T) {\n    *a = append(*a, t)\n}\n\nfunc (a *Bag) IsEmpty() bool {\n    return len(*a) == 0\n}\n\nfunc (a *Bag) Size() int {\n    return len(*a)\n}\n\nThis works in principle in the sense that I can add items to a Bag and check its size and everything. However this also means that the following code is legal\na := make(bag.Bag,0,0)\na.Add(1)\na.Add(\"Hello world!\")\na.Add(5.6)\na.Add(time.Now())\n\nI was just wondering if there was any way of enforcing the type so it conforms to a contract similar to\nBag<T> bagOfMyType = new Bag<T>()\n\ne.g.\nBag<Integer> bagOfInts = new Bag<Integer>()\n\nI know Go doesn't have generics and they're not really The Go Way, but I was just wondering if it is a possible to \"enforce\" anything at compile time (probably not) \nSorry for the long post\nEDIT: OK so I've been looking into this a little further, I've pretty much given up with the generics side of things (I understand this is not on the roadmap for Go) so I'm thinking of doing something similar to Haskell typeclasses with interfaces, e.g.\ntype T interface{}\ntype Bag interface {\n    Add(t T)\n    IsEmpty() bool\n    Size() int\n}\n\ntype IntSlice []int\n\nfunc (i *IntSlice) Add(t T) {\n    *i = append(*i, t.(int)) // will throw runtime exception if user attempts to add anything other than int\n}\n\nfunc (i *IntSlice) IsEmpty() bool {\n    return len(*i) == 0\n}\n\nfunc (i *IntSlice) Size() int {\n    return len(*i)\n}\n\nThe problem with this is the type enforcement is only enforced at runtime.\nAnyone got any ideas how to improve on this?", "output": "I'm new to Go myself, so I'm curious if someone will have a better answer, but here's how I see it:\nYou want compile-time enforcement that when Add() is called on an IntSlice, its parameter is an int.  Well, here's how you do that:\nfunc (i *IntSlice) Add(t int) {\n    *i = append(*i, t)\n}\n\nSince there aren't generics, the Add() method is going to be different for every type of Bag, so the Bag interface, assuming you need it, becomes just:\ntype Bag interface {\n    IsEmpty() bool\n    Size() int\n}\n\nThat makes sense to me, because you can't pass a Bag around and throw just anything in it.  Knowing that something is a Bag isn't enough to know how to call Add() on it; you must know what type of Bag you're dealing with.\nYou could make the interface specific to the type, like IntBag, but since only one type is actually going to satisfy that interface, you might as well get rid of the interface and change the name of IntSlice to IntBag.\nBasically that means giving up entirely on anything generic-like, and just creating a type with some methods that do what you want:\ntype IntBag []int\n\nfunc (b *IntBag) Add(i int) {\n    *b = append(*b, i)\n}\n\nfunc (b IntBag) IsEmpty() bool {\n    return len(b) == 0\n}\n\nfunc (b IntBag) Size() int {\n    return len(b)\n}\n\nUpdate: Sometimes generics really would come in handy.  It seems to me we're left choosing on a case-by-case basis what exactly is best for a given problem.  With empty interfaces and reflection, you can get some generic-like behavior, but it tends to be ugly and you give up some compile-time type checking.  Or you give up on generics and have some code-duplication. Or you just do it a totally different way.\nI asked a question a few weeks ago about how I should use Go to handle problems that look to me like they need class hierarchies. The answer was basically that there is no general solution; it's all case-by-case. I think the same applies for generics: there are no generics in Go, and there's no general solution for translating generics-based solutions to Go.\nThere are many cases where you might use generics in another language but interfaces are perfectly adequate (or truly shine) in Go.  Your example here is one where interfaces aren't really a proper replacement.  See also: Go Vs. Generics."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Properly pass arguments to Go Exec\n\nQuestion:\nI'm trying to learn go and as a start I wanted to try to throw together a super simple web server for controlling my iTunes.  I've used osascript -e 'Tell Application \"iTunes\" to playpause' to this purpose many times in the past and thought I could simply sluff the call off to osascript here.\nThe commented out \"say 5\" command does work.\npackage main\n\nimport \"exec\"\n//import \"os\"\n\nfunc main() {\n\n    var command = \"Tell Application 'iTunes' to playpause\"\n    //var command = \"say 5\"\n\n    c := exec.Command(\"/usr/bin/osascript\", \"-e\", command)\n//  c.Stdin = os.Stdin\n    _, err := c.CombinedOutput()\n    println(err.String());\n\n\n}\n\nThe response I am receiving from this is as follows - \njessed@JesseDonat-MBP ~/Desktop/goproj » ./8.out\nexit status 1\n[55/1536]0x1087f000\n\nI'm not exactly sure where to go from here and any direction would be greatly appreciated.", "output": "I got it working with this\npackage main\n\nimport (\n    \"fmt\"\n    \"exec\"\n)\n\nfunc main() {\n    command := \"Tell Application \\\"iTunes\\\" to playpause\"\n\n    c := exec.Command(\"/usr/bin/osascript\", \"-e\", command)\n    if err := c.Run(); err != nil {\n        fmt.Println(err.String())\n    }\n}\n\nI think exec.Command(...) adds double quotes to the parameters if there is spaces in them, so you only need to escape \\\" where you need them."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go Programming Language Mutual Concurrent Execution\n\nQuestion:\nI have two concurrent go routines like below,\nRoutine 1{                                                  \n\nroutine procedure   \n\ncritical section{                                                     \n}\n\nroutine procedure                        \n} \n\nRoutine 2{                                                  \n\nroutine procedure   \n\ncritical section{                                                     \n}\n\nroutine procedure                       \n} \n\nIs it possible by using some go inbuilt functions to implement critical section ?", "output": "Your question: \n\nI have N concurrent go routines (all more or less same purpose). Each of those have a critical section. Before entering critical section, each routine just do some message sending job. When it enters critical section, I need all other routines must stop execution until it exits critical section. Is it possible by using any library function in GO?\n\nWhat you are asking about (to force a stop on all other goroutines while one goroutine is in the critical section) is not typical in Go programs. There is no library function to stop all other goroutines, so you will need to stop them by designing proper synchronization among goroutines in your program. The typical scenario is for all goroutines to (potentially) run concurrently, except for those goroutines that are blocked somehow.\nTo control concurrent access to a shared resource in a Go program you can use Go channels, the \"sync\" package, pipes, or network connections.\nUsing sync.Mutex, the Go code may look like this (but please keep in mind that, whenever possible, Go programs should preferably use Go channels instead of mutexes):\npackage main\n\nimport \"sync\"\n\nvar m sync.Mutex\nvar wg sync.WaitGroup\n\nfunc routine1() {\n    ... do something ...\n\n    m.Lock()\n    ... critical section (access the shared resource here) ...\n    m.Unlock()\n\n    ... do something ...\n    wg.Done()\n}\n\nfunc routine2() {\n    ... do something ...\n\n    m.Lock()\n    ... critical section (access the shared resource here) ...\n    m.Unlock()\n\n    ... do something ...\n    wg.Done()\n}\n\nfunc main() {\n    wg.Add(1); go routine1()\n    wg.Add(1); go routine2()\n    wg.Wait()\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go language on iPhone\n\nQuestion:\nIs it possible to write in Go for iPhone?\nI think following steps are required\n\nCompile Go as ARM Mach-O binary (I expect GCCGO be able to do that)\nCompile iPhone app as static library (I think it possible to rename main() -> main2(), etc)\nCompile Go as Mach-O binary linked with iPhone static library. Go will have to call main2.\nmake some plist files, zip, sign", "output": "Minux maintains the Go iOS port here: https://bitbucket.org/minux/goios/wiki/Home"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Marshalling DIDL-Lite with Go's xml package\n\nQuestion:\nHere's a sample DIDL-Lite XML document from the UPnP AV ContentDirectory v2 Service Template:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<DIDL-Lite\n xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n xmlns=\"urn:schemas-upnp-org:metadata-1-0/DIDL-Lite/\"\n xmlns:upnp=\"urn:schemas-upnp-org:metadata-1-0/upnp/\"\n xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n xsi:schemaLocation=\"\n   urn:schemas-upnp-org:metadata-1-0/DIDL-Lite/\n    http://www.upnp.org/schemas/av/didl-lite-v2-20060531.xsd\n   urn:schemas-upnp-org:metadata-1-0/upnp/\n    http://www.upnp.org/schemas/av/upnp-v2-20061231.xsd\">\n   <item id=\"18\" parentID=\"13\" restricted=\"0\">\n      ...\n   </item>\n</DIDL-Lite>\n\nHow would one go about marshalling to this with Go's xml package? More specifically:\n\nHow are namespace prefixes defined, such as xmlns:dc and xmlns:upnp?\nHow are multiple name spaces configured on an element?\nHow is the namespace set for attributes, such as the xsi prefix on the schemaLocation attribute?\n\nAs a base, I have something like this:\ntype DIDLLite struct {\n    XMLName xml.Name `xml:\"urn:schemas-upnp-org:metadata-1-0/DIDL-Lite/ DIDL-Lite\"`\n    // ??? namespace prefixes dc, upnp, xsi\n    Objects []Object\n}\n\nI've also found this possibly related bug.", "output": "The example you gave is marshalled.  I assume you mean to ask, \"how would one define Go data types that marshal with xml.Marshal into this?\"\npackage main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\ntype DIDLLite struct {\n    XMLName xml.Name\n    DC      string   `xml:\"xmlns:dc,attr\"`\n    UPNP    string   `xml:\"xmlns:upnp,attr\"`\n    XSI     string   `xml:\"xmlns:xsi,attr\"`\n    XLOC    string   `xml:\"xsi:schemaLocation,attr\"`\n    Objects []Object `xml:\"item\"`\n}\n\ntype Object struct {\n    ID         string `xml:\"id,attr\"`\n    Parent     string `xml:\"parentID,attr\"`\n    Restricted string `xml:\"restricted,attr\"`\n}\n\nfunc main() {\n    d := DIDLLite{\n        XMLName: xml.Name{\n            Space: \"urn:schemas-upnp-org:metadata-1-0/DIDL-Lite/\",\n            Local: \"DIDL-Lite\",\n        },\n        DC:   \"http://purl.org/dc/elements/1.1/\",\n        UPNP: \"urn:schemas-upnp-org:metadata-1-0/upnp/\",\n        XSI:  \"http://www.w3.org/2001/XMLSchema-instance\",\n        XLOC: `\n   urn:schemas-upnp-org:metadata-1-0/DIDL-Lite/\n    http://www.upnp.org/schemas/av/didl-lite-v2-20060531.xsd\n   urn:schemas-upnp-org:metadata-1-0/upnp/\n    http://www.upnp.org/schemas/av/upnp-v2-20061231.xsd`,\n        Objects: []Object{{ID: \"18\", Parent: \"13\", Restricted: \"0\"}},\n    }\n    b, err := xml.MarshalIndent(d, \"\", \"    \")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(string(b))\n}\n\nOutput:\n<DIDL-Lite xmlns=\"urn:schemas-upnp-org:metadata-1-0/DIDL-Lite/\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:upnp=\"urn:schemas-upnp-org:metadata-1-0/upnp/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"\n   urn:schemas-upnp-org:metadata-1-0/DIDL-Lite/\n    http://www.upnp.org/schemas/av/didl-lite-v2-20060531.xsd\n   urn:schemas-upnp-org:metadata-1-0/upnp/\n    http://www.upnp.org/schemas/av/upnp-v2-20061231.xsd\">\n    <item id=\"18\" parentID=\"13\" restricted=\"0\"></item>\n</DIDL-Lite>\n\nwhich can be pretty printed to match your example above.  xml.MarshallIndent is a little primitive yet."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How do you use the net functions effectively in Go?\n\nQuestion:\nFor example, having basic packet protocol, like:\n[packetType int][packetId int][data []byte]\nAnd making a client and server doing simple things with it (egx, chatting.)", "output": "Here's a client and server with sloppy panic error-handling. They have some limitations:\n\nThe server only handles one client connection at a time. You could fix this by using goroutines.\nPackets always contain 100-byte payloads. You could fix this by putting a length in the packet somewhere and not using encoding/binary for the entire struct, but I've kept it simple.\n\nHere's the server:\npackage main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n    \"net\"\n)\n\ntype packet struct {\n    // Field names must be capitalized for encoding/binary.\n    // It's also important to use explicitly sized types.\n    // int32 rather than int, etc.\n    Type int32\n    Id   int32\n    // This must be an array rather than a slice.\n    Data [100]byte\n}\n\nfunc main() {\n    // set up a listener on port 2000\n    l, err := net.Listen(\"tcp\", \":2000\")\n    if err != nil {\n        panic(err.String())\n    }\n\n    for {\n        // start listening for a connection\n        conn, err := l.Accept()\n        if err != nil {\n            panic(err.String())\n        }\n        handleClient(conn)\n    }\n}\n\nfunc handleClient(conn net.Conn) {\n    defer conn.Close()\n\n    // a client has connected; now wait for a packet\n    var msg packet\n    binary.Read(conn, binary.BigEndian, &msg)\n    fmt.Printf(\"Received a packet: %s\\n\", msg.Data)\n\n    // send the response\n    response := packet{Type: 1, Id: 1}\n    copy(response.Data[:], \"Hello, client\")\n    binary.Write(conn, binary.BigEndian, &response)\n}\n\nHere's the client. It sends one packet with packet type 0, id 0, and the contents \"Hello, server\". Then it waits for a response, prints it, and exits.\npackage main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n    \"net\"\n)\n\ntype packet struct {\n    Type int32\n    Id   int32\n    Data [100]byte\n}\n\nfunc main() {\n    // connect to localhost on port 2000\n    conn, err := net.Dial(\"tcp\", \":2000\")\n    if err != nil {\n        panic(err.String())\n    }\n    defer conn.Close()\n\n    // send a packet\n    msg := packet{}\n    copy(msg.Data[:], \"Hello, server\")\n    err = binary.Write(conn, binary.BigEndian, &msg)\n    if err != nil {\n        panic(err.String())\n    }\n\n    // receive the response\n    var response packet\n    err = binary.Read(conn, binary.BigEndian, &response)\n    if err != nil {\n        panic(err.String())\n    }\n    fmt.Printf(\"Response: %s\\n\", response.Data)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does Go have lambda expressions or anything similar?\n\nQuestion:\nDoes Go support lambda expressions or anything similar?\nI want to port a library from another language that uses lambda expressions (Ruby).", "output": "Yes.\nHere is an example, copied and pasted carefully:\n\npackage main\n\nimport fmt \"fmt\"\n\ntype Stringy func() string\n\nfunc foo() string{\n  return \"Stringy function\"\n}\n\nfunc takesAFunction(foo Stringy){\n  fmt.Printf(\"takesAFunction: %v\\n\", foo())\n}\n\nfunc returnsAFunction()Stringy{\n  return func()string{\n    fmt.Printf(\"Inner stringy function\\n\");\n    return \"bar\" // have to return a string to be stringy\n  }\n}\n\nfunc main(){\n  takesAFunction(foo);\n  var f Stringy = returnsAFunction();\n  f();\n  var baz Stringy = func()string{\n    return \"anonymous stringy\\n\"\n  };\n  fmt.Printf(baz());\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Git: Ignore compiled Google Go\n\nQuestion:\nMy compiled Go code does not end with an extension on Linux. \nAny tips for handling ignoring these in the .gitignore file?", "output": "Keep your build products separate from your source code.  This has several advantages:\n\nyou can start many different builds of the same code at the same time without creating multiple clones\nit's easy to be confident that you've really done a clean; rm -rf objdir will remove files that a buggy make clean will miss\nyou can kick off a build from a read-only copy of the source tree (e.g., CD-ROM)\nyou're less likely to accidentally commit generated files\ngit clean -dxf will clean your source tree, but won't touch your built files\n\nNote that GNU Automake and Make support a feature called VPATH to make it easy to separate the source tree from the build tree."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the starting point for simple image indexing for search tool\n\nQuestion:\nI'm bulding a small photo gallery website and I need a function that detect duplicate images (don't need to be be 100% accurate, just like Google Image Search).  \nI'm using a very new language (Golang) so I don't think there is any available library for this out there.  \nSo what is the starting point for me? Please give me some keyword about this. Or if you have any material that is simple and easy to understand, please share me.", "output": "I think this blog post is simple and easy to understand."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go XML Unmarshal example doesn't compile\n\nQuestion:\nThe Xml example in the go docs is broken. Does anyone know how to make it work? When I compile it, the result is:\nxmlexample.go:34: cannot use \"name\" (type string) as type xml.Name in field value\nxmlexample.go:34: cannot use nil as type string in field value\nxmlexample.go:34: too few values in struct initializer\n\nHere is the relevant code:\npackage main\n\nimport (\n        \"bytes\"\n        \"xml\"\n)\n\ntype Email struct {\n        Where string \"attr\";\n        Addr string;\n}\n\ntype Result struct {\n        XMLName xml.Name \"result\";\n        Name string;\n        Phone string;\n        Email []Email;\n}\n\nvar buf = bytes.NewBufferString ( `\n<result>\n        <email where=\"home\">\n                <addr>gre@example.com</addr>\n        </email>\n        <email where='work'>\n                <addr>gre@work.com</addr>\n        </email>\n        <name>Grace R. Emlin</name>\n        <address>123 Main Street</address>\n</result>`)\n\n\nfunc main() {\n        var result = Result{ \"name\", \"phone\", nil }\n        xml.Unmarshal ( buf , &result )\n        println ( result.Name )\n}", "output": "The type Result is defined as:\ntype Result struct {\n    XMLName xml.Name \"result\"\n    Name    string\n    Phone   string\n    Email   []Email\n}\n\nThe type xml.Name, embedded in type Result, is defined as:\n// A Name represents an XML name (Local) annotated\n// with a name space identifier (Space).\n// In tokens returned by Parser.Token, the Space identifier\n// is given as a canonical URL, not the short prefix used\n// in the document being parsed.\ntype Name struct {\n    Space, Local string\n}\n\nTherefore, initialize, using composite literals, using something similar to one of:\nvar result = Result{xml.Name{}, \"name\", \"phone\", nil}\n\nvar result = Result{xml.Name{\"space\", \"local\"}, \"name\", \"phone\", nil}\n\nvar result = Result{Name: \"name\", Phone: \"phone\", Email: nil}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Data structure for modelling a containment/composite relation\n\nQuestion:\nI posted a similar message in golang mailing list, as it involve some language specific details. I hope the cuncurrency support native to the language may have a better way to model this than a pattern. If you are not familar with golang, please help me with your knowledge of data structure in general. I think most of my doubts are lanuage neutral and I had better response from SO.\nI am trying model a storage area (has a containement relation like, storage -> Rack(s) -> Shelf(s) -> Bin(s).\nAs I learned, typically it may model with \"composite pattern\". But, in an effort to \n- Keep the structural (hierarchy) details seperate from objects\n- Use the language constructs (channels to walk the tree etc)\nI was thinking of modelling the information in a tree.I do not have an understanding of what is the best tree structure suitable for this application. \n\nIn go, I see two libraries implementing LLRB and treap. What would you recommend? Is there a more suitable data structure available?\nDoes the tree has to be balanced? for example, I may have only ine shelf in one rack, but can be arbitrariy long containment in others.\nFor quick traversal, I will keep it in memory. How do I manage loading, building and persisting the tree structure? Do I build the tree everytime I open the application, and do not persist the tree itself but the objects.", "output": "You got good answers on the Go-Nuts list.  Sameer Ajmani's advice to start with  built in types is good.  Don't get bogged down in something more complex until simple solutions prove inadequate.  Si guy has your solution for persistence.  Gob is fast and simple."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang passing http.ResponseWriter\n\nQuestion:\nI am trying to figure out if its possible to not have to pass along the http.ResponseWriter everywhere i go when programming a web application. I am setting up a simple mvc web framework and i find myself having to pass the http.ResponseWriter through various functions when its only used in lets say the last function. \nRoutes package\n\n// Struct containing http requests and variables\ntype UrlInfo struct {\n    Res http.ResponseWriter\n    Req *http.Request\n    Vars map[string]string\n}\n\nfunc HandleFunc(handlepath string, runfunc func(*UrlInfo)) {\n    // Set handler and setup struct\n    http.HandleFunc(getHandlePath(handlepath), func(w http.ResponseWriter, r *http.Request) {\n        url := new(UrlInfo)\n        url.Res = w\n        url.Req = r\n        url.Vars = parsePathVars(r.URL.Path, handlepath)\n\n        runfunc(url)\n    })\n}\n\n// Parse file and send to responsewriter\nfunc View(w http.ResponseWriter, path string, data interface{}) {\n    // Go grab file from views folder\n    temp, err := template.ParseFiles(path+\".html\")\n    if err != nil {\n        // Couldnt find html file send error\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    } else {\n        temp.ExecuteTemplate(w, temp.Name(), data)\n    }\n}\n\nController package\n\nimport (\n    \"routes\"\n)\n\nfunc init() {\n    // Build handlefunc\n    routes.HandleFunc(\"/home/\", home)\n}\n\nfunc home(urlinfo *routes.UrlInfo) {\n    info := make(map[string]string)\n    info[\"Title\"] = urlinfo.Vars[\"title\"]\n    info[\"Body\"] = \"Body Info\"\n\n    gi.View(urlinfo.Res, \"pages/about\", info)\n}\n\nI would like to not have to pass anything in the home function just so i can pass it again to the view function to spit out. Would be nice to be able to set it in one place and pull from it whenever needed. This would also nice in regard to multiple packages that communicate to the routes package in the same regard.\nAny and all thoughts, tips or tricks are welcome. Thanks.", "output": "There are a number of ways you can do this. The trick is to figure out what is you actually need from the ResponseWriter you are passing through. It sounds like you just need to exercise a little function composition.\nChange your design so that the View returns an io.Reader, and an error that you can then pipe into the ResponseWriter. Here's a completely untested example:\nfunc View(path string, data interface{}) (io.Reader, error) {\n    // Go grab file from views folder\n    temp, err := template.ParseFiles(path+\".html\")\n    if err != nil {\n        // Couldnt find html file send error\n       return nil, err\n    } else {\n        buf := bytes.Buffer()\n        temp.ExecuteTemplate(buf, temp.Name(), data)\n        return buf\n    }\n}\n\nfunc HandleFunc(handlepath string, runfunc func(*UrlInfo) (io.Reader, error)) {\n    // Set handler and setup struct\n    http.HandleFunc(getHandlePath(handlepath),\n                    func(w http.ResponseWriter, r *http.Request) {\n        url := new(UrlInfo)\n        url.Res = w\n        url.Req = r\n        url.Vars = parsePathVars(r.URL.Path, handlepath)\n\n        rdr, err := runfunc(url)\n        io.Copy(w, rdr);\n    })\n}\n\nWith this the only thing that has to worry about the http ResponseWriter is your HandleFunc function."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Automatically 301 Redirecting in Go\n\nQuestion:\nI'm trying to redirect a url to a different url (either 301 or 301). Basically, I'm looking for the go equivalent of following php code:\n<?php\n// Permanent redirection\nheader(\"HTTP/1.1 301 Moved Permanently\");\nheader(\"Location: http://google.com/\");\n?>\n\nSo far this is what I've done:\nwriter.Header().Set(\"Location\", \"http://google.com\")\nwriter.WriteHeader(301)\n\nAnd also:\nhandler := rawHttp.RedirectHandler(\"http://google.com\", 301)\nhandler.ServeHTTP(writer, req)\n\nIt 'kind of' works. The only problem is it write a 'Found' text with a link to http://google.com so I've to click it. I want it to redirect automatically without displaying a 'Found' link.", "output": "Solved it. Either works. I was just sending some text before setting up the redirect."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What's the recommended way to connect to MySQL from Go?\n\nQuestion:\nI am looking for a reliable solution to connect to a MySQL database from Go. I've seen some libraries around, but it is difficult to determine the different states of completeness and current maintenance. I don't have complex needs, but I'd like to know what people are relying on or the most standard solution to connect to MySQL.", "output": "A few drivers are available but you should only consider those that implement the database/sql API as\n\nit provides a clean and efficient syntax,\nit ensures you can later change the driver without changing your code, apart the import and connection.\n\nTwo fast and reliable drivers are available for MySQL :\n\nMyMySQL\nGo-MySQL-Driver\n\nI've used both of them in production, programs are running for months with connection numbers in the millions without failure.\nOther SQL database drivers are listed on go-wiki.\nImport when using MyMySQL :\nimport (\n    \"database/sql\"\n    _ \"github.com/ziutek/mymysql/godrv\"\n)\n\nImport when using Go-MySQL-Driver :\nimport (\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nConnecting and closing using MyMySQL :\ncon, err := sql.Open(\"mymysql\", database+\"/\"+user+\"/\"+password)\ndefer con.Close()\n// here you can use the connection, it will be closed when function returns\n\nConnecting and closing using Go-MySQL-Driver :\ncon, err := sql.Open(\"mysql\", store.user+\":\"+store.password+\"@/\"+store.database)\ndefer con.Close()\n\nSelect one row :\nrow := con.QueryRow(\"select mdpr, x, y, z from sometable where id=?\", id)\ncb := new(SomeThing)\nerr := row.Scan(&cb.Mdpr, &cb.X, &cb.Y, &cb.Z)\n\nSelect multiple rows and build an array with results :\nrows, err := con.Query(\"select a, b from item where p1=? and p2=?\", p1, p2)\nif err != nil { /* error handling */}\nitems := make([]*SomeStruct, 0, 10)\nvar ida, idb uint\nfor rows.Next() {\n    err = rows.Scan(&ida, &idb)\n    if err != nil { /* error handling */}\n    items = append(items, &SomeStruct{ida, idb})\n}\n\nInsert : \n_, err = con.Exec(\"insert into tbl (id, mdpr, isok) values (?, ?, 1)\", id, mdpr)\n\nYou'll see that working in Go with MySQL is a delightful experience : I never had a problem, my servers run for months without errors or leaks. The fact that most functions simply take a variable number of arguments lighten a task which is tedious in many languages.\nNote that if, in the future, you need to use another MySQL driver, you'll just have to change two lines in one go file : the line doing the import and the line opening the connection."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to use cgo in Goclipse with Mingw?\n\nQuestion:\nWhen i try to use cgo I get the error\nexec gcc: exec: \"gcc\": executable file not found in %PATH%\nI have Mingw installed. How do I tell Goclipse where gcc is? I could not find a way in preferences or properties to set this.", "output": "Add the path to MinGW gcc to your Windows PATH environment variable.\nSetting environment variables under Windows"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Methods of an interface\n\nQuestion:\nWould be correct the next way to implement the methods attached to an interface? (getKey, getData)\ntype reader interface {\n    getKey(ver uint) string\n    getData() string\n}\n\ntype location struct {\n    reader\n    fileLocation string\n    err os.Error\n}\n\nfunc (self *location) getKey(ver uint) string {...}\n\nfunc (self *location) getData() string {...}\n\nfunc NewReader(fileLocation string) *location {\n    _location := new(location)\n    _location.fileLocation = fileLocation\n    return _location\n}", "output": "In Go you don't need to explicitly say that you are implementing an interface—if a type has everything required by an interface, it can be used via that interface. So you don't need to say reader inside the type location struct.\nSee here: http://golang.org/doc/effective_go.html#interfaces_and_types"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Issue with Mutual Execution of Concurrent Go Routines\n\nQuestion:\nIn my code there are three concurrent routines. I try to give a brief overview of my code,\nRoutine 1 {\ndo something\n\n*Send int to Routine 2\nSend int to Routine 3\nPrint Something\nPrint Something*\n\ndo something\n}\n\nRoutine 2 {\ndo something\n\n*Send int to Routine 1\nSend int to Routine 3\nPrint Something\nPrint Something*\n\ndo something\n}\n\nRoutine 3 {\ndo something\n\n*Send int to Routine 1\nSend int to Routine 2\nPrint Something\nPrint Something*\n\ndo something\n}\n\nmain {\nroutine1\nroutine2\nroutine3\n}\n\nI want that, while codes between two do something (codes between two star marks) is executing, flow of control must not go to other go routines. For example, when routine1 is executing the events between two stars (sending and printing events), routine 2 and 3 must be blocked (means flow of execution does not pass to routine 2 or 3 from routine 1).After completing last print event, flow of execution may pass to routine 2 or 3.Can anybody help me by specifying, how can I achieve this ? Is it possible to implement above specification by WaitGroup ? Can anybody show me by giving a simple example how to implement above specified example by using WaitGroup. Thanks.\nNB:May be this is repeat question of this. I tried by using that sync-lock mechanism, however, may be because I have a large code that's why I could not put lock-unlock properly, and it's creating deadlock situation (or may be my method is error producing). Can anybody help me by a simple procedure thus I can achieve this. I give a simple example of my code here where Here I want to put two prints and sending event inside mutex (for routine 1) thus routine 2 can't interrupt it. Can you help me how is it possible. One possible solution given, \nhttp://play.golang.org/p/-uoQSqBJKS which gives error.", "output": "Why do you want to do this? \nThe deadlock problem is, if you don't allow other goroutines to be scheduled, then your channel sends can't proceed, unless there's buffering. Go's channels have finite buffering, so you end up with a race condition on draining before they get sent on while full. You could introduce infinite buffering, or put each send in its own goroutine, but it again comes down to: why are you trying to do this; what are you trying to achieve?\nAnother thing: if you only want to ensure mutual exclusion of the three sets of code between *s, then yes, you can use mutexes. If you want to ensure that no code interrupts your block, regardless of where it was suspended, then you might need to use runtime.LockOSThread and runtime.UnlockOSThread. These are fairly low level and you need to know what you're doing, and they're rarely needed. Of you want there to be no other goroutines running, you'll have to have runtime.GOMAXPROCS(1), which is currently the default."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Generic function using an interface\n\nQuestion:\nSince I've a similar function for 2 different data types:\nfunc GetStatus(value uint8) (string) {...}\nfunc GetStatus(name string) (string) {...}\n\nI would want to use a way more simple like:\nfunc GetStatus(value interface{}) (string) {...}\n\nIs possible to create a generic function using an interface?\nThe data type could be checked using reflect.Typeof(value)", "output": "Does what you want to do need the complexity and overhead of the reflect  package? Have you considered a simple switch statement type switch?\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc GetStatus(value interface{}) string {\n    var s string\n    switch v := value.(type) {\n    case uint8:\n        v %= 85\n        s = string(v + (' ' + 1))\n    case string:\n        s = v\n    default:\n        s = \"error\"\n    }\n    return s\n}\n\nfunc main() {\n    fmt.Println(GetStatus(uint8(2)), GetStatus(\"string\"), GetStatus(float(42.0)))\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: int from string in go\n\nQuestion:\nWhat's the function to create a int value from string \ni := ???.????( \"10\" )", "output": "Import the strconv package (src/pkg/strconv), then use strconv.Atoi(\"10\")"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE filter entity key (Golang)\n\nQuestion:\nI want to use look like\ndatastore.NewQuery(\"Article\").Filter(\"ID =\", id)\n\nto get entity key.\nHow do this?\nSorry for my poor English. Thanks!", "output": "I never tried Go but I'll give it a shot:\nk := datastore.NewKey(c, \"Activity\", \"\", id, nil)\nq := datastore.NewQuery(\"Article\").Filter(\"__key__ =\", k)\n\nWhere c is your appengine.Context"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: With Go, how to append unknown number of byte into a vector and get a slice of bytes?\n\nQuestion:\nI'm trying to encode a large number to a list of bytes(uint8 in Go).\nThe number of bytes is unknown, so I'd like to use vector.\nBut Go doesn't provide vector of byte, what can I do?\nAnd is it possible to get a slice of such a byte vector?\nI intends to implement data compression.\nInstead of store small and large number with the same number of bytes,\nI'm implements a variable bytes that uses less bytes with small number \nand more bytes with large number.\nMy code can not compile, invalid type assertion:\n  1 package main\n  2 \n  3 import (\n  4     //\"fmt\"\n  5     \"container/vector\"\n  6 )\n  7 \n  8 func vbEncodeNumber(n uint) []byte{\n  9     bytes := new(vector.Vector)\n 10     for {\n 11         bytes.Push(n % 128)\n 12         if n < 128 {\n 13             break\n 14         }\n 15         n /= 128\n 16     }\n 17     bytes.Set(bytes.Len()-1, bytes.Last().(byte)+byte(128))\n 18     return bytes.Data().([]byte) // <-\n 19 }\n 20 \n 21 func main() { vbEncodeNumber(10000) }\n\nI wish to writes a lot of such code into binary file, \nso I wish the func can return byte array.\nI haven't find a code example on vector.", "output": "Since you're trying to represent large numbers, you might see if the big package serves your purposes.\nThe general Vector struct can be used to store bytes. It accepts an empty interface as its type, and any other type satisfies that interface. You can retrieve a slice of interfaces through the Data method, but there's no way to convert that to a slice of bytes without copying it. You can't use type assertion to turn a slice of interface{} into a slice of something else. You'd have to do something like the following at the end of your function: (I haven't tried compiling this code because I can't right now)\nbyteSlice = make([]byte, bytes.Len())\nfor i, _ := range byteSlice {\n    byteSlice[i] = bytes.At(i).(byte)\n}\nreturn byteSlice"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: replace c++ with go + swig\n\nQuestion:\nI recently asked this question https://softwareengineering.stackexchange.com/questions/129076/go-instead-of-c-c-with-cgo and got some very interesting input. However there's a mistake in my question: I assumed cgo could also be used to access c++ code but that's not possible. Instead you need to use SWIG.\nThe go faq says \"The cgo program provides the mechanism for a “foreign function interface” to allow safe calling of C libraries from Go code. SWIG extends this capability to C++ libraries. \"\nmy question:\nIs it possible to access high-level c++ frameworks such as QT with SWIG + Go and get productive? I'd like to use Go as a \"scripting language\" to utilize c++ libraries.\nHave you any experience with go and swig? Are there pitfalls I have to be aware of?\nUpdate/Answer: I've asked this over IRC too and I think the question is solved:\nSWIG is a rather clean way of interfacing c++ code from other languages. Sadly matching the types of c++ to something like go can be very complex and in most cases you have to specify the mapping yourself. That means that SWIG is a good way to leverage an existing codebase to reuse already written algorithms. However mapping a library like Qt to go will take you ages. Mind it's surely possible but you don't want to do it.\nThose of you that came here for gui programming with go might want try go-gtk or the go version of wxWidgets.", "output": "Is it possible?  Yes.\nCan it be done in a reasonably short period of time?  No.\nIf you go back and look at other projects that have taken large frameworks and tried to put an abstraction layer on it, you'll find most are \"incomplete\".  You can probably make a fairly good start and get some initial wrappers in place, but generally even the work to get the simple cases solved takes time when there is a lot of underlying code to wrap, even with automated tools (which help, but are never a complete solution).  And then...  you get to the nasty remaining 10% that will take you forever (ok, a really really long time at least).  And then think about how it's a changing target in the first place.  Qt, for example, is about to release the next major rewrite.\nGenerally, it's safest to stick to the framework language that the framework was designed for.  Though many have language extensions within the project itself.  For example, for Qt you should check out QML, which provides (among many other things) a javascript binding to Qt.  Sort of.  But it might meet your \"scripting\" requirement."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Nesting function calls in GO\n\nQuestion:\nLet us say we want to implement following computation:\noutval / err = f3(f3(f1(inval)) \nwhere each of f1, f2, f3 can fail with an error at that time we stop the computation and set err to error returned by the failing function. (Of course, nesting can be arbitrarily long)\nIn languages like C++/JAVA/C# it can be easily done by having f1, f2 and f3 throw an exception and enclosing the computation in a try-catch block, while in languages like Haskell we can use monads instead.\nNow I am trying to implement it in GO and the only approach I can think of is obvious if-else ladder which is rather verbose. I don't have issue if we can't nest the calls, but in my opinion adding error check after each line in code looks ugly and it breaks the flow. I would like to know if there is any better way of doing it.\nEdit: Editing as per the comment by peterSO\nBelow is the concrete example and straightforward implementation  \npackage main\n\nimport \"fmt\"\n\nfunc f1(in int) (out int, err error) {\n    return in + 1, err\n}\n\nfunc f2(in int) (out int, err error) {\n    return in + 2, err\n}\n\nfunc f3(in int) (out int, err error) {\n    return in + 3, err\n}\n\nfunc calc(in int) (out int, err error) {\n    var temp1, temp2 int\n    temp1, err = f1(in)\n    if err != nil {\n        return temp1, err\n    }\n    temp2, err = f2(temp1)\n    if err != nil {\n        return temp2, err\n    }\n    return f3(temp2)\n}\n\nfunc main() {\n     inval := 0\n     outval, err := calc3(inval)\n     fmt.Println(inval, outval, err)\n}\n\nWhat I am trying to illustrate is, function calc does some computation possibly with the help of library functions that can fail and semantics is if any call fails calc propagates the error to the caller (similar to not handling the exception). In my opinion, code for calc is ugly.\nBetween for this particular case where all library functions have exactly same signature, we can make the code better (I am using idea from http://golang.org/doc/articles/wiki/#tmp_269)\nfunc saferun(f func (int) (int, error)) func (int, error) (int, error) {\n    return func (in int, err error) (int, error) {\n        if err != nil {\n            return in, err\n        }\n        return f(in)\n    }\n} \n\nThen we can redefine calc as\nfunc calc(in int) (out int, err error) {\n    return saferun(f3)(saferun(f2)(f1(in)))\n}\n\nor as\nfunc calc(in int) (out int, err error) {\n    sf2 := saferun(f2)\n    sf3 := saferun(f3)\n    return sf3(sf2(f1(in)))\n}\n\nBut without generics support, I am not sure how I can use this approach for any set of library functions.", "output": "The discussion between Errors vs Exceptions is a long and tedious one. I shall therefore not go into it.\nThe simplest answer to your question concerns Go's built-in defer, panic, and recover functions as discussed in this blog post. They can offer behaviour similar to exceptions.\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    defer func() {\n        // This recovers from a panic if one occurred. \n        if x := recover(); x != nil {\n            fmt.Printf(\"%v\\n\", x)\n        }\n    }()\n\n    value := f(f(f(1)))\n    fmt.Printf(\"%d\\n\", value)\n}\n\nfunc f(i int) int {\n    value := i*i + 1\n\n    // something goes wrong, panic instead of returning an error.\n    panic(\"ohnoes\")\n\n    return value\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What does it mean by a 'systems language'?\n\nQuestion:\nThe Go talk 2009 pdf has a comment to explain why they came up with the go language :\n\nNo new major systems language in a decade.\n\nWhat's the meaning of systems language?\n\nIs it a language that is supposed to run on target system by generating native binary?\nIs it a language that can build operating system on its own? \n\nI can see C#/Java is `not' a systems language, and C/C++ is.", "output": "It's a rough, informal distinction, but the idea is that there are \"application programming languages,\" targeted at programmers who develop shrinkwrapped business applications, and \"systems programming languages,\" targeted at programmers who program tools for other programmers (compilers, etc.) and low-level software such as OS kernels, device drivers, etc.\nIn short, most (recently-invented, anyway) languages are designed to make it easier to develop user-facing software for dealing with some non-computing domain---finance, engineering, etc. Systems programming languages are those, such as C, FORTH, Go, etc. which are intended or at least suitable for programming in the domain of computing.\nThese often, but do not always, feature compilation to native code, loose type systems which permit extensive \"punning,\" and unmanaged memory access through pointers or an equivalent construct."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: HTTP Post dynamic data to and from Google App Engine\n\nQuestion:\nI want to write an application in Java that will communicate with Google App Engine app written in Go by sending and receiving dynamic data. The data is not human readable (as in, not ASCII, Unicode or the like) and ranges from a couple bytes to about 1MB.\nI am wondering if it is possible to send such data to and from GAE using Post method directly, or is it better to just encode it as a hex dump and transfer is at text (thusly increasing its size a couple times)?", "output": "Yes, this is possible, of course. Just like an HTTP response, an HTTP request can contain a payload of any sort (unless it's a GET or other method that doesn't permit a body); just set the content-type appropriately and send the data in the body of the HTTP request."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: In go, how do you create an interface when methods are called by *Type?\n\nQuestion:\nAttempting to create an interface, but methods have *Type, not Type receivers\nAPOLOGIZE: was sleepy and mis-read error messages.  Thought I was being block from creating the DB interface when in reality I was mis-using it.  Sorry about that... will be more careful in the future!\n\ntype Char string\n\nfunc (*Char) toType(v *string) interface{} {\n        if v == nil {\n                return (*Char)(nil)\n        }\n        var s string = *v\n        ch := Char(s[0])\n        return &ch\n}\nfunc (v *Char) toRaw() *string {\n        if v == nil {\n                return (*string)(nil)\n        }\n        s := *((*string)(v))\n        return &s\n}\n\nfrom here I would like an interface that contains the methods toType and toRaw\n\ntype DB interface{\n        toRaw() *string\n        toType(*string) interface{}\n}\n\ndoes not work since the function receivers are pointers.  I say this because when I try to use it I get the error.k\n\n    Char does not implement DB (toRaw method requires pointer receiver)\n\nIs there a way to create an interface from toType and toRaw, or do I need to backup and have the receivers be the types themselves and not pointers to types?", "output": "I don't understand what your problem is. Yes, the way you've written it, *Char conforms to the interface DB and Char doesn't. You can either \n\nchange your code so that the methods operate on the non-pointer type Char directly (which will automatically also work for *Char too)\nonly use *Char when you need something to be compatible with type DB"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Built-in \"html/template\" or \"mustache\", which one shall I use?\n\nQuestion:\nI'm new to golang, and want to use it to build a web app.\nI found it has built-in html/template, which can render html template with specified data, and there is also a mustache port which seems good.\nI'm not sure which one shall I use. Please give me some advices or comparations between them to let me decide, thank you.", "output": "I prefer use html/template because it comes in Go library, and by its simple design.\nYou can see in the next web application how powerfull it is:\nhttps://bitbucket.org/jzs/sketchground/src"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: how to make an absolute path http redirect in golang\n\nQuestion:\nI was reading the source code goto, and I found the code below in goto/talk/0/main.go:\nhttp.Redirect(w, r, url, http.StatusFound)\n\nAccording to the context, url was an absolute path, and an absolute path redirect was expected. But as the golang/http/redirect mentioned:\n\nRedirect replies to the request with a redirect to url, which may be a path relative to the request path.\n\nIt results as a relative path redirect. I don't know if http.Redirect did an absolute path redirect before, but it doesn't nowadays.\nSo how can I make an absolute path redirect in golang?\nI searched the Internet, but found nothing,can anyone help me?\nThanks in advance.", "output": "I finally found that to perform an absolute path redirect, the url must be a complete url, such as http://www.stackoverflow.com or https://github.com, but not www.stackoverflow.com."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Deadlock Error in Mutually Concurrent Go Routines\n\nQuestion:\nI have three concurrent go routines like below,\nfunc Routine1() {\n    mutex1.Lock()\n\n    do something\n\n    mutex2.Lock()\n    mutex3.Lock()\n    send int to routine 2\n    send int to routine 3\n   * Print Something *\n    mutex2.Unlock()\n    mutex3.Unlock()\n\n    receive ints\n    do something \n\n    mutex2.Lock()\n    mutex3.Lock()\n    send int to routine 2\n    send int to routine 3\n    Print Something\n    mutex2.Unlock()\n    mutex3.Unlock()\n\n    do something\n    receive ints\n    mutex1.Unlock()\n    wg.Done()\n}\n\nfunc Routine2() {\n    mutex2.Lock()\n\n    do something\n\n    mutex1.Lock()\n    mutex3.Lock()\n    send int to routine 1\n    send int to routine 3\n    Print Something\n    mutex1.Unlock()\n    mutex3.Unlock()\n\n    do something\n    receive ints\n\n    mutex1.Lock()\n    mutex3.Lock()\n    send int to routine 1\n    send int to routine 3\n    Print Something\n    mutex1.Unlock()\n    mutex3.Unlock()\n\n    do something\n    receive ints\n    mutex2.Unlock()\n    wg.Done()\n}\n\nfunc Routine3() {\n// same structure as routine 1 & 2\n}\nfunc main() {\nwg.Add(3)\ngo Routine1()\ngo Routine2()\nRoutine3()\nwg.Wait()\n}\n\nThis logical code gives deadlock situation every time. Actually, when it runs, just execute print statement of routine 1 (statement between * marks) manytimes (though my print statement is only one) and gives deadlock error. Can anybody inform me what is wrong with the code logic. Thanks.\nNB. For more info, code can be found here, http://play.golang.org/p/pW6aXryUaK, where only line number 290 is executing.  The original code which contains no error, can be found here play.golang.org/p/UL3rj8DJRk. I just add lock and unlock to them. Thanks.\nI want to add another point: in the code of play.golang.org/p/UL3rj8DJRk, you can find outputs of various print statements like this: process [number] sends [int] to process [number] at   [time nano seconds]. However, as the result of three concurrent routines, sometimes the print statement is not executing properly (means not printing whole, there is some thing inserted by another print like process [number] sends [int] to process [number] at process [number]). Can any body help me how to manage this ?", "output": "It is impossible to identify the cause of the deadlock because the code you posted does not contain enough information.\nIt may be caused by the order in which you are acquiring locks, or it may be caused by usage of unbuffered Go channels.\nUntil you post complete Go source code, there is no way to answer your question.\nIf you need to discuss the code in greater length, you probably should post it to golang-nuts."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Distinguishing sign of zero : -float64(0) from float64(0) in Go\n\nQuestion:\nI want to serialize a floating point in such a way that sign info is not lost.  Specifically, I would like to distinguish IEEE-754 negative zero from regular zero.\nThe language spec says\n\nThe result of a floating-point division by zero is not specified beyond the IEEE-754 standard; whether a run-time panic occurs is implementation-specific.\n\nwhich suggests that I cannot do\nn == 0 && (float64(1) / n) < 0\n\nand I tried math.Copysign and math.Signbit which says\n\nfunc Signbit(x float64) bool\n\nSignbit returns true if x is negative or negative zero.\n\nbut\nn == 0 && math.Signbit(n)\n\ndoesn't seem to work for\nn := -float64(0)\n\nAny ideas?\nEDIT:\nI filed issue 2196 to track what I think is a confusing difference between\nnz := -float64(0)\n\nand\npz := float64(0)\nnz := -pz\n\nas suggested by peterSO.", "output": "package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    pz := float64(0)\n    nz := -pz\n    fmt.Println(pz, math.Signbit(pz), nz, math.Signbit(nz))\n    if n := nz; n == 0 && math.Signbit(n) {\n        fmt.Println(\"n is negative zero:\", n)\n    }\n}\n\nOutput:\n0 false -0 true\nn is negative zero: -0"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is there a queue implementation?\n\nQuestion:\nCan anyone suggest Go container for simple and fast FIF/queue, Go has 3 different containers: heap, list and vector. Which one is more suitable to implement a queue?", "output": "Either vector or list should work, but vector is probably the way to go. I say this because vector will probably allocate less often than list and garbage collection (in the current Go implementation) is fairly expensive. In a small program it probably won't matter, though."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Equivalent of Goroutines in Clojure / Java\n\nQuestion:\nI recently enjoyed watching the Google IO talk on Go Concurrency patterns \nAlthough the Go approach to concurrency (groutines, communication over channels) is clearly different to Clojure (immutability, manged references, STM), it seemed like the Go approach could still be useful in some circumstances in a Clojure context.\nSo is there a direct equivalent in Clojure or Java for Go's concurrency primitives (perhaps a library), in particular:\n\nchannel-like objects that block until a reader and writer are available at both ends\nA select-like construct that can wait for results on multiple channels\n\nP.S. Perfectly happy with a Java solution since it would be easy to use from Clojure\nUPDATE Since the question was originally asked, Clojure now has core.async which provides all this functionality and more.", "output": "You should check out core.async. It is a library written by Rich Hickey that implements go style channels."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Issue with Compiling Go in Windows 64bit\n\nQuestion:\nI have installed Go from gomingw for windows 64 bit. However, I cannot find out anywhere how to actually compile a .go file. This is the program linked directly from the Go wiki for Windows Support, but all the tutorials talk about using 6g and gccgo etc. and none of those work on my windows machine. Actually, what I am trying to do is, I put my \"hello.go\" in src folder and after going to src folder I run the command \"8g hello.go\" in command prompt. But. it showing error \"open a.go no such file or directory\". Can anybody help me by providing correct steps to compile a go program in Windows? Thanks in advance.", "output": "Navigate to your source code directory (for example, C:\\Arpsss), display the current directory, and display the current directory contents.\nC:\\>cd C:\\Arpssss\nC:\\Arpssss>cd\nC:\\Arpssss\nC:\\Arpssss>dir\n Volume in drive C has no label.\n Directory of C:\\Arpssss\n11/28/2011  10:26 AM    <DIR>          .\n11/28/2011  10:26 AM    <DIR>          ..\n11/28/2011  10:24 AM                73 hello.go\n               1 File(s)             73 bytes\n               2 Dir(s)   4,949,831,680 bytes free\n\nTry to compile a non-existent file named a.go.\nC:\\Arpssss>8g a.go\nopen a.go: No such file or directory\n\nThis is the error you reported--you tried to compile a file named a.go that wasn't in your current directory.\nCompile, link, and run the hello.go Go source file in the current directory.\nC:\\Arpssss>8g hello.go\nC:\\Arpssss>8l -o hello.exe hello.8\nC:\\Arpssss>hello\nHello, World!\n\nThe hello.go program.\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, World!\")\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: rand package error in Go\n\nQuestion:\nI try to call the ExpFloat64() function of the rand package (http://golang.org/pkg/rand/). However, it gives following error \"prog.go:4: imported and not used: rand prog.go:7: undefined: ExpFloat64\". Can anybody help me why is it giving error ? Code given below.\npackage main\n\nimport \"fmt\"\nimport \"rand\"\n\nfunc main() {\nfmt.Println(ExpFloat64())\n}", "output": "The error message explains it perfectly - in Go, you can't import packages and not use them. Here, it says you're importing rand and not using it, so either use it or don't import it. Your main function should be:\nfmt.Println(rand.ExpFloat64())"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: golang map prints out of order\n\nQuestion:\nWhy is the map printing out of order, and how do I get it in to order?\npackage main\n\nimport (\n    \"fmt\"\n)\n\ntype monthsType struct {\n    no   int\n    text string\n}\n\nvar months = map[int]string{\n    1:\"January\", 2:\"Fabruary\", 3:\"March\", 4:\"April\", 5:\"May\", 6:\"June\",\n    7:\"July\", 8:\"August\", 9:\"September\", 10:\"October\", 11:\"Novenber\", 12:\"December\",\n}\n\nfunc main(){\n    for no, month := range months {\n        fmt.Print(no)\n        fmt.Println(\"-\" + month)\n    }\n}\n\nPrints out:\n10-October\n7-July\n1-January\n9-September\n4-April\n5-May\n2-Fabruary\n12-December\n11-Novenber\n6-June\n8-August\n3-March", "output": "Code:\nfunc DemoSortMap() (int, error) {\n    fmt.Println(\"use an array to access items by number:\")\n    am := [2]string{\"jan\", \"feb\"}\n    for i, n := range am {\n        fmt.Printf(\"%2d: %s\\n\", i, n)\n    }\n    fmt.Println(\"maps are non-sorted:\")\n    mm := map[int]string{2: \"feb\", 1: \"jan\"}\n    for i, n := range mm {\n        fmt.Printf(\"%2d: %s\\n\", i, n)\n    }\n    fmt.Println(\"access items via sorted list of keys::\")\n    si := make([]int, 0, len(mm))\n    for i := range mm {\n        si = append(si, i)\n    }\n    sort.Ints(si)\n    for _, i := range si {\n        fmt.Printf(\"%2d: %s\\n\", i, mm[i])\n    }\n\n    return 0, nil\n}\n\n(most of it stolen from M. Summerfield's book)\noutput:\nuse an array to access items by number:\n 0: jan\n 1: feb\nmaps are non-sorted:\n 2: feb\n 1: jan\naccess items via sorted list of keys::\n 1: jan\n 2: feb"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Google App Engine high performance proxy workaround\n\nQuestion:\nI`ve started using GAE for its high performance. When I found out that it doesn't have all the features I needed (static ip for the app, custom ports), I figured I would need to find some proxy server with similarly high performance as a workaround. My app is still in early stages of development, so there is no problem in tailoring it for this solution.\nWhat notable cloud-based proxy servers can you recommend for use with Google App Engine to complement what can't be done in GAE?", "output": "You can try running nginx on EC2.  I looked for a while to see if a service like this existed, but I never found anything.\nDisclaimer: this is a link to my blog"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Issue with Installing Go in Windows\n\nQuestion:\nI download GO compiler for windows from http://code.google.com/p/gomingw/downloads/list. However, in Read Me file, it stated that for installation information, check http://golang.org/doc/install.html#install. But, in golang.org, there is only information about Linux installation, not for windows. Can anybody help me by specifying how to install it or giving a source where can I found the steps of installation. Thanks in advance.", "output": "Download the gowin386_release.r60.3_installer.exe file and run it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How would I implement one-to-many on App Engine in Go?\n\nQuestion:\nHow would I implement one-to-many on Google App Engine in the Go programming language?\nFor example, if I have the structs below, how would I store the association of many Votes to one Comment?  Would I use an array (slice) of keys to Votes in the Comment struct, or one key to the Comment from the Vote struct?\ntype Comment struct {\n    Author  string\n    Content string\n    Date    datastore.Time\n}\n\ntype Vote struct {\n    User string\n    Score int\n}", "output": "The only types that are allowed for fields in the current version of the Go AppEngine SDK are as follows:\n\nsigned integers (int, int8, int16, int32 and int64),\nbool,\nstring,\nfloat32 and float64,\nany type whose underlying type is one of the above predeclared types,\n*Key,\nappengine.BlobKey,\n[]byte (up to 1 megabyte in length),\nslices of any of the above (up to 100 elements in length).\n\nGiven that, there appear to be two ways to do this.  One is to maintain a slice of keys to point to the Votes of a given Comment.  However this is likely to run up against the 100 element limit for any reasonably popular comment.\nThe other approach is to store a \"pointer\" to the comment in each vote struct like this:\ntype Vote struct {\n    User string\n    Score int\n    CommentKey *datastore.Key\n}    \n\ntype Comment struct {\n    Author  string\n    Content string\n    Date    datastore.Time\n}\n\nThen when you go to query it you need to do it in two steps. First you get the Comment you're interested in (in this case just the first one that happens to be returned).  Second, you query for all the votes that \"point\" to that comment:\nq := datastore.NewQuery(\"Comment\").Limit(1)\ncomments := make([]Comment, 0, 1)\nvar err os.Error\nvar keys []*datastore.Key\nif keys, err = q.GetAll(c, &comments); err != nil {\n    // handle the error\n}\n\ncomment := comments[0]\nvq := datastore.NewQuery(\"Vote\").Filter(\"CommentKey=\", keys[0])\n\nvotes := make([]Vote, 0, 10)\nif _, err := vq.GetAll(c, &votes); err != nil {\n    // handle the error\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: \"all goroutines are asleep - deadlock! Exit status 2\" error in a printer-receiver program\n\nQuestion:\nI am trying to create a simple program to learn channels in Go.\nBut I´m running in to a deadlock error, which I can´t figure out\npackage main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc printer(c chan int) {\n    for i := 0; i < 10; i++ {\n        c <- i\n        time.Sleep(time.Second)\n    }\n}\n\nfunc reciever(c chan int) {\n    for {\n        recievedMsg := <-c\n        fmt.Println(recievedMsg)\n    }\n}\n\nfunc main() {\n    newChanel := make(chan int)\n    printer(newChanel)\n    reciever(newChanel)\n}\n\nMy initial thoughts was something about the Sleep function, but even if I don´t include this I still run into this error and exit message.\nCan anyone give some hints on how to solve this? \nThanks in advance", "output": "You need two execution threads because now there is no way for the reciever function to be called as you never leave the printer function. You need to execute one of them on a separate goroutine.\nYou should also close the channel and use the range operator in your loop, so that it ends when the channel is closed.\nSo I propose you this code :\nfunc printer(c chan int) {\n    for i := 0; i < 10; i++ {\n        c <- i\n        time.Sleep(time.Second)\n    }\n    close(c)\n}\n\nfunc reciever(c chan int) {\n    for recievedMsg := range c {\n        fmt.Println(recievedMsg)\n    }\n}\n\nfunc main() {\n    newChanel := make(chan int)\n    go printer(newChanel)\n    reciever(newChanel)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Find the path to the executable\n\nQuestion:\nI compile a program with Go for various platforms and run it by calling a relative path or just by its name (if it is in the PATH variable).\nIs it possible to find out where the executable is?\nSay, my program is called \"foo(.exe)\". I can run ./foo, foo (if it's in the PATH), ../../subdir/subdir/foo.\nI have tried to use os.Args[0] and I guess I should check if the program name contains something different besides \"foo\". If yes, use filepath.Abs, if no, use (I can't find the function name, there is a function that looks through the PATH to check where the program is).", "output": "Use package osext.\nIt's providing function Executable() that returns an absolute path to the current program executable.\nIt's portable between systems.\nOnline documentation\npackage main\n\nimport (\n    \"github.com/kardianos/osext\"\n    \"fmt\"\n)\n\nfunc main() {\n    filename, _ := osext.Executable()\n    fmt.Println(filename)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to serialize a complex interface with unexported fields?\n\nQuestion:\nI need to serialize some complex interface (template.Template). It has many unexported fields, and gob don't want to work with them. Any suggestions?\nP.S. Actualy, I trying to put a parsed template to memcache on App Engine.", "output": "The short answer is that there's usually a reason for unexported fields--template.Template, for instance, contains information which changes during parsing--so I'd advise against serializing them yourself with reflect. However, the GobEncoder and GobDecoder interfaces were recently added to gob; if you need to serialize a complex struct with unexported fields, encourage the author of the package to implement these interfaces. Even better, implement them yourself (shouldn't be hard for template.Template) and contribute your patch."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to convert from []byte to int in Go Programming\n\nQuestion:\nI need to create a client-server example over TCP. In the client side I read 2 numbers and I send them to the server. The problem I faced is that I can't convert from []byte to int, because the communication accept only data of type []byte.\nIs there any way to convert []byte to int or I can send int to the server?\nSome sample code will be really appreciated.\nThanks.", "output": "You can use encoding/binary's ByteOrder to do this for 16, 32, 64 bit types\nPlay\npackage main\n\nimport \"fmt\"\nimport \"encoding/binary\"\n\nfunc main() {\n    var mySlice = []byte{244, 244, 244, 244, 244, 244, 244, 244}\n    data := binary.BigEndian.Uint64(mySlice)\n    fmt.Println(data)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Rationale for Go's method syntax\n\nQuestion:\nOk, I have to admit, I don't really use Go very much at all, but I did just observe something that strikes me as odd for a language that strives for minimality and all that good stuff as Go does. I would be surprised if there isn't a legitimate rationale behind it, so that's what I'm looking for.\nSo when you have a method, you define it like this:\nfunc (s *SomeStruct) Foo(x int) { }\n\nbut why have an extra parameter list just for the \"receiver\", as I think it's called? Would it not be a simpler and more elegant design to just do\nfunc Foo(s *SomeStruct, x int) { }\n\nand then have s.Foo(5) just be translated to a call to a function Foo(s, 5)?", "output": "Methods are fundamentally special and different from regular functions.\n\nMethods must live in the same package as the receiver type.\nMethods are used to satisfy interfaces.\nReceiver parameters are the only parameters which may be overloaded.\nWhen anonymous struct fields have methods, those methods are \"inherited\".\n\nWith your proposal, the line between a function and a method becomes very blurry and it's difficult to figure out how to resolve the above issues.\nThat said, I think it would be really interesting to design a language with multimethods and interfaces. However, that language would not be Go."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to make stdcall from Go\n\nQuestion:\nI have a pointer to a COM interface and would like to take the function pointers from its virtual table and make method calls. To do this I need to make stdcall method calls. In Go how do I make a call with convention stdcall or make a call with convention stdcall in cgo?", "output": "See \"godoc syscall Proc\" for instructions on how to call stdcall functions on windows. Be warned that *Proc.Call does allocate / deallocate memory, so, if you care about efficiency, you should use correspondent syscall.Syscall/syscall.Syscall6/syscall.Syscall9/... function instead.\nAlex"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why doesn't my struct code work?\n\nQuestion:\npackage app\n\ntype ConfigSet struct {\n    installed bool\n}\n\nimport (\n    \"fmt\"\n    \"html/template\"\n    \"net/http\"\n)\n\nfunc init() {\n    config := ConfigSet{}\n\n    // -------------------------------------- //\n    //             CONFIGURATION              //\n    // -------------------------------------- //\n\n    // Change to \"true\" after configuration is done!\n    config.installed = false\n\n    // -------------------------------------- //\n    //           END CONFIGURATION            //\n    // -------------------------------------- //\n\n    http.HandleFunc(\"/\", index)\n    http.HandleFunc(\"/index.php\", index)\n}\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    if config.installed == false {\n        w.Header().Set(\"Location\", \"/install/\")\n        return\n    }\n}\n\nI can't seem to figure out why this doesn't work. The error I get is:\n2012/05/21 13:22:01 go-app-builder: Failed parsing input (1 error)\n2012/05/21 13:22:01 /root/TravianGAE/app/app.go:7:1: expected declaration, found 'import'\n\nI don't understand, am I supposed to declare anything there?", "output": "Put your import first, before the type."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Generating the SHA hash of a string using golang\n\nQuestion:\nCan someone show me a working example of how to generate a SHA hash of a string that I have, say myPassword := \"beautiful\", using Go?", "output": "An example :\nimport (\n    \"crypto/sha1\"\n    \"encoding/base64\"\n)\n\nfunc (ms *MapServer) storee(bv []byte) {\n    hasher := sha1.New()\n    hasher.Write(bv)\n    sha := base64.URLEncoding.EncodeToString(hasher.Sum(nil))\n        ...\n}\n\nIn this example I make a sha from a byte array. You can get the byte array using\nbv := []byte(myPassword) \n\nOf course you don't need to encode it in base64 if you don't have to : you may use the raw byte array returned by the Sum function.\nThere seems to be some little confusion in comments below. So let's clarify for next users the best practices on conversions to strings:\n\nyou never store a SHA as a string in a database, but as raw bytes\nwhen you want to display a SHA to a user, a common way is Hexadecimal\nwhen you want a string representation because it must fit in an URL or in a filename, the usual solution is Base64, which is more compact"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: More idiomatic way of adding channel result to queue on completion\n\nQuestion:\nSo, right now, I just pass a pointer to a Queue object (implementation doesn't really matter) and call queue.add(result) at the end of goroutines that should add things to the queue.\nI need that same sort of functionality—and of course doing a loop checking completion with the comma ok syntax is unacceptable in terms of performance versus the simple queue add function call.\nIs there a way to do this better, or not?", "output": "There are actually two parts to your question: how does one queue data in Go, and how does one use a channel without blocking.\nFor the first part, it sounds like what you need to do is instead of using the channel to add things to the queue, use the channel as a queue.  For example:\nvar (\n    ch = make(chan int) // You can add an int parameter to this make call to create a buffered channel\n\n    // Do not buffer these channels!\n    gFinished = make(chan bool)\n    processFinished = make(chan bool)\n)\nfunc f() {\n    go g()\n    for {\n        // send values over ch here...\n    }\n    <-gFinished\n    close(ch)\n}\nfunc g() {\n    // create more expensive objects...\n    gFinished <- true\n}\nfunc processObjects() {\n    for val := range ch {\n        // Process each val here\n    }\n    processFinished <- true\n}\nfunc main() {\n    go processObjects()\n    f()\n    <-processFinished\n}\n\nAs for how you can make this more asynchronous, you can (as cthom06 pointed out) pass a second integer to the make call in the second line which will make send operations asynchronous until the channel's buffer is full.\nEDIT: However (as cthom06 also pointed out), because you have two goroutines writing to the channel, one of them has to be responsible for closing the channel.  Also, my previous revision would exit before processObjects could complete.  The way I chose to synchronize the goroutines is by creating a couple more channels that pass around dummy values to ensure that the cleanup gets finished properly.  Those channels are specifically unbuffered so that the sends happen in lock-step."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Type conversion from (type *int) to type int\n\nQuestion:\nI want to convert a pointer *int to its real value int, in Go language.\nHow do you do it?", "output": "Just use the * operator. For example:\nvar i  int = 10  // `i` is an integer, with value 10\nvar p *int = &i  // `p` is a pointer to an integer, its value is a memory address\nvar n  int = *p  // `n` is again an integer, with value 10\n\nOnce you get the hang of what's happening, the above code can be written in a more idiomatic (and simpler)  way like this, assuming that we're inside a function:\ni := 10\np := &i\nn := *p"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How can I use Google Spreadsheet API from Go?\n\nQuestion:\nI need to be able to read and write data to a spreadsheet. I am programming in the Go Language in Google App Engine.", "output": "A lot of time has passed since this question was asked and answered. Interaction with Google Sheets from golang is much better now.\nCurrently the \"Google Apps Script Execution API\" offers the broadest access. Get started here: https://developers.google.com/apps-script/guides/rest/quickstart/go"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the fastest way to generate a long random string in Go?\n\nQuestion:\nLike [a-zA-Z0-9] string:\nna1dopW129T0anN28udaZ\nor hexadecimal string:\n8c6f78ac23b4a7b8c0182d\nBy long I mean 2K and more characters.", "output": "This does about 200MBps on my box.  There's obvious room for improvement.\ntype randomDataMaker struct {\n    src rand.Source\n}\n\nfunc (r *randomDataMaker) Read(p []byte) (n int, err error) {\n    for i := range p {\n        p[i] = byte(r.src.Int63() & 0xff)\n    }\n    return len(p), nil\n}\n\nYou'd just use io.CopyN to produce the string you want.  Obviously you could adjust the character set on the way in or whatever.\nThe nice thing about this model is that it's just an io.Reader so you can use it making anything.\nTest is below:\nfunc BenchmarkRandomDataMaker(b *testing.B) {\n    randomSrc := randomDataMaker{rand.NewSource(1028890720402726901)}\n    for i := 0; i < b.N; i++ {\n        b.SetBytes(int64(i))\n        _, err := io.CopyN(ioutil.Discard, &randomSrc, int64(i))\n        if err != nil {\n            b.Fatalf(\"Error copying at %v: %v\", i, err)\n        }\n    }\n}\n\nOn one core of my 2.2GHz i7:\nBenchmarkRandomDataMaker       50000        246512 ns/op     202.83 MB/s\n\nEDIT\nSince I wrote the benchmark, I figured I'd do the obvious improvement thing (call out to the random less frequently).  With 1/8 the calls to rand, it runs about 4x faster, though it's a big uglier:\nNew version:\nfunc (r *randomDataMaker) Read(p []byte) (n int, err error) {\n    todo := len(p)\n    offset := 0\n    for {\n        val := int64(r.src.Int63())\n        for i := 0; i < 8; i++ {\n            p[offset] = byte(val & 0xff)\n            todo--\n            if todo == 0 {\n                return len(p), nil\n            }\n            offset++\n            val >>= 8\n        }\n    }\n\n    panic(\"unreachable\")\n}\n\nNew benchmark:\nBenchmarkRandomDataMaker      200000        251148 ns/op     796.34 MB/s\n\nEDIT 2\nTook out the masking in the cast to byte since it was redundant.  Got a good deal faster:\nBenchmarkRandomDataMaker      200000        231843 ns/op     862.64 MB/s\n\n(this is so much easier than real work sigh)\nEDIT 3\nThis came up in irc today, so I released a library.  Also, my actual benchmark tool, while useful for relative speed, isn't sufficiently accurate in its reporting.\nI created randbo that you can reuse to produce random streams wherever you may need them."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to detect broken symlinks in Go?\n\nQuestion:\nI have tried opening the file with ff, _ := os.Open(\"Filename\") and then running ffi, _ := ff.Stat(). \nWhich is the closest thing I could find that provides any details, but that doesn't seem to be following the symlinks. \nWhat I'm really trying to do is extract the original file name (which is deleted) from the symlink.\nI'm on a Linux machine.", "output": "os.Readlink(filename) does it."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: cgo - How to convert go string to LPCWSTR\n\nQuestion:\nI would like to use some of windows api, but I have no idea how to start. Is there any tutorial for it? \nAnyway I have a simple code. Can you please help me to get this correct?\npackage mypackage\n/*\n#cgo LDFLAGS: -luser32\n#include <windows.h>\n*/\nimport \"C\"\nimport \"unsafe\"\n\nfunc MessageBox(m string) {\n      cm := C.CString(s)\n      defer C.free(unsafe.Pointer(cm))\n      C.MessageBoxA(C.HWND(nil), (*C.CHAR)(cm), C.LPCSTR(nil), 0) // It display a message.\n}\n\nEdit: I can deal with char* but still do not know what with wchar_t*.\nimport \"syscall\"\n\nfunc MessageBoxU(m string) {\n        C.MessageBoxW(C.HWND(nil), (*C.WCHAR)(unsafe.Pointer(syscall.StringToUTF16Ptr(m))), C.LPCWSTR(nil), 0)\n}\n\nPlease let me know if this is not go idiom.", "output": "The following are two projects which wrap the Windows API to Go:\n\ngithub.com/antonlahti/go-winapi\ngithub.com/AllenDang/w32\n\nA usage example:\n    func setWidgetText(hwnd HWND, text string) error {\n        if TRUE != go-winapi.SendMessage(hwnd, WM_SETTEXT, 0, uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(text)))) {\n            return newError(\"WM_SETTEXT failed\")\n        }\n        return nil\n    }"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go bug in ioutil.ReadFile()\n\nQuestion:\nI am running a program in Go which sends data continuously after reading a file /proc/stat.\nUsing ioutil.ReadFile(\"/proc/stat\")\nAfter running for about 14 hrs i got err: too many files open /proc/stat\nClick here for snippet of code.\nI doubt that defer f.Close is ignored by Go sometimes or it is skipping it.\n\nThe snippet of code (in case play.golang.org dies sooner than stackoverflow.com):\npackage main\n\nimport (\"fmt\";\"io/ioutil\")\n\nfunc main() {\n    for {\n        fmt.Println(\"Hello, playground\")\n        fData,err := ioutil.ReadFile(\"/proc/stat\")\n        if err != nil {\n            fmt.Println(\"Err is \",err)\n        }   \n        fmt.Println(\"FileData\",string(fData))\n    }\n}", "output": "The reason probably is that somewhere in your program:\n\nyou are forgetting to close files, or\nyou are leaning on the garbage collector to automatically close files on object finalization, but Go's conservative garbage collector fails to do so. In this case you should check your program's memory consumption (whether it is steadily increasing while the program is running).\n\nIn either case, try to check the contents of /proc/PID/fd to see whether the number of open files is increasing while the program is running."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Dynamically initialize array size in go\n\nQuestion:\nI try to write a small application in go that takes 'x' numbers of integers from standard input, calculates the mean and gives it back. I have only gotten so far:\nfunc main() {\nvar elems, mean int\nsum := 0\n\nfmt.Print(\"Number of elements? \")\n\nfmt.Scan(&elems)\n\nvar array = new([elems]int)\n\nfor i := 0; i < elems; i++ {\n    fmt.Printf(\"%d . Number? \", i+1)\n    fmt.Scan(&array[i])\n    sum += array[i];\n}............\n\nWhen trying to compile this I get the following error message:\n\ninvalid array bound elems\n\nWhat is wrong here?", "output": "You should use a slice instead of an array:\n//var array = new([elems]int) - no, arrays are not dynamic\nvar slice = make([]int,elems) // or slice := make([]int, elems)\n\nSee \"go slices usage and internals\". Also you may want to consider using range for your loop:\n// for i := 0; i < elems; i++ { - correct but less idiomatic\nfor i, v := range slice {"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Is it possible to use Python with Go\n\nQuestion:\nPossible Duplicate:\nMixing python with a faster language for optimization in GAE \n\nI wounder if you can use python with Go, I have just introduced myself to Go (by mistake lol, although that it exists long time ago) to Go, it feels like python, I like it, but I'm not planning to learn it because python satisfies me, I'm just wondering, is it possible to create an app on google app engine using python sdk and Go for some tasks?\nI already know that they have a totally different for go \nEDIT\nI think i have just asked a stupid question because I have just found out that you have to compile Go!\nanyway I'll keep the question for today maybe I'll have a good answer that I'm not expecting.", "output": "You can use different languages in the same app -- however, each one in a different version. They will have access to the same datastore and memcache, however CRON and (I think) tasks will only work for the active version (because they target the main version url using a relative path). You would have to \"talk\" between versions using HTTP. You can also have the main app in Python and a Go or Java backend, etc.\nGo is compiled, but the Go SDK do all the work for you, re-compiling the app each time you change your code. It is pretty neat and fun to try Go this way."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to limit google app engine instances to just one?\n\nQuestion:\nI'm using go language and it seems good practice to communicate between different threads/routines by channels and locks instead of datastore. However, it appears that it's not possible between two instances if there's more than one instance running. Is there a way to make it not open a second one, even if there's high traffic?", "output": "You should use Backends if you want fine to control the spawning and shutdown of instances."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: leveldb-go example, docs\n\nQuestion:\nLevelDB-Go is port of LevelDB in Go language.\nLevelDB-Go often referred as native alternative for Go apps.\nWebsite has no examples and no documentation.\nShould I learn it by reading source code?\nor there is another website with examples and docs?\nDoes library support concurrency?", "output": "I played around a little with leveldb\nHere is what I got so far. This should get you started.\npackage main\n\nimport (\n    \"code.google.com/p/leveldb-go/leveldb/db\"\n    \"code.google.com/p/leveldb-go/leveldb/table\"\n    \"fmt\"\n    \"runtime\"\n)\n\ntype kv struct {\n    K []byte\n    V []byte\n}\n\ntype kvs struct {\n    items map[int]kv\n}\n\nfunc (p *kv) PutKV(k []byte, v []byte) {\n    p.K = k\n    p.V = v\n}\n\nfunc (items *kvs) PutKVs() {\n    fmt.Println(items)\n}\n\nfunc (p *kv) GetKV() (key []byte, value []byte) {\n    key = p.K\n    value = p.V\n    return\n}\n\nfunc Check(e error) {\n    if e != nil {\n        _, file, line, _ := runtime.Caller(1)\n    }\n}\n\nfunc p(r []byte, e error) {\n    if e != nil {\n        return e\n    }\n    println(string(r))\n}\n\nconst (\n    DBFILE = \"/tmp/leveldb2.db\"\n)\n\nvar DBFS = db.DefaultFileSystem\n\nfunc main() {\n    Connection, e := DBFS.Create(DBFILE)\n    Check(e)\n    w := table.NewWriter(Connection, nil)\n    defer w.Close()\n\n    e = w.Set([]byte(\"1\"), []byte(\"red\"), nil)\n    Check(e)\n    e = w.Set([]byte(\"2\"), []byte(\"yellow\"), nil)\n    Check(e)\n    e = w.Set([]byte(\"3\"), []byte(\"blue\"), nil)\n    Check(e)\n    e = w.Close()\n    Check(e)\n    w = nil\n\n    count()\n\n    fmt.Println(\"Printing # KV\")\n    itemsKV := readByte()\n    fmt.Println(itemsKV[0])\n    fmt.Println(itemsKV[1])\n    fmt.Println(itemsKV[2])\n    println(\"Done Printing # KV\")\n\n    Connection, e = DBFS.Create(DBFILE)\n    Check(e)\n    w = table.NewWriter(Connection, nil)\n    defer w.Close()\n    e = w.Set([]byte(\"4\"), []byte(\"green\"), nil)\n    Check(e)\n    e = w.Set([]byte(\"5\"), []byte(\"white\"), nil)\n    Check(e)\n    e = w.Set([]byte(\"6\"), []byte(\"black\"), nil)\n    Check(e)\n    e = w.Close()\n    Check(e)\n}\n\nfunc count() {\n    Connection, e := DBFS.Open(DBFILE)\n    Check(e)\n    b := []byte(\"0\")\n    r := table.NewReader(Connection, nil)\n\n    println(\"\\n\\n###### Counting ###### \")\n\n    iter, n := r.Find(b, nil), 0\n    for iter.Next() {\n        n++\n        println(\"Count # \", n)\n    }\n\n    e = r.Close()\n    Check(e)\n    println(\"#####Total: \", n)\n}\n\nfunc read() map[int64]string {\n    Connection, e := DBFS.Open(DBFILE)\n    Check(e)\n    b := []byte(\"0\")\n    r := table.NewReader(Connection, nil)\n\n    items := map[int64]string{}\n    iter, _ := r.Find(b, nil), 0\n    for iter.Next() {\n        k := iter.Key()\n        v := iter.Value()\n        items[int64(k[0])] = string(v)\n    }\n\n    e = r.Close()\n    Check(e)\n    return items\n}\n\nfunc readByte() map[int]kv {\n    Connection, e := DBFS.Open(DBFILE)\n    Check(e)\n    c := 0\n    b := []byte(\"0\")\n    r := table.NewReader(Connection, nil)\n\n    //items := map[int64]kv{}\n    item := new(kv)\n    items := map[int]kv{}\n    iter, _ := r.Find(b, nil), 0\n    for iter.Next() {\n        k := iter.Key()\n        v := iter.Value()\n        item.PutKV(k, v)\n        items[c] = *item\n        c++\n    }\n\n    e = r.Close()\n    Check(e)\n    return items\n}\n\nfunc findOne(k []byte) []byte {\n    Connection, e := DBFS.Open(DBFILE)\n    Check(e)\n    b := []byte(\"0\")\n    r := table.NewReader(Connection, nil)\n\n    iter, _ := r.Find(b, nil), 0\n    k = iter.Key()\n    v := iter.Value()\n\n    e = r.Close()\n    Check(e)\n    return v\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Which types are mutable and immutable in the Google Go Language?\n\nQuestion:\nIn Google Go, I read that Strings are immutable, ok but are int's?\nWhat about other types? As a slightly older programmer I prefer mutability even though I know the benefits of immutability, I prefer to live dangerously.\nKnow what types are mutable or immutable would be very helpful.\n\nUpdate, what I am mostly concerned about is the practical issues depending upon the type being mutable or immutable. As in the typical example in Java, if you create a String in a loop and loop for 10,000 times, you will get 10,000 String's created which are then later garbage collected. This has actually been a serious issue in a project in a company I worked at.\nThe the question is, does Go's Immutability in some cases cause the same problem? \nIt affects how you should treat the var. (or I assume it does).\n\nUpdate again, I am also concerned about other practical concerns. Knowing that something is immutable means that I can write code which is parallel and updates to one reference of the object should not update the other references. However sometimes I wish to do dangerous things, I want mutability.\nThese are consequences of mutability vs immutability and affect how I can write the code.", "output": "Don't worry -- Go will let you shoot yourself in the foot if you really want to :-)\nGo is not like Erlang, which might be what you are getting at with the question.\nx := 1\nx = 2\n\nallocates one variable, x, with a value of 1, then reassigns it to 2 -- no additional memory is allocated here.  \nAs you note, strings are immutable, so doing a string manipulation can result in making copies.  If you find that you want to do in-place modifications to character data, you'll probably want to operate on variables of []byte via the bytes package.\nRuss Cox's post about this should answer most of your questions about basic data structures: http://research.swtch.com/2009/11/go-data-structures.html\nAs other commenters noted, you'll want to look at the value semantics of Go functions -- they might be a little surprising at first.\nIf you have the following function:\nfunc (t MyType) myFunc() {\n    // do something to set a field in t\n}\n\nand you call in your code\nmyVar.myFunc()\n\nyou might be surprised to see that this doesn't do what you want because the t that is seen in myFunc() is really a copy of myVar.  \nBut, the following will work:\nfunc (t *myType) myFunc() {\n    // do something to set a field in t\n}\n\nbecause the function has a copy of the pointer and can access the underlying structure via that pointer."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: capture spaced user input\n\nQuestion:\nI am trying to capture user input in Go with little luck. I can get non-spaced words to work:\nvar s string\nprintln(\"enter string:\")\nfmt.Scan(&s)\n\nHowever, the Go documentation says that scan will delimit at spaces and new lines. So I think I have to set up bufio.Reader's ReadLine. Here is my attempt, which will not compile:\npackage main\n\nimport (\n    \"bufio\"\n    \"os\"\n    \"fmt\"\n)\n\nconst delim = '\\n'\nconst file = \"file\"\n\nfunc main() {\n\n    r := bufio.NewReader() *Reader\n\n    println(\"enter string:\")\n    line, err := r.ReadString(delim)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    fmt.Println(line)\n\n}\n\nerrors:\n1.go:14: not enough arguments in call to bufio.NewReader\n1.go:14: undefined: Reader\n\nSo, how do I define \"Reader\"? And if it was defined, would this be the correct way to capture the input as a string, delimited at \"\\n\", and not at the space? Or should I be doing something completely different?\nThanks in advance.", "output": "Change\nr := bufio.NewReader() *Reader\n\nto read\nr := bufio.NewReader(os.Stdin)\n\nto fix the problem.\nThe original encantation is incorrect because you seem to just copied and pasted the method's signature from the spec, but the spec defines the signature, not an example of a call, so *Reader in there is the method's return type (the type your variable r will have).  And the method's sole argument is defined to be rd io.Reader; that interface is conveniently implemented by the os.Stdin symbol which seems like a perfect match for your task.\nP.S.\nConsider reading all the docs in the \"Learning Go\" documentation section, especially \"Effective Go\"."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Search support for Google App Engine Go runtime\n\nQuestion:\nThere is search support (experimental) for python and Java, and eventually Go also may supported. Till then, how can I do minimal search on my records?\nThrough the mailing list, I got an idea about proxying the search request to a python backend. I am still evaluating GAE, and not used backends yet. To setup the search with a python backed, do I have to send all the request (from Go) to data store through this backend? How practical is it, and disadvantages? Any tutorial on this.\nthanks.", "output": "There is full text search coming for the Go runtime very very very soon."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Golang Regular Expressions - what am I doing incorrectly?\n\nQuestion:\nAs a personal project, trying to learn Go(lang) by applying it to something, I am writing an EMCAScript/JavaScript \"compiler\"; all it will (initially) do is allow you to include other .js files.\nFunctionality aside, I am pulling my hair out trying to figure out the regexp package. Here is the snippet that does not seem to be doing what I want it to:\n// Note: \"lines\" is an array of strings.\n\nvar includeRegex, _ = regexp.Compile(\"^[ \\t]*include[(]{1}\\\"([^\\\"]+)\\\"[)]{1};\")\nfor _, line := range lines {\n   var isInclude = includeRegex.Match([]byte(line))\n   if isInclude {\n      var includeFile = includeRegex.FindString(line)\n      fmt.Println(\"INCLUDE\", includeFile)\n   } else {\n      // ...\n   }\n\nI have already stumbled across Go's subset of regular expressions, hence why the regex does not read as ^\\s*include\\(\"([^\"]+)\"\\);. I have already tested both the preferred, and the Go-style regex, in RegexPal, and both definitely work.  The match just never seems to occurr; what am I doing wrong?\nFor what it's worth, the include() statement I am trying to parse looks like so:\ninclude(\"somefile.js\");\n\nEDIT: For what it's worth, I am keeping the code here.", "output": "This seems to work with the latest weekly\npackage main\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"regexp\"\n        \"strings\"\n)\n\nfunc main() {\n        includeRegex, err := regexp.Compile(`^\\s*include\\(\"(\\\\\\\"|[^\"])+\"\\);`)\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        for _, line := range strings.Split(`\nfoo\ninclude \"abc.def\"\ninclude(\"file.js\");\n            include \"me\\\"to\\\"\"\n            include(\"please\\\"!\\\"\");\n        nothing here          \n`, \"\\n\") {\n                if includeRegex.Match([]byte(line)) {\n                        includeFile := includeRegex.FindString(line)\n                        fmt.Println(\"INCLUDE\", includeFile)\n                } else {\n                        fmt.Printf(\"no match for \\\"%s\\\"\\n\", line)\n                }\n        }\n}\n\nOutput:\n$ go build && ./tmp \nno match for \"\"\nno match for \"foo\"\nno match for \"include \"abc.def\"\"\nINCLUDE include(\"file.js\");\nno match for \"        include \"me\\\"to\\\"\"\"\nINCLUDE       include(\"please\\\"!\\\"\");\nno match for \"  nothing here      \"\nno match for \"\"\n$"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Android App from Go programming language\n\nQuestion:\nI am hearing buzzes about Go programming language from google. Wikipedia describes it like this: \"Go aims to provide the efficiency of a statically-typed compiled language with the ease of programming of a dynamic language\". I was thinking that since it is a language from the maker of android, they should have some support for creating android Apps. Is there any tool to create android App from Go? Is Go worthy language to learn with an assumption that \"SOMEDAY\" android might be based on GO.", "output": "There's currently no way to build Android apps with Go, and some hypothetical future version of Android isn't a good reason to invest time in Go today.\nThat said, Go is a great language, you can do a lot with it like write webservers, command line apps, and even AppEngine apps.  So there's lots of good reasons to learn Go!  But Android isn't one of them.\nEdit:\nAs of Go 1.5 it is possible to write Android apps completely in Go or as a Java app calling a Go JNI library. iOS is also expected to arrive in time for the final 1.5 release. Go to https://github.com/golang/mobile for more details."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: How to check whether a file or directory exists?\n\nQuestion:\nI want to check the existence of file ./conf/app.ini in my Go code, \nbut I can't find a good way to do that.  \nI know there is a method of File in Java: public boolean exists(), which returns true if the file or directory exists.\nBut how can this be done in Go?", "output": "// exists returns whether the given file or directory exists\nfunc exists(path string) (bool, error) {\n    _, err := os.Stat(path)\n    if err == nil { return true, nil }\n    if os.IsNotExist(err) { return false, nil }\n    return false, err\n}\n\nEdited to add error handling."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Does LiteIDE x14 work at all?\n\nQuestion:\nI'm trying out LiteIDE for golang and there are no docs to speak of and apparently no forum.  I've set the Env for my environment and go installation.  When I try to use it on the hello.go file (as a file or a a project) all I get is\n<action id=\"Run\" cmd=\"${TARGETPATH}\" args=\"${TARGETARGS}\">\n<start=\" \" workdir=\"C:/liteide.projects\"/>\n \n\n<error msg=\"process failed to start\" />\n\n</action>\n\n(Sorry for the formatting but the Code Sample tags in this forum can't handle XML blocks.)\nLots of other people have seen the same thing.\nWhat are the TARGETPATH and TARGETARGS that is shown?\nIs there any documentation on how to configure LiteIDE?", "output": "LiteIDE apparently does not work.  I filed this bug report and their advice was to try a recent beta of the next release.  That didn't work either, however."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: 6g: No such file or directory - Building Go packages with `gomake` on Snow Leopard\n\nQuestion:\nI have two .go files, numbers.go and numbers_test.go and I want to build and execute the tests as per the creating a new package tutorial (scroll down for details on the files.)  All files are in the same directory.\nWhen I navigate to that directory in Terminal and type gomake I get this:\n6g  -o _go_.6 numbers.go\nmake: 6g: No such file or directory\nmake: *** [_go_.6] Error 1\n\nThis error is saying that it cannot find numbers.go.  If I manually execute this line (without moving directory):\n6g  -o _go_.6 numbers.go\n\nit successfully creates the _go_.6 file.  So why can't gomake find the file?\nHere are the files I am using:\nnumbers.go looks like this:\npackage numbers\n\nfunc Double(i int) int {\n  return i * 2\n}\n\nnumbers_test.go looks like this:\npackage numbers\n\nimport (\n    \"testing\"\n)\n\ntype doubleTest struct {\n    in, out int\n}\n\nvar doubleTests = []doubleTest{\n    doubleTest{1, 2},\n    doubleTest{2, 4},\n    doubleTest{-5, -10},\n}\n\nfunc TestDouble(t *testing.T) {\n    for _, dt := range doubleTests {\n        v := Double(dt.in)\n        if v != dt.out {\n            t.Errorf(\"Double(%d) = %d, want %d.\", dt.in, v, dt.out)\n        }\n    }\n}\n\nand finally, my Makefile looks like this:\ninclude $(GOROOT)/src/Make.inc\n\nTARG=numbers\nGOFILES=\\\n    numbers.go\n\ninclude $(GOROOT)/src/Make.pkg", "output": "The error doesn't say that it can't find numbers.go - it's saying that it can't find 6g. In your Makefile, try putting the path to 6g in your PATH, as well as any other Go-specific environment variables."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Image manipulation in Golang\n\nQuestion:\nI have the following:\n\nBackground image (bi)\nImage1 (i1)\nImage3 (i2)\n\nI want to position i1 and i2 over bi with some angle and then produce a final image. I have x and y axis value for i1 and i2 and their expected rotation angle. i1 and i2 may partially overlay on each other. but I have z index for i1 and i2 to know, if in case they overlap then who will be in foreground.\nI am trying to achieve this in Golang.\nhttp://golang.org/doc/articles/image_draw.html seems to do this. Anyone knows any similar example of code, that may help. Or can you show me couple of lines in Golang as a pseudo program?\nThanks.", "output": "Not sure exactly what you are looking for and I haven't worked with the image package much at all ... but just following the sample code and using graphics-go package (it works for me), I was able to do something at least.\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"image/draw\"\n    \"image\"\n    \"image/jpeg\"\n    \"code.google.com/p/graphics-go/graphics\"\n)\n\nfunc main() {\n    fImg1, _ := os.Open(\"arrow1.jpg\")\n    defer fImg1.Close()\n    img1, _, _ := image.Decode(fImg1)\n\n    fImg2, _ := os.Open(\"arrow2.jpg\")\n    defer fImg2.Close()\n    img2, _, _ := image.Decode(fImg2)\n\n    m := image.NewRGBA(image.Rect(0, 0, 800, 600))\n    draw.Draw(m, m.Bounds(), img1, image.Point{0,0}, draw.Src)\n    //draw.Draw(m, m.Bounds(), img2, image.Point{-200,-200}, draw.Src)\n    graphics.Rotate(m, img2, &graphics.RotateOptions{3.5})\n\n    toimg, _ := os.Create(\"new.jpg\")\n    defer toimg.Close()\n\n    jpeg.Encode(toimg, m, &jpeg.Options{jpeg.DefaultQuality})\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: exec.Run and argv problem\n\nQuestion:\nI want to create an array of exec.Cmd and pipe them together to make an squid authenticator. It works when the commands in file have no arguments. With arguments, it only reads EOF. I've checked the argv array and its content is ok. \nThe relevant portion of the code is:\nfunc initCmd(file *os.File) []* exec.Cmd {\n    var cmd     [MAX_PROC]* exec.Cmd;\n    var e       os.Error\n\n    // Initialize the commands in the config file\n    environ := os.Environ();\n    var i int\n    for i=0; i < MAX_PROC; i++ {\n        line := getLine(file)\n        if line == \"\" { break }\n        parts := strings.Fields(line)\n        cmd[i], e = exec.Run(parts[0], parts[1:], environ, \n                             exec.Pipe, exec.Pipe, exec.Pipe)\n        exitOnError(&e)\n    }\n    return cmd[0:i]\n}\n\nAny ideas?\nThanks.\nPS: If it helps, the complete program source is at github.", "output": "The args need to include arg0 also. Try exec.Run(parts[0], parts)\nI opened an issue about how this is confusing, but they claim it's working as intended:\nhttp://code.google.com/p/go/issues/detail?id=428"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Issues retrieving MongoDB documents with Go\n\nQuestion:\nI have the following code, and I'm not sure why it is not returning a slice of Notes. I am using the mgo library from labix.org to connect to MongoDB and following their online documentation.\ntype Note struct {\n    Url string\n    Title string\n    Date string\n    Body string\n}\n\nfunc loadNotes() ([]Note) {\n    session, err := mgo.Dial(\"localhost\")\n    if err != nil {\n            panic(err)\n    }\n    defer session.Close()\n\n    // Optional. Switch the session to a monotonic behavior.\n    session.SetMode(mgo.Monotonic, true)\n\n    c := session.DB(\"test\").C(\"notes\")\n\n    notes := []Note{}\n    iter := c.Find(nil).Limit(100).Iter()\n    err = iter.All(&notes)\n    if err != nil {\n        panic(iter.Err())\n    }\n\n    return notes\n}\n\nfunc main() {\n    notes := loadNotes()\n    for note := range notes {\n        fmt.Println(note.Title)\n    }\n}  \n\nIf I just print out notes I get what looks like a slice of two structs, but I can't access them by means of notes.Title or anything like that.\n[{ Some example title 20 September 2012 Some example content}]\n\nThis is what my documents look like:\n> db.notes.find()\n{ \"_id\" : \"some-example-title\", \"title\" : \"Some example title\", \"date\" : \"20 September 2012\", \"body\" : \"Some example content\" }\n\nThe real issue is that it's returning the notes as one big slice rather than a Note{} (I think?)\nIf I'm doing something obviously wrong, any insight would help.", "output": "your problem is here:\nfor note := range notes {\n    fmt.Println(note.Title)\n}\n\nit should read:\nfor _, note := range notes {\n    fmt.Println(note.Title)\n}\n\nusing a range statement on a slice returns pairs of the form i, v, where i is the index in the slice, and v is the item at the index in that slice.  Since you omitted the second value, you're looping on indexes, not on Note values.\nIt's in the RangeClause section of the spec: http://golang.org/ref/spec#RangeClause"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: In Regexp.FindAllStringSubmatch(), what does the second parameter do?\n\nQuestion:\nIn this method:\nfunc (re *Regexp) FindAllStringSubmatch(s string, n int) [][]string\n\nWhat does the second parameter do?\nI have tried:\nre, _ := regexp.Compile(\"a\")\nrs := re.FindAllString(\"aaaaa, \", **1**) // 1 get one 'a', 2 get two 'a's, 3 get three 'a's ...\nfor _,v := range rs {\n    fmt.Println(v)\n\n}\n\nIt seems that the second parameter is about how many times it matches. Am I right?\nCould anybody give me an answer for sure? Official doc or some links is prefer.", "output": "Citation from the overview section of http://golang.org/pkg/regexp/:\n\nIf 'All' is present, the routine matches successive non-overlapping matches of the entire expression. Empty matches abutting a preceding match are ignored. The return value is a slice containing the successive return values of the corresponding non-'All' routine. These routines take an extra integer argument, n; if n >= 0, the function returns at most n matches/submatches."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Copying all elements of a map into another\n\nQuestion:\nGiven\nvar dst, src map[K]V\n\nI can copy all entries from src into dst by doing\nfor k, v := range src {\n    dst[k] = v\n}\n\nIs there a more idiomatic way to do this?\ncopy only works on slices (and string as a source).", "output": "That looks like a perfectly fine way to do this to me. I don't think copying one map into another is common enough to have a one-liner solution."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: notwithstanding keyword\n\nQuestion:\nWhat does the notwithstanding keyword mean in Google Go?", "output": "2017 Update: There was a major parser update and the new one no longer seems to support these Easter egg words.\n\nLooks like an easter egg in the lexer to me:\nhttps://github.com/golang/go/blob/08e25fc1ba397e02ec776561ed73b7f9a8b94392/src/cmd/compile/internal/gc/lex.go#L2152-L2156\nthe relevant section is the symbol table:\n\"notwithstanding\",      LIGNORE,    Txxx,       OXXX,\n\"thetruthofthematter\",  LIGNORE,    Txxx,       OXXX,\n\"despiteallobjections\", LIGNORE,    Txxx,       OXXX,\n\"whereas\",              LIGNORE,    Txxx,       OXXX,\n\"insofaras\",            LIGNORE,    Txxx,       OXXX,\n\nI guess they could be used to test handling of the lexical type LIGNORE, but there doesn't seem to be any \"real\" ignored tokens."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Trouble reading from a socket in go\n\nQuestion:\nI'm trying to learn the go language, and I'm writing a simple echo server. I'm having difficulty making it work, though.\nfunc listen(server string) {\n    var buf []byte\n\n    listener, ok := net.Listen(\"tcp\", server)\n    if ok != nil {\n        fmt.Fprintf(os.Stderr, \"Could not listen on socket: %s\\n\", ok.String())\n        return\n    }\n    conn, ok := listener.Accept()\n    if ok != nil {\n        fmt.Fprintf(os.Stderr, \"Could not accept connection on socket: %s\\n\", ok.String())\n        return\n    }\n\n    writelen, ok := conn.Write(strings.Bytes(\"Ready to receive\\n\"))\n    if ok != nil {\n        fmt.Fprintf(os.Stderr, \"Could not write to socket: %s\\n\", ok.String())\n    } else {\n        fmt.Printf(\"Wrote %d bytes to socket\\n\", writelen)\n    }\n\n    for ;; {\n        readlen, ok := conn.Read(buf)\n        if ok != nil {\n            fmt.Fprintf(os.Stderr, \"Error when reading from socket: %s\\n\", ok.String())\n            return\n        }\n        if readlen == 0 {\n            fmt.Printf(\"Connection closed by remote host\\n\")\n            return\n        }\n\n        fmt.Printf(\"Client at %s says '%s'\\n\", conn.RemoteAddr().String(), buf)\n    }\n}\n\nI get the following output from this function:\n[nathan@ebisu ~/src/go/echo_server] ./6.out 1234\nUsing port 1234\nWrote 17 bytes to socket\nError when reading from socket: EOF\n\nThis is what I see on the client:\n[nathan@ebisu ~] telnet 127.0.0.1 1234\nTrying 127.0.0.1...\nConnected to 127.0.0.1.\nEscape character is '^]'.\nReady to receive\nConnection closed by foreign host.\n\nAny help would be appreciated (or pointers to resources; the go documentation on the sockets API leaves a little to be desired).\nThanks,\nNathan", "output": "In your example, buf needs to have a definite size. You've declared it as a 0-length slice. \nDeclare it as:\nvar buf = make([]byte, 1024)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: GAE Go size of datastore\n\nQuestion:\nIs there some function one can call to get the amount of entries in the GAE Go Datastore of an app, without querying it for the whole database and counting the output?", "output": "c := appengine.NewContext(r)\n    var result struct {\n        Bytes int64 `datastore:\"bytes\"`\n        Count int64 `datastore:\"count\"`\n        Timestamp datastore.Time `datastore:\"timestamp\"`\n    }\n    datastore.NewQuery(\"__Stat_Total__\").Run(c).Next(&result)\n    c.Infof(\"count: %d\", result.Count)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Format a Go string without printing?\n\nQuestion:\nIs there a simple way to format a string in Go without printing the string?\nI can do:\nbar := \"bar\"\nfmt.Printf(\"foo: %s\", bar)\n\nBut I want the formatted string returned rather than printed so I can manipulate it further.\nI could also do something like:\ns := \"foo: \" + bar\n\nBut this becomes difficult to read when the format string is complex, and cumbersome when one or many of the parts aren't strings and have to be converted first, like\ni := 25\ns := \"foo: \" + strconv.Itoa(i)\n\nIs there a simpler way to do this?", "output": "Sprintf is what you are looking for.\nExample\nfmt.Sprintf(\"foo: %s\", bar)\n\nYou can also see it in use in the Errors example as part of \"A Tour of Go.\"\nreturn fmt.Sprintf(\"at %v, %s\", e.When, e.What)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Go - password security in binary\n\nQuestion:\nI intend to save a password/secret key in my Go application to be used in communication with some other applications. I wonder how to secure it from for example someone obtaining the binary and searching for it in some hex viewer. Are such security practices common, or am I worrying too much?", "output": "Obfuscate the data and/or code. This means to store the password in a form that is reasonably difficult to search for, and if its location is found the password is reasonably difficult to decipher.\nIn case no obfuscation method is secure enough (you want full security), the only solution is not to put the password into the executable in any form."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: For a struct vertex, what's the difference between map[int]vertex and map[int]*vertex?\n\nQuestion:\nTo define a map from int to struct vertex, should I define map[int]vertex or map[int]*vertex? Which one is preferred?\nI extended Chickencha's code:\npackage main\n\ntype vertex struct {\n    x, y int \n}\n\nfunc main() {\n    a := make(map[int]vertex)\n    b := make(map[int]*vertex)\n\n    v := &vertex{0, 0}\n    a[0] = *v\n    b[0] = v \n\n    v.x, v.y = 4, 4\n    println(a[0].x, a[0].y, b[0].x, b[0].y)\n\n    //a[0].x = 3 // cannot assign to (a[0]).x\n    //a[0].y = 3 // cannot assign to (a[0]).y\n    b[0].x = 3 \n    b[0].y = 3 \n    println(a[0].x, a[0].y, b[0].x, b[0].y)\n\n    u1 := a[0]\n    u1.x = 2 \n    u1.y = 2 \n    u2 := b[0]\n    u2.x = 2 \n    u2.y = 2 \n    println(a[0].x, a[0].y, b[0].x, b[0].y)\n}\n\nThe output:\n0 0 4 4\n0 0 3 3\n0 0 2 2\n\nFrom the output, my understanding is, if I want to change the struct member in place, I must use pointer to the struct.\nBut I'm still not sure the underlying reasons. Especially, why I cannot assign to a[0].x?", "output": "The main difference is that map[int]vertex stores vertex values and map[int]*vertex stores vertex references (pointers). The output of the following program should help illustrate:\npackage main\n\ntype vertex struct {\n    x, y int\n}\n\nfunc main() {\n    a := make(map[int]vertex)\n    b := make(map[int]*vertex)\n\n    v := &vertex{0, 0}\n    a[0] = *v\n    b[0] = v\n\n    v.x, v.y = 4, 4\n    println(a[0].x, a[0].y, b[0].x, b[0].y)\n}\n\nOutput:\n0 0 4 4\n\nThe vertex stored in b is modified by the v.x, v.y = 4, 4 line, while the vertex stored in a is not."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Re-slicing slices in Golang\n\nQuestion:\nI recently picked up the Go language, and now I am confused with the following code:\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n    a := make([]int, 5)\n    printSlice(\"a\", a)\n    b := make([]int, 0, 5)\n    printSlice(\"b\", b)\n    c := b[:2]\n    printSlice(\"c\", c)\n    d := c[2:5]\n    printSlice(\"d\", d)\n}\n\nfunc printSlice(s string, x []int) {\n    fmt.Printf(\"%s len=%d cap=%d %v\\n\",\n        s, len(x), cap(x), x)\n}\n\nAnd the result:\na len=5 cap=5 [0 0 0 0 0]\nb len=0 cap=5 []\nc len=2 cap=5 [0 0] //why the capacity of c not 2 but 5 instead\nd len=3 cap=3 [0 0 0]", "output": "c is a slice taken from the array b. This isn't a copy, but just a window over the 2 first elements of b.\nAs b has a capacity of 5, c could be extended to take the 3 other places (in fact it makes a new slice but over the same place in memory).\nThe maximal capacity of the slice is the capacity of the underlying array minus the position of the start of the slice in the array :\n array : [0 0 0 0 0 0 0 0 0 0 0 0]\n array :  <----   capacity   --->\n slice :     [0 0 0 0]\n slice :      <---- capacity ---> \n\nMaybe this program will make it more clear that c and d are just windows over b :\nfunc main() {\n    b := make([]int, 0, 5)\n    c := b[:2]\n    d := c[1:5] // this is equivalent to d := b[1:5]\n    d[0] = 1\n    printSlice(\"c\", c)\n    printSlice(\"d\", d)\n}\n\nOutput : \nc len=2 cap=5 [0 1] // modifying d has modified c\nd len=4 cap=4 [1 0 0 0]"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Error Handling in Go\n\nQuestion:\nI have a go code like this,\nmain()\n{\n    do something\n    do something\n    .\n    .\n    .\n    do something\n}\n\nNow, I don't know which \"do something\" is throwing an error. Is it possible in Go to catch the error and print it? How?", "output": "Go language did not include exception handling mechanism. However, it has panic/recover mechanism which gives a little bit of exception handling."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Concurrent routines in Google's Go Language\n\nQuestion:\nIs it possible in go:\nSuppose, I have 3 concurrent routines which can send integers to each other. Now, suppose both concurrent routine 2 & 3 sends an integer to concurrent routine 1. Is it possible in go that routine 1 takes both two values and process it farther ? To make it clear, I have following code:\npackage main\nimport \"rand\"\n\nfunc Routine1(command12 chan int, response12 chan int, command13 chan int, response13 chan int ) {\nfor i := 0; i < 10; i++ {\n    i := rand.Intn(100)\nif i%2 == 0 {\ncommand12 <- i \n}\n\nif i%2 != 0 {\ncommand13 <- i \n}\n\nprint(<-response13, \" 1st\\n\");\n}\nclose(command12)\n}\n\nfunc Routine2(command12 chan int, response12 chan int, command23 chan int, response23 chan int) {\nfor i := 0; ; i++ {\n    x, open := <-command12\n    if !open {\n        return;\n    }\n     print(x , \" 2nd\\n\");\n    y := rand.Intn(100)\n    if i%2 == 0 {\ncommand12 <- y \n}\n\nif i%2 != 0 {\ncommand23 <- y \n}\n}\n}\n\nfunc Routine3(command13 chan int, response13 chan int, command23 chan int, response23 chan int) {\nfor i := 0; ; i++ {\n    x, open := <-command13\n    if !open {\n        return;\n    }\n     print(x , \" 3nd\\n\");\n    y := rand.Intn(100)\n    response23 <- y\n}\n}\n\nfunc main() {\n   command12 := make(chan int)\n   response12 := make(chan int)\n   command13 := make(chan int)\n   response13 := make(chan int)\n   command23 := make(chan int)\n   response23 := make(chan int)\n\n   go Routine1(command12, response12,command13, response13 )\n   Routine2(command12, response12,command23, response23)\n   Routine3(command13, response13,command23, response23 )\n}\n\nHere, in this example routine 1 can send an int to routine 2 or 3. I assume it is routine 3. Now suppose, routine 3 also send an int to routine 2. Is it possible for routine 2 to take those two values and process further (dynamic concurrent routines)? Can any body help to modify this program accordingly.", "output": "I hate abstract examples, anyway I will do my best to answer your question.\n\nIs it possible in go that routine 1 takes both two values and process it farther?\n\nWhat do you want to archive? Inside routine1 you can either do:\n// Read exactly one command from routine2 as well as exactly\n// one command from routine3\ncmd1 := <-command12\ncmd2 := <-command13\n// Process the pair of the two commands here\n\nOR\n// Process a single command only, which was either sent by routine2\n// or by routine3. If there are commands available on both channels\n// (command12 and command13) the select statement chooses a branch\n// fairly.\nselect {\n    case cmd1 := <-command12:\n        // process command from routine 2\n    case cmd2 := <-command13\n        // process command from routine 3\n}\n\nI hope that will answer your question. Also note that Go channels support multiple-writers (as well as mutliple readers) by default. So, it might be enough to use exactly one input channel per goroutine. For example, routine1 might only read commands from a channel called command1, but both routine2 and routine3 might use the same command1 channel to send messages to routine1.\nAnother common idiom in Go is to pass a reply channel as part of the message. For example:\ntype Command struct {\n    Cmd string\n    Reply chan-> int\n}\n\nfunc routine2() {\n    reply := make(chan int)\n    command1 <- Command{\"doSomething\", reply}\n    status := <-reply\n}\n\nfunc routine1() {\n    cmd <- command1;\n    // process cmd.Cmd\n    cmd.Reply <- 200 // SUCCESS (status code)\n}\n\nDepending on your actual problem, this might simplify your program drastically :)"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why does the function return early?\n\nQuestion:\nI've just started learning go, and have been working through the tour. The last exercise is to edit a web crawler to crawl in parallel and without repeats.\nHere is the link to the exercise: http://tour.golang.org/#70\nHere is the code. I only changed the crawl and the main function. So I'll just post those to keep it neat.\n    // Crawl uses fetcher to recursively crawl\n    // pages starting with url, to a maximum of depth.\n    var used = make(map[string]bool)\n    var urlchan = make(chan string)\n    func Crawl(url string, depth int, fetcher Fetcher) {\n        // TODO: Fetch URLs in parallel.\n        // Done: Don't fetch the same URL twice.\n        // This implementation doesn't do either:\n        done := make(chan bool)\n        if depth <= 0 {\n            return\n        }\n        body, urls, err := fetcher.Fetch(url)\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        fmt.Printf(\"\\nfound: %s %q\\n\\n\", url, body)\n        go func() {\n            for _, i := range urls {\n                urlchan <- i\n            }\n            done <- true\n        }()\n        for u := range urlchan {\n            if used[u] == false {\n                used[u] = true\n                go Crawl(u, depth-1, fetcher)\n            }\n            if <-done == true {\n                break\n            }\n        }\n        return\n    }\n\n    func main() {\n        used[\"http://golang.org/\"] = true\n        Crawl(\"http://golang.org/\", 4, fetcher)\n    }\n\nThe problem is that when I run the program the crawler stops after printing\n    not found: http://golang.org/cmd/\n\nThis only happens when I try to make the program run in parallel. If I have it run linearly then all the urls are found correctly.\nNote: If I am not doing this right (parallelism I mean) then I apologise.", "output": "Be careful with goroutine. \nBecause when the main routine, or main() func, returns, all others go routine would be killed immediately. \nYour Crawl() seems like recursive, however it is not, which means it would return immediately, not awaiting for other Crawl() routines. And you know that if the first Crawl(), called by main(), returns, the main() func regards its mission fulfilled. \nWhat you could do is to let main() func wait until the last Crawl() returns. The sync package, or a chan would help.\nYou could probably take a look at the last solution of this, which I did months ago:\nvar store map[string]bool\n\nfunc Krawl(url string, fetcher Fetcher, Urls chan []string) {\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n    } else {\n        fmt.Printf(\"found: %s %q\\n\", url, body)\n    }\n    Urls <- urls\n}\n\nfunc Crawl(url string, depth int, fetcher Fetcher) {\n    Urls := make(chan []string)\n    go Krawl(url, fetcher, Urls)\n    band := 1\n    store[url] = true // init for level 0 done\n    for i := 0; i < depth; i++ {\n        for band > 0 {\n            band--\n            next := <- Urls\n            for _, url := range next {\n                if _, done := store[url] ; !done {\n                    store[url] = true\n                    band++\n                    go Krawl(url, fetcher, Urls)\n                }\n            }\n        }\n    }\n    return\n}\n\nfunc main() {\n    store = make(map[string]bool)\n    Crawl(\"http://golang.org/\", 4, fetcher)\n}"}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Golang Determining whether *File points to file or directory\n\nQuestion:\nIs there a way to determine whether my *File is pointing to a file or a directory?\nfileOrDir, err := os.Open(name)\n// How do I know whether I have a file or directory?\n\nI want to be able to read stats about the file if it is just a file, and be able to read the files within the directory if it is a directory\nfileOrDir.Readdirnames(0) // If dir\nos.Stat(name) // If file", "output": "For example,\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    name := \"FileOrDir\"\n    fi, err := os.Stat(name)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    switch mode := fi.Mode(); {\n    case mode.IsDir():\n        // do directory stuff\n        fmt.Println(\"directory\")\n    case mode.IsRegular():\n        // do file stuff\n        fmt.Println(\"file\")\n    }\n}\n\nNote:\nThe example is for Go 1.1. For Go 1.0, replace case mode.IsRegular(): with case mode&os.ModeType == 0:."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: Why does filepath.Walk() panic?\n\nQuestion:\nI am trying to code up the wiki for go programing language.\nI have put the data in /data folder and .html files in the /tmpl folder.\nI have coded up the main function as follows\nfunc main() {\n    walk := func(path string, info os.FileInfo, err error) error {\n        if err == nil && !info.IsDir() && filepath.Ext(path) == \".html\" {\n            http.HandleFunc(\"/view/\", makeHandler(viewHandler))\n            http.HandleFunc(\"/edit/\", makeHandler(editHandler))\n            http.HandleFunc(\"/save/\", makeHandler(saveHandler))\n        }\n        return err\n    }\n    root := TEMPLATE_PATH + \"edit.html\"\n    err := filepath.Walk(root, walk)\n    if err != nil {\n        return\n    }\n}\n\nI am getting panic edit.html not found. Could anyone please guide me?", "output": "From the documentation of filepath.Walk you can read:\n\nfunc Walk(root string, walkFn WalkFunc) error\nWalk walks the file tree rooted at root, calling walkFn for each file or directory in the \n  tree, including root. All errors that arise visiting files and directories are filtered by \n  walkFn. The files are walked in lexical order, which makes the output deterministic but \n  means that for very large directories Walk can be inefficient.\n\nSo Walk expects a directory as first parameter. You're putting a file in there, which\nmakes the whole thing throw a panic.\nI'm not sure what you're attempting to do, but if you want to open that file, use os.Open or os.Stat if you want to test for existance.\nA general tip when coding in go: Use the gofmt command to format your code according to the style guidelines."}
{"instruction": "You are an expert Go language developer. Answer the following question clearly and accurately.", "input": "Title: What is the difference between Go's multithreading and pthread or Java Threads?\n\nQuestion:\nWhat is the difference between Go's multithreading approach and other approaches, such as pthread, boost::thread or Java Threads?", "output": "Quoted from Day 3 Tutorial <- read this for more information.\n\nGoroutines are multiplexed as needed\n  onto system threads. When a goroutine\n  executes a blocking system call, no\n  other goroutine is blocked.\nWe will do the same for CPU-bound\n  goroutines at some point, but for now,\n  if you want user-level parallelism you\n  must set $GOMAXPROCS. or call\n  runtime.GOMAXPROCS(n).\n\nA goroutine does not necessarily correspond to an OS thread. It can have smaller initial stack size and the stack will grow as needed. \nMultiple gorouitines may be multiplexed into a single thread when needed.\nMore importantly, the concept is as outlined above, that a goroutine is a sequential program that may block itself but does not block other goroutines.\nGoroutines is implemented as pthreads in gccgo, so it can be identical to OS thread, too.\nIt's separating the concept of OS thread and our thinking of multithreading when programming."}
